{"version":3,"file":"component---src-pages-editors-vm-tsx-2f22718c265227fa4119.js","mappings":"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","sources":["webpack://jacdac-docs/./node_modules/@material-ui/icons/BugReport.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/Cancel.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/Pause.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/PlayForWork.js","webpack://jacdac-docs/./jacdac-ts/src/vm/server.ts","webpack://jacdac-docs/./jacdac-ts/src/vm/client.ts","webpack://jacdac-docs/./jacdac-ts/src/vm/environment.ts","webpack://jacdac-docs/./jacdac-ts/src/vm/expr.ts","webpack://jacdac-docs/./jacdac-ts/src/vm/utils.ts","webpack://jacdac-docs/./jacdac-ts/src/vm/runner.ts","webpack://jacdac-docs/./src/components/vm/useVMRunner.ts","webpack://jacdac-docs/./src/components/vm/VMDiagnostics.tsx","webpack://jacdac-docs/./src/components/blockly/RoleChip.tsx","webpack://jacdac-docs/./src/components/blockly/BlockRoles.tsx","webpack://jacdac-docs/./src/components/vm/VMRunnerButtons.tsx","webpack://jacdac-docs/./src/components/vm/VMStartSimulatorButton.tsx","webpack://jacdac-docs/./src/components/vm/VMToolbar.tsx","webpack://jacdac-docs/./src/components/blockly/dsl/servicesdsl.ts","webpack://jacdac-docs/./src/components/blockly/dsl/serverservicesdsl.ts","webpack://jacdac-docs/./src/components/blockly/dsl/toolsdsl.ts","webpack://jacdac-docs/./src/components/blockly/dsl/loopsdsl.ts","webpack://jacdac-docs/./src/components/blockly/dsl/logicdsl.ts","webpack://jacdac-docs/./src/components/blockly/dsl/mathdsl.ts","webpack://jacdac-docs/./src/components/blockly/dsl/jsondsl.ts","webpack://jacdac-docs/./src/components/blockly/dsl/widgetdsl.ts","webpack://jacdac-docs/./src/components/vm/vmdsls.ts","webpack://jacdac-docs/./src/components/vm/VMEditor.tsx","webpack://jacdac-docs/./src/pages/editors/vm.tsx"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5c-.49 0-.96.06-1.41.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8zm-6 8h-4v-2h4v2zm0-4h-4v-2h4v2z\"\n}), 'BugReport');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z\"\n}), 'Cancel');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M6 19h4V5H6v14zm8-14v14h4V5h-4z\"\n}), 'Pause');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M11 5v5.59H7.5l4.5 4.5 4.5-4.5H13V5h-2zm-5 9c0 3.31 2.69 6 6 6s6-2.69 6-6h-2c0 2.21-1.79 4-4 4s-4-1.79-4-4H6z\"\n}), 'PlayForWork');\n\nexports.default = _default;","import {\n    isHighLevelRegister,\n    isHighLevelEvent,\n    isCommand,\n} from \"../../../jacdac-ts/src/jdom/spec\"\nimport { SMap } from \"../jdom/utils\"\nimport { jdpack, PackedValues } from \"../jdom/pack\"\nimport { atomic } from \"./utils\"\nimport { CHANGE } from \"../jdom/constants\"\nimport Packet from \"../jdom/packet\"\nimport { DecodedPacket } from \"../jdom/pretty\"\nimport JDRegisterServer from \"../jdom/registerserver\"\nimport { ExternalRequest } from \"./environment\"\nimport SensorServer from \"../servers/sensorserver\"\n\nexport const VM_EXTERNAL_REQUEST = \"vmExternalRequest\"\n\nclass VMRegisterServer extends JDRegisterServer<PackedValues> {\n    constructor(\n        private serviceServer: VMServiceServer,\n        private reg: jdspec.PacketInfo,\n        defaultValue?: PackedValues\n    ) {\n        super(serviceServer, reg.identifier, defaultValue)\n    }\n\n    async sendGetAsync() {\n        this.serviceServer.raiseGetRegisterEvent(this.reg.name)\n    }\n\n    async theRealSendGetAsync() {\n        await super.sendGetAsync()\n    }\n}\n\n// TODO: need to take specification into account and\n// TOOD: implement the proper base class (SensorServer)\nexport class VMServiceServer extends SensorServer<any[]> {\n    private eventNameToId: SMap<number> = {}\n    private regNameToId: SMap<number> = {}\n    private regFieldToId: SMap<number> = {}\n    private commandPackets: SMap<DecodedPacket> = {}\n    private cmdFieldToId: SMap<number> = {}\n\n    constructor(public role: string, private spec: jdspec.ServiceSpec) {\n        super(spec.classIdentifier, {\n            readingValues: [false],\n            streamingInterval: 50,\n        })\n        spec.packets.filter(isHighLevelRegister).map(reg => {\n            const regServer = this.addExistingRegister(\n                new VMRegisterServer(this, reg)\n            )\n            this.regNameToId[reg.name] = reg.identifier\n            reg.fields?.forEach((pkt, index) => {\n                this.regFieldToId[`${reg.name}:${pkt.name}`] = index\n            })\n            regServer.subscribe(CHANGE, () => {\n                this.emit(VM_EXTERNAL_REQUEST, <ExternalRequest>{\n                    kind: \"set\",\n                    role: this.role,\n                    tgt: reg.name,\n                })\n            })\n        })\n\n        spec.packets.filter(isCommand).map(cmd => {\n            this.addCommand(cmd.identifier, (pkt: Packet) => {\n                this.commandPackets[cmd.identifier] = pkt.decoded\n                this.emit(VM_EXTERNAL_REQUEST, <ExternalRequest>{\n                    kind: \"cmd\",\n                    role: this.role,\n                    tgt: cmd.name,\n                })\n            })\n            cmd.fields?.forEach((pkt, index) => {\n                this.regFieldToId[`${cmd.name}:${pkt.name}`] = index\n            })\n        })\n\n        spec.packets.filter(isHighLevelEvent).forEach(pkt => {\n            this.eventNameToId[pkt.name] = pkt.identifier\n        })\n    }\n\n    raiseGetRegisterEvent(regName: string) {\n        this.emit(VM_EXTERNAL_REQUEST, <ExternalRequest>{\n            kind: \"get\",\n            role: this.role,\n            tgt: regName,\n        })\n    }\n\n    async respondToGetRegisterEvent(regName: string) {\n        const reg = this.register(this.regNameToId[regName]) as VMRegisterServer\n        await reg.theRealSendGetAsync()\n    }\n\n    async sendEventNameAsync(eventName: string, values?: PackedValues) {\n        const pkt = this.spec.packets.find(\n            p => isHighLevelEvent(p) && p.name === eventName\n        )\n        if (pkt) {\n            await this.sendEvent(\n                this.eventNameToId[eventName],\n                jdpack(pkt.packFormat, values)\n            )\n        }\n    }\n\n    lookupRegister(root: string, fld: string) {\n        if (this.regNameToId[root]) {\n            const reg = this.register(this.regNameToId[root])\n            if (!fld) return reg.values()?.[0]\n            else {\n                return reg.values()?.[this.regFieldToId[`${root}:${fld}`]]\n            }\n        } else if (this.commandPackets[root]) {\n            const cmd = this.commandPackets[root]\n            return cmd.decoded?.[this.cmdFieldToId[`${root}:${fld}`]]?.value\n        }\n        return undefined\n    }\n\n    public writeRegister(root: string, ev: atomic[]) {\n        const reg = this.register(this.regNameToId[root])\n        reg.setValues(ev)\n    }\n}\n","import { isEvent, isRegister, isCommand, isIntensity } from \"../jdom/spec\"\nimport { JDServiceClient } from \"../jdom/serviceclient\"\nimport JDService from \"../jdom/service\"\nimport JDRegister from \"../jdom/register\"\nimport JDEvent from \"../jdom/event\"\nimport { CHANGE, EVENT, REPORT_UPDATE, SystemReg } from \"../jdom/constants\"\nimport { SMap } from \"../jdom/utils\"\nimport { jdpack, PackedValues } from \"../jdom/pack\"\nimport { atomic } from \"./utils\"\n\nexport class VMServiceClient extends JDServiceClient {\n    private _registers: SMap<JDRegister> = {}\n    private _reportUpdate: SMap<boolean> = {}\n    private _events: SMap<JDEvent> = {}\n\n    constructor(service: JDService) {\n        super(service)\n    }\n\n    public registerRegister(regName: string, handler: () => void) {\n        if (!this._registers[regName]) {\n            const pkt = this.service.specification.packets.find(\n                pkt => isRegister(pkt) && pkt.name === regName\n            )\n            if (pkt) {\n                const register = this.service.register(pkt.identifier)\n                this._registers[regName] = register\n                this.mount(register.subscribe(CHANGE, handler))\n            }\n        }\n    }\n\n    public registerEvent(eventName: string, handler: () => void) {\n        if (!this._events[eventName]) {\n            const pkt = this.service.specification.packets.find(\n                pkt => isEvent(pkt) && pkt.name === eventName\n            )\n            if (pkt) {\n                const event = this.service.event(pkt.identifier)\n                this._events[eventName] = event\n                this.mount(event.subscribe(EVENT, handler))\n            }\n        }\n    }\n\n    public async sendCommandAsync(commandName: string, values: PackedValues) {\n        const pkt = this.service.specification.packets.find(\n            p => isCommand(p) && p.name === commandName\n        )\n        if (pkt) {\n            await this.service.sendCmdAsync(\n                pkt.identifier,\n                jdpack(pkt.packFormat, values),\n                true\n            )\n        }\n    }\n\n    public async writeRegisterAsync(regName: string, values: atomic[]) {\n        const register = this._registers[regName]\n        if (register.code === SystemReg.Value) await this.setEnabled()\n        await this.writeRegAsync(this._registers[regName], values)\n    }\n\n    private async writeRegAsync(jdreg: JDRegister, values: atomic[]) {\n        await jdreg?.sendSetPackedAsync(\n            jdreg.specification?.packFormat,\n            values,\n            true\n        )\n    }\n\n    private async setEnabled() {\n        const pkt = this.service.specification.packets.find(isIntensity)\n        if (pkt && pkt.fields[0].type === \"bool\") {\n            const jdreg = this.service.register(SystemReg.Intensity)\n            await this.writeRegAsync(jdreg, [true])\n        }\n    }\n\n    public async lookupRegisterAsync(\n        root: string,\n        fld: string,\n        reportUpdate = false\n    ) {\n        if (root in this._registers) {\n            const register = this._registers[root]\n            if (reportUpdate && !this._reportUpdate[root]) {\n                this._reportUpdate[root] = true\n                this.mount(register.subscribe(REPORT_UPDATE, () => {}))\n            }\n            await register.refresh()\n            if (!fld) return register.unpackedValue?.[0]\n            else {\n                const field = register.fields.find(f => f.name === fld)\n                return field?.value\n            }\n        } else if (root in this._events) {\n            const field = this._events[root].fields?.find(f => f.name === fld)\n            return field?.value\n        }\n        return undefined\n    }\n}\n","import jsep from \"jsep\"\nimport { assert, SMap } from \"../jdom/utils\"\nimport JDService from \"../jdom/service\"\nimport JDEventSource from \"../jdom/eventsource\"\nimport { PackedValues } from \"../jdom/pack\"\nimport { serviceSpecificationFromClassIdentifier } from \"../jdom/spec\"\nimport { RoleRegister, RoleEvent } from \"./compile\"\nimport { VMEnvironmentInterface } from \"./runner\"\nimport { VMRole } from \"./ir\"\nimport { VMServiceServer, VM_EXTERNAL_REQUEST } from \"./server\"\nimport { VMServiceClient } from \"./client\"\nimport { atomic } from \"./utils\"\n\nexport const GLOBAL_CHANGE = \"vmEnvGlobalChange\"\nexport const REGISTER_CHANGE = \"vmEnvRegisterChange\"\nexport const EXTERNAL_REQUEST = \"vmEnvEventChange\"\n\nexport interface ExternalRequest {\n    kind: \"event\" | \"get\" | \"set\" | \"cmd\"\n    role: string\n    tgt: string\n}\n\nexport enum VMExceptionCode {\n    RoleNoService = \"vmEnvRoleNoService\",\n    TypeMismatch = \"vmEnvTypeMismatch\",\n    InternalError = \"vmInternalError\",\n}\n\nexport class VMException extends Error {\n    constructor(readonly code: VMExceptionCode, readonly data: string) {\n        super()\n    }\n}\n\nexport interface GlobalVariable {\n    type: \"number\" | \"boolean\" | \"string\"\n    value: atomic\n}\n\nexport class VMEnvironment\n    extends JDEventSource\n    implements VMEnvironmentInterface\n{\n    private _currentRequest: ExternalRequest = undefined\n    private _clientEnvs: SMap<VMServiceClient> = {}\n    private _serverEnvs: SMap<VMServiceServer> = {}\n    private _globals: SMap<GlobalVariable> = {}\n\n    constructor(\n        private registers: RoleRegister[],\n        private events: RoleEvent[],\n        private serverRoles: VMRole[]\n    ) {\n        super()\n        this.setupServers()\n    }\n\n    private setupServers() {\n        this.serverRoles.forEach(p => {\n            // get the service\n            const service = serviceSpecificationFromClassIdentifier(\n                p.serviceClass\n            )\n            if (service) {\n                // spin up JDServiceServer\n                const serviceServer = new VMServiceServer(p.role, service)\n                this._serverEnvs[p.role] = serviceServer\n                serviceServer.subscribe(\n                    VM_EXTERNAL_REQUEST,\n                    (p: ExternalRequest) => {\n                        this._currentRequest = p\n                        this.emit(EXTERNAL_REQUEST, p)\n                    }\n                )\n            }\n        })\n    }\n\n    public globals() {\n        return this._globals\n    }\n\n    public servers() {\n        return Object.keys(this._serverEnvs).map(k => {\n            return {\n                role: k,\n                serviceClass: this._serverEnvs[k].serviceClass,\n                server: this._serverEnvs[k],\n            }\n        })\n    }\n\n    public serviceChanged(role: string, service: JDService) {\n        if (this._clientEnvs[role]) {\n            this._clientEnvs[role].unmount()\n            this._clientEnvs[role] = undefined\n        }\n        if (!service) this._rolesUnbound.push(role)\n        else {\n            this._rolesBound.push(role)\n            this._clientEnvs[role] = new VMServiceClient(service)\n            this.registers.forEach(r => {\n                if (r.role === role) {\n                    this.registerRegister(role, r.register)\n                }\n            })\n            this.events.forEach(e => {\n                if (e.role === role) {\n                    this.registerEvent(role, e.event)\n                }\n            })\n        }\n    }\n\n    public roleBound(role: string) {\n        return !!this._clientEnvs[role]\n    }\n\n    public registerRegister(role: string, reg: string) {\n        const serviceEnv = this.getService(role)\n        serviceEnv.registerRegister(reg, () => {\n            this.emit(REGISTER_CHANGE, reg)\n        })\n    }\n\n    public registerEvent(role: string, tgt: string) {\n        const serviceEnv = this.getService(role)\n        serviceEnv.registerEvent(tgt, () => {\n            this._currentRequest = { kind: \"event\", role, tgt }\n            this.emit(EXTERNAL_REQUEST, this._currentRequest)\n        })\n    }\n\n    private getRootName(e: jsep.MemberExpression | string) {\n        if (!e) return undefined\n        if (typeof e === \"string\") return e\n        if (e.type === \"MemberExpression\")\n            return (e.object as jsep.Identifier).name\n        return undefined\n    }\n\n    private getService(e: jsep.MemberExpression | string) {\n        const root = this.getRootName(e)\n        if (!root) return undefined\n        const s = this._clientEnvs[root]\n        return s\n    }\n\n    private getServer(e: jsep.MemberExpression | string) {\n        const root = this.getRootName(e)\n        if (!root) return undefined\n        const s = this._serverEnvs[root]\n        return s\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    public async sendCommandAsync(\n        e: jsep.MemberExpression,\n        values: PackedValues\n    ) {\n        const serviceEnv = this.getService(e)\n        if (serviceEnv) {\n            await serviceEnv?.sendCommandAsync(\n                (e.property as jsep.Identifier).name,\n                values\n            )\n        } else {\n            const server = this.getServer(e)\n            await server?.sendEventNameAsync(\n                (e.property as jsep.Identifier).name,\n                values\n            )\n        }\n    }\n\n    public async lookupAsync(\n        e: jsep.MemberExpression | string,\n        reportUpdate = false\n    ) {\n        const roleName = this.getRootName(e)\n        if (roleName.startsWith(\"$var\")) {\n            const me = e as jsep.MemberExpression\n            if (me.property.type === \"Identifier\") {\n                const local = (me.property as jsep.Identifier).name\n                return this._globals[local]?.value\n            }\n            return undefined\n        }\n        const ep = (e as jsep.MemberExpression).property as\n            | jsep.Identifier\n            | jsep.MemberExpression\n        const root =\n            typeof ep === \"string\"\n                ? ep\n                : ep.type === \"Identifier\"\n                ? ep.name\n                : (ep.object as jsep.Identifier).name\n        const fld =\n            typeof ep === \"string\"\n                ? undefined\n                : ep.type === \"Identifier\"\n                ? undefined\n                : (ep.property as jsep.Identifier).name\n        const serviceEnv = this.getService(e)\n        if (serviceEnv) {\n            return await serviceEnv.lookupRegisterAsync(root, fld, reportUpdate)\n        } else {\n            const server = this.getServer(e)\n            return server.lookupRegister(root, fld)\n        }\n    }\n\n    public async writeRegisterAsync(\n        e: jsep.MemberExpression | string,\n        values: atomic[]\n    ) {\n        const serviceEnv = this.getService(e)\n        const me = e as jsep.MemberExpression\n        if (me.property.type === \"Identifier\") {\n            const reg = (me.property as jsep.Identifier).name\n            if (serviceEnv) await serviceEnv.writeRegisterAsync(reg, values)\n            else {\n                const server = this.getServer(e)\n                return server.writeRegister(reg, values)\n            }\n        }\n    }\n\n    public writeGlobal(\n        e: jsep.MemberExpression | string,\n        value: string | boolean | number\n    ) {\n        const roleName = this.getRootName(e)\n        if (!roleName || !roleName.startsWith(\"$var\")) return undefined\n        const me = e as jsep.MemberExpression\n        if (me.property.type === \"Identifier\") {\n            const local = (me.property as jsep.Identifier).name\n            if (this._globals[local]) {\n                const firstType = this._globals[local].type\n                if (firstType !== typeof value) {\n                    throw new VMException(\n                        VMExceptionCode.TypeMismatch,\n                        `variable ${local} has first type ${firstType}; trying to assign ${value.toString()}`\n                    )\n                }\n                if (value !== this._globals[local].value) {\n                    this._globals[local].value = value\n                    this.emit(GLOBAL_CHANGE)\n                }\n            } else {\n                const firstType = typeof value\n                if (\n                    firstType !== \"string\" &&\n                    firstType !== \"boolean\" &&\n                    firstType !== \"number\"\n                ) {\n                    throw new VMException(\n                        VMExceptionCode.TypeMismatch,\n                        `Value of type ${firstType} not supported`\n                    )\n                }\n                this._globals[local] = { type: firstType, value }\n                this.emit(GLOBAL_CHANGE)\n            }\n            return true\n        }\n        return false\n    }\n\n    public clearExternalStimulii() {\n        this._currentRequest = undefined\n        this.rolesReset()\n    }\n\n    public hasRequest(e: jsep.MemberExpression | string): ExternalRequest {\n        const roleName = this.getRootName(e)\n        const me = e as jsep.MemberExpression\n        if (me.property.type === \"Identifier\") {\n            const op = (me.property as jsep.Identifier).name\n            if (\n                this._currentRequest?.role === roleName &&\n                this._currentRequest?.tgt === op\n            )\n                return this._currentRequest\n        }\n        return undefined\n    }\n\n    public async completeRequest(request: ExternalRequest) {\n        assert(request.kind === \"get\")\n        const server = this.getServer(request.role)\n        await server.respondToGetRegisterEvent(request.tgt)\n    }\n\n    // role events\n    private _rolesBound: string[] = []\n    private _rolesUnbound: string[] = []\n    private rolesReset() {\n        this._rolesBound = []\n        this._rolesUnbound = []\n    }\n    public initRoles() {\n        this._rolesBound = Object.keys(this._clientEnvs).slice(0)\n    }\n    public roleTransition(role: string, event: string): boolean {\n        if (event === \"bound\") {\n            return !!this._rolesBound.find(r => role === \"any\" || r === role)\n        } else {\n            return !!this._rolesUnbound.find(r => role === \"any\" || r === role)\n        }\n    }\n\n    public unsubscribe() {\n        for (const vs of Object.values(this._clientEnvs)) {\n            vs.unmount()\n        }\n    }\n}\n","import jsep from \"jsep\"\n\nexport type GetValue = (\n    e: jsep.MemberExpression | string,\n    reportUpdate: boolean\n) => any\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type StartMap = { e: jsep.Expression; v: any }[]\n\nexport type CallEvaluator = (\n    ce: jsep.CallExpression,\n    ee: VMExprEvaluator\n) => any\n\nexport function unparse(e: jsep.Expression): string {\n    switch (e.type) {\n        case \"ArrayExpression\": {\n            const ae = e as jsep.ArrayExpression\n            return `[${ae.elements.map(unparse).join(\", \")}]`\n        }\n        case \"CallExpression\": {\n            const caller = e as jsep.CallExpression\n            return `${unparse(caller.callee)}(${caller.arguments\n                .map(unparse)\n                .join(\", \")})`\n        }\n        case \"MemberExpression\": {\n            const root = e as jsep.MemberExpression\n            return root.computed\n                ? `${unparse(root.object)}[${unparse(root.property)}]`\n                : `${unparse(root.object)}.${unparse(root.property)}`\n        }\n        case \"BinaryExpression\": {\n            const be = e as any\n            return `(${unparse(be.left)} ${be.operator} ${unparse(be.right)})`\n        }\n        case \"UnaryExpression\": {\n            const ue = e as jsep.UnaryExpression\n            return `${ue.operator}${unparse(ue.argument)}`\n        }\n        case \"Identifier\": {\n            return (e as jsep.Identifier).name\n        }\n        case \"Literal\": {\n            return (e as jsep.Literal).raw\n        }\n        default:\n            return \"TODO\"\n    }\n}\n\nexport class VMExprEvaluator {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    private exprStack: any[] = []\n    private reportUpdate = false\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    constructor(private env: GetValue, private callEval: CallEvaluator) {}\n\n    public tos() {\n        return this.exprStack[this.exprStack.length - 1]\n    }\n\n    public pop() {\n        return this.exprStack.pop()\n    }\n\n    public async evalAsync(e: jsep.Expression, reportUpdate = false) {\n        this.exprStack = []\n        this.reportUpdate = reportUpdate\n        await this.visitExpressionAsync(e)\n        return this.exprStack.pop()\n    }\n\n    public async visitExpressionAsync(e: jsep.Expression) {\n        switch (e.type) {\n            case \"ArrayExpression\": {\n                // nothing to do here yet (only used for event function)\n                break\n            }\n\n            case \"CallExpression\": {\n                if (this.callEval) {\n                    const ret = this.callEval(<jsep.CallExpression>e, this)\n                    this.exprStack.push(ret)\n                } else this.exprStack.push(undefined)\n                break\n            }\n\n            case \"BinaryExpression\": {\n                const be = <jsep.BinaryExpression>e\n                if (be.operator === \"&&\" || be.operator === \"||\") {\n                    await this.visitExpressionAsync(be.left)\n                    switch (be.operator) {\n                        case \"||\":\n                            if (this.tos()) return\n                            else await this.visitExpressionAsync(be.right)\n                            return\n                        case \"&&\":\n                            if (!this.tos()) return\n                            else await this.visitExpressionAsync(be.right)\n                            return\n                    }\n                }\n                await this.visitExpressionAsync(be.left)\n                await this.visitExpressionAsync(be.right)\n                const right = this.exprStack.pop()\n                const left = this.exprStack.pop()\n                switch (be.operator) {\n                    case \"+\":\n                        this.exprStack.push(left + right)\n                        return\n                    case \"-\":\n                        this.exprStack.push(left - right)\n                        return\n                    case \"/\":\n                        this.exprStack.push(left / right)\n                        return\n                    case \"*\":\n                        this.exprStack.push(left * right)\n                        return\n                    case \"%\":\n                        this.exprStack.push(left % right)\n                        return\n                    case \">>\":\n                        this.exprStack.push(left >> right)\n                        return\n                    case \">>>\":\n                        this.exprStack.push(left >>> right)\n                        return\n                    case \"<<\":\n                        this.exprStack.push(left << right)\n                        return\n                    case \"|\":\n                        this.exprStack.push(left | right)\n                        return\n                    case \"&\":\n                        this.exprStack.push(left & right)\n                        return\n                    case \"^\":\n                        this.exprStack.push(left ^ right)\n                        return\n                    case \"==\":\n                        this.exprStack.push(left == right)\n                        return\n                    case \"!=\":\n                        this.exprStack.push(left != right)\n                        return\n                    case \"===\":\n                        this.exprStack.push(left === right)\n                        return\n                    case \"!==\":\n                        this.exprStack.push(left !== right)\n                        return\n                    case \"<\":\n                        this.exprStack.push(left < right)\n                        return\n                    case \">\":\n                        this.exprStack.push(left > right)\n                        return\n                    case \"<=\":\n                        this.exprStack.push(left <= right)\n                        return\n                    case \">=\":\n                        this.exprStack.push(left >= right)\n                        return\n                }\n                break\n            }\n\n            case \"UnaryExpression\": {\n                const ue = <jsep.UnaryExpression>e\n                await this.visitExpressionAsync(ue.argument)\n                const top = this.exprStack.pop()\n                switch (ue.operator) {\n                    case \"ABS\":\n                        this.exprStack.push(Math.abs(top))\n                        return\n                    case \"!\":\n                        this.exprStack.push(!top)\n                        return\n                    case \"~\":\n                        this.exprStack.push(~top)\n                        return\n                    case \"-\":\n                        this.exprStack.push(-top)\n                        return\n                    case \"+\":\n                        this.exprStack.push(+top)\n                        return\n                }\n                break\n            }\n\n            case \"MemberExpression\": {\n                // for now, we don't support evaluation of obj or prop\n                // of obj.prop\n                const val = await this.env(\n                    e as jsep.MemberExpression,\n                    this.reportUpdate\n                )\n                //if (val === undefined) {\n                //    throw new VMError(VMCode.InternalError, `lookup of ${unparse(e)} failed`)\n                //}\n                this.exprStack.push(val)\n                return\n            }\n            case \"Identifier\": {\n                const id = <jsep.Identifier>e\n                const val = await this.env(id.name, this.reportUpdate)\n                // if (val === undefined)\n                //    throw new VMError(VMCode.InternalError, `lookup of ${id.name} failed`)\n                this.exprStack.push(val)\n                return\n            }\n            case \"Literal\": {\n                const lit = <jsep.Literal>e\n                this.exprStack.push(lit.value)\n                return\n            }\n            default:\n        }\n    }\n}\n","export type atomic = string | boolean | number\n\nexport class Mutex {\n    private promises: (() => Promise<any>)[] = []\n    private shift() {\n        this.promises.shift()\n        if (this.promises[0]) this.promises[0]()\n    }\n    acquire<T>(f: () => Promise<T>): Promise<T> {\n        return new Promise<T>((resolve, reject) => {\n            this.promises.push(() =>\n                f().then(\n                    v => {\n                        this.shift()\n                        resolve(v)\n                    },\n                    e => {\n                        this.shift()\n                        reject(e)\n                    }\n                )\n            )\n            if (this.promises.length == 1) this.promises[0]()\n        })\n    }\n}\n","import jsep from \"jsep\"\nimport { VMProgram, VMHandler, VMCommand, VMRole } from \"./ir\"\nimport RoleManager from \"../jdom/rolemanager\"\nimport {\n    VMEnvironment,\n    VMException,\n    VMExceptionCode,\n    GLOBAL_CHANGE,\n    REGISTER_CHANGE,\n    EXTERNAL_REQUEST,\n    ExternalRequest,\n} from \"./environment\"\nimport { VMExprEvaluator, unparse, CallEvaluator } from \"./expr\"\nimport JDEventSource from \"../jdom/eventsource\"\nimport {\n    CHANGE,\n    ROLE_BOUND,\n    ROLE_UNBOUND,\n    SERVICE_PROVIDER_REMOVED,\n    TRACE,\n} from \"../jdom/constants\"\nimport { checkProgram, compileProgram } from \"./compile\"\nimport {\n    VM_GLOBAL_CHANGE,\n    VM_COMMAND_FAILED,\n    VM_WATCH_CHANGE,\n    VM_BREAKPOINT,\n    VM_INTERNAL_ERROR,\n    VM_LOG_ENTRY,\n    VM_ROLE_MISSING,\n} from \"./events\"\nimport { Mutex, atomic } from \"./utils\"\nimport { assert, SMap } from \"../jdom/utils\"\nimport { JDClient } from \"../jdom/client\"\nimport JDServiceProvider from \"../jdom/serviceprovider\"\nimport JDDevice from \"../jdom/device\"\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type VMTraceContext = any\n\nenum VMInternalStatus {\n    Ready = \"ready\", // the pc is at this instruction, but pre-condition not met\n    Enabled = \"enabled\", // the instruction pre-conditions are met (is this needed?)\n    Running = \"running\", // the instruction has started running (may need retries)\n    Sleeping = \"sleep\", // waiting to be woken by timer\n    Completed = \"completed\", // the instruction completed successfully\n    Stopped = \"stopped\", // halt instruction encountered, handler stopped\n}\n\nconst VM_WAKE_SLEEPER = \"vmWakeSleeper\"\n\nexport interface VMEnvironmentInterface {\n    writeRegisterAsync: (\n        e: jsep.MemberExpression | string,\n        v: atomic[]\n    ) => Promise<void>\n    sendCommandAsync: (\n        command: jsep.MemberExpression,\n        values: atomic[]\n    ) => Promise<void>\n    lookupAsync: (\n        e: jsep.MemberExpression | string,\n        reportUpdate: boolean\n    ) => Promise<atomic>\n    writeGlobal: (e: jsep.MemberExpression | string, v: atomic) => boolean\n    hasRequest: (e: jsep.MemberExpression | string) => ExternalRequest\n    roleTransition: (role: string, direction: string) => boolean\n    roleBound: (role: string) => boolean\n}\n\nclass VMJumpException extends Error {\n    constructor(public label: string) {\n        super()\n    }\n}\n\nclass VMTimerException extends Error {\n    constructor(public ms: number) {\n        super()\n    }\n}\n\nclass VMRequestException extends Error {\n    constructor(public request: ExternalRequest) {\n        super()\n    }\n}\n\nclass VMCommandEvaluator {\n    private _regSaved: number = undefined\n    private _changeSaved: number = undefined\n    private _started = false\n    constructor(\n        public parent: VMCommandRunner,\n        private readonly env: VMEnvironmentInterface,\n        private readonly cmd: VMCommand\n    ) {}\n\n    trace(msg: string, context: VMTraceContext = {}) {\n        this.parent.trace(msg, { command: this.cmd.command.type, ...context })\n    }\n\n    private get inst() {\n        return (this.cmd.command.callee as jsep.Identifier)?.name\n    }\n\n    private callEval(): CallEvaluator {\n        return (caller: jsep.CallExpression, ee: VMExprEvaluator) => {\n            const callee = <jsep.MemberExpression>caller.callee\n            const namespace = (callee.object as jsep.Identifier).name\n            const funName = (callee.property as jsep.Identifier).name\n            const args = caller.arguments\n            if (namespace === \"$fun\") {\n                switch (funName) {\n                    case \"roleBoundExpression\": {\n                        const role = (args[0] as jsep.Identifier).name\n                        return this.env.roleBound(role)\n                    }\n                    default: // ERROR\n                }\n                throw new VMException(\n                    VMExceptionCode.InternalError,\n                    `unknown function ${namespace}.${funName}`\n                )\n            } else\n                throw new VMException(\n                    VMExceptionCode.InternalError,\n                    `unknown namespace ${namespace}`\n                )\n        }\n    }\n\n    private newEval() {\n        return new VMExprEvaluator(\n            async (e, reportUpdate) =>\n                await this.env.lookupAsync(e, reportUpdate),\n            this.callEval()\n        )\n    }\n\n    private async evalExpressionAsync(\n        e: jsep.Expression,\n        reportUpdate = false\n    ) {\n        const expr = this.newEval()\n        return await expr.evalAsync(e, reportUpdate)\n    }\n\n    private async checkExpressionAsync(\n        e: jsep.Expression,\n        reportUpdate = false\n    ) {\n        return (await this.evalExpressionAsync(e, reportUpdate)) ? true : false\n    }\n\n    private async startAsync() {\n        if (\n            this.cmd.command.callee.type !== \"MemberExpression\" &&\n            (this.inst === \"awaitRegister\" || this.inst === \"awaitChange\")\n        ) {\n            // need to capture register value for awaitChange/awaitRegister\n            const args = this.cmd.command.arguments\n            this._regSaved = await this.evalExpressionAsync(args[0], true)\n            if (this.inst === \"awaitChange\")\n                this._changeSaved = await this.evalExpressionAsync(args[1])\n            return true\n        }\n        return false\n    }\n\n    public async evaluate(): Promise<VMInternalStatus> {\n        if (!this._started) {\n            const neededStart = await this.startAsync()\n            this._started = true\n            if (neededStart) return VMInternalStatus.Running\n        }\n        const args = this.cmd.command.arguments\n        if (this.cmd.command.callee.type === \"MemberExpression\") {\n            // interpret as a service command (role.comand)\n            const expr = this.newEval()\n            const values: atomic[] = []\n            for (const a of this.cmd.command.arguments) {\n                values.push(await expr.evalAsync(a))\n            }\n            await this.env.sendCommandAsync(\n                this.cmd.command.callee as jsep.MemberExpression,\n                values\n            )\n            return VMInternalStatus.Completed\n        }\n        switch (this.inst) {\n            case \"branchOnCondition\": {\n                const expr = await this.checkExpressionAsync(args[0])\n                if (expr) {\n                    throw new VMJumpException((args[1] as jsep.Identifier).name)\n                }\n                return VMInternalStatus.Completed\n            }\n            case \"jump\": {\n                throw new VMJumpException((args[0] as jsep.Identifier).name)\n            }\n            case \"label\": {\n                return VMInternalStatus.Completed\n            }\n            case \"awaitEvent\": {\n                const event = args[0] as jsep.MemberExpression\n                const request = this.env.hasRequest(event)\n                if (request) {\n                    if (await this.checkExpressionAsync(args[1])) {\n                        throw new VMRequestException(request)\n                    }\n                }\n                return VMInternalStatus.Running\n            }\n            case \"roleBound\": {\n                const role = (args[0] as jsep.Identifier).name\n                const event = (args[1] as jsep.Identifier).name\n                return this.env.roleTransition(role, event)\n                    ? VMInternalStatus.Completed\n                    : VMInternalStatus.Running\n            }\n            case \"awaitCondition\": {\n                return (await this.checkExpressionAsync(args[0]))\n                    ? VMInternalStatus.Completed\n                    : VMInternalStatus.Running\n            }\n            case \"awaitChange\":\n            case \"awaitRegister\": {\n                const regValue = await this.evalExpressionAsync(args[0])\n                if (\n                    (this.inst === \"awaitRegister\" &&\n                        regValue !== this._regSaved) ||\n                    (this.inst === \"awaitChange\" &&\n                        Math.abs(regValue - this._regSaved) >=\n                            Math.abs(this._changeSaved))\n                ) {\n                    return VMInternalStatus.Completed\n                }\n                return VMInternalStatus.Running\n            }\n            case \"writeRegister\":\n            case \"writeLocal\": {\n                const expr = this.newEval()\n                const values: atomic[] = []\n                for (const a of this.cmd.command.arguments.slice(1)) {\n                    values.push(await expr.evalAsync(a))\n                }\n                this.trace(\"eval-end\", { expr: unparse(args[1]) })\n                const reg = args[0] as jsep.MemberExpression\n                if (this.inst === \"writeRegister\") {\n                    await this.env.writeRegisterAsync(reg, values)\n                    this.trace(\"write-after-wait\", {\n                        reg: unparse(reg),\n                        expr: values[0],\n                    })\n                } else this.env.writeGlobal(reg, values[0])\n                return VMInternalStatus.Completed\n            }\n            case \"watch\": {\n                const expr = this.newEval()\n                const ev = await expr.evalAsync(args[0])\n                this.parent.watch(this.cmd?.sourceId, ev)\n                return VMInternalStatus.Completed\n            }\n            case \"log\": {\n                const expr = this.newEval()\n                const ev = await expr.evalAsync(args[0])\n                const evString = ev + \"\"\n                this.parent.writeLog(this.cmd?.sourceId, evString)\n                return VMInternalStatus.Completed\n            }\n            case \"halt\": {\n                return VMInternalStatus.Stopped\n            }\n            case \"nop\": {\n                return VMInternalStatus.Completed\n            }\n            case \"wait\": {\n                const expr = this.newEval()\n                const ev = await expr.evalAsync(args[0])\n                throw new VMTimerException(ev * 1000)\n            }\n            default:\n                throw new VMException(\n                    VMExceptionCode.InternalError,\n                    `Unknown instruction ${this.inst}`\n                )\n        }\n    }\n}\n\nclass VMCommandRunner {\n    private _eval: VMCommandEvaluator\n    private _status: VMInternalStatus = VMInternalStatus.Running\n    constructor(\n        public readonly parent: VMHandlerRunner,\n        private handlerId: number,\n        env: VMEnvironment,\n        public cmd: VMCommand\n    ) {\n        this._eval = new VMCommandEvaluator(this, env, cmd)\n    }\n\n    trace(msg: string, context: VMTraceContext = {}) {\n        this.parent.trace(msg, { handler: this.handlerId, ...context })\n    }\n\n    watch(id: string, val: any) {\n        this.parent.watch(id, val)\n    }\n\n    writeLog(id: string, val: any) {\n        this.parent.writeLog(id, val)\n    }\n\n    get status() {\n        return this._status\n    }\n\n    set status(s: VMInternalStatus) {\n        this._status = s\n    }\n\n    async stepAsync() {\n        if (this.status === VMInternalStatus.Running) {\n            this.trace(unparse(this.cmd.command))\n            this.status = await this._eval.evaluate()\n        }\n    }\n}\n\nclass VMHandlerRunner extends JDEventSource {\n    private _commandIndex: number = undefined\n    private _currentCommand: VMCommandRunner = undefined\n    private stopped = false\n    private _labelToIndex: SMap<number> = {}\n\n    constructor(\n        public readonly parent: VMProgramRunner,\n        public readonly id: number,\n        public readonly env: VMEnvironment,\n        public readonly handler: VMHandler\n    ) {\n        super()\n        // find the label commands (targets of jumps)\n        this.handler.commands.forEach((c, index) => {\n            const cmd = c as VMCommand\n            const id = cmd.command?.callee as jsep.Identifier\n            if (id?.name === \"label\") {\n                const label = cmd.command.arguments[0] as jsep.Identifier\n                this._labelToIndex[label.name] = index\n            }\n        })\n        this.reset()\n    }\n\n    trace(msg: string, context: VMTraceContext = {}) {\n        this.parent.trace(msg, { id: this.id, ...context })\n    }\n\n    watch(id: string, val: any) {\n        this.parent.watch(id, val)\n    }\n\n    writeLog(id: string, val: any) {\n        this.parent.writeLog(id, val)\n    }\n\n    get status() {\n        return this.stopped\n            ? VMInternalStatus.Stopped\n            : this._commandIndex === undefined\n            ? VMInternalStatus.Ready\n            : this._currentCommand.status === VMInternalStatus.Completed &&\n              this._commandIndex < this.handler.commands.length - 1\n            ? VMInternalStatus.Running\n            : this._currentCommand.status\n    }\n\n    get command() {\n        return this._currentCommand\n    }\n\n    get atTop() {\n        return (\n            this.status === VMInternalStatus.Running && this._commandIndex === 0\n        )\n    }\n\n    gotoTop() {\n        if (\n            this.status === VMInternalStatus.Ready &&\n            this.handler.commands.length\n        )\n            this.commandIndex = 0\n    }\n\n    reset() {\n        this.commandIndex = undefined\n        this.stopped = false\n    }\n\n    wake() {\n        if (this._currentCommand) {\n            this._currentCommand.status = VMInternalStatus.Completed\n            this.next()\n        }\n    }\n\n    // run-to-completion semantics\n    // returns command if breakpoint encountered when not single stepping\n    async runToCompletionAsync(singleStep = false) {\n        if (this.stopped || !this.handler.commands.length) return undefined\n        if (this.commandIndex === undefined) {\n            this.commandIndex = 0\n        }\n        if ((await this.singleStepCheckBreakAsync(singleStep)) && !singleStep)\n            return this._currentCommand\n        while (this.next()) {\n            if (singleStep || (await this.singleStepCheckBreakAsync()))\n                return this._currentCommand\n        }\n        return undefined\n    }\n\n    private next() {\n        if (\n            this._currentCommand.status === VMInternalStatus.Completed &&\n            this.commandIndex < this.handler.commands.length - 1\n        ) {\n            this.commandIndex++\n            return true\n        }\n        return false\n    }\n\n    private getCommand() {\n        const cmd = this.handler.commands[this._commandIndex]\n        if (cmd.type === \"ite\") {\n            throw new VMException(\n                VMExceptionCode.InternalError,\n                \"ite not compiled away\"\n            )\n        }\n        return cmd as VMCommand\n    }\n\n    private async singleStepCheckBreakAsync(singleStep = false) {\n        this.trace(\"step begin\")\n        const sid = this._currentCommand.cmd?.sourceId\n        if (!singleStep && (await this.parent.breakpointOnAsync(sid))) {\n            return true\n        }\n        await this.singleStepAsync()\n        this.trace(\"step end\")\n        return false\n    }\n\n    private async singleStepAsync() {\n        try {\n            await this._currentCommand.stepAsync()\n        } catch (e) {\n            if (e instanceof VMJumpException) {\n                const { label } = e as VMJumpException\n                const index = this._labelToIndex[label]\n                this.commandIndex = index\n                this._currentCommand.status = VMInternalStatus.Completed\n            } else if (e instanceof VMTimerException) {\n                const { ms } = e as VMTimerException\n                this._currentCommand.status = VMInternalStatus.Sleeping\n                await this.parent.sleepAsync(this, ms)\n            } else if (e instanceof VMRequestException) {\n                const { request } = e as VMRequestException\n                this._currentCommand.status = VMInternalStatus.Completed\n                this.parent.handlerWokeOnRequest(this, request)\n            } else {\n                this.emit(VM_COMMAND_FAILED, this._currentCommand.cmd.sourceId)\n                throw e\n            }\n        }\n        if (this._currentCommand.status === VMInternalStatus.Stopped)\n            this.stopped = true\n    }\n\n    private set commandIndex(index: number) {\n        if (index === undefined) {\n            this._commandIndex = undefined\n            this._currentCommand = undefined\n        } else if (index !== this._commandIndex) {\n            this._commandIndex = index\n            this._currentCommand = new VMCommandRunner(\n                this,\n                this.id,\n                this.env,\n                this.getCommand()\n            )\n        }\n    }\n\n    private get commandIndex() {\n        return this._commandIndex\n    }\n}\n\nexport type WatchValueType = boolean | string | number\n\ninterface SleepingHandler {\n    ms: number\n    handlerRunner: VMHandlerRunner\n    handler?: VMHandler\n    id: NodeJS.Timeout\n}\n\nfunction isEveryHandler(h: VMHandler) {\n    assert(!!h)\n    if (h.commands.length) {\n        const cmd = (h.commands[0] as VMCommand).command\n            .callee as jsep.Identifier\n        return cmd.name === \"wait\"\n    }\n    return false\n}\n\nfunction isRegisterChangeHandler(h: VMHandler) {\n    assert(!!h)\n    if (h.commands.length) {\n        const cmd = (h.commands[0] as VMCommand).command\n            .callee as jsep.Identifier\n        return cmd.name === \"awaitChange\" || cmd.name === \"awaitRegister\"\n    }\n    return false\n}\n\nexport enum VMStatus {\n    Stopped = \"stopped\",\n    Running = \"running\",\n    Paused = \"paused\",\n}\n\nconst MAX_LOG = 100\n\nexport class VMProgramRunner extends JDClient {\n    // program, environment\n    private _handlerRunners: VMHandlerRunner[] = []\n    private _env: VMEnvironment\n    private _roles: VMRole[] = []\n    private _serverRoles: VMRole[] = []\n    // running\n    private _status: VMStatus\n    private _waitQueue: VMHandlerRunner[] = []\n    private _everyQueue: VMHandlerRunner[] = []\n    private _runQueue: VMHandlerRunner[] = []\n    private _waitRunMutex: Mutex\n    private _sleepQueue: SleepingHandler[] = []\n    private _sleepMutex: Mutex\n    // debugging\n    private _watch: SMap<any> = {}\n    private _log: { text: string; count: number }[] = []\n    private _breaks: SMap<boolean> = {}\n    private _breaksMutex: Mutex\n    // providing new services\n    private _provider: JDServiceProvider\n    private _device: JDDevice\n    private _onCompletionOfExternalRequest: {\n        handler: VMHandlerRunner\n        request: ExternalRequest\n    }[] = []\n\n    constructor(\n        readonly roleManager: RoleManager,\n        readonly program: VMProgram\n    ) {\n        super()\n\n        const compiled = compileProgram(program)\n        const { registers, events, errors } = checkProgram(compiled)\n        this._roles = compiled.roles\n        this._serverRoles = compiled.serverRoles\n        if (errors?.length) console.debug(\"ERRORS\", errors)\n\n        // data structures for running program\n        this._status = VMStatus.Stopped\n        this._env = new VMEnvironment(registers, events, compiled.serverRoles)\n        this._handlerRunners = compiled.handlers.map(\n            (h, index) => new VMHandlerRunner(this, index, this._env, h)\n        )\n\n        // TODO: can't add multiple handlers until we have deduplicate CHANGE on Event\n        /*\n        const len = this._handlerRunners.length\n        compiled.handlers.forEach((h, index) =>\n            this._handlerRunners.push(\n                new VMHandlerRunner(this, len + index, this._env, h)\n            )\n        )*/\n\n        this._waitRunMutex = new Mutex()\n        this._breaksMutex = new Mutex()\n        this._sleepMutex = new Mutex()\n        // TODO: only try to wake handlers that are waiting on change to reg or event\n        this.mount(\n            this._env.subscribe(REGISTER_CHANGE, (reg: string) => {\n                this.waitingToRunning()\n            })\n        )\n        this.mount(\n            this.roleManager.bus.subscribe(\n                SERVICE_PROVIDER_REMOVED,\n                (provider: JDServiceProvider) => {\n                    if (provider === this._provider) {\n                        this._provider = undefined\n                    }\n                }\n            )\n        )\n        // control requests (client:{event}, server:{set, get, cmd})\n        this.mount(\n            this._env.subscribe(\n                EXTERNAL_REQUEST,\n                (request: ExternalRequest) => {\n                    switch (request.kind) {\n                        case \"get\": {\n                            // TODO: in this case, if there is a handler\n                            // waiting on this Request then the function\n                            // handlerWokeOnRequest will be invoked. If\n                            // it is not then we should just return the\n                            // current value of register\n                            break\n                        }\n                        // these handler invocations are \"fire and forget\"\n                        case \"set\":\n                        case \"cmd\":\n                        case \"event\":\n                            break\n                    }\n                    this.waitingToRunning()\n                }\n            )\n        )\n        this.mount(\n            this._env.subscribe(GLOBAL_CHANGE, name => {\n                this.emit(VM_GLOBAL_CHANGE, name)\n                this.waitingToRunning()\n            })\n        )\n        this.mount(\n            this.subscribe(\n                VM_WAKE_SLEEPER,\n                async (h: VMHandlerRunner | VMHandler) => {\n                    await this.wakeSleeper(h)\n                }\n            )\n        )\n        this.initializeRoleManagement()\n    }\n\n    public handlerWokeOnRequest(\n        handler: VMHandlerRunner,\n        request: ExternalRequest\n    ) {\n        if (request.kind === \"get\") {\n            this._onCompletionOfExternalRequest.push({ handler, request })\n        }\n    }\n\n    // control of VM\n    get status() {\n        return this._status\n    }\n\n    get logData() {\n        return this._log.slice(0)\n    }\n\n    globals(): { name: string; value: atomic }[] {\n        const g = this._env.globals()\n        return Object.keys(g).map(k => {\n            return { name: k, value: g[k].value }\n        })\n    }\n\n    private setStatus(s: VMStatus) {\n        if (s !== this._status) {\n            this._status = s\n            this.emit(CHANGE)\n        }\n    }\n\n    // debugging\n    trace(message: string, context: VMTraceContext = {}) {\n        this.emit(TRACE, { message, context })\n    }\n\n    watch(sourceId: string, value: WatchValueType) {\n        this._watch[sourceId] = value\n        this.emit(VM_WATCH_CHANGE, sourceId)\n    }\n\n    writeLog(sourceId: string, value: WatchValueType) {\n        const s = value + \"\"\n        const last = this._log[this._log.length - 1]\n        if (last?.text === s) last.count++\n        else this._log.push({ text: value + \"\", count: 1 })\n        while (this._log.length > MAX_LOG) this._log.shift()\n        this.emit(VM_LOG_ENTRY, sourceId)\n    }\n\n    lookupWatch(sourceId: string) {\n        return this._watch[sourceId]\n    }\n\n    async setBreakpointsAsync(breaks: string[]) {\n        await this._breaksMutex.acquire(async () => {\n            this._breaks = {}\n            breaks.forEach(b => {\n                this._breaks[b] = true\n            })\n        })\n    }\n\n    async clearBreakpointsAsync() {\n        await this._breaksMutex.acquire(async () => {\n            this._breaks = {}\n        })\n    }\n\n    async breakpointOnAsync(id: string) {\n        let ret = false\n        await this._breaksMutex.acquire(async () => {\n            ret = !!this._breaks?.[id]\n        })\n        return ret\n    }\n\n    // utility called by handlerRunner\n    async sleepAsync(\n        h: VMHandlerRunner,\n        ms: number,\n        handler: VMHandler = undefined\n    ) {\n        assert(h.status === VMInternalStatus.Sleeping)\n        await this._sleepMutex.acquire(async () => {\n            const id = setTimeout(() => {\n                this.emit(VM_WAKE_SLEEPER, h ? h : handler)\n            }, ms)\n            this._sleepQueue.push({ ms, handlerRunner: h, id, handler })\n        })\n    }\n\n    async startAsync() {\n        if (this.status !== VMStatus.Stopped) return // already running\n        this.trace(\"start\")\n        try {\n            await this._waitRunMutex.acquire(async () => {\n                await this.device()\n                this._waitQueue = this._handlerRunners.slice(0)\n                this._waitQueue.forEach(h => h.reset())\n                this._runQueue = []\n                this._everyQueue = []\n                this._onCompletionOfExternalRequest = []\n                this._env.clearExternalStimulii()\n                this._env.initRoles()\n                this.stopSleepers()\n                // make sure to have another handler for every\n                /*\n                for (const h of this._waitQueue) {\n                    if (isEveryHandler(h.handler)) {\n                        const dup = new VMHandlerRunner(\n                            this,\n                            undefined,\n                            this._env,\n                            h.handler\n                        )\n                        dup.reset()\n                        this._everyQueue.push(dup)\n                    }\n                }*/\n            })\n            await this.clearBreakpointsAsync()\n            this.setStatus(VMStatus.Running)\n            await this.waitingToRunning()\n        } catch (e) {\n            console.debug(e)\n            this.emit(VM_INTERNAL_ERROR, e)\n        }\n    }\n\n    async device() {\n        if (!this._provider) {\n            await this.startProvider()\n        }\n        return this._device\n    }\n\n    cancel() {\n        if (this.status === VMStatus.Stopped) return // nothing to cancel\n        this.setStatus(VMStatus.Stopped)\n        this.trace(\"cancelled\")\n    }\n\n    async resumeAsync() {\n        if (this.status !== VMStatus.Paused) return\n        this.trace(\"resume\")\n        this.setStatus(VMStatus.Running)\n        await this.runAsync()\n    }\n\n    private async getCurrentRunner() {\n        return await this._waitRunMutex.acquire(async () => {\n            if (this._runQueue.length) return this._runQueue[0]\n            return undefined\n        })\n    }\n\n    async stepAsync() {\n        if (this.status !== VMStatus.Paused) return\n        this.trace(\"step\")\n        const h = await this.getCurrentRunner()\n        if (h) {\n            await this.runHandlerAsync(h, true)\n            await this.postProcessHandler(h)\n            const newHead = await this.getCurrentRunner()\n            if (newHead && newHead !== h) {\n                this.emitBreakpoint(newHead)\n            }\n        }\n    }\n\n    private _in_run = false\n    private async runAsync() {\n        if (this.status === VMStatus.Stopped) return\n        if (this._in_run) return\n        this.trace(\"run\")\n        this._in_run = true\n        try {\n            let h: VMHandlerRunner = undefined\n            while (\n                this.status === VMStatus.Running &&\n                (h = await this.getCurrentRunner())\n            ) {\n                assert(!h.atTop)\n                await this.runHandlerAsync(h)\n                await this.postProcessHandler(h)\n            }\n        } catch (e) {\n            console.debug(e)\n            this.emit(VM_INTERNAL_ERROR, e)\n        }\n        this._in_run = false\n        this.trace(\"run end\")\n    }\n\n    private emitBreakpoint(h: VMHandlerRunner) {\n        this.emit(\n            VM_BREAKPOINT,\n            h,\n            h.status === VMInternalStatus.Completed\n                ? \"\"\n                : h.command.cmd?.sourceId\n        )\n    }\n\n    private async runHandlerAsync(h: VMHandlerRunner, oneStep = false) {\n        try {\n            const brkCommand = await h.runToCompletionAsync(oneStep)\n            if ((brkCommand && !oneStep) || this.status === VMStatus.Paused) {\n                this.setStatus(VMStatus.Paused)\n                this.emitBreakpoint(h)\n            }\n            if (h.status === VMInternalStatus.Completed) {\n                h.reset()\n            }\n        } catch (e) {\n            if (e instanceof VMException) {\n                const ex = e as VMException\n                if (ex.code === VMExceptionCode.RoleNoService)\n                    this.emit(VM_ROLE_MISSING, (e as VMException).data)\n            } else {\n                console.debug(e)\n                this.emit(VM_INTERNAL_ERROR, e)\n            }\n            // on handler error, reset the handler\n            h.reset()\n        }\n    }\n\n    private async postProcessHandler(h: VMHandlerRunner) {\n        if (\n            h.status === VMInternalStatus.Ready ||\n            h.status === VMInternalStatus.Sleeping ||\n            h.status === VMInternalStatus.Stopped\n        ) {\n            let done: VMHandlerRunner = undefined\n            await this._waitRunMutex.acquire(async () => {\n                assert(!!this._runQueue.length)\n                assert(h === this._runQueue[0])\n                done = this._runQueue.shift()\n                const moveToWait = h.status === VMInternalStatus.Ready\n                if (moveToWait && !isEveryHandler(h.handler)) {\n                    this._waitQueue.push(done)\n                    done = undefined\n                }\n            })\n            if (\n                (done &&\n                    h.status === VMInternalStatus.Ready &&\n                    isEveryHandler(h.handler)) ||\n                isRegisterChangeHandler(h.handler)\n            ) {\n                if (this.status === VMStatus.Running)\n                    await this.runHandlerAsync(h)\n                else if (this.status === VMStatus.Paused) {\n                    await this._waitRunMutex.acquire(async () => {\n                        this._runQueue.unshift(h)\n                        // this.emitBreakpoint(h)\n                    })\n                }\n            }\n        } else if (h.status === VMInternalStatus.Completed) {\n            const q = this._onCompletionOfExternalRequest\n            const index = q.findIndex(p => p.handler === h)\n            if (index > -1) {\n                const [del] = q.splice(index, 1)\n                await this._env.completeRequest(del.request)\n            }\n        }\n    }\n\n    // call this whenever some event/change arises\n    private async waitingToRunning() {\n        if (this.status !== VMStatus.Stopped) {\n            this.trace(\"waiting to running - try\")\n            await this._waitRunMutex.acquire(async () => {\n                if (this.status === VMStatus.Paused && this._runQueue.length)\n                    return\n                this.trace(\"waiting to running - start\")\n                const handlersStarted: VMHandler[] = []\n                const newRunners: VMHandlerRunner[] = []\n                const sleepingRunners: VMHandlerRunner[] = []\n                for (const h of this._waitQueue) {\n                    await this.runHandlerAsync(h, true)\n                    if (h.status === VMInternalStatus.Sleeping) {\n                        sleepingRunners.push(h)\n                    } else if (\n                        !h.atTop &&\n                        handlersStarted.findIndex(hs => hs === h.handler) === -1\n                    ) {\n                        newRunners.push(h)\n                        handlersStarted.push(h.handler)\n                    }\n                }\n                newRunners.forEach(h => {\n                    this._runQueue.push(h)\n                    const index = this._waitQueue.indexOf(h)\n                    if (index >= 0) this._waitQueue.splice(index, 1)\n                })\n                sleepingRunners.forEach(h => {\n                    const index = this._waitQueue.indexOf(h)\n                    if (index >= 0) this._waitQueue.splice(index, 1)\n                })\n            })\n            await this.runAsync()\n            this._env.clearExternalStimulii()\n        }\n    }\n\n    private async stopSleepers() {\n        await this._sleepMutex.acquire(async () => {\n            for (const s of this._sleepQueue) {\n                clearTimeout(s.id)\n            }\n            this._sleepQueue = []\n        })\n    }\n\n    private async wakeSleeper(h: VMHandlerRunner | VMHandler) {\n        try {\n            // let handlerMs: number = undefined\n            let handlerRunner: VMHandlerRunner = undefined\n            // let handler: VMHandler = undefined\n            await this._sleepMutex.acquire(async () => {\n                const index = this._sleepQueue.findIndex(\n                    p => p?.handlerRunner === h // || p?.handler === h\n                )\n                assert(index >= 0)\n                if (index >= 0) {\n                    const p = this._sleepQueue[index]\n                    //  handlerMs = p.ms\n                    handlerRunner = p.handlerRunner\n                    // handler = p?.handler\n                    this._sleepQueue.splice(index, 1)\n                    // clearTimeout(p.id)\n                }\n            })\n            if (this.status === VMStatus.Stopped) return\n            // this logic is to deal with starting a handler rather than a runner\n            await this._waitRunMutex.acquire(async () => {\n                /*\n                if (!handlerRunner && isEveryHandler(handler)) {\n                    const index = this._everyQueue.findIndex(\n                        h => h.handler === handler\n                    )\n                    if (index >= 0) {\n                        handlerRunner = this._everyQueue[index]\n                        this._everyQueue.splice(index, 1)\n                        handlerRunner.gotoTop()\n                    }\n                }*/\n                if (handlerRunner) {\n                    // transition to the run queue\n                    handlerRunner.wake()\n                    this._runQueue.push(handlerRunner)\n                }\n            })\n            /*\n            const theHandler = handlerRunner?.handler || handler\n            if (isEveryHandler(theHandler)) {\n                // setup next\n                this.sleepAsync(undefined, handlerMs, theHandler)\n            }*/\n            if (handlerRunner) {\n                if (this.status === VMStatus.Running) {\n                    this.trace(\"wake sleeper run\")\n                    this.runAsync()\n                } else if (this.status === VMStatus.Paused) {\n                    this.emitBreakpoint(await this.getCurrentRunner())\n                }\n            }\n        } catch (e) {\n            console.debug(e)\n            this.emit(VM_INTERNAL_ERROR, e)\n        }\n    }\n\n    private initializeRoleManagement() {\n        // adding a (role,service) binding\n        const addRoleService = (role: string) => {\n            const service = this.roleManager.service(role)\n            if (service) {\n                this._env.serviceChanged(role, service)\n            }\n        }\n        // initialize client\n        this._roles.forEach(r => {\n            addRoleService(r.role)\n        })\n        this.mount(\n            this.roleManager.subscribe(ROLE_BOUND, async (role: string) => {\n                if (this._serverRoles.find(r => r.role === role)) return\n                addRoleService(role)\n                this.waitingToRunning()\n            })\n        )\n        this.mount(\n            this.roleManager.subscribe(ROLE_UNBOUND, (role: string) => {\n                if (this._serverRoles.find(r => r.role === role)) return\n                this._env.serviceChanged(role, undefined)\n                this.waitingToRunning()\n            })\n        )\n    }\n\n    // spin up provider\n    private async startProvider() {\n        const servers = this._env.servers()\n        if (servers.length) {\n            this._provider = new JDServiceProvider(\n                servers.map(s => s.server)\n                // if we create a deviceId, then trouble ensues\n                // as a second device gets spun up later\n                //{\n                //    deviceId: \"VMServiceProvider\",\n                //}\n            )\n            this._device = this.roleManager.bus.addServiceProvider(\n                this._provider\n            )\n            servers.forEach((s, index) => {\n                this.roleManager.updateRole(\n                    this._serverRoles[index].role,\n                    s.serviceClass,\n                    this._device.deviceId\n                )\n            })\n            // make sure it gets known (HACK)\n            for (const s of servers) {\n                await s.server.statusCode.sendGetAsync()\n            }\n        }\n    }\n\n    public unmount() {\n        console.log(\"VMProgram (unmount)\")\n        super.unmount()\n        if (this._provider) {\n            this.roleManager.bus.removeServiceProvider(this._provider)\n        }\n    }\n}\n","import { useContext, useEffect, useState } from \"react\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport { VMProgram } from \"../../../jacdac-ts/src/vm/ir\"\nimport {\n    VMProgramRunner,\n    VMTraceContext,\n} from \"../../../jacdac-ts/src/vm/runner\"\nimport AppContext from \"../AppContext\"\nimport { ERROR, TRACE } from \"../../../jacdac-ts/src/jdom/constants\"\nimport Flags from \"../../../jacdac-ts/src/jdom/flags\"\nimport RoleManager from \"../../../jacdac-ts/src/jdom/rolemanager\"\n\nexport default function useVMRunner(\n    roleManager: RoleManager,\n    program: VMProgram,\n    autoRun: boolean\n) {\n    const { setError } = useContext(AppContext)\n    const [runner, setRunner] = useState<VMProgramRunner>()\n    const [_autoStart, _setAutoStart] = useState<boolean>(!!autoRun)\n\n    const run = async () => {\n        _setAutoStart(!!autoRun)\n        await runner.startAsync()\n    }\n    const cancel = async () => {\n        _setAutoStart(false)\n        runner.cancel()\n    }\n\n    // auto start\n    useEffect(() => {\n        if (_autoStart && runner) runner.startAsync()\n        return () => runner?.cancel()\n    }, [runner, _autoStart])\n\n    // create runner\n    useEffect(() => {\n        try {\n            const newTestRunner =\n                program && new VMProgramRunner(roleManager, program)\n            setRunner(newTestRunner)\n\n            return () => newTestRunner?.unmount()\n        } catch (e) {\n            console.debug(e)\n            setRunner(undefined)\n        }\n    }, [roleManager, program])\n\n    // errors\n    useEffect(() => runner?.subscribe(ERROR, e => setError(e)), [runner])\n    // traces\n    const handleTrace = (value: {\n        message: string\n        context: VMTraceContext\n    }) => {\n        const { message, context } = value\n        if (Flags.diagnostics) console.debug(`vm> ${message}`, context)\n    }\n    useEffect(\n        () =>\n            runner?.subscribe<{ message: string; context: VMTraceContext }>(\n                TRACE,\n                handleTrace\n            ),\n        [runner]\n    )\n\n    return { runner, run, cancel }\n}\n","import { Grid, Typography } from \"@material-ui/core\"\nimport React from \"react\"\nimport { VMProgram } from \"../../../jacdac-ts/src/vm/ir\"\nimport CodeBlock from \"../CodeBlock\"\n\nexport default function VMDiagnostics(props: { program: VMProgram }) {\n    const { program } = props\n    return (\n        <Grid item xs={12}>\n            <Typography variant=\"subtitle1\">VM</Typography>\n            <CodeBlock\n                className=\"json\"\n                downloadName={\"test.json.vm\"}\n                downloadText={JSON.stringify(program, null, 2)}\n            >\n                {JSON.stringify(program, null, 2)}\n            </CodeBlock>\n        </Grid>\n    )\n}\n","import React, { useContext } from \"react\"\nimport BlockContext from \"./BlockContext\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport DeviceAvatar from \"../devices/DeviceAvatar\"\nimport { serviceSpecificationFromClassIdentifier } from \"../../../jacdac-ts/src/jdom/spec\"\nimport JDService from \"../../../jacdac-ts/src/jdom/service\"\nimport {\n    addServiceProvider,\n    serviceProviderDefinitionFromServiceClass,\n} from \"../../../jacdac-ts/src/servers/servers\"\n\nimport { BlockSvg, FieldVariable } from \"blockly\"\nimport useServiceServer from \"../hooks/useServiceServer\"\nimport CancelIcon from \"@material-ui/icons/Cancel\"\nimport { Chip, Tooltip } from \"@material-ui/core\"\nimport { TWIN_BLOCK } from \"./toolbox\"\n\nexport default function RoleChip(props: {\n    role: string\n    serviceClass: number\n    service: JDService\n    preferredDeviceId: string\n}) {\n    const { workspace } = useContext(BlockContext)\n    const { role, service, serviceClass, preferredDeviceId } = props\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const serviceServer = useServiceServer(service)\n    const handleRoleClick = () => {\n        // spin off simulator\n        if (!service && !preferredDeviceId ) {\n            const specification =\n                serviceSpecificationFromClassIdentifier(serviceClass)\n            if (specification) {\n                addServiceProvider(\n                    bus,\n                    serviceProviderDefinitionFromServiceClass(\n                        specification.classIdentifier\n                    )\n                )\n            }\n        }\n        // add twin block\n        if (workspace) {\n            // try to find existing twin block\n            let twinBlock = workspace\n                .getTopBlocks(false)\n                .find(\n                    b =>\n                        b.type === TWIN_BLOCK &&\n                        (\n                            b.inputList[0].fieldRow.find(\n                                f => f.name === \"role\"\n                            ) as FieldVariable\n                        )?.getVariable()?.name === role\n                ) as BlockSvg\n            if (!twinBlock) {\n                twinBlock = workspace.newBlock(TWIN_BLOCK) as BlockSvg\n                let variable = workspace.getVariable(\n                    role,\n                    `${serviceClass}:client`\n                )\n                if (!variable)\n                    variable = workspace.getVariable(\n                        role,\n                        `${serviceClass}:server`\n                )\n                console.log(`new twin`, { twinBlock, variable })\n                const field = twinBlock.inputList[0].fieldRow.find(\n                    f => f.name === \"role\"\n                ) as FieldVariable\n                field.setValue(variable.getId())\n                const m = workspace.getMetrics()\n                twinBlock.moveBy(m.viewWidth / 2, m.viewHeight / 3)\n                twinBlock.initSvg()\n                twinBlock.render(false)\n            }\n            workspace.centerOnBlock(twinBlock.id)\n        }\n    }\n\n    const handleDelete = () => bus.removeServiceProvider(serviceServer.device)\n    return (\n        <Chip\n            label={role}\n            variant={service ? \"default\" : \"outlined\"}\n            avatar={service && <DeviceAvatar device={service.device} />}\n            onClick={handleRoleClick}\n            onDelete={serviceServer ? handleDelete : undefined}\n            deleteIcon={\n                <Tooltip title=\"stop simulator\">\n                    <CancelIcon />\n                </Tooltip>\n            }\n        />\n    )\n}\n","import React, { useContext } from \"react\"\nimport useChange from \"../../jacdac/useChange\"\nimport BlockContext from \"./BlockContext\"\nimport { Grid } from \"@material-ui/core\"\nimport RoleChip from \"./RoleChip\"\n\nexport default function BlockClientRoles() {\n    const { roleManager } = useContext(BlockContext)\n    const roles = useChange(roleManager, _ => _?.roles())\n\n    return (\n        <>\n            {roles?.map(({ role, service, serviceClass, preferredDeviceId }) => (\n                <Grid item key={role}>\n                    <RoleChip\n                        role={role}\n                        service={service}\n                        serviceClass={serviceClass}\n                        preferredDeviceId={preferredDeviceId}\n                    />\n                </Grid>\n            ))}\n        </>\n    )\n}\n","import React, { useContext, useEffect, useMemo, useState } from \"react\"\nimport useChange from \"../../jacdac/useChange\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport { VMProgramRunner, VMStatus } from \"../../../jacdac-ts/src/vm/runner\"\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\"\nimport StopIcon from \"@material-ui/icons/Stop\"\nimport IconButtonWithTooltip from \"../ui/IconButtonWithTooltip\"\nimport { Chip, Grid } from \"@material-ui/core\"\nimport PauseIcon from \"@material-ui/icons/Pause\"\nimport { arrayConcatMany } from \"../../../jacdac-ts/src/jdom/utils\"\nimport { VM_BREAKPOINT } from \"../../../jacdac-ts/src/vm/events\"\nimport { VMHandler, VMProgram } from \"../../../jacdac-ts/src/vm/ir\"\nimport PlayForWorkIcon from \"@material-ui/icons/PlayForWork\"\nimport useMounted from \"../hooks/useMounted\"\nimport IconButtonWithProgress from \"../ui/IconButtonWithProgress\"\nimport BugReportIcon from \"@material-ui/icons/BugReport\"\nimport BlockContext from \"../blockly/BlockContext\"\n\nfunction useWorkspaceBreakpoints(program: VMProgram) {\n    const { workspace } = useContext(BlockContext)\n    const breakpoints = useMemo(\n        () =>\n            arrayConcatMany(\n                program?.handlers\n                    ?.filter(h => !h.meta) // don't debug watch statements\n                    .map(h => h.commands.map(cmd => cmd.sourceId))\n            )?.filter(id => !!id) || [],\n        [program]\n    )\n    const setBreakpointHighlight = (sourceId: string) => {\n        workspace?.highlightBlock(sourceId)\n    }\n\n    return {\n        breakpoints,\n        setBreakpointHighlight,\n    }\n}\n\nexport default function VMRunnerButtons(props: {\n    runner: VMProgramRunner\n    run: () => Promise<void>\n    cancel: () => Promise<void>\n}) {\n    const { runner, run, cancel } = props\n    const status = useChange(runner, t => t?.status)\n    const stopped = !status || status === VMStatus.Stopped\n    const program = runner?.program\n    const [indeterminate, setIndeterminate] = useState(false)\n    const [breakpoint, setBreakpoint] = useState<string>(undefined)\n    const pausing = breakpoint === \"\"\n    const paused = !!breakpoint?.length\n    const mounted = useMounted()\n    const disabled = indeterminate || !runner\n    const { breakpoints, setBreakpointHighlight } =\n        useWorkspaceBreakpoints(program)\n\n    //console.log(\"runner status\", status)\n\n    const handleRun = async () => {\n        try {\n            setIndeterminate(true)\n            setBreakpoint(undefined)\n            await run()\n        } finally {\n            if (mounted()) setIndeterminate(false)\n        }\n    }\n    const handleCancel = async () => {\n        try {\n            setIndeterminate(true)\n            await runner.clearBreakpointsAsync()\n            setBreakpoint(undefined)\n            await cancel()\n        } finally {\n            if (mounted()) setIndeterminate(false)\n        }\n    }\n    const handleResume = async () => {\n        try {\n            setIndeterminate(true)\n            setBreakpoint(undefined)\n            await runner.clearBreakpointsAsync()\n            await runner.resumeAsync()\n        } finally {\n            if (mounted()) setIndeterminate(false)\n        }\n    }\n    const handlePause = async () => {\n        try {\n            setIndeterminate(true)\n            await runner.setBreakpointsAsync(breakpoints)\n            await runner.resumeAsync()\n            setBreakpoint(\"\")\n        } finally {\n            if (mounted()) setIndeterminate(false)\n        }\n    }\n    const handleStep = () => runner.stepAsync()\n\n    // register breakpoint handler\n    useEffect(\n        () =>\n            runner?.subscribe(\n                VM_BREAKPOINT,\n                (_: VMHandler, sourceId?: string) => {\n                    if (mounted()) setBreakpoint(sourceId)\n                }\n            ),\n        [runner]\n    )\n\n    // setting blockly breakpoint\n    useEffect(() => {\n        setBreakpointHighlight(breakpoint)\n        return () => setBreakpointHighlight(undefined)\n    }, [breakpoint])\n\n    // reset breakpoint in ui when runner, paused mode changes\n    useEffect(() => setBreakpoint(undefined), [runner])\n\n    return (\n        <>\n            <Grid item>\n                <IconButtonWithTooltip\n                    title={paused ? \"resume\" : stopped ? \"start\" : \"stop\"}\n                    disabled={disabled}\n                    color={stopped ? \"primary\" : \"default\"}\n                    onClick={\n                        paused\n                            ? handleResume\n                            : stopped\n                            ? handleRun\n                            : handleCancel\n                    }\n                >\n                    {paused || stopped ? <PlayArrowIcon /> : <StopIcon />}\n                </IconButtonWithTooltip>{\" \"}\n            </Grid>\n            <Grid item>\n                <IconButtonWithProgress\n                    title={pausing ? \"cancel pause\" : paused ? \"step\" : \"pause\"}\n                    disabled={disabled}\n                    indeterminate={pausing}\n                    onClick={\n                        pausing\n                            ? handleResume\n                            : paused\n                            ? handleStep\n                            : handlePause\n                    }\n                >\n                    {paused ? <PlayForWorkIcon /> : <PauseIcon />}\n                </IconButtonWithProgress>\n            </Grid>\n            {(pausing || paused) && (\n                <Grid item>\n                    <Chip\n                        icon={<BugReportIcon />}\n                        label={pausing ? \"pausing\" : \"paused\"}\n                        color={\"secondary\"}\n                    />\n                </Grid>\n            )}\n        </>\n    )\n}\n","import React from \"react\"\nimport IconButtonWithTooltip from \"../ui/IconButtonWithTooltip\"\nimport AddIcon from \"@material-ui/icons/Add\"\nimport { useContext } from \"react\"\nimport AppContext from \"../AppContext\"\n\nexport default function VMStartSimulatorButton() {\n    const { toggleShowDeviceHostsDialog } = useContext(AppContext)\n    return (\n        <IconButtonWithTooltip\n            title=\"start simulator\"\n            onClick={toggleShowDeviceHostsDialog}\n        >\n            <AddIcon />\n        </IconButtonWithTooltip>\n    )\n}\n","import { Grid } from \"@material-ui/core\"\nimport React from \"react\"\nimport { VMProgramRunner } from \"../../../jacdac-ts/src/vm/runner\"\nimport BlockClientRoles from \"../blockly/BlockRoles\"\nimport VMRunnerButtons from \"./VMRunnerButtons\"\nimport VMStartSimulatorButton from \"./VMStartSimulatorButton\"\n\nexport default function VMToolbar(props: {\n    runner: VMProgramRunner\n    run: () => Promise<void>\n    cancel: () => Promise<void>\n}) {\n    const { runner, run, cancel } = props\n    return (\n        <Grid\n            container\n            direction=\"row\"\n            spacing={1}\n            alignItems=\"center\"\n            alignContent=\"center\"\n        >\n            <VMRunnerButtons runner={runner} run={run} cancel={cancel} />\n            <Grid item>\n                <VMStartSimulatorButton />\n            </Grid>\n            <BlockClientRoles />\n        </Grid>\n    )\n}\n","import {\n    SRV_HID_KEYBOARD,\n    SRV_LED,\n    SRV_LED_MATRIX,\n    SRV_SEVEN_SEGMENT_DISPLAY,\n} from \"../../../../jacdac-ts/src/jdom/constants\"\nimport type { DataRecordWindowRequest } from \"../../../workers/data/dist/node_modules/data.worker\"\n\nimport KeyboardKeyField from \"../fields/KeyboardKeyField\"\nimport LEDColorField from \"../fields/LEDColorField\"\nimport LEDMatrixField from \"../fields/LEDMatrixField\"\nimport {\n    BlockDefinition,\n    BlockReference,\n    CategoryDefinition,\n    CODE_STATEMENT_TYPE,\n    CommandBlockDefinition,\n    CustomBlockDefinition,\n    DATA_SCIENCE_STATEMENT_TYPE,\n    EventBlockDefinition,\n    identityTransformData,\n    InputDefinition,\n    NumberInputDefinition,\n    OptionsInputDefinition,\n    toolsColour,\n    TWIN_BLOCK,\n    ValueInputDefinition,\n    VariableInputDefinition,\n} from \"../toolbox\"\nimport BlockDomainSpecificLanguage, {\n    CreateBlocksOptions,\n    CreateCategoryOptions,\n} from \"./dsl\"\nimport JDomTreeField from \"../fields/JDomTreeField\"\nimport TwinField from \"../fields/TwinField\"\nimport {\n    createServiceColor,\n    fieldsToFieldInputs,\n    fieldsToMessage,\n    fieldsToValues,\n    getServiceInfo,\n    roleVariable,\n    serviceHelp,\n    ServicesBaseDSL,\n    toRoleType,\n} from \"./servicesbase\"\nimport { humanify } from \"../../../../jacdac-ts/jacdac-spec/spectool/jdspec\"\nimport { Block } from \"blockly\"\nimport postTransformData from \"./workers/data.proxy\"\n\nconst SET_STATUS_LIGHT_BLOCK = \"jacdac_set_status_light\"\nconst ROLE_BOUND_EVENT_BLOCK = \"jacdac_role_bound_event\"\nconst ROLE_BOUND_BLOCK = \"jacdac_role_bound\"\nconst RECORD_WINDOW_BLOCK = \"jacdac_record_window\"\nconst INSPECT_BLOCK = \"jacdac_tools_inspect\"\nconst commandColor = \"#8c6a1d\"\n\nexport class ServicesBlockDomainSpecificLanguage\n    extends ServicesBaseDSL\n    implements BlockDomainSpecificLanguage\n{\n    id = \"jacdacServices\"\n    // generic role blocks\n    private _roleBlocks: BlockDefinition[]\n\n    createBlocks(options: CreateBlocksOptions) {\n        const { theme } = options\n        this.serviceColor = createServiceColor(theme)\n\n        // pure service information here\n        const {\n            allServices,\n            supportedServices,\n            registers,\n            events,\n            commands,\n            registerSimpleTypes,\n            registerComposites,\n            registerSimpleEnumTypes,\n            registerCompositeEnumTypes,\n        } = getServiceInfo()\n\n        const resolveService = (cls: number): jdspec.ServiceSpec[] =>\n            allServices.filter(srv => srv.classIdentifier === cls)\n\n        const customClientBlockDefinitions: CustomBlockDefinition[] = [\n            ...resolveService(SRV_HID_KEYBOARD).map(\n                service =>\n                    <CustomBlockDefinition>{\n                        kind: \"block\",\n                        type: `key`,\n                        message0: `%1 %2 key %3`,\n                        args0: [\n                            roleVariable(service),\n                            <OptionsInputDefinition>{\n                                type: \"field_dropdown\",\n                                name: \"action\",\n                                options: [\n                                    [\"press\", \"press\"],\n                                    [\"down\", \"down\"],\n                                    [\"up\", \"up\"],\n                                ],\n                            },\n                            {\n                                type: KeyboardKeyField.KEY,\n                                name: \"combo\",\n                            },\n                        ],\n                        colour: this.serviceColor(service),\n                        inputsInline: true,\n                        previousStatement: CODE_STATEMENT_TYPE,\n                        nextStatement: CODE_STATEMENT_TYPE,\n                        tooltip: `Send a keyboard key combo`,\n                        helpUrl: serviceHelp(service),\n                        service,\n                        expression: `role.key(combo.selectors, combo.modifiers, action)`,\n                        template: \"custom\",\n                    }\n            ),\n            ...resolveService(SRV_LED).map(\n                service =>\n                    <CustomBlockDefinition>{\n                        kind: \"block\",\n                        type: `fade`,\n                        message0: `fade %1 to %2 at speed %3`,\n                        args0: [\n                            roleVariable(service),\n                            {\n                                type: \"input_value\",\n                                name: \"color\",\n                                check: \"Number\",\n                            },\n                            {\n                                type: \"input_value\",\n                                name: \"speed\",\n                                check: \"Number\",\n                            },\n                        ],\n                        values: {\n                            color: {\n                                kind: \"block\",\n                                type: LEDColorField.SHADOW.type,\n                            },\n                            speed: {\n                                kind: \"block\",\n                                type: \"jacdac_ratio\",\n                            },\n                        },\n                        colour: this.serviceColor(service),\n                        inputsInline: true,\n                        previousStatement: CODE_STATEMENT_TYPE,\n                        nextStatement: CODE_STATEMENT_TYPE,\n                        tooltip: `Fade LED color`,\n                        helpUrl: serviceHelp(service),\n                        service,\n                        expression: `role.animate((color >> 16) & 0xff, (color >> 8) & 0xff, (color >> 0) & 0xff, speed * 0xff)`,\n                        template: \"custom\",\n                    }\n            ),\n            ...resolveService(SRV_SEVEN_SEGMENT_DISPLAY).map(\n                service =>\n                    <CustomBlockDefinition>{\n                        kind: \"block\",\n                        type: `set_digits`,\n                        message0: `set %1 digits to %2`,\n                        args0: [\n                            roleVariable(service),\n                            {\n                                type: \"input_value\",\n                                name: \"digits\",\n                                check: \"Number\",\n                            },\n                        ],\n                        values: {\n                            digits: {\n                                kind: \"block\",\n                                type: \"math_number\",\n                            },\n                        },\n                        colour: this.serviceColor(service),\n                        inputsInline: true,\n                        previousStatement: CODE_STATEMENT_TYPE,\n                        nextStatement: CODE_STATEMENT_TYPE,\n                        tooltip: `Display a number of the screen`,\n                        helpUrl: serviceHelp(service),\n                        service,\n                        template: \"custom\",\n                    }\n            ),\n            ...resolveService(SRV_LED_MATRIX).map(\n                service =>\n                    <CustomBlockDefinition>{\n                        kind: \"block\",\n                        type: `show_leds`,\n                        message0: `show %1 leds %2`,\n                        args0: [\n                            roleVariable(service),\n                            {\n                                type: LEDMatrixField.KEY,\n                                name: \"leds\",\n                            },\n                        ],\n                        colour: this.serviceColor(service),\n                        inputsInline: true,\n                        previousStatement: CODE_STATEMENT_TYPE,\n                        nextStatement: CODE_STATEMENT_TYPE,\n                        tooltip: `Display LEDs on the LED matrix`,\n                        helpUrl: serviceHelp(service),\n                        service,\n                        // encode digits\n                        template: \"custom\",\n                    }\n            ),\n        ].map(def => {\n            def.type = `jacdac_custom_${def.service.shortId.toLowerCase()}_${\n                def.type\n            }`\n            return def\n        })\n\n        const eventClientBlocks = events.map<EventBlockDefinition>(\n            ({ service, events }) => ({\n                kind: \"block\",\n                type: `jacdac_events_${service.shortId}`,\n                message0: `on %1 %2`,\n                args0: [\n                    roleVariable(service),\n                    <InputDefinition>{\n                        type: \"field_dropdown\",\n                        name: \"event\",\n                        options: events.map(event => [\n                            humanify(event.name),\n                            event.name,\n                        ]),\n                    },\n                ],\n                colour: this.serviceColor(service),\n                inputsInline: true,\n                nextStatement: CODE_STATEMENT_TYPE,\n                tooltip: `Events for the ${service.name} service`,\n                helpUrl: serviceHelp(service),\n                service,\n                events,\n                template: \"event\",\n            })\n        )\n\n        const registerChangeByEventClientBlocks =\n            this.makeRegisterChangeByEventBlocks(registers)\n        const registerSimpleGetClientBlocks =\n            this.makeRegisterSimpleGetBlocks(registerSimpleTypes)\n        const registerEnumGetClientBlocks = this.makeRegisterEnumGetBlocks([\n            ...registerSimpleEnumTypes,\n            ...registerCompositeEnumTypes,\n        ])\n        const registerNumericsGetClientBlocks =\n            this.makeRegisterNumericsGetBlocks(registerComposites)\n        const registerSetClientBlocks = this.makeRegisterSetBlocks(registers)\n\n        const commandClientBlocks = commands.map<CommandBlockDefinition>(\n            ({ service, command }) => ({\n                kind: \"block\",\n                type: `jacdac_command_${service.shortId}_${command.name}`,\n                message0: !command.fields.length\n                    ? `${humanify(command.name)} %1`\n                    : `${humanify(command.name)} %1 with ${fieldsToMessage(\n                          command\n                      )}`,\n                args0: [roleVariable(service), ...fieldsToFieldInputs(command)],\n                values: fieldsToValues(service, command),\n                inputsInline: true,\n                colour: this.serviceColor(service),\n                tooltip: command.description,\n                helpUrl: serviceHelp(service),\n                service,\n                command,\n                previousStatement: CODE_STATEMENT_TYPE,\n                nextStatement: CODE_STATEMENT_TYPE,\n\n                template: \"command\",\n            })\n        )\n\n        this._serviceBlocks = [\n            ...eventClientBlocks,\n            ...registerSimpleGetClientBlocks,\n            ...registerEnumGetClientBlocks,\n            ...registerNumericsGetClientBlocks,\n            ...registerSetClientBlocks,\n            ...commandClientBlocks,\n            ...customClientBlockDefinitions,\n            ...registerChangeByEventClientBlocks,\n        ]\n\n        this._eventFieldBlocks = this.makeFieldBlocks(\n            events.map(p => ({ service: p.service, packets: p.events }))\n        )\n\n        // client only\n        this._roleBlocks = [\n            {\n                kind: \"block\",\n                type: ROLE_BOUND_EVENT_BLOCK,\n                message0: \"on %1 %2\",\n                args0: [\n                    <VariableInputDefinition>{\n                        type: \"field_variable\",\n                        name: \"role\",\n                        variable: \"any\",\n                        variableTypes: [\n                            \"client\",\n                            ...supportedServices.map(srv => toRoleType(srv)),\n                        ],\n                        defaultType: \"client\",\n                    },\n                    <OptionsInputDefinition>{\n                        type: \"field_dropdown\",\n                        name: \"event\",\n                        options: [\n                            [\"bound\", \"bound\"],\n                            [\"unbound\", \"unbound\"],\n                        ],\n                    },\n                ],\n                inputsInline: true,\n                nextStatement: CODE_STATEMENT_TYPE,\n                colour: commandColor,\n                tooltip: \"Runs code when a role is connected or disconnected\",\n                helpUrl: \"\",\n                template: \"role_binding_event\",\n            },\n            {\n                kind: \"block\",\n                type: ROLE_BOUND_BLOCK,\n                message0: \"%1 bound\",\n                args0: [\n                    <VariableInputDefinition>{\n                        type: \"field_variable\",\n                        name: \"role\",\n                        variable: \"any\",\n                        variableTypes: [\n                            \"client\",\n                            ...supportedServices.map(srv => toRoleType(srv)),\n                        ],\n                        defaultType: \"client\",\n                    },\n                ],\n                output: \"Boolean\",\n                inputsInline: true,\n                colour: commandColor,\n                tooltip: \"Runs code when a role is connected or disconnected\",\n                helpUrl: \"\",\n                template: \"role_bound\",\n            },\n            {\n                kind: \"block\",\n                type: SET_STATUS_LIGHT_BLOCK,\n                message0: \"set %1 status light to %2\",\n                args0: [\n                    <VariableInputDefinition>{\n                        type: \"field_variable\",\n                        name: \"role\",\n                        variable: \"all\",\n                        variableTypes: [\n                            \"client\",\n                            ...supportedServices.map(srv => toRoleType(srv)),\n                        ],\n                        defaultType: \"client\",\n                    },\n                    <ValueInputDefinition>{\n                        type: \"input_value\",\n                        name: \"color\",\n                        check: \"Number\",\n                    },\n                ],\n                values: {\n                    color: {\n                        kind: \"block\",\n                        type: LEDColorField.SHADOW.type,\n                    },\n                },\n                inputsInline: true,\n                previousStatement: CODE_STATEMENT_TYPE,\n                nextStatement: CODE_STATEMENT_TYPE,\n                colour: commandColor,\n                tooltip: \"Sets the color on the status light\",\n                helpUrl: \"\",\n            },\n        ]\n\n        const toolsBlocks: BlockDefinition[] = [\n            {\n                kind: \"block\",\n                type: TWIN_BLOCK,\n                message0: `view %1 %2 %3`,\n                args0: [\n                    <VariableInputDefinition>{\n                        type: \"field_variable\",\n                        name: \"role\",\n                        variable: \"none\",\n                        variableTypes: [\n                            \"client\",\n                            ...supportedServices.map(srv => toRoleType(srv)),\n                            ...supportedServices.map(srv =>\n                                toRoleType(srv, false)\n                            ),\n                        ],\n                        defaultType: \"client\",\n                    },\n                    {\n                        type: \"input_dummy\",\n                    },\n                    <InputDefinition>{\n                        type: TwinField.KEY,\n                        name: \"twin\",\n                    },\n                ],\n                colour: toolsColour,\n                inputsInline: false,\n                tooltip: `Twin of the selected service`,\n                nextStatement: DATA_SCIENCE_STATEMENT_TYPE,\n                helpUrl: \"\",\n                template: \"meta\",\n                transformData: identityTransformData,\n            },\n            {\n                kind: \"block\",\n                type: INSPECT_BLOCK,\n                message0: `inspect %1 %2 %3`,\n                args0: [\n                    <VariableInputDefinition>{\n                        type: \"field_variable\",\n                        name: \"role\",\n                        variable: \"none\",\n                        variableTypes: [\n                            \"client\",\n                            ...supportedServices.map(srv => toRoleType(srv)),\n                        ],\n                        defaultType: \"client\",\n                    },\n                    {\n                        type: \"input_dummy\",\n                    },\n                    <InputDefinition>{\n                        type: JDomTreeField.KEY,\n                        name: \"twin\",\n                    },\n                ],\n                colour: toolsColour,\n                inputsInline: false,\n                tooltip: `Inspect a service`,\n                helpUrl: \"\",\n                template: \"meta\",\n            },\n            <BlockDefinition>{\n                kind: \"block\",\n                type: RECORD_WINDOW_BLOCK,\n                message0: \"record last %1 s\",\n                args0: [\n                    <NumberInputDefinition>{\n                        type: \"field_number\",\n                        name: \"horizon\",\n                        value: 10,\n                    },\n                ],\n                inputsInline: false,\n                previousStatement: DATA_SCIENCE_STATEMENT_TYPE,\n                nextStatement: DATA_SCIENCE_STATEMENT_TYPE,\n                colour: toolsColour,\n                template: \"meta\",\n                dataPreviewField: true,\n                transformData: async (\n                    block: Block,\n                    data: { time: number }[],\n                    previousData: { time: number }[]\n                ) => {\n                    const horizon = block.getFieldValue(\"horizon\") || 10\n                    return postTransformData(<DataRecordWindowRequest>{\n                        type: \"record_window\",\n                        data,\n                        previousData,\n                        horizon,\n                    })\n                },\n            },\n        ]\n\n        return [\n            ...this._serviceBlocks,\n            ...this._eventFieldBlocks,\n            ...this._roleBlocks,\n            ...toolsBlocks,\n        ]\n    }\n\n    createCategory(options: CreateCategoryOptions) {\n        const makeServicesCategories = this.createCategoryHelper(options)\n\n        const clientServicesCategories = makeServicesCategories(\n            this._serviceBlocks,\n            this._eventFieldBlocks\n        )\n\n        const commonCategory: CategoryDefinition = {\n            kind: \"category\",\n            name: \"Roles\",\n            colour: commandColor,\n            contents: [\n                <BlockReference>{\n                    kind: \"block\",\n                    type: ROLE_BOUND_EVENT_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: ROLE_BOUND_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: SET_STATUS_LIGHT_BLOCK,\n                    values: {\n                        color: {\n                            kind: \"block\",\n                            type: LEDColorField.SHADOW.type,\n                        },\n                    },\n                },\n            ],\n        }\n\n        const toolsCategory: CategoryDefinition = {\n            kind: \"category\",\n            name: \"Tools\",\n            colour: toolsColour,\n            contents: [\n                <BlockReference>{\n                    kind: \"block\",\n                    type: TWIN_BLOCK,\n                },\n                <BlockDefinition>{\n                    kind: \"block\",\n                    type: RECORD_WINDOW_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: INSPECT_BLOCK,\n                },\n            ],\n        }\n\n        return [...clientServicesCategories, commonCategory, toolsCategory]\n    }\n}\nconst servicesDSL = new ServicesBlockDomainSpecificLanguage()\nexport default servicesDSL\n","import { humanify } from \"../../../../jacdac-ts/jacdac-spec/spectool/jdspec\"\nimport {\n    CategoryDefinition,\n    CODE_STATEMENT_TYPE,\n    CommandBlockDefinition,\n    ContentDefinition,\n    EventBlockDefinition,\n    InputDefinition,\n    LabelDefinition,\n    SeparatorDefinition,\n} from \"../toolbox\"\nimport BlockDomainSpecificLanguage, {\n    CreateBlocksOptions,\n    CreateCategoryOptions,\n} from \"./dsl\"\nimport {\n    createServiceColor,\n    fieldsToFieldInputs,\n    fieldsToMessage,\n    fieldsToValues,\n    getServiceInfo,\n    roleVariable,\n    serviceHelp,\n    ServiceRegister,\n    ServicesBaseDSL,\n} from \"./servicesbase\"\n\nexport class ServerServicesBlockDomainSpecificLanguage\n    extends ServicesBaseDSL\n    implements BlockDomainSpecificLanguage\n{\n    id = \"jacdacServerServices\"\n    supportedServices: jdspec.ServiceSpec[] = []\n\n    makeRegisterGetSetRequestBlocks(\n        registers: ServiceRegister[],\n        isGet: boolean\n    ) {\n        return registers\n            .filter(\n                r =>\n                    (isGet &&\n                        (r.register.kind === \"ro\" ||\n                            r.register.kind === \"rw\")) ||\n                    (!isGet && r.register.kind == \"rw\")\n            )\n            .map<EventBlockDefinition>(({ service, register }) => ({\n                kind: \"block\",\n                type: `jacdac_register_${isGet ? \"get\" : \"set\"}_request_${\n                    service.shortId\n                }_${register.name}`,\n                message0: `on register ${isGet ? \"get\" : \"set\"} %1 ${humanify(\n                    register.name\n                )}`,\n                args0: [roleVariable(service, false)],\n                colour: this.serviceColor(service),\n                inputsInline: true,\n                nextStatement: CODE_STATEMENT_TYPE,\n                tooltip: register.description,\n                helpUrl: serviceHelp(service),\n                service,\n                events: [register],\n                template: \"event\",\n            }))\n    }\n\n    createBlocks(options: CreateBlocksOptions) {\n        const { theme } = options\n        this.serviceColor = createServiceColor(theme)\n\n        // pure service information here\n        const {\n            registers,\n            events,\n            commands,\n            registerSimpleTypes,\n            registerComposites,\n            registerSimpleEnumTypes,\n            registerCompositeEnumTypes,\n        } = getServiceInfo()\n\n        const eventServerBlocks = events.flatMap<CommandBlockDefinition>(\n            ({ service, events }) => {\n                const eventsNoArgs = events.filter(ev => ev.fields.length === 0)\n                const retNoArgs: CommandBlockDefinition = {\n                    kind: \"block\",\n                    type: `jacdac_raise_event_${service.shortId}`,\n                    message0: `raise %1 %2`,\n                    args0: [\n                        roleVariable(service, false),\n                        <InputDefinition>{\n                            type: \"field_dropdown\",\n                            name: \"event\",\n                            options: eventsNoArgs.map(event => [\n                                humanify(event.name),\n                                event.name,\n                            ]),\n                        },\n                    ],\n                    inputsInline: true,\n                    colour: this.serviceColor(service),\n                    tooltip: `Events for the ${service.name} service`,\n                    helpUrl: serviceHelp(service),\n                    service,\n                    command: undefined,\n                    previousStatement: CODE_STATEMENT_TYPE,\n                    nextStatement: CODE_STATEMENT_TYPE,\n\n                    template: \"raiseNo\",\n                }\n                const eventsArgs = events.filter(ev => ev.fields.length)\n                const retArgs = eventsArgs.map<CommandBlockDefinition>(ev => {\n                    return {\n                        kind: \"block\",\n                        type: `jacdac_raise_event_${service.shortId}_${ev.name}`,\n                        message0: !ev.fields.length\n                            ? `raise %1 ${humanify(ev.name)}`\n                            : `raise %1 ${humanify(\n                                  ev.name\n                              )} with ${fieldsToMessage(ev)}`,\n                        args0: [\n                            roleVariable(service, false),\n                            ...fieldsToFieldInputs(ev),\n                        ],\n                        values: fieldsToValues(service, ev),\n                        inputsInline: true,\n                        colour: this.serviceColor(service),\n                        tooltip: ev.description,\n                        helpUrl: serviceHelp(service),\n                        service,\n                        command: ev,\n                        previousStatement: CODE_STATEMENT_TYPE,\n                        nextStatement: CODE_STATEMENT_TYPE,\n\n                        template: \"raiseArgs\",\n                    }\n                })\n                return [retNoArgs, ...retArgs]\n            }\n        )\n\n        const registerSimpleGetServerBlocks = this.makeRegisterSimpleGetBlocks(\n            registerSimpleTypes,\n            false\n        )\n        const registerEnumGetServerBlocks = this.makeRegisterEnumGetBlocks(\n            [...registerSimpleEnumTypes, ...registerCompositeEnumTypes],\n            false\n        )\n        const registerNumericsGetServerBlocks =\n            this.makeRegisterNumericsGetBlocks(registerComposites, false)\n        const registerSetServerBlocks = this.makeRegisterSetBlocks(\n            registers,\n            false\n        )\n        const registerSetRequestBlocks = this.makeRegisterGetSetRequestBlocks(\n            registers,\n            false\n        )\n        const registerGetRequestBlocks = this.makeRegisterGetSetRequestBlocks(\n            registers,\n            true\n        )\n\n        const commandServerBlocks = commands.map<EventBlockDefinition>(\n            ({ service, command }) => ({\n                kind: \"block\",\n                type: `jacdac_command_server_${service.shortId}_${command.name}`,\n                message0: `on ${humanify(command.name)} %1`,\n                args0: [roleVariable(service, false)],\n                colour: this.serviceColor(service),\n                inputsInline: true,\n                nextStatement: CODE_STATEMENT_TYPE,\n                tooltip: command.description,\n                helpUrl: serviceHelp(service),\n                service,\n                events: [command],\n                template: \"event\",\n            })\n        )\n\n        this._serviceBlocks = [\n            ...eventServerBlocks,\n            ...registerSimpleGetServerBlocks,\n            ...registerEnumGetServerBlocks,\n            ...registerNumericsGetServerBlocks,\n            ...registerSetServerBlocks,\n            ...commandServerBlocks,\n            ...registerSetRequestBlocks,\n            ...registerGetRequestBlocks,\n        ]\n\n        this._eventFieldBlocks = this.makeFieldBlocks(\n            commands.map(p => ({ service: p.service, packets: [p.command] })),\n            false\n        )\n\n        return [...this._serviceBlocks, ...this._eventFieldBlocks]\n    }\n\n    createCategory(options: CreateCategoryOptions) {\n        const makeServicesCategories = this.createCategoryHelper(options)\n\n        const serverServicesCategories = makeServicesCategories(\n            this._serviceBlocks,\n            this._eventFieldBlocks,\n            false\n        )\n\n        if (!serverServicesCategories?.length) return []\n\n        return [\n            <SeparatorDefinition>{\n                kind: \"sep\",\n            },\n            {\n                kind: \"category\",\n                name: \"Servers\",\n                contents: serverServicesCategories,\n            } as CategoryDefinition,\n        ]\n    }\n}\nconst serverServicesDSL = new ServerServicesBlockDomainSpecificLanguage()\nexport default serverServicesDSL\n","import jsep from \"jsep\"\nimport { toIdentifier } from \"../../../../jacdac-ts/src/vm/compile\"\nimport { CmdWithErrors, makeVMBase } from \"../../vm/VMgenerator\"\nimport LogViewField from \"../fields/LogViewField\"\nimport VariablesField from \"../fields/VariablesFields\"\nimport WatchValueField from \"../fields/WatchValueField\"\nimport {\n    BlockReference,\n    CODE_STATEMENT_TYPE,\n    DATA_SCIENCE_STATEMENT_TYPE,\n    identityTransformData,\n    InputDefinition,\n    LabelDefinition,\n    toolsColour,\n} from \"../toolbox\"\nimport BlockDomainSpecificLanguage from \"./dsl\"\n\nconst WATCH_BLOCK = \"tools_watch\"\nconst LOG_BLOCK = \"tools_log\"\nconst VIEW_LOG_BLOCK = \"tools_log_view\"\nconst VARIABLES_BLOCK = \"tools_variables_view\"\n\nconst colour = toolsColour\n\nconst toolsDSL: BlockDomainSpecificLanguage = {\n    id: \"tools\",\n    createBlocks: () => [\n        {\n            kind: \"block\",\n            type: VARIABLES_BLOCK,\n            message0: `variables %1 %2`,\n            args0: [\n                {\n                    type: \"input_dummy\",\n                },\n                {\n                    type: VariablesField.KEY,\n                    name: \"variables\",\n                },\n            ],\n            colour,\n            inputsInline: false,\n            tooltip: `Watch variables values`,\n            helpUrl: \"\",\n            template: \"meta\",\n        },\n        {\n            kind: \"block\",\n            type: WATCH_BLOCK,\n            message0: `watch %1 %2`,\n            args0: [\n                <InputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                },\n                <InputDefinition>{\n                    type: WatchValueField.KEY,\n                    name: \"watch\",\n                },\n            ],\n            colour,\n            inputsInline: true,\n            tooltip: `Watch a value in the editor`,\n            helpUrl: \"\",\n            nextStatement: DATA_SCIENCE_STATEMENT_TYPE,\n            transformData: identityTransformData,\n        },\n        {\n            kind: \"block\",\n            type: LOG_BLOCK,\n            message0: `log %1`,\n            args0: [\n                <InputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                },\n            ],\n            colour,\n            inputsInline: true,\n            previousStatement: CODE_STATEMENT_TYPE,\n            nextStatement: CODE_STATEMENT_TYPE,\n            tooltip: `Log an entry to the console`,\n            helpUrl: \"\",\n        },\n        {\n            kind: \"block\",\n            type: VIEW_LOG_BLOCK,\n            message0: `console %1 %2`,\n            args0: [\n                {\n                    type: \"input_dummy\",\n                },\n                <InputDefinition>{\n                    type: LogViewField.KEY,\n                    name: \"watch\",\n                },\n            ],\n            colour,\n            inputsInline: false,\n            tooltip: `View console content`,\n            template: \"meta\",\n        },\n    ],\n    createCategory: () => [\n        {\n            kind: \"category\",\n            name: \"Debugger\",\n            colour: colour,\n            contents: [\n                <LabelDefinition>{\n                    kind: \"label\",\n                    text: \"Variables\",\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: VARIABLES_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: WATCH_BLOCK,\n                },\n                <LabelDefinition>{\n                    kind: \"label\",\n                    text: \"Logging\",\n                },\n                {\n                    kind: \"block\",\n                    type: LOG_BLOCK,\n                    values: {\n                        value: { kind: \"block\", type: \"text\" },\n                    },\n                },\n                {\n                    kind: \"block\",\n                    type: VIEW_LOG_BLOCK,\n                },\n            ],\n        },\n        {\n            kind: \"sep\",\n        },\n    ],\n\n    compileCommandToVM: ({ block, blockToExpression }): CmdWithErrors => {\n        const { type } = block\n        if (type === LOG_BLOCK) {\n            const { inputs } = block\n            const { expr, errors } = blockToExpression(\n                undefined,\n                inputs[0].child\n            )\n            return {\n                cmd: makeVMBase(block, {\n                    type: \"CallExpression\",\n                    arguments: [expr],\n                    callee: toIdentifier(\"log\"),\n                }),\n                errors,\n            }\n        }\n        return undefined\n    },\n    compileEventToVM: ({ block, blockToExpression }) => {\n        const { type } = block\n        if (type === WATCH_BLOCK) {\n            const { inputs } = block\n            const { expr, errors } = blockToExpression(\n                undefined,\n                inputs[0].child\n            )\n            return {\n                expression: <jsep.CallExpression>{\n                    type: \"CallExpression\",\n                    arguments: [expr],\n                    callee: toIdentifier(\"watch\"),\n                },\n                errors,\n                meta: true,\n            }\n        }\n        return undefined\n    },\n}\n\nexport default toolsDSL\n","import { toIdentifier } from \"../../../../jacdac-ts/src/vm/compile\"\nimport { VMCommand } from \"../../../../jacdac-ts/src/vm/ir\"\nimport {\n    BlockReference,\n    CategoryDefinition,\n    CODE_STATEMENT_TYPE,\n    InputDefinition,\n    SeparatorDefinition,\n    ValueInputDefinition,\n} from \"../toolbox\"\nimport { makeVMBase, processErrors } from \"../../vm/VMgenerator\"\nimport BlockDomainSpecificLanguage from \"./dsl\"\nimport { paletteColorByIndex } from \"./palette\"\n\nconst WAIT_BLOCK = \"jacdac_wait\"\nconst ON_START_BLOCK = \"jacdac_start\"\nconst REPEAT_EVERY_BLOCK = \"jacdac_repeat_every\"\n\nconst colour = paletteColorByIndex(0)\nconst loopsDsl: BlockDomainSpecificLanguage = {\n    id: \"loops\",\n    createBlocks: () => [\n        {\n            kind: \"block\",\n            type: WAIT_BLOCK,\n            message0: \"wait %1 s\",\n            args0: [\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"time\",\n                    check: \"Number\",\n                },\n            ],\n            inputsInline: true,\n            previousStatement: CODE_STATEMENT_TYPE,\n            nextStatement: CODE_STATEMENT_TYPE,\n            colour,\n            tooltip: \"Wait the desired time\",\n            helpUrl: \"\",\n        },\n        {\n            kind: \"block\",\n            type: ON_START_BLOCK,\n            message0: `on start`,\n            args0: [],\n            colour,\n            inputsInline: true,\n            tooltip: `Runs code when the device starts`,\n            helpUrl: \"\",\n            nextStatement: CODE_STATEMENT_TYPE,\n        },\n        {\n            kind: \"block\",\n            type: REPEAT_EVERY_BLOCK,\n            message0: `repeat every %1s`,\n            args0: [\n                <InputDefinition>{\n                    type: \"input_value\",\n                    name: \"interval\",\n                    check: \"Number\",\n                },\n            ],\n            colour,\n            inputsInline: true,\n            tooltip: `Repeats code at a given interval in seconds`,\n            helpUrl: \"\",\n            nextStatement: CODE_STATEMENT_TYPE,\n        },\n    ],\n\n    createCategory: () => [\n        <SeparatorDefinition>{\n            kind: \"sep\",\n        },\n        <CategoryDefinition>{\n            kind: \"category\",\n            name: \"Events\",\n            colour,\n            contents: [\n                <BlockReference>{\n                    kind: \"block\",\n                    type: REPEAT_EVERY_BLOCK,\n                    values: {\n                        interval: { kind: \"block\", type: \"jacdac_time_picker\" },\n                    },\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: ON_START_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: WAIT_BLOCK,\n                    values: {\n                        time: { kind: \"block\", type: \"jacdac_time_picker\" },\n                    },\n                },\n            ].filter(b => !!b),\n        },\n    ],\n    compileEventToVM: ({ block, blockToExpression }) => {\n        const { type } = block\n        if (type === ON_START_BLOCK) {\n            return {\n                expression: (\n                    makeVMBase(block, {\n                        type: \"CallExpression\",\n                        arguments: [],\n                        callee: toIdentifier(\"start\"),\n                    }) as VMCommand\n                ).command,\n                errors: processErrors(block, []),\n            }\n        } else if (type === REPEAT_EVERY_BLOCK) {\n            const { inputs } = block\n            const { expr: time, errors } = blockToExpression(\n                undefined,\n                inputs[0].child\n            )\n            return {\n                expression: (\n                    makeVMBase(block, {\n                        type: \"CallExpression\",\n                        arguments: [time],\n                        callee: toIdentifier(\"wait\"),\n                    }) as VMCommand\n                ).command,\n                errors: processErrors(block, errors),\n            }\n        }\n        return undefined\n    },\n    compileCommandToVM: ({ event, block, blockToExpression }) => {\n        const { type } = block\n        if (type === WAIT_BLOCK) {\n            const { inputs } = block\n            {\n                const { expr: time, errors } = blockToExpression(\n                    event,\n                    inputs[0].child\n                )\n                return {\n                    cmd: makeVMBase(block, {\n                        type: \"CallExpression\",\n                        arguments: [time],\n                        callee: toIdentifier(\"wait\"),\n                    }),\n                    errors: processErrors(block, errors),\n                }\n            }\n        }\n        return undefined\n    },\n}\nexport default loopsDsl\n","import jsep from \"jsep\"\nimport { ExpressionWithErrors } from \"../../vm/VMgenerator\"\nimport BlockDomainSpecificLanguage from \"./dsl\"\n\nconst ops = {\n    AND: \"&&\",\n    OR: \"||\",\n    EQ: \"===\",\n    NEQ: \"!==\",\n    LT: \"<\",\n    GT: \">\",\n    LTE: \"<=\",\n    GTE: \">=\",\n    NEG: \"-\",\n}\n\nconst logicDsl: BlockDomainSpecificLanguage = {\n    id: \"logic\",\n    types: [\n        \"variable_if\",\n        \"logic_compare\",\n        \"logic_operation\",\n        \"logic_negate\",\n        \"logic_boolean\",\n    ],\n    createCategory: () => [\n        {\n            kind: \"category\",\n            name: \"Logic\",\n            colour: \"%{BKY_LOGIC_HUE}\",\n            contents: [\n                {\n                    kind: \"block\",\n                    type: \"dynamic_if\",\n                },\n                {\n                    kind: \"block\",\n                    type: \"logic_compare\",\n                    values: {\n                        A: { kind: \"block\", type: \"math_number\" },\n                        B: { kind: \"block\", type: \"math_number\" },\n                    },\n                },\n                {\n                    kind: \"block\",\n                    type: \"logic_operation\",\n                    values: {\n                        A: { kind: \"block\", type: \"logic_boolean\" },\n                        B: { kind: \"block\", type: \"logic_boolean\" },\n                    },\n                },\n                {\n                    kind: \"block\",\n                    type: \"logic_negate\",\n                    values: {\n                        BOOL: { kind: \"block\", type: \"logic_boolean\" },\n                    },\n                },\n                {\n                    kind: \"block\",\n                    type: \"logic_boolean\",\n                },\n            ],\n        },\n    ],\n    compileExpressionToVM: ({\n        event,\n        block,\n        blockToExpressionInner,\n    }): ExpressionWithErrors => {\n        const { type, inputs } = block\n        switch (type) {\n            case \"logic_operation\": {\n                const left = blockToExpressionInner(event, inputs[0].child)\n                const right = blockToExpressionInner(event, inputs[1].child)\n                const op = inputs[1].fields[\"op\"].value as string\n                return {\n                    expr: <jsep.BinaryExpression>{\n                        type: \"BinaryExpression\",\n                        operator: ops[op] || op,\n                        left,\n                        right,\n                    },\n                    errors: [],\n                }\n            }\n            case \"logic_negate\": {\n                const argument = blockToExpressionInner(event, inputs[0].child)\n                return {\n                    expr: <jsep.UnaryExpression>{\n                        type: \"UnaryExpression\",\n                        operator: \"!\",\n                        argument,\n                        prefix: false, // TODO: handle logic_negate\n                    },\n                    errors: [],\n                }\n            }\n            case \"logic_compare\": {\n                const left = blockToExpressionInner(event, inputs[0].child)\n                const right = blockToExpressionInner(event, inputs[1].child)\n                const op = inputs[1].fields[\"op\"].value as string\n                return {\n                    expr: <jsep.BinaryExpression>{\n                        type: \"BinaryExpression\",\n                        operator: ops[op] || op,\n                        left,\n                        right,\n                    },\n                    errors: [],\n                }\n            }\n        }\n        return undefined\n    },\n}\nexport default logicDsl\n","import jsep from \"jsep\"\nimport { ExpressionWithErrors } from \"../../vm/VMgenerator\"\nimport {\n    BlockDefinition,\n    BlockReference,\n    CategoryDefinition,\n    OptionsInputDefinition,\n    ValueInputDefinition,\n} from \"../toolbox\"\nimport BlockDomainSpecificLanguage from \"./dsl\"\n\nconst ops = {\n    NEG: \"-\",\n    ADD: \"+\",\n    MULTIPLY: \"*\",\n    DIVIDE: \"/\",\n    MINUS: \"-\",\n}\n\nconst mathDsl: BlockDomainSpecificLanguage = {\n    id: \"jacdacmath\",\n    createBlocks: () => [\n        {\n            kind: \"block\",\n            type: \"jacdac_math_arithmetic\",\n            message0: \"%1 %2 %3\",\n            args0: [\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"A\",\n                    check: \"Number\",\n                },\n                <OptionsInputDefinition>{\n                    type: \"field_dropdown\",\n                    name: \"OP\",\n                    options: [\n                        [\"%{BKY_MATH_ADDITION_SYMBOL}\", \"ADD\"],\n                        [\"%{BKY_MATH_SUBTRACTION_SYMBOL}\", \"MINUS\"],\n                        [\"%{BKY_MATH_MULTIPLICATION_SYMBOL}\", \"MULTIPLY\"],\n                        [\"%{BKY_MATH_DIVISION_SYMBOL}\", \"DIVIDE\"],\n                    ],\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"B\",\n                    check: \"Number\",\n                },\n            ],\n            inputsInline: true,\n            output: \"Number\",\n            style: \"math_blocks\",\n            helpUrl: \"%{BKY_MATH_ARITHMETIC_HELPURL}\",\n            extensions: [\"math_op_tooltip\"],\n        },\n        {\n            kind: \"block\",\n            type: \"jacdac_math_single\",\n            message0: \"%1 %2\",\n            args0: [\n                <OptionsInputDefinition>{\n                    type: \"field_dropdown\",\n                    name: \"OP\",\n                    options: [\n                        [\"-\", \"NEG\"],\n                        [\"%{BKY_MATH_SINGLE_OP_ABSOLUTE}\", \"ABS\"],\n                    ],\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"NUM\",\n                    check: \"Number\",\n                },\n            ],\n            output: \"Number\",\n            style: \"math_blocks\",\n            helpUrl: \"%{BKY_MATH_SINGLE_HELPURL}\",\n            extensions: [\"math_op_tooltip\"],\n        },\n        {\n            kind: \"block\",\n            type: \"jacdac_math_random\",\n            message0: \"random\",\n            args0: [],\n            output: \"Number\",\n            style: \"math_blocks\",\n            vm: function () {\n                return Math.random()\n            },\n        },\n        <BlockDefinition>{\n            kind: \"block\",\n            type: \"jacdac_math_clamp\",\n            message0: \"clamp %1 in [%2, %3]\",\n            args0: [\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"minInclusive\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"maxInclusive\",\n                    check: \"Number\",\n                },\n            ],\n            output: \"Number\",\n            style: \"math_blocks\",\n            vm: function (\n                value: number,\n                minInclusive: number,\n                maxInclusive: number\n            ) {\n                return value < minInclusive\n                    ? minInclusive\n                    : value > maxInclusive\n                    ? maxInclusive\n                    : value\n            },\n        },\n        {\n            kind: \"block\",\n            type: \"jacdac_math_map\",\n            message0: \"map %1 from [%2, %3] to [%4, %5]\",\n            args0: [\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"fromMin\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"fromMax\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"toMin\",\n                    check: \"Number\",\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"toMax\",\n                    check: \"Number\",\n                },\n            ],\n            output: \"Number\",\n            style: \"math_blocks\",\n        },\n    ],\n    createCategory: () => [\n        <CategoryDefinition>{\n            kind: \"category\",\n            name: \"Math\",\n            colour: \"%{BKY_MATH_HUE}\",\n            contents: [\n                {\n                    kind: \"block\",\n                    type: \"jacdac_math_arithmetic\",\n                    values: {\n                        A: { kind: \"block\", type: \"math_number\" },\n                        B: { kind: \"block\", type: \"math_number\" },\n                    },\n                },\n                {\n                    kind: \"block\",\n                    type: \"jacdac_math_single\",\n                    values: {\n                        NUM: {\n                            kind: \"block\",\n                            type: \"math_number\",\n                        },\n                    },\n                },\n                <BlockReference>{ kind: \"block\", type: \"jacdac_math_random\" },\n                { kind: \"block\", type: \"jacdac_math_map\" },\n                { kind: \"block\", type: \"math_number\" },\n            ],\n        },\n    ],\n    compileExpressionToVM: ({\n        event,\n        block,\n        blockToExpressionInner,\n    }): ExpressionWithErrors => {\n        const { type, inputs } = block\n        switch (type) {\n            case \"math_single\": // built-in blockly\n            case \"jacdac_math_single\": {\n                const argument = blockToExpressionInner(event, inputs[0].child)\n                const op = inputs[0].fields[\"op\"].value as string\n                return {\n                    expr: <jsep.UnaryExpression>{\n                        type: \"UnaryExpression\",\n                        operator: ops[op] || op,\n                        argument,\n                        prefix: false, // TODO: handle math-negate\n                    },\n                    errors: [],\n                }\n            }\n            case \"math_arithmetic\": // built-in blockly\n            case \"jacdac_math_arithmetic\": {\n                const left = blockToExpressionInner(event, inputs[0].child)\n                const right = blockToExpressionInner(event, inputs[1].child)\n                const op = inputs[1].fields[\"op\"].value as string\n                return {\n                    expr: <jsep.BinaryExpression>{\n                        type: \"BinaryExpression\",\n                        operator: ops[op] || op,\n                        left,\n                        right,\n                    },\n                    errors: [],\n                }\n            }\n        }\n        return undefined\n    },\n}\n\nexport default mathDsl\n","import {\n    BlockDefinition,\n    BlockReference,\n    BOOLEAN_TYPE,\n    DummyInputDefinition,\n    JSON_TYPE,\n    LabelDefinition,\n    PRIMITIVE_TYPES,\n    StatementInputDefinition,\n    TextInputDefinition,\n    ValueInputDefinition,\n} from \"../toolbox\"\nimport BlockDomainSpecificLanguage, {\n    CompileExpressionToVMOptions,\n} from \"./dsl\"\nimport { paletteColorByIndex } from \"./palette\"\n\nconst colour = paletteColorByIndex(-2)\nconst JSON_FIELD_TYPE = \"JSONField\"\nconst JSON_OBJECT_BLOCK = \"json_object\"\nconst JSON_FIELD_SET_BLOCK = \"json_field_set\"\nconst JSON_FIELD_GET_TEMPLATE = \"jsonFieldGet\"\nconst JSON_FIELD_VALUE_TYPE = [...PRIMITIVE_TYPES, JSON_TYPE]\nconst JSON_FIELD_HAS_BLOCK = \"json_field_has\"\n\nconst jsonDSL: BlockDomainSpecificLanguage = {\n    id: \"json\",\n    createBlocks: () => [\n        <BlockDefinition>{\n            kind: \"block\",\n            type: JSON_OBJECT_BLOCK,\n            message0: \"{ %1 %2 }\",\n            args0: [\n                <DummyInputDefinition>{\n                    type: \"input_dummy\",\n                },\n                <StatementInputDefinition>{\n                    type: \"input_statement\",\n                    name: \"fields\",\n                    check: JSON_FIELD_TYPE,\n                },\n            ],\n            output: JSON_TYPE,\n            colour,\n        },\n        <BlockDefinition>{\n            kind: \"block\",\n            type: JSON_FIELD_SET_BLOCK,\n            message0: \"%1: %2\",\n            args0: [\n                <TextInputDefinition>{\n                    type: \"field_input\",\n                    name: \"name\",\n                    spellcheck: false,\n                },\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                    check: JSON_FIELD_VALUE_TYPE,\n                },\n            ],\n            previousStatement: JSON_FIELD_TYPE,\n            nextStatement: JSON_FIELD_TYPE,\n            colour,\n        },\n        ...PRIMITIVE_TYPES.map(\n            output =>\n                <BlockDefinition>{\n                    kind: \"block\",\n                    type: `json_field_get_as_${output.toLowerCase()}`,\n                    message0: `%1 [ %2 ] as ${output.toLowerCase()}`,\n                    args0: [\n                        <ValueInputDefinition>{\n                            type: \"input_value\",\n                            name: \"value\",\n                            check: JSON_TYPE,\n                        },\n                        <TextInputDefinition>{\n                            type: \"field_input\",\n                            name: \"name\",\n                            spellcheck: false,\n                        },\n                    ],\n                    output,\n                    colour,\n                    template: JSON_FIELD_GET_TEMPLATE,\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    vm: (value: any, name: string) => value?.[name],\n                }\n        ),\n        {\n            kind: \"block\",\n            type: JSON_FIELD_HAS_BLOCK,\n            message0: `has %1 [ %2 ]`,\n            args0: [\n                <ValueInputDefinition>{\n                    type: \"input_value\",\n                    name: \"value\",\n                    check: JSON_TYPE,\n                },\n                <TextInputDefinition>{\n                    type: \"field_input\",\n                    name: \"name\",\n                    spellcheck: false,\n                },\n            ],\n            output: BOOLEAN_TYPE,\n            colour,\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            vm: (value: any, name: string) => !!value?.[name],\n        },\n    ],\n    createCategory: () => [\n        {\n            kind: \"category\",\n            name: \"JSON\",\n            colour,\n            contents: [\n                <LabelDefinition>{\n                    kind: \"label\",\n                    text: \"Create\",\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: JSON_OBJECT_BLOCK,\n                },\n                <BlockReference>{\n                    kind: \"block\",\n                    type: JSON_FIELD_SET_BLOCK,\n                    values: {\n                        value: {\n                            kind: \"block\",\n                            type: \"math_number\",\n                        },\n                    },\n                },\n                <LabelDefinition>{\n                    kind: \"label\",\n                    text: \"Read\",\n                },\n                ...PRIMITIVE_TYPES.map(output => ({\n                    kind: \"block\",\n                    type: `json_field_get_as_${output.toLowerCase()}`,\n                    values: {\n                        value: <BlockReference>{\n                            kind: \"block\",\n                            type: \"variables_get\",\n                            check: JSON_TYPE,\n                        },\n                    },\n                })),\n                {\n                    kind: \"block\",\n                    type: JSON_FIELD_HAS_BLOCK,\n                },\n            ],\n        },\n    ],\n\n    compileExpressionToVM(options: CompileExpressionToVMOptions) {\n        const { event, block, definition, blockToExpressionInner } = options\n        const { type } = block\n        const { template } = definition\n        if (type === JSON_OBJECT_BLOCK) {\n            // TODO: handle json field set block\n        } else if (type === JSON_FIELD_SET_BLOCK) {\n            // TODO: handle json field get block\n        } else if (template === JSON_FIELD_GET_TEMPLATE) {\n            // TODO: generate json expression\n            console.log(\"json expr\", {\n                event,\n                block,\n                definition,\n                blockToExpressionInner,\n            })\n            return undefined\n        }\n        // don't know\n        return undefined\n    },\n}\n\nexport default jsonDSL\n","import {\n    BlockReference,\n    CategoryDefinition,\n    DATA_SCIENCE_STATEMENT_TYPE,\n    DummyInputDefinition,\n    identityTransformData,\n    NumberInputDefinition,\n    toolsColour,\n} from \"../toolbox\"\nimport BlockDomainSpecificLanguage from \"./dsl\"\nimport DataColumnChooserField from \"../fields/DataColumnChooserField\"\nimport GaugeWidgetField from \"../fields/GaugeWidgetField\"\n\nconst DASHBOARD_GAUGE_BLOCK = \"jacdac_widget_gauge\"\n\nconst colour = toolsColour\nconst widgetDSL: BlockDomainSpecificLanguage = {\n    id: \"widget\",\n    createBlocks: () => [\n        {\n            kind: \"block\",\n            type: DASHBOARD_GAUGE_BLOCK,\n            message0: \"gauge min %1 max %2 %3 %4 %5\",\n            args0: [\n                <NumberInputDefinition>{\n                    type: \"field_number\",\n                    name: \"min\",\n                },\n                <NumberInputDefinition>{\n                    type: \"field_number\",\n                    name: \"max\",\n                    value: 100,\n                },\n                {\n                    type: DataColumnChooserField.KEY,\n                    name: \"field\",\n                    dataType: \"number\",\n                },\n                <DummyInputDefinition>{\n                    type: \"input_dummy\",\n                },\n                {\n                    type: GaugeWidgetField.KEY,\n                    name: \"widget\",\n                },\n            ],\n            previousStatement: DATA_SCIENCE_STATEMENT_TYPE,\n            nextStatement: DATA_SCIENCE_STATEMENT_TYPE,\n            colour,\n            template: \"meta\",\n            inputsInline: false,\n            transformData: identityTransformData,\n        },\n    ],\n\n    createCategory: () => [\n        <CategoryDefinition>{\n            kind: \"category\",\n            name: \"Widgets\",\n            contents: [\n                <BlockReference>{ kind: \"block\", type: DASHBOARD_GAUGE_BLOCK },\n            ],\n            colour,\n        },\n    ],\n}\n\nexport default widgetDSL\n","import servicesDSL from \"../blockly/dsl/servicesdsl\"\nimport serverServicesDSL from \"../blockly/dsl/serverservicesdsl\"\nimport toolsDsl from \"../blockly/dsl/toolsdsl\"\nimport loopsDsl from \"../blockly/dsl/loopsdsl\"\nimport logicDsl from \"../blockly/dsl/logicdsl\"\nimport mathDsl from \"../blockly/dsl/mathdsl\"\nimport variablesDsl from \"../blockly/dsl/variablesdsl\"\nimport shadowDsl from \"../blockly/dsl/shadowdsl\"\nimport fieldsDsl from \"../blockly/dsl/fieldsdsl\"\nimport jsonDsl from \"../blockly/dsl/jsondsl\"\nimport chartDsl from \"../blockly/dsl/chartdsl\"\nimport dataDsl from \"../blockly/dsl/datadsl\"\nimport widgetDSL from \"../blockly/dsl/widgetdsl\"\n\nconst vmDsls = [\n    servicesDSL,\n    serverServicesDSL,\n    loopsDsl,\n    logicDsl,\n    mathDsl,\n    jsonDsl,\n    variablesDsl,\n    toolsDsl,\n    widgetDSL,\n    dataDsl,\n    chartDsl,\n    shadowDsl,\n    fieldsDsl,\n]\nexport default vmDsls\n","import { Grid, NoSsr } from \"@material-ui/core\"\nimport React, {\n    useCallback,\n    useContext,\n    useEffect,\n    useMemo,\n    useState,\n} from \"react\"\nimport Flags from \"../../../jacdac-ts/src/jdom/flags\"\nimport useVMRunner from \"./useVMRunner\"\nimport VMDiagnostics from \"./VMDiagnostics\"\nimport VMToolbar from \"./VMToolbar\"\nimport { VMProgram } from \"../../../jacdac-ts/src/vm/ir\"\nimport BlockContext, { BlockProvider } from \"../blockly/BlockContext\"\nimport BlockDiagnostics from \"../blockly/BlockDiagnostics\"\nimport workspaceJSONToVMProgram from \"./VMgenerator\"\nimport BlockEditor from \"../blockly/BlockEditor\"\nimport { arrayConcatMany } from \"../../../jacdac-ts/src/jdom/utils\"\nimport vmDsls from \"./vmdsls\"\nimport { VMStatus } from \"../../../jacdac-ts/src/vm/runner\"\nimport { VM_WARNINGS_CATEGORY, WORKSPACE_FILENAME } from \"../blockly/toolbox\"\nimport FileTabs from \"../fs/FileTabs\"\nimport { WorkspaceFile } from \"../../../jacdac-ts/src/dsl/workspacejson\"\nimport FileSystemContext from \"../FileSystemContext\"\nimport { resolveWorkspaceServices } from \"../blockly/WorkspaceContext\"\n\nconst VM_EDITOR_ID = \"vm\"\nconst VM_SOURCE_STORAGE_KEY = \"tools:vmeditor\"\nconst VM_NEW_FILE_CONTENT = JSON.stringify({\n    editor: VM_EDITOR_ID,\n    xml: \"\",\n} as WorkspaceFile)\n\nfunction VMEditorWithContext() {\n    const {\n        dsls,\n        workspace,\n        workspaceJSON,\n        roleManager,\n        setWarnings,\n        dragging,\n    } = useContext(BlockContext)\n    const { fileSystem } = useContext(FileSystemContext)\n    const [program, setProgram] = useState<VMProgram>()\n    const autoStart = true\n    const { runner, run, cancel } = useVMRunner(roleManager, program, autoStart)\n\n    // don't run the VM while dragging as it glitches the Ui\n    useEffect(() => {\n        if (runner?.status === VMStatus.Running) cancel()\n    }, [runner, dragging])\n    useEffect(() => {\n        try {\n            const newProgram = workspaceJSONToVMProgram(workspaceJSON, dsls)\n            if (JSON.stringify(newProgram) !== JSON.stringify(program))\n                setProgram(newProgram)\n        } catch (e) {\n            console.error(e)\n            setProgram(undefined)\n        }\n    }, [dsls, workspaceJSON])\n    useEffect(\n        () =>\n            program &&\n            roleManager?.updateRoles([\n                ...program.roles,\n                ...program.serverRoles.map(r => ({\n                    role: r.role,\n                    serviceClass: r.serviceClass,\n                    preferredDeviceId: \"TBD\",\n                })),\n            ]),\n        [roleManager, program]\n    )\n    useEffect(\n        () =>\n            setWarnings(\n                VM_WARNINGS_CATEGORY,\n                arrayConcatMany(program?.handlers.map(h => h.errors))\n            ),\n        [program]\n    )\n\n    useEffect(() => {\n        const services = resolveWorkspaceServices(workspace)\n        if (services) {\n            services.runner = runner\n        }\n    }, [workspace, runner])\n\n    return (\n        <Grid container direction=\"column\" spacing={1}>\n            {!!fileSystem && (\n                <Grid item xs={12}>\n                    <FileTabs\n                        newFileName={WORKSPACE_FILENAME}\n                        newFileContent={VM_NEW_FILE_CONTENT}\n                        hideFiles={true}\n                    />\n                </Grid>\n            )}\n            <Grid item xs={12}>\n                <VMToolbar runner={runner} run={run} cancel={cancel} />\n            </Grid>\n            <Grid item xs={12}>\n                <BlockEditor editorId={VM_EDITOR_ID} />\n            </Grid>\n            {Flags.diagnostics && (\n                <>\n                    <VMDiagnostics program={program} />\n                    <BlockDiagnostics />\n                </>\n            )}\n        </Grid>\n    )\n}\n\nexport default function VMEditor() {\n    const dsls = useMemo(() => {\n        return vmDsls\n    }, [])\n    const handleOnBeforeSaveWorkspaceFile = useCallback(\n        (file: WorkspaceFile) => {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const f = file as any\n            f.vm = workspaceJSONToVMProgram(file.json, dsls)\n        },\n        []\n    )\n\n    return (\n        <NoSsr>\n            <BlockProvider\n                storageKey={VM_SOURCE_STORAGE_KEY}\n                dsls={dsls}\n                onBeforeSaveWorkspaceFile={\n                    Flags.diagnostics\n                        ? handleOnBeforeSaveWorkspaceFile\n                        : undefined\n                }\n            >\n                <VMEditorWithContext />\n            </BlockProvider>\n        </NoSsr>\n    )\n}\n","import React from \"react\"\nimport VMEditor from \"../../components/vm/VMEditor\"\n\nexport default function Page() {\n    return <VMEditor />\n}\n"],"names":["isHighLevelRegister","isHighLevelEvent","isCommand","jdpack","CHANGE","JDRegisterServer","SensorServer","VM_EXTERNAL_REQUEST","VMRegisterServer","serviceServer","reg","defaultValue","identifier","sendGetAsync","raiseGetRegisterEvent","name","theRealSendGetAsync","VMServiceServer","role","spec","classIdentifier","readingValues","streamingInterval","eventNameToId","regNameToId","regFieldToId","commandPackets","cmdFieldToId","packets","filter","map","regServer","addExistingRegister","fields","forEach","pkt","index","subscribe","emit","kind","tgt","cmd","addCommand","decoded","regName","respondToGetRegisterEvent","register","sendEventNameAsync","eventName","values","find","p","sendEvent","packFormat","lookupRegister","root","fld","value","undefined","writeRegister","ev","setValues","isEvent","isRegister","isIntensity","JDServiceClient","EVENT","REPORT_UPDATE","SystemReg","VMServiceClient","service","_registers","_reportUpdate","_events","registerRegister","handler","specification","mount","registerEvent","event","sendCommandAsync","commandName","sendCmdAsync","writeRegisterAsync","code","Value","setEnabled","writeRegAsync","jdreg","sendSetPackedAsync","type","Intensity","lookupRegisterAsync","reportUpdate","refresh","unpackedValue","field","f","assert","JDEventSource","serviceSpecificationFromClassIdentifier","GLOBAL_CHANGE","REGISTER_CHANGE","EXTERNAL_REQUEST","VMExceptionCode","VMException","data","Error","VMEnvironment","registers","events","serverRoles","_currentRequest","_clientEnvs","_serverEnvs","_globals","_rolesBound","_rolesUnbound","setupServers","serviceClass","globals","servers","Object","keys","k","server","serviceChanged","unmount","push","r","e","roleBound","serviceEnv","getService","getRootName","object","s","getServer","property","lookupAsync","roleName","startsWith","me","local","ep","writeGlobal","firstType","TypeMismatch","toString","clearExternalStimulii","rolesReset","hasRequest","op","completeRequest","request","initRoles","slice","roleTransition","unsubscribe","vs","unparse","ae","elements","join","caller","callee","arguments","computed","be","left","operator","right","ue","argument","raw","VMExprEvaluator","env","callEval","exprStack","tos","length","pop","evalAsync","visitExpressionAsync","ret","top","Math","abs","val","id","lit","Mutex","promises","shift","acquire","Promise","resolve","reject","then","v","ROLE_BOUND","ROLE_UNBOUND","SERVICE_PROVIDER_REMOVED","TRACE","checkProgram","compileProgram","VM_GLOBAL_CHANGE","VM_COMMAND_FAILED","VM_WATCH_CHANGE","VM_BREAKPOINT","VM_INTERNAL_ERROR","VM_LOG_ENTRY","VM_ROLE_MISSING","JDClient","JDServiceProvider","VMInternalStatus","VM_WAKE_SLEEPER","VMJumpException","label","VMTimerException","ms","VMRequestException","VMCommandEvaluator","parent","_regSaved","_changeSaved","_started","trace","msg","context","command","ee","namespace","funName","args","InternalError","newEval","evalExpressionAsync","expr","checkExpressionAsync","startAsync","inst","evaluate","neededStart","Running","a","Completed","regValue","watch","sourceId","evString","writeLog","Stopped","VMCommandRunner","handlerId","_status","_eval","stepAsync","status","VMHandlerRunner","_commandIndex","_currentCommand","stopped","_labelToIndex","commands","c","reset","gotoTop","Ready","commandIndex","wake","next","runToCompletionAsync","singleStep","singleStepCheckBreakAsync","getCommand","sid","breakpointOnAsync","singleStepAsync","Sleeping","sleepAsync","handlerWokeOnRequest","isEveryHandler","h","isRegisterChangeHandler","VMStatus","MAX_LOG","VMProgramRunner","roleManager","program","_handlerRunners","_roles","_serverRoles","_waitQueue","_everyQueue","_runQueue","_sleepQueue","_watch","_log","_breaks","_onCompletionOfExternalRequest","_in_run","compiled","errors","roles","console","debug","_env","handlers","_waitRunMutex","_breaksMutex","_sleepMutex","waitingToRunning","bus","provider","_provider","wakeSleeper","initializeRoleManagement","g","setStatus","message","last","text","count","lookupWatch","setBreakpointsAsync","breaks","b","clearBreakpointsAsync","setTimeout","handlerRunner","device","stopSleepers","startProvider","_device","cancel","resumeAsync","Paused","runAsync","getCurrentRunner","runHandlerAsync","postProcessHandler","newHead","emitBreakpoint","atTop","oneStep","brkCommand","ex","RoleNoService","done","moveToWait","unshift","q","findIndex","del","splice","handlersStarted","newRunners","sleepingRunners","hs","indexOf","clearTimeout","addRoleService","addServiceProvider","updateRole","deviceId","statusCode","log","removeServiceProvider","useContext","useEffect","useState","AppContext","ERROR","Flags","useVMRunner","autoRun","setError","runner","setRunner","_autoStart","_setAutoStart","run","newTestRunner","handleTrace","diagnostics","Grid","Typography","React","CodeBlock","VMDiagnostics","props","JSON","stringify","BlockContext","JacdacContext","DeviceAvatar","serviceProviderDefinitionFromServiceClass","useServiceServer","CancelIcon","Chip","Tooltip","TWIN_BLOCK","RoleChip","workspace","preferredDeviceId","handleRoleClick","twinBlock","getTopBlocks","inputList","fieldRow","getVariable","newBlock","variable","setValue","getId","m","getMetrics","moveBy","viewWidth","viewHeight","initSvg","render","centerOnBlock","handleDelete","useChange","BlockClientRoles","_","useMemo","PlayArrowIcon","StopIcon","IconButtonWithTooltip","PauseIcon","arrayConcatMany","PlayForWorkIcon","useMounted","IconButtonWithProgress","BugReportIcon","useWorkspaceBreakpoints","breakpoints","meta","setBreakpointHighlight","highlightBlock","VMRunnerButtons","t","indeterminate","setIndeterminate","breakpoint","setBreakpoint","pausing","paused","mounted","disabled","handleRun","handleCancel","handleResume","handlePause","handleStep","AddIcon","VMStartSimulatorButton","toggleShowDeviceHostsDialog","VMToolbar","SRV_HID_KEYBOARD","SRV_LED","SRV_LED_MATRIX","SRV_SEVEN_SEGMENT_DISPLAY","KeyboardKeyField","LEDColorField","LEDMatrixField","CODE_STATEMENT_TYPE","DATA_SCIENCE_STATEMENT_TYPE","identityTransformData","toolsColour","JDomTreeField","TwinField","createServiceColor","fieldsToFieldInputs","fieldsToMessage","fieldsToValues","getServiceInfo","roleVariable","serviceHelp","ServicesBaseDSL","toRoleType","humanify","postTransformData","SET_STATUS_LIGHT_BLOCK","ROLE_BOUND_EVENT_BLOCK","ROLE_BOUND_BLOCK","RECORD_WINDOW_BLOCK","INSPECT_BLOCK","commandColor","ServicesBlockDomainSpecificLanguage","createBlocks","options","theme","serviceColor","allServices","supportedServices","registerSimpleTypes","registerComposites","registerSimpleEnumTypes","registerCompositeEnumTypes","resolveService","cls","srv","customClientBlockDefinitions","message0","args0","KEY","colour","inputsInline","previousStatement","nextStatement","tooltip","helpUrl","expression","template","check","color","SHADOW","speed","digits","def","shortId","toLowerCase","eventClientBlocks","registerChangeByEventClientBlocks","makeRegisterChangeByEventBlocks","registerSimpleGetClientBlocks","makeRegisterSimpleGetBlocks","registerEnumGetClientBlocks","makeRegisterEnumGetBlocks","registerNumericsGetClientBlocks","makeRegisterNumericsGetBlocks","registerSetClientBlocks","makeRegisterSetBlocks","commandClientBlocks","description","_serviceBlocks","_eventFieldBlocks","makeFieldBlocks","_roleBlocks","variableTypes","defaultType","output","toolsBlocks","transformData","dataPreviewField","block","previousData","horizon","getFieldValue","createCategory","makeServicesCategories","createCategoryHelper","clientServicesCategories","commonCategory","contents","toolsCategory","servicesDSL","ServerServicesBlockDomainSpecificLanguage","makeRegisterGetSetRequestBlocks","isGet","eventServerBlocks","flatMap","eventsNoArgs","retNoArgs","eventsArgs","retArgs","registerSimpleGetServerBlocks","registerEnumGetServerBlocks","registerNumericsGetServerBlocks","registerSetServerBlocks","registerSetRequestBlocks","registerGetRequestBlocks","commandServerBlocks","serverServicesCategories","serverServicesDSL","toIdentifier","makeVMBase","LogViewField","VariablesField","WatchValueField","WATCH_BLOCK","LOG_BLOCK","VIEW_LOG_BLOCK","VARIABLES_BLOCK","toolsDSL","compileCommandToVM","blockToExpression","inputs","child","compileEventToVM","processErrors","paletteColorByIndex","WAIT_BLOCK","ON_START_BLOCK","REPEAT_EVERY_BLOCK","loopsDsl","interval","time","ops","AND","OR","EQ","NEQ","LT","GT","LTE","GTE","NEG","logicDsl","types","A","B","BOOL","compileExpressionToVM","blockToExpressionInner","prefix","ADD","MULTIPLY","DIVIDE","MINUS","mathDsl","style","extensions","vm","random","minInclusive","maxInclusive","NUM","BOOLEAN_TYPE","JSON_TYPE","PRIMITIVE_TYPES","JSON_FIELD_TYPE","JSON_OBJECT_BLOCK","JSON_FIELD_SET_BLOCK","JSON_FIELD_GET_TEMPLATE","JSON_FIELD_VALUE_TYPE","JSON_FIELD_HAS_BLOCK","jsonDSL","spellcheck","definition","DataColumnChooserField","GaugeWidgetField","DASHBOARD_GAUGE_BLOCK","widgetDSL","dataType","toolsDsl","variablesDsl","shadowDsl","fieldsDsl","jsonDsl","chartDsl","dataDsl","vmDsls","NoSsr","useCallback","BlockProvider","BlockDiagnostics","workspaceJSONToVMProgram","BlockEditor","VM_WARNINGS_CATEGORY","WORKSPACE_FILENAME","FileTabs","FileSystemContext","resolveWorkspaceServices","VM_EDITOR_ID","VM_SOURCE_STORAGE_KEY","VM_NEW_FILE_CONTENT","editor","xml","VMEditorWithContext","dsls","workspaceJSON","setWarnings","dragging","fileSystem","setProgram","autoStart","newProgram","error","updateRoles","services","VMEditor","handleOnBeforeSaveWorkspaceFile","file","json","Page"],"sourceRoot":""}