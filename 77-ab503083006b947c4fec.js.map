{"version":3,"sources":["webpack:///./src/components/dashboard/DashboardLED.tsx"],"names":["DashboardLED","props","useContext","JacdacContext","bus","service","services","variant","widgetSize","useWidgetSize","length","host","useServiceHost","color","useWidgetTheme","active","brightnessRegister","register","LedReg","Brightness","useRegisterUnpackedValue","brightness","animationData","Animation","WaveLength","waveLength","LedCount","ledCount","animation","useMemo","LedAnimation","useAnimationFrame","update","timestamp","hsv","useChange","a","handleBrightnessChange","ev","newValue","sendSetPackedAsync","undefined","opacity","fill","hsvToCss","ln","Math","min","lw","m","w","h","Array","map","_","i"],"mappings":"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","file":"77-ab503083006b947c4fec.js","sourcesContent":["import React, { useContext, useMemo } from \"react\";\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\";\nimport useWidgetSize from \"../widgets/useWidgetSize\";\nimport useServiceHost from \"../hooks/useServiceHost\";\nimport SvgWidget from \"../widgets/SvgWidget\";\nimport useWidgetTheme from \"../widgets/useWidgetTheme\";\nimport useChange from \"../../jacdac/useChange\";\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\";\nimport useAnimationFrame from \"../hooks/useAnimationFrame\";\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\";\nimport { Grid, Slider } from \"@material-ui/core\";\nimport LEDServiceHost, { LedAnimation, LedAnimationData } from \"../../../jacdac-ts/src/hosts/ledservicehost\";\nimport { LedReg } from \"../../../jacdac-ts/src/jdom/constants\";\nimport { hsvToCss } from \"../../../jacdac-ts/src/jdom/color\";\nimport LoadingProgress from \"../ui/LoadingProgress\";\n\nexport default function DashboardLED(props: DashboardServiceProps) {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { service, services, variant } = props;\n    const widgetSize = useWidgetSize(variant, services.length);\n    const host = useServiceHost<LEDServiceHost>(service);\n    const color = host ? \"secondary\" : \"primary\";\n    const { active } = useWidgetTheme(color);\n    const brightnessRegister = service.register(LedReg.Brightness);\n    const [brightness] = useRegisterUnpackedValue<[number]>(brightnessRegister);\n    const animationData = useRegisterUnpackedValue<LedAnimationData>(service.register(LedReg.Animation));\n    const [waveLength] = useRegisterUnpackedValue<[number]>(service.register(LedReg.WaveLength));\n    const [ledCount] = useRegisterUnpackedValue<[number]>(service.register(LedReg.LedCount));\n\n    // restart animation with steps\n    const animation = useMemo(() => new LedAnimation(animationData), [animationData])\n    // animate\n    useAnimationFrame(() => {\n        animation.update(bus.timestamp); return true;\n    }, [animation])\n\n    const hsv = useChange(animation, a => a?.hsv)\n\n    const handleBrightnessChange = async (ev: unknown, newValue: number | number[]) => {\n        await brightnessRegister.sendSetPackedAsync(\"u0.16\", [newValue as number], true);\n    }\n\n    // nothing to see\n    if (hsv === undefined)\n        return <LoadingProgress />;\n\n    const opacity = brightness;\n    const fill = hsvToCss(hsv[0], hsv[1], hsv[2], brightness * 0xff, waveLength !== undefined);\n\n    const ln = Math.min(ledCount || 1, 5)\n    const lw = 15.5;\n    const m = 1;\n    const w = (lw + m) * ln;\n    const h = 42;\n    return <Grid container spacing={2}>\n        <Grid item xs={2}>\n            {brightness !== undefined && <Slider\n                orientation=\"vertical\"\n                min={0} max={1}\n                step={0.01}\n                color={color}\n                valueLabelDisplay=\"off\"\n                value={brightness}\n                onChange={handleBrightnessChange} />}\n        </Grid>\n        <Grid item xs={10}>\n            <SvgWidget width={w} height={h} size={\"5em\"}>\n                {Array(ln).fill(0).map((_, i) =>\n                    <g key={i} transform={`translate(${i * (lw + m)}, 0)`}>\n                        <path fill=\"#999\" d=\"M14.2 13V7.1C14.2 3.2 11 0 7.1 0 3.2 0 0 3.2 0 7.1v13.7c1.9 1.9 4.4 2.9 7.1 2.8 4.6 0 8.4-2.6 8.4-5.9v-1.5c0-1.2-.5-2.3-1.3-3.2z\" opacity=\".65\" />\n                        <path fill=\"#8c8c8c\" d=\"M2.8 17.5l-1.2-1.4h1L5 17.5v18.6c0 .3-.5.5-1.1.5-.6 0-1.1-.2-1.1-.5zm10.1 6.7c0-.7-1.1-1.3-2.1-1.8-.4-.2-1.2-.6-1.2-.9v-3.4l2.5-2h-.9l-3.7 2v3.5c0 .7.9 1.2 1.9 1.7.4.2 1.3.8 1.3 1.1v16.9c0 .4.5.7 1.1.7.6 0 1.1-.3 1.1-.7z\" />\n                        <path opacity={opacity} fill={fill} d=\"M14.2 13V7.1C14.2 3.2 11 0 7.1 0 3.2 0 0 3.2 0 7.1v13.7c1.9 1.9 4.4 2.9 7.1 2.8 4.6 0 8.4-2.6 8.4-5.9v-1.5c0-1.2-.5-2.3-1.3-3.2z\" />\n                        <path fill=\"#d1d1d1\" d=\"M14.2 13v3.1c0 2.7-3.2 5-7.1 5-3.9 0-7.1-2.2-7.1-5v4.6c1.9 1.9 4.4 2.9 7.1 2.8 4.6 0 8.4-2.6 8.4-5.9v-1.5c0-1.1-.5-2.2-1.3-3.1z\" opacity=\".9\" />\n                        <path fill=\"#e6e6e6\" d=\"M14.2 13v3.1c0 2.7-3.2 5-7.1 5-3.9 0-7.1-2.2-7.1-5v4.6c1.9 1.9 4.4 2.9 7.1 2.8 4.6 0 8.4-2.6 8.4-5.9v-1.5c0-1.1-.5-2.2-1.3-3.1z\" opacity=\".7\" />\n                        <path fill=\"#e6e6e6\" d=\"M14.2 13v3.1c0 2.7-3.2 5-7.1 5-3.9 0-7.1-2.2-7.1-5v3.1c1.9 1.9 4.4 2.9 7.1 2.8 4.6 0 8.4-2.6 8.4-5.9 0-1.1-.5-2.2-1.3-3.1z\" opacity=\".25\" />\n                        <ellipse cx=\"-7.2\" cy=\"-16.1\" fill=\"#e6e6e6\" opacity=\".25\" rx=\"7.1\" ry=\"5\" transform=\"scale(-1)\" />\n                        <ellipse cx=\"-7.2\" cy=\"-16.1\" fill=\"#e6e6e6\" opacity=\".25\" rx=\"7.1\" ry=\"5\" transform=\"scale(-1)\" />\n                        <path opacity=\".61\" fill=\"#fff\" d=\"M7.2 22c-4.3 0-6.1-2-6.1-2l.7-.7S3.4 21 7.2 21c2.4.1 4.7-.9 6.3-2.7l.8.6C12.4 21 9.9 22.1 7.2 22z\" />\n                        <path opacity=\".61\" fill=\"#fff\" d=\"M2.6 3.2C1.5 4.3.9 5.8.9 7.4v10.3l1.9 1.5V8.8c-.9-2.8-.3-4.2.7-5.2-.3-.1-.6-.2-.9-.4zm7.3-1.6l-.3.9c1.5.7 2.6 2.1 2.8 3.7h1c-.3-2-1.6-3.7-3.5-4.6z\" />\n                    </g>)}\n            </SvgWidget>\n        </Grid>\n    </Grid>\n}"],"sourceRoot":""}