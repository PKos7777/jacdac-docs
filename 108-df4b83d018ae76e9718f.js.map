{"version":3,"sources":["webpack:///./src/components/dashboard/DashboardAccelerometer.tsx"],"names":["CanvasWidget","lazy","valueDisplay","v","roundWithPrecision","Sliders","props","host","register","forces","useRegisterUnpackedValue","handleChangeX","event","newValue","reading","values","y","n","nz","Math","sqrt","setValues","sendGetAsync","handleChangeY","x","length","min","max","step","marks","value","lerp","v0","v1","t","DashboardAccelerometer","service","AccelerometerReg","Forces","useServiceHost","color","useWidgetTheme","active","rotator","useCallback","delta","rotation","unpackedValue","undefined","z","roll","atan2","pitch","atan"],"mappings":"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","file":"108-df4b83d018ae76e9718f.js","sourcesContent":["import React, { lazy, useCallback, ChangeEvent } from \"react\"\nimport { AccelerometerReg } from \"../../../jacdac-ts/src/jdom/constants\"\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\"\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\"\nimport useWidgetTheme from \"../widgets/useWidgetTheme\"\nimport useServiceHost from \"../hooks/useServiceHost\"\nimport SensorServiceHost from \"../../../jacdac-ts/src/hosts/sensorservicehost\"\nimport { JDRegister } from \"../../../jacdac-ts/src/jdom/register\"\nimport { Grid, Mark, NoSsr } from \"@material-ui/core\"\nimport { roundWithPrecision } from \"../../../jacdac-ts/src/jdom/utils\"\nimport { Vector } from \"../widgets/threeutils\"\nimport LoadingProgress from \"../ui/LoadingProgress\"\nimport Suspense from \"../ui/Suspense\"\nimport SliderWithLabel from \"../ui/SliderWithLabel\"\n\nconst CanvasWidget = lazy(() => import(\"../widgets/CanvasWidget\"))\n\nconst valueDisplay = (v: number) => roundWithPrecision(v, 1)\nfunction Sliders(props: {\n    host: SensorServiceHost<[number, number, number]>\n    register: JDRegister\n}) {\n    const { host, register } = props\n    const forces = useRegisterUnpackedValue<[number, number, number]>(register)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const handleChangeX: any = async (\n        event: unknown,\n        newValue: number | number[]\n    ) => {\n        const [, y] = host.reading.values()\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const n = (newValue as any) as number\n        const nz = -Math.sqrt(1 - (n * n + y * y))\n        host.reading.setValues([n, y, nz])\n        await register.sendGetAsync()\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const handleChangeY: any = async (event: unknown, newValue: number | number[]) => {\n        const [x] = host.reading.values()\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const n = (newValue as any) as number\n        const nz = -Math.sqrt(1 - (x * x + n * n))\n        host.reading.setValues([x, n, nz])\n        await register.sendGetAsync()\n    };\n\n    if (!forces?.length) return <LoadingProgress />\n    const [x, y] = forces\n    const min = -2\n    const max = 2\n    const step = 0.1\n    const marks: Mark[] = [\n        {\n            value: 0,\n        },\n        {\n            value: -1,\n        },\n        {\n            value: 1,\n        },\n    ]\n    return (\n        <>\n            <Grid item xs={12}>\n                <SliderWithLabel\n                    label=\"X\"\n                    valueLabelDisplay=\"auto\"\n                    valueLabelFormat={valueDisplay}\n                    aria-label=\"x\"\n                    min={min}\n                    max={max}\n                    step={step}\n                    value={x}\n                    onChange={handleChangeX}\n                    marks={marks}\n                />\n            </Grid>\n            <Grid item xs={12}>\n                <SliderWithLabel\n                    label=\"Y\"\n                    valueLabelDisplay=\"auto\"\n                    valueLabelFormat={valueDisplay}\n                    aria-label=\"y\"\n                    min={min}\n                    max={max}\n                    step={step}\n                    value={y}\n                    onChange={handleChangeY}\n                    marks={marks}\n                />\n            </Grid>\n        </>\n    )\n}\n\nfunction lerp(v0: number, v1: number, t: number) {\n    return v0 * (1 - t) + v1 * t\n}\n\nexport default function DashboardAccelerometer(props: DashboardServiceProps) {\n    const { service } = props\n    const register = service.register(AccelerometerReg.Forces)\n    const host = useServiceHost<SensorServiceHost<[number, number, number]>>(\n        service\n    )\n    const color = host ? \"secondary\" : \"primary\"\n    const { active } = useWidgetTheme(color)\n    const rotator = useCallback(\n        (delta: number, rotation: Vector) => {\n            const forces = register.unpackedValue\n            if (!forces) return undefined\n            const [x, y, z] = forces\n            const roll = Math.atan2(-y, z)\n            const pitch = Math.atan(x / (y * y + z * z))\n\n            return {\n                x: lerp(rotation.x, roll, 0.1),\n                y: 0,\n                z: lerp(rotation.z, pitch, 0.1),\n            }\n        },\n        [register]\n    )\n\n    return (\n        <Grid container direction=\"row\">\n            <Grid item>\n                <NoSsr>\n                    <Suspense>\n                        <CanvasWidget\n                            showAxes={true}\n                            color={active}\n                            rotator={rotator}\n                        />\n                    </Suspense>\n                </NoSsr>\n            </Grid>\n            {host && <Sliders host={host} register={register} />}\n        </Grid>\n    )\n}\n"],"sourceRoot":""}