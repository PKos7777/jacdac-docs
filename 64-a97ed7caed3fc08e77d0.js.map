{"version":3,"sources":["webpack:///./src/components/dashboard/DashboardAnalogButton.tsx"],"names":["ACTIVE_SPEED","INACTIVE_SPEED","DashboardAnalogButton","props","service","services","variant","pressureRegister","register","AnalogButtonReg","Pressure","useRegisterUnpackedValue","pressure","ActiveThreshold","activeThreshold","widgetSize","host","useServiceHost","useState","down","setDown","color","label","useWidgetTheme","background","controlBackground","active","handleDown","handleUp","buttonProps","useSvgButtonProps","useAnimationFrame","reading","values","p","keepAnimating","setValues","sendGetAsync","undefined","buttonActive","w","mo","r","cx","cy","ro","rp","ri","ps","range","a","d","describeArc"],"mappings":"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","file":"64-a97ed7caed3fc08e77d0.js","sourcesContent":["import React, { useState } from \"react\";\nimport { AnalogButtonReg, AnalogButtonVariant } from \"../../../jacdac-ts/src/jdom/constants\";\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\";\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\";\nimport useWidgetSize from \"../widgets/useWidgetSize\";\nimport useServiceHost from \"../hooks/useServiceHost\";\nimport SvgWidget from \"../widgets/SvgWidget\";\nimport useSvgButtonProps from \"../hooks/useSvgButtonProps\";\nimport useWidgetTheme from \"../widgets/useWidgetTheme\";\nimport { describeArc } from \"../widgets/svgutils\";\nimport AnalogSensorServiceHost from \"../../../jacdac-ts/src/hosts/analogsensorservicehost\";\nimport useAnimationFrame from \"../hooks/useAnimationFrame\";\n\nconst ACTIVE_SPEED = 0.05\nconst INACTIVE_SPEED = 0.1\n\nexport default function DashboardAnalogButton(props: DashboardServiceProps) {\n    const { service, services, variant } = props;\n    const pressureRegister = service.register(AnalogButtonReg.Pressure);\n    const [pressure] = useRegisterUnpackedValue<[number]>(pressureRegister)\n    const [activeThreshold] = useRegisterUnpackedValue<[number]>(service.register(AnalogButtonReg.ActiveThreshold))\n    //const [buttonVariant] = useRegisterUnpackedValue<[AnalogButtonVariant]>(service.register(AnalogButtonReg.Variant));\n    const widgetSize = `clamp(5em, 25vw, 100%)`\n    const host = useServiceHost<AnalogSensorServiceHost>(service);\n    const [down, setDown] = useState(false)\n    const color = host ? \"secondary\" : \"primary\";\n    const label = `button pressure ${pressure}`\n    const { background, controlBackground, active } = useWidgetTheme(color);\n    const handleDown = () => {\n        setDown(true)\n    }\n    const handleUp = () => {\n        setDown(false)\n    }\n    const buttonProps = useSvgButtonProps<SVGCircleElement>(label, host && handleDown, host && handleUp)\n\n    useAnimationFrame(() => {\n        if (!host) return false;\n        const [p] = host.reading.values();\n        let keepAnimating = true;\n        if (down) {\n            if (p > 1 - ACTIVE_SPEED) {\n                host.reading.setValues([1]);\n                keepAnimating = false;\n            } else\n                host.reading.setValues([p + ACTIVE_SPEED]);\n        } else {\n            if (p < INACTIVE_SPEED) {\n                host.reading.setValues([0]);\n                keepAnimating = false;\n            } else\n                host.reading.setValues([p - INACTIVE_SPEED]);\n        }\n        host.reading.sendGetAsync(); // refresh ui\n        return keepAnimating;\n    }, [down])\n\n    if (pressure === undefined)\n        return null;\n\n    const buttonActive = pressure > activeThreshold;\n    const w = 64;\n    const mo = down ? 3 : 5;\n    const r = w / 2;\n    const cx = r;\n    const cy = r;\n    const ro = r;\n    const rp = r - mo;\n    const ri = rp - mo;\n    const ps = mo;\n\n    const range = 360;\n    const a = pressure * range;\n    const d = describeArc(cx, cy, rp, 0, a)\n\n    /*\n        {buttonVariant === AnalogButtonVariant.Capacitive && <path transform={`translate(20,20)`} aria-hidden={true}\n            pointerEvents=\"none\"\n            style={{ userSelect: \"none\" }}\n            fill={background}\n            d=\"M17.81 4.47c-.08 0-.16-.02-.23-.06C15.66 3.42 14 3 12.01 3c-1.98 0-3.86.47-5.57 1.41-.24.13-.54.04-.68-.2-.13-.24-.04-.55.2-.68C7.82 2.52 9.86 2 12.01 2c2.13 0 3.99.47 6.03 1.52.25.13.34.43.21.67-.09.18-.26.28-.44.28zM3.5 9.72c-.1 0-.2-.03-.29-.09-.23-.16-.28-.47-.12-.7.99-1.4 2.25-2.5 3.75-3.27C9.98 4.04 14 4.03 17.15 5.65c1.5.77 2.76 1.86 3.75 3.25.16.22.11.54-.12.7-.23.16-.54.11-.7-.12-.9-1.26-2.04-2.25-3.39-2.94-2.87-1.47-6.54-1.47-9.4.01-1.36.7-2.5 1.7-3.4 2.96-.08.14-.23.21-.39.21zm6.25 12.07c-.13 0-.26-.05-.35-.15-.87-.87-1.34-1.43-2.01-2.64-.69-1.23-1.05-2.73-1.05-4.34 0-2.97 2.54-5.39 5.66-5.39s5.66 2.42 5.66 5.39c0 .28-.22.5-.5.5s-.5-.22-.5-.5c0-2.42-2.09-4.39-4.66-4.39-2.57 0-4.66 1.97-4.66 4.39 0 1.44.32 2.77.93 3.85.64 1.15 1.08 1.64 1.85 2.42.19.2.19.51 0 .71-.11.1-.24.15-.37.15zm7.17-1.85c-1.19 0-2.24-.3-3.1-.89-1.49-1.01-2.38-2.65-2.38-4.39 0-.28.22-.5.5-.5s.5.22.5.5c0 1.41.72 2.74 1.94 3.56.71.48 1.54.71 2.54.71.24 0 .64-.03 1.04-.1.27-.05.53.13.58.41.05.27-.13.53-.41.58-.57.11-1.07.12-1.21.12zM14.91 22c-.04 0-.09-.01-.13-.02-1.59-.44-2.63-1.03-3.72-2.1-1.4-1.39-2.17-3.24-2.17-5.22 0-1.62 1.38-2.94 3.08-2.94 1.7 0 3.08 1.32 3.08 2.94 0 1.07.93 1.94 2.08 1.94s2.08-.87 2.08-1.94c0-3.77-3.25-6.83-7.25-6.83-2.84 0-5.44 1.58-6.61 4.03-.39.81-.59 1.76-.59 2.8 0 .78.07 2.01.67 3.61.1.26-.03.55-.29.64-.26.1-.55-.04-.64-.29-.49-1.31-.73-2.61-.73-3.96 0-1.2.23-2.29.68-3.24 1.33-2.79 4.28-4.6 7.51-4.6 4.55 0 8.25 3.51 8.25 7.83 0 1.62-1.38 2.94-3.08 2.94s-3.08-1.32-3.08-2.94c0-1.07-.93-1.94-2.08-1.94s-2.08.87-2.08 1.94c0 1.71.66 3.31 1.87 4.51.95.94 1.86 1.46 3.27 1.85.27.07.42.35.35.61-.05.23-.26.38-.47.38z\"></path>}\n            */\n\n\n\n    return <SvgWidget width={w} size={widgetSize}>\n        <rect x={0} y={0} rx={2} ry={2} width={w} height={w} fill={background} />\n        {pressure && <path d={d} stroke={active} strokeLinecap={\"round\"} strokeWidth={ps} />}\n        <circle cx={cx} cy={mo} r={mo / 3}\n            aria-label={`active threshold ${activeThreshold}`}\n            fill={controlBackground} transform={`rotate(${range * activeThreshold}, ${cx}, ${cy})`} />\n        <circle cx={cx} cy={cy} r={ri}\n            aria-live=\"polite\"\n            fill={buttonActive ? active : controlBackground}\n            {...buttonProps}\n        />\n    </SvgWidget>\n}"],"sourceRoot":""}