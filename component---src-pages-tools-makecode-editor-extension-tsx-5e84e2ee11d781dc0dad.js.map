{"version":3,"sources":["webpack://jacdac-docs/./node_modules/@material-ui/icons/Add.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/Delete.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/Save.js","webpack://jacdac-docs/./jacdac-ts/src/azure-iot/dtdl.ts","webpack://jacdac-docs/./src/components/AddServiceIconButton.tsx","webpack://jacdac-docs/./src/components/ServiceSpecificationSelect.tsx","webpack://jacdac-docs/./src/components/ui/PaperBox.tsx","webpack://jacdac-docs/./src/components/makecode/MakeCodeEditorExtensionClient.ts","webpack://jacdac-docs/./src/components/makecode/MakeCodeEditorExtension.tsx","webpack://jacdac-docs/./src/pages/tools/makecode-editor-extension.tsx"],"names":["DTDL_REFERENCE_URL","DTDL_NAME","DTDL_CONTEXT","toDTMI","segments","version","map","seg","undefined","toString","replace","join","toLowerCase","toUnit","pkt","fields","length","field","unit","units","semantic","rad","m","m2","s","ms","us","K","C","F","g","mA","uA","A","mV","uV","V","indexOf","enumDTDI","srv","en","classIdentifier","name","enumSchema","dtdl","valueSchema","enumValues","Object","keys","members","k","escapeName","displayName","enumValue","fieldType","type","isFloat","isSimpleType","test","shift","enums","objectSchema","schemas","arraySchema","schema","elementSchema","toSchema","supportsArray","startRepeats","repeatIndex","findIndex","nonRepeat","slice","repeats","packetToDTDL","types","const","rw","ro","event","kind","description","writable","trim","escapeDisplayName","serviceSpecificationToDTDL","serviceSpecificationDTMI","notes","contents","packets","filter","derived","internal","e","console","log","c","extends","id","serviceSpecificationFromName","hasEvents","find","hasEnums","push","concat","serviceSpecificationToComponent","deviceSpecificationDTMI","dev","DTMIToRoute","dtmi","route","deviceSpecificationToDTDL","options","services","serviceSpecificationFromClassIdentifier","uniqueServices","uniqueMap","names","forEach","shortId","shortName","count","i","inlineServices","AddServiceIconButton","props","error","onAdd","children","serviceFilter","React","servicesAnchorEl","setServicesAnchorEl","servicesMenuId","useId","useMemo","serviceSpecifications","isInfrastructure","handleServiceAddClick","currentTarget","handleServiceAddClose","Boolean","useStyles","makeStyles","createStyles","root","minWidth","ServiceSpecificationSelect","label","serviceClass","setServiceClass","variant","fullWidth","useState","Math","random","labelId","classes","specs","spec","handleChange","parseInt","target","value","PaperBox","padding","elevation","bgcolor","others","theme","useTheme","spacing","READ","MESSAGE_PACKET","HIDDEN","SHOWN","SENDER","MakeCodeEditorExtensionClient","pendingCommands","extensionId","inIFrame","window","location","hash","substr","_connected","_visible","nextRequestId","handleMessage","bind","addEventListener","mount","removeEventListener","on","refresh","init","setVisible","vis","emit","CHANGE","mkRequest","resolve","reject","action","body","extId","response","sendRequest","Promise","msg","parent","postMessage","ev","data","_target","CONNECT","debug","success","resp","read","r","readUser","write","code","json","jres","dependencies","queryPermission","requestPermission","dataStreamConsole","dataStreamMessages","messages","JDClient","useMakeCodeEditorExtensionClient","useContext","JacdacContext","bus","client","setClient","useEffect","clear","channel","source","pkts","Packet","timestamp","sender","processPacket","unmount","toTypescript","config","ns","roles","role","camelize","resolveMakecodeServiceFromClassIdentifier","service","qName","toDependencies","mk","repo","toJSON","JSON","stringify","ClientRoleRow","component","onUpdate","validateClientRole","nameError","serviceError","textId","handleComponentNameChange","handleSetService","handleComponentDelete","splice","MakeCodeEditorExtension","connected","useChange","configuration","setConfiguration","subscribe","cfg","JSONTryParse","hasMakeCodeService","resolveMakecodeService","update","clone","handleAddService","camelName","n","uniqueName","handleSave","ts","deps","content","display","minHeight","flexDirection","transition","transitions","create","easing","sharp","duration","leavingScreen","flexGrow","MakeCodeEditorExtensionPage","DarkModeContext","toggleDarkMode","darkModeMounted","rawTheme","createMuiTheme","palette","primary","main","secondary","contrastThreshold","responsiveFontSizes"],"mappings":"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","file":"component---src-pages-tools-makecode-editor-extension-tsx-5e84e2ee11d781dc0dad.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\"\n}), 'Add');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\"\n}), 'Delete');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z\"\n}), 'Save');\n\nexports.default = _default;","/* eslint-disable @typescript-eslint/no-explicit-any */\n/***\n * Jacdac service/device specification to DTDL\n *\n *  DTDL specification: https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/dtdlv2.md.\n */\n\nimport {\n    serviceSpecificationFromClassIdentifier,\n    serviceSpecificationFromName,\n} from \"../jdom/spec\"\nimport { uniqueMap } from \"../jdom/utils\"\n\nexport const DTDL_REFERENCE_URL =\n    \"https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/dtdlv2.md\"\nexport const DTDL_NAME = \"Digital Twins Definition Language\"\nexport const DTDL_CONTEXT = \"dtmi:dtdl:context;2\"\n\n// https://github.com/Azure/digital-twin-model-identifier\n// ^dtmi:(?:_+[A-Za-z0-9]|[A-Za-z])(?:[A-Za-z0-9_]*[A-Za-z0-9])?(?::(?:_+[A-Za-z0-9]|[A-Za-z])(?:[A-Za-z0-9_]*[A-Za-z0-9])?)*;[1-9][0-9]{0,8}$\nfunction toDTMI(segments: (string | number)[], version?: number) {\n    return `dtmi:jacdac:${[...segments]\n        .map(seg =>\n            seg === undefined\n                ? \"???\"\n                : typeof seg === \"string\"\n                ? seg\n                : `x${seg.toString(16)}`\n        )\n        .map(seg => seg.replace(/(-|_)/g, \"\"))\n        .join(\":\")};${version !== undefined ? version : 1}`.toLowerCase()\n}\n\nfunction toUnit(pkt: jdspec.PacketInfo) {\n    if (pkt.fields.length !== 1) return undefined\n    const field = pkt.fields[0]\n    if (!field.unit) return undefined\n\n    /**\n     *     type Unit = \"m\" | \"kg\" | \"g\" | \"s\" | \"A\" | \"K\" | \"cd\" | \"mol\" | \"Hz\" | \"rad\" | \"sr\" | \"N\" | \"Pa\" | \"J\" | \"W\" | \"C\" | \"V\" | \"F\" | \"Ohm\"\n        | \"S\" | \"Wb\" | \"T\" | \"H\" | \"Cel\" | \"lm\" | \"lx\" | \"Bq\" | \"Gy\" | \"Sv\" | \"kat\" | \"m2\" | \"m3\" | \"l\" | \"m/s\" | \"m/s2\" | \"m3/s\" | \"l/s\"\n        | \"W/m2\" | \"cd/m2\" | \"bit\" | \"bit/s\" | \"lat\" | \"lon\" | \"pH\" | \"dB\" | \"dBW\" | \"Bspl\" | \"count\" | \"/\" | \"%RH\" | \"%EL\" | \"EL\"\n        | \"1/s\" | \"1/min\" | \"beat/min\" | \"beats\" | \"S/m\" | \"B\" | \"VA\" | \"VAs\" | \"var\" | \"vars\" | \"J/m\" | \"kg/m3\" | \"deg\";\n\n    type SecondaryUnit = \"ms\" | \"min\" | \"h\" | \"MHz\" | \"kW\" | \"kVA\" | \"kvar\" | \"Ah\" | \"Wh\" | \"kWh\"\n        | \"varh\" | \"kvarh\" | \"kVAh\" | \"Wh/km\" | \"KiB\" | \"GB\" | \"Mbit/s\" | \"B/s\" | \"MB/s\" | \"mV\" | \"mA\" | \"dBm\" | \"ug/m3\"\n        | \"mm/h\" | \"m/h\" | \"ppm\" | \"/100\" | \"/1000\" | \"hPa\" | \"mm\" | \"cm\" | \"km\" | \"km/h\";\n     */\n    const units: jdspec.SMap<{ semantic: string; unit: string }> = {\n        \"m/s2\": {\n            semantic: \"Acceleration\",\n            unit: \"metrePerSecondSquared\",\n        },\n        rad: {\n            semantic: \"Angle\",\n            unit: \"radian\",\n        },\n        \"rad/s\": {\n            semantic: \"AngularVelocity\",\n            unit: \"radianPerSecond\",\n        },\n        \"rad/s2\": {\n            semantic: \"AngularAcceleration\",\n            unit: \"radianPerSecondSquared\",\n        },\n        m: {\n            semantic: \"Length\",\n            unit: \"metre\",\n        },\n        m2: {\n            semantic: \"Area\",\n            unit: \"squareMetre\",\n        },\n        s: {\n            semantic: \"TimeSpan\",\n            unit: \"second\",\n        },\n        ms: {\n            semantic: \"TimeSpan\",\n            unit: \"millisecond\",\n        },\n        us: {\n            semantic: \"TimeSpan\",\n            unit: \"microsecond\",\n        },\n        K: {\n            semantic: \"Temperature\",\n            unit: \"kelvin\",\n        },\n        C: {\n            semantic: \"Temperature\",\n            unit: \"degreeCelsius\",\n        },\n        F: {\n            semantic: \"Temperature\",\n            unit: \"degreeFahrenheit\",\n        },\n        g: {\n            semantic: \"Acceleration\",\n            unit: \"gForce\",\n        },\n        mA: {\n            semantic: \"Current\",\n            unit: \"milliampere\",\n        },\n        uA: {\n            semantic: \"Current\",\n            unit: \"microampere\",\n        },\n        A: {\n            semantic: \"Current\",\n            unit: \"ampere\",\n        },\n        mV: {\n            semantic: \"Voltage\",\n            unit: \"millivolt\",\n        },\n        uV: {\n            semantic: \"Voltage\",\n            unit: \"microvolt\",\n        },\n        V: {\n            semantic: \"Voltage\",\n            unit: \"volt\",\n        },\n    }\n    const unit = units[field.unit]\n    if (unit) return unit\n\n    // ignoring some known units\n    if ([\"#\", \"/\"].indexOf(field.unit) > -1) return undefined\n\n    //console.warn(`unsupported unit ${field.unit}`)\n    return undefined\n}\n\n// https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/dtdlv2.md#primitive-schemas\n\nfunction enumDTDI(srv: jdspec.ServiceSpec, en: jdspec.EnumInfo): string {\n    return toDTMI([srv.classIdentifier, en.name])\n}\n\nfunction enumSchema(srv: jdspec.ServiceSpec, en: jdspec.EnumInfo): DTDLSchema {\n    const dtdl = {\n        \"@type\": \"Enum\",\n        \"@id\": enumDTDI(srv, en),\n        valueSchema: \"integer\",\n        enumValues: Object.keys(en.members).map(k => ({\n            name: escapeName(k),\n            displayName: k,\n            enumValue: en.members[k],\n        })),\n    }\n    return dtdl\n}\n\nfunction fieldType(\n    srv: jdspec.ServiceSpec,\n    pkt: jdspec.PacketInfo,\n    field: jdspec.PacketMember\n) {\n    let type: string\n    if (field.type == \"bool\") type = \"boolean\"\n    else if (field.isFloat) type = \"float\"\n    else if (field.isSimpleType) {\n        if (/^(u|i)/.test(field.type)) type = \"integer\"\n        else if (field.type === \"B\")\n            // base64 encoded binary data\n            type = \"string\"\n    } else if (field.type === \"string\" || field.type == \"string0\")\n        type = \"string\"\n    else if (field.shift && /^(u|i)/.test(field.type)) type = \"float\"\n    // decimal type\n    else {\n        const en = srv.enums[field.type]\n        if (en) type = enumDTDI(srv, en)\n    }\n\n    //if (!type)\n    //    console.warn(`unknown field type ${field.type}`, field)\n\n    return {\n        name: field.name == \"_\" ? pkt.name : field.name,\n        type: type,\n    }\n}\n\n// warps fields into an object\nfunction objectSchema(schemas: DTDLSchema[]): DTDLSchema {\n    return {\n        \"@type\": \"Object\",\n        fields: schemas,\n    }\n}\n\n// wraps a schema into an array\nfunction arraySchema(schema: string | DTDLSchema): DTDLSchema {\n    return {\n        \"@type\": \"Array\",\n        elementSchema: schema,\n    }\n}\n\n// converts JADAC pkt data layout into a DTDL schema\nfunction toSchema(\n    srv: jdspec.ServiceSpec,\n    pkt: jdspec.PacketInfo,\n    supportsArray?: boolean\n): string | DTDLSchema {\n    const fields = pkt.fields.map(field => fieldType(srv, pkt, field))\n    if (!fields.length) return undefined\n\n    // a single data entry\n    if (fields.length === 1 && !pkt.fields[0].startRepeats)\n        return fields[0].type\n\n    // map fields into schema\n    const schemas: DTDLSchema[] = fields.map(field => ({\n        name: field.name,\n        schema: field.type,\n    }))\n\n    // is there an array?\n    const repeatIndex = pkt.fields.findIndex(field => field.startRepeats)\n\n    if (repeatIndex < 0) {\n        // no array\n        // wrap schemas into an object\n        return objectSchema(schemas)\n    }\n\n    // check if arrays are supported\n    if (!supportsArray) {\n        //console.warn(`arrays not supported in ${srv.shortName}.${pkt.name}`)\n        return undefined\n    }\n\n    if (repeatIndex == 0) {\n        // the whole structure is an array\n        return arraySchema(objectSchema(schemas))\n    } else {\n        // split fields into prelude and array data\n        const nonRepeat = schemas.slice(0, repeatIndex)\n        const repeats = schemas.slice(repeatIndex)\n        return objectSchema([\n            ...nonRepeat,\n            {\n                name: \"repeat\",\n                schema: arraySchema(\n                    repeats.length > 1 ? objectSchema(repeats) : repeats[0]\n                ),\n            },\n        ])\n    }\n}\n\nfunction packetToDTDL(\n    srv: jdspec.ServiceSpec,\n    pkt: jdspec.PacketInfo\n): DTDLContent {\n    const types: jdspec.SMap<string> = {\n        const: \"Property\",\n        rw: \"Property\",\n        ro: \"Telemetry\",\n        event: \"Telemetry\",\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const dtdl: any = {\n        \"@type\": types[pkt.kind] || `Unsupported${pkt.kind}`,\n        name: pkt.name,\n        \"@id\": toDTMI([srv.classIdentifier, pkt.kind, pkt.name]),\n        description: pkt.description,\n    }\n    switch (pkt.kind) {\n        case \"report\":\n        case \"command\":\n            // https://docs.microsoft.com/en-us/azure/digital-twins/concepts-models#azure-digital-twins-dtdl-implementation-specifics\n            return undefined\n        case \"const\":\n        case \"rw\":\n        case \"ro\":\n        case \"event\": {\n            const unit = toUnit(pkt)\n            if (unit) {\n                dtdl.unit = unit.unit\n            }\n            dtdl.schema = toSchema(srv, pkt, false)\n            if (pkt.kind === \"rw\") dtdl.writable = true\n            if (!dtdl.schema && pkt.kind === \"event\") {\n                // keep a count of the events\n                dtdl[\"@type\"] = [dtdl[\"@type\"], \"Event\"]\n                dtdl.schema = toDTMI([srv.classIdentifier, \"event\"])\n            } else if (unit && unit.semantic)\n                dtdl[\"@type\"] = [dtdl[\"@type\"], unit.semantic]\n            break\n        }\n        default:\n            //console.log(`unknown packet kind ${pkt.kind}`)\n            break\n    }\n\n    if (!dtdl.schema) {\n        //console.log(`unknown schema for ${srv.name}.${pkt.name}`);\n        return undefined\n    }\n\n    return dtdl\n}\n\ninterface DTDLNode {\n    \"@type\"?: string\n    \"@id\"?: string\n    // 1-64 characters\n    // ^[a-zA-Z](?:[a-zA-Z0-9_]*[a-zA-Z0-9])?$\n    name?: string\n    displayName?: string\n    description?: string\n}\n\ninterface DTDLSchema extends DTDLNode {\n    fields?: DTDLSchema[]\n    schema?: string | DTDLSchema\n    elementSchema?: string | DTDLSchema\n}\n\ninterface DTDLContent extends DTDLNode {\n    \"@type\": \"Property\" | \"Command\" | \"Component\" | \"Interface\"\n    unit?: string\n    schema?: string | DTDLSchema\n}\n\ninterface DTDLInterface extends DTDLContent {\n    contents: DTDLContent[]\n    extends?: string | string[]\n    schemas?: (DTDLSchema | DTDLInterface)[]\n    \"@context\"?: string\n}\n\nexport function escapeName(name: string) {\n    name = name.trim().replace(/[^a-zA-Z0-9_]/g, \"_\")\n    if (!/^[a-zA-Z]/.test(name)) name = \"a\" + name\n    name = name[0].toLowerCase() + name.slice(1)\n    return name.slice(0, 64)\n}\n\nfunction escapeDisplayName(name: string) {\n    return name.slice(0, 64)\n}\n\nexport function serviceSpecificationToDTDL(\n    srv: jdspec.ServiceSpec\n): DTDLInterface {\n    const dtdl: DTDLInterface = {\n        \"@type\": \"Interface\",\n        \"@id\": serviceSpecificationDTMI(srv),\n        displayName: escapeDisplayName(srv.name),\n        description: srv.notes[\"short\"],\n        contents: srv.packets\n            .filter(pkt => !pkt.derived && !pkt.internal)\n            .map(pkt => {\n                try {\n                    return packetToDTDL(srv, pkt)\n                } catch (e) {\n                    console.log(`failed to generate DTDL for ${srv.name}`, e)\n                    return undefined\n                }\n            })\n            .filter(c => !!c),\n    }\n    if (srv.extends.length)\n        dtdl.extends = srv.extends.map(id =>\n            serviceSpecificationDTMI(serviceSpecificationFromName(id))\n        )\n\n    const hasEvents = srv.packets.find(pkt => pkt.kind === \"event\")\n    const hasEnums = Object.keys(srv.enums).length\n    if (hasEvents || hasEnums) {\n        dtdl.schemas = []\n        if (hasEvents)\n            dtdl.schemas.push({\n                \"@id\": toDTMI([srv.classIdentifier, \"event\"]),\n                \"@type\": \"Object\",\n                fields: [\n                    {\n                        name: \"count\",\n                        schema: \"integer\",\n                    },\n                ],\n            })\n        if (hasEnums)\n            dtdl.schemas = dtdl.schemas.concat(\n                Object.keys(srv.enums).map(en => enumSchema(srv, srv.enums[en]))\n            )\n    }\n    dtdl[\"@context\"] = DTDL_CONTEXT\n    return dtdl\n}\n\nexport function serviceSpecificationToComponent(\n    srv: jdspec.ServiceSpec,\n    name: string\n): any {\n    const dtdl = {\n        \"@type\": \"Component\",\n        name: name,\n        displayName: escapeDisplayName(srv.name),\n        schema: serviceSpecificationDTMI(srv),\n    }\n    return dtdl\n}\n\nexport interface DTDLGenerationOptions {\n    inlineServices?: boolean // generate all services\n}\n\nexport function serviceSpecificationDTMI(srv: jdspec.ServiceSpec) {\n    return toDTMI([\"services\", srv.classIdentifier])\n}\n\nexport function deviceSpecificationDTMI(dev: jdspec.DeviceSpec) {\n    return toDTMI([\"devices\", dev.id.replace(/-/g, \":\")])\n}\n\nexport function DTMIToRoute(dtmi: string) {\n    const route =\n        dtmi.toLowerCase().replace(/;/, \"-\").replace(/:/g, \"/\") + \".json\"\n    return route\n}\n\nexport function deviceSpecificationToDTDL(\n    dev: jdspec.DeviceSpec,\n    options?: DTDLGenerationOptions\n): any {\n    const services = dev.services.map(srv =>\n        serviceSpecificationFromClassIdentifier(srv)\n    )\n    const uniqueServices = uniqueMap(\n        services,\n        srv => srv.classIdentifier.toString(),\n        srv => srv\n    )\n    const schemas = uniqueServices.map(srv => serviceSpecificationToDTDL(srv))\n\n    // allocate names\n    const names: string[] = []\n    services.forEach(srv => {\n        const name = escapeName(srv.shortId || srv.shortName)\n        if (names.indexOf(name) < 0) names.push(name)\n        else {\n            let count = 2\n            while (names.indexOf(name + count) > -1) count++\n            names.push(name + count)\n        }\n    })\n\n    const dtdl: DTDLInterface = {\n        \"@type\": \"Interface\",\n        \"@id\": deviceSpecificationDTMI(dev),\n        displayName: escapeDisplayName(dev.name),\n        description: dev.description,\n        contents: services.map((srv, i) =>\n            serviceSpecificationToComponent(srv, names[i])\n        ),\n        \"@context\": DTDL_CONTEXT,\n    }\n    if (options?.inlineServices) return [dtdl, ...schemas]\n    else return dtdl\n}\n","import React, { useMemo } from 'react';\nimport { Menu, MenuItem, Typography } from '@material-ui/core';\nimport { isInfrastructure, serviceSpecificationFromClassIdentifier, serviceSpecifications } from '../../jacdac-ts/src/jdom/spec';\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport AddIcon from '@material-ui/icons/Add';\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport IconButtonWithTooltip from \"./ui/IconButtonWithTooltip\"\nimport { useId } from \"react-use-id-hook\"\n\nexport default function AddServiceIconButton(props: {\n    onAdd: (service: jdspec.ServiceSpec) => void,\n    serviceFilter?: (service: jdspec.ServiceSpec) => boolean,\n    error?: string,\n    children?: JSX.Element | JSX.Element[]\n}) {\n    const { error, onAdd, children, serviceFilter } = props;\n    const [servicesAnchorEl, setServicesAnchorEl] = React.useState<null | HTMLElement>(null);\n    const servicesMenuId = useId();\n    const services = useMemo(() => serviceSpecifications()\n        .filter(srv => !isInfrastructure(srv))\n        .filter(srv => !serviceFilter || serviceFilter(srv))\n        , [serviceFilter])\n\n    const handleServiceAddClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n        setServicesAnchorEl(event.currentTarget);\n    };\n    const handleServiceAddClose = (id: number) => () => {\n        setServicesAnchorEl(null);\n        if (id !== undefined) {\n            const srv = serviceSpecificationFromClassIdentifier(id);\n            onAdd(srv);\n        }\n    };\n\n    return <>\n        <IconButtonWithTooltip title=\"Add a service\" aria-controls={servicesMenuId} aria-haspopup=\"true\" onClick={handleServiceAddClick}>\n            {children || <AddIcon />}\n        </IconButtonWithTooltip>\n        <Menu\n            id={servicesMenuId}\n            anchorEl={servicesAnchorEl}\n            keepMounted\n            open={Boolean(servicesAnchorEl)}\n            onClose={handleServiceAddClose(undefined)}\n        >\n            {services.map(srv => <MenuItem key={srv.classIdentifier} value={srv.classIdentifier.toString(16)}\n                onClick={handleServiceAddClose(srv.classIdentifier)}>\n                {srv.name}\n            </MenuItem>)}\n        </Menu>\n        <Typography variant=\"caption\" color={error ? \"error\" : \"inherit\"} component=\"div\">\n            {error || \"Select one or more services.\"}\n        </Typography></>\n}","import { createStyles, makeStyles, MenuItem, TextField, Theme } from \"@material-ui/core\";\nimport React, { ChangeEvent, useState } from \"react\";\nimport { serviceSpecifications } from \"../../jacdac-ts/src/jdom/spec\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        root: {\n            minWidth: \"18rem\",\n        }\n    }),\n);\n\nexport default function ServiceSpecificationSelect(props: {\n    label: string,\n    serviceClass: number;\n    setServiceClass: (serviceClass: number) => void;\n    variant?: \"outlined\" | \"filled\" | \"standard\";\n    fullWidth?: boolean;\n    error?: string;\n}) {\n    const { label, serviceClass, setServiceClass, variant, fullWidth, error } = props;\n    const [labelId] = useState('select-' + Math.random());\n    const classes = useStyles();\n    const specs = serviceSpecifications().filter(spec => !/^_/.test(spec.shortId))\n\n    const handleChange = (event: ChangeEvent<HTMLInputElement>) =>\n        setServiceClass(parseInt(event.target.value));\n\n    return <TextField\n        id={labelId}\n        className={classes.root}\n        label={label}\n        error={!!error}\n        helperText={error}\n        value={serviceClass}\n        select\n        variant={variant}\n        fullWidth={fullWidth}\n        onChange={handleChange}>\n        <MenuItem key=\"none\" value=\"NaN\">No service selected</MenuItem>\n        {specs.map(spec => <MenuItem\n            key={spec.classIdentifier}\n            value={spec.classIdentifier}>{spec.name}</MenuItem>)}\n    </TextField>\n}","import { Box, BoxProps, Paper, PaperProps, useTheme } from \"@material-ui/core\";\nimport React from \"react\";\n\nexport default function PaperBox(props: { padding?: number; elevation?: number; bgcolor?: string } & BoxProps) {\n    const { children, padding, elevation, bgcolor, ...others } = props;\n    const theme = useTheme();\n\n    return <Box {...others} bgcolor={bgcolor} mb={theme.spacing(0.25)}>\n        <Paper square elevation={elevation}>\n            {padding !== 0 && <Box p={theme.spacing(padding || 0.25)}>\n                {children}\n            </Box>}\n            {padding === 0 && children}\n        </Paper>\n    </Box>\n}","import { useContext, useEffect, useState } from \"react\";\nimport { JDClient } from \"../../../jacdac-ts/src/jdom/client\";\nimport { CHANGE, CONNECT, CONNECTING, PACKET_SEND } from \"../../../jacdac-ts/src/jdom/constants\";\nimport { inIFrame } from \"../../../jacdac-ts/src/jdom/iframeclient\";\nimport Packet from \"../../../jacdac-ts/src/jdom/packet\";\nimport { SMap } from \"../../../jacdac-ts/src/jdom/utils\";\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\";\n\nexport const READ = \"read\"\nexport const MESSAGE_PACKET = \"messagepacket\"\nconst HIDDEN = \"hidden\"\nconst SHOWN = \"shown\"\nconst SENDER = \"jacdac-editor-extension\"\n\nexport interface ReadResponse {\n    code?: string;\n    json?: string;\n    jres?: string;\n}\n\nexport class MakeCodeEditorExtensionClient extends JDClient {\n    private readonly pendingCommands: {\n        [key: string]: {\n            action: string;\n            resolve: (resp: any) => void;\n            reject: (e: any) => void;\n        }\n    } = {};\n    private readonly extensionId: string = inIFrame() ? window.location.hash.substr(1) : undefined;\n    private _target: any; // full apptarget\n    private _connected = false;\n    private _visible = false;\n\n    constructor() {\n        super();\n        this.handleMessage = this.handleMessage.bind(this);\n        if (typeof window !== \"undefined\") {\n            window.addEventListener(\"message\", this.handleMessage, false);\n            this.mount(() => window.removeEventListener(\"message\", this.handleMessage));\n        }\n        // always refresh on load\n        this.on(SHOWN, () => this.refresh());\n        // notify parent that we're ready\n        this.init();\n    }\n\n    get target() {\n        return this._target;\n    }\n\n    get connected() {\n        return this._connected;\n    }\n\n    get visible() {\n        return this._visible;\n    }\n\n    private setVisible(vis: boolean) {\n        if (this._visible !== vis) {\n            this._visible = vis;\n            this.emit(CHANGE);\n        }\n    }\n\n    private nextRequestId = 1;\n    private mkRequest(resolve: (resp: any) => void, reject: (e: any) => void, action: string, body?: any): any {\n        const id = \"jd_\" + this.nextRequestId++;\n        this.pendingCommands[id] = { action, resolve, reject };\n        return {\n            type: \"pxtpkgext\",\n            action,\n            extId: this.extensionId,\n            response: true,\n            id,\n            body\n        }\n    }\n\n    private sendRequest<T>(action: string, body?: any): Promise<T> {\n        this.log(`send ${action}`)\n        if (!this.extensionId)\n            return Promise.resolve(undefined);\n\n        return new Promise((resolve, reject) => {\n            const msg = this.mkRequest(resolve, reject, action, body);\n            window.parent.postMessage(msg, \"*\");\n        })\n    }\n\n    private handleMessage(ev: any) {\n        const msg = ev.data;\n        if (msg?.type !== \"pxtpkgext\")\n            return;\n        if (!msg.id) {\n            switch (msg.event) {\n                case \"extinit\":\n                    this.log(`init`)\n                    this._target = msg.target;\n                    this._connected = true;\n                    this.emit(CONNECT);\n                    this.emit(CHANGE);\n                    break;\n                case \"extloaded\":\n                    this.log(`loaded`)\n                    break;\n                case \"extshown\":\n                    this.setVisible(true)\n                    this.emit(SHOWN);\n                    this.emit(CHANGE);\n                    break;\n                case \"exthidden\":\n                    this.setVisible(false)\n                    this.emit(HIDDEN);\n                    this.emit(CHANGE);\n                    break;\n                case \"extdatastream\":\n                    this.emit('datastream', true);\n                    break;\n                case \"extconsole\":\n                    this.emit('console', msg.body);\n                    break;\n                case \"extmessagepacket\":\n                    this.emit(MESSAGE_PACKET, msg.body);\n                    break;\n                default:\n                    console.debug(\"Unhandled event\", msg);\n            }\n        }\n        else {\n            const { action, resolve, reject } = this.pendingCommands[msg.id] || {};\n            delete this.pendingCommands[msg.id];\n\n            if (msg.success && resolve)\n                resolve(msg.resp);\n            else if (!msg.success && reject)\n                reject(msg.resp);\n            // raise event as well\n            switch (action) {\n                case \"extinit\":\n                    this._connected = true;\n                    this.emit(CONNECT);\n                    this.emit(CHANGE);\n                    break;\n                case \"extusercode\":\n                    // Loaded, set the target\n                    this.emit('readuser', msg.resp);\n                    this.emit(CHANGE);\n                    break;\n                case \"extreadcode\":\n                    // Loaded, set the target\n                    this.emit(READ, msg.resp);\n                    this.emit(CHANGE);\n                    break;\n                case \"extwritecode\":\n                    this.emit('written', undefined);\n                    break;\n            }\n        }\n    }\n\n    private async init() {\n        this.log(`initializing`)\n        await this.sendRequest<void>('extinit');\n        this.log(`connected`)\n        await this.refresh();\n    }\n\n    private async refresh() {\n        this.log(`refresh`)\n        const r = await this.read();\n    }\n\n    async read(): Promise<ReadResponse> {\n        if (!this.extensionId) {\n            const r: ReadResponse = {};\n            this.emit(READ, r);\n            return r;\n        } else {\n            const resp: ReadResponse = await this.sendRequest('extreadcode');\n            return resp;\n        }\n    }\n\n    async readUser() {\n        await this.sendRequest('extusercode')\n    }\n\n    async write(code: string, json?: string, jres?: string, dependencies?: SMap<string>): Promise<void> {\n        if (!this.extensionId) {\n            // Write to local storage instead\n            this.emit('written', undefined);\n        } else {\n            await this.sendRequest<void>('extwritecode', {\n                code: code || undefined,\n                json: json || undefined,\n                jres: jres || undefined,\n                dependencies\n            })\n        }\n    }\n\n    async queryPermission() {\n        await this.sendRequest('extquerypermission');\n    }\n\n    async requestPermission(console: boolean) {\n        await this.sendRequest('extrequestpermission', {\n            console\n        })\n    }\n\n    async dataStreamConsole(console: boolean) {\n        await this.sendRequest('extdatastream', {\n            console\n        })\n    }\n\n    async dataStreamMessages(messages: boolean) {\n        await this.sendRequest('extdatastream', {\n            messages\n        })\n    }\n}\n\n\nexport default function useMakeCodeEditorExtensionClient() {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext);\n    const [client, setClient] = useState<MakeCodeEditorExtensionClient>(undefined);\n    useEffect(() => {\n        console.log(`mkcd: new editor client`)\n        const c = new MakeCodeEditorExtensionClient();\n        c.on(CONNECT, () => {\n            console.log(`mkcd: stream messages`)\n            c.dataStreamMessages(true)\n        });\n        c.on([HIDDEN, SHOWN], () => bus.clear());\n        c.on(MESSAGE_PACKET, (msg) => {\n            if (msg.channel === \"jacdac\" && msg.source !== SENDER) {\n                const pkts = Packet.fromFrame(msg.data, bus.timestamp);\n                for (const pkt of pkts) {\n                    pkt.sender = msg.source || \"makecode\";\n                    bus.processPacket(pkt);\n                }\n            }\n        })\n        setClient(c);\n        return () => c?.unmount()\n    }, []);\n    return client;\n}","import { Grid, TextField } from \"@material-ui/core\"\nimport React, { ChangeEvent, useEffect, useMemo, useState } from \"react\"\nimport {\n    clone,\n    JSONTryParse,\n    SMap,\n    uniqueName,\n} from \"../../../jacdac-ts/src/jdom/utils\"\nimport useChange from \"../../jacdac/useChange\"\n// tslint:disable-next-line: no-submodule-imports match-default-export-name\nimport DeleteIcon from \"@material-ui/icons/Delete\"\nimport {\n    serviceSpecifications,\n} from \"../../../jacdac-ts/src/jdom/spec\"\nimport AddServiceIconButton from \"../AddServiceIconButton\"\nimport ServiceSpecificationSelect from \"../ServiceSpecificationSelect\"\nimport { escapeName } from \"../../../jacdac-ts/src/azure-iot/dtdl\"\nimport IconButtonWithTooltip from \"../ui/IconButtonWithTooltip\"\nimport useMakeCodeEditorExtensionClient, {\n    READ,\n    ReadResponse,\n} from \"./MakeCodeEditorExtensionClient\"\nimport CmdButton from \"../CmdButton\"\n// tslint:disable-next-line: no-submodule-imports match-default-export-name\nimport SaveIcon from \"@material-ui/icons/Save\"\nimport { camelize } from \"../../../jacdac-ts/jacdac-spec/spectool/jdspec\"\nimport { useId } from \"react-use-id-hook\"\nimport { resolveMakecodeService, resolveMakecodeServiceFromClassIdentifier } from \"../../../jacdac-ts/src/jdom/makecode\"\n\ninterface ClientRole {\n    name: string\n    service: number\n}\n\ninterface Configuration {\n    roles: ClientRole[]\n}\n\nfunction toTypescript(config: Configuration) {\n    const ns = \"myModules\"\n    return `// auto-generated, do not edit.\nnamespace ${ns} {\n${config.roles\n    .map(\n        role => `\n    //% fixedInstance block=\"${role.name}\"\n    export const ${camelize(role.name)} = new ${\n            resolveMakecodeServiceFromClassIdentifier(role.service).client.qName\n        }(\"${camelize(role.name)}\");\n`\n    )\n    .join(\"\")}\n\n    // start after main\n    control.runInParallel(function() {\n        ${config.roles\n            .map(\n                role => `    ${ns}.${camelize(role.name)}.start();\n        `\n            )\n            .join(\"\")}\n    })\n}\n    `\n}\n\nfunction toDependencies(config: Configuration) {\n    const r: SMap<string> = {}\n    config?.roles.forEach(role => {\n        const mk = resolveMakecodeServiceFromClassIdentifier(role.service)\n        r[mk.client.name] = `github:${mk.client.repo}`\n    })\n    return r\n}\n\nfunction toJSON(config: Configuration) {\n    return config && JSON.stringify(config, null, 4)\n}\n\nfunction ClientRoleRow(props: {\n    config: Configuration\n    component: ClientRole\n    onUpdate: () => void\n}) {\n    const { component, onUpdate, config } = props\n    const { name, service } = component\n    const { nameError, serviceError } = useMemo(\n        () => validateClientRole(config, component),\n        [config, component]\n    )\n    const textId = useId()\n    const handleComponentNameChange = (ev: ChangeEvent<HTMLInputElement>) => {\n        component.name = escapeName(ev.target.value)\n        onUpdate()\n    }\n    const handleSetService = (serviceClass: number) => {\n        component.service = serviceClass\n        onUpdate()\n    }\n    const handleComponentDelete = () => {\n        config.roles.splice(config.roles.indexOf(component), 1)\n        onUpdate()\n    }\n    return (\n        <Grid item xs={12}>\n            <Grid container spacing={2}>\n                <Grid item xs={4} md={6}>\n                    <TextField\n                        id={textId}\n                        fullWidth={true}\n                        error={!!nameError}\n                        variant=\"outlined\"\n                        label=\"name\"\n                        helperText={nameError}\n                        value={name}\n                        onChange={handleComponentNameChange}\n                    />\n                </Grid>\n                <Grid item xs={4} md={4}>\n                    <ServiceSpecificationSelect\n                        variant=\"outlined\"\n                        label=\"service\"\n                        serviceClass={service}\n                        setServiceClass={handleSetService}\n                        error={serviceError}\n                    />\n                </Grid>\n                <Grid item>\n                    <IconButtonWithTooltip\n                        title=\"Remove service\"\n                        onClick={handleComponentDelete}\n                    >\n                        <DeleteIcon />\n                    </IconButtonWithTooltip>\n                </Grid>\n            </Grid>\n        </Grid>\n    )\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction validateClientRole(config: Configuration, role: ClientRole) {\n    const serviceError: string = undefined\n    const nameError: string = undefined\n    // TODO\n    return { serviceError, nameError }\n}\n\nexport default function MakeCodeEditorExtension() {\n    const client = useMakeCodeEditorExtensionClient()\n    const connected = useChange(client, c => c?.connected)\n    const [configuration, setConfiguration] = useState<Configuration>({\n        roles: [],\n    } as Configuration)\n    useEffect(\n        () =>\n            client?.subscribe(READ, (resp: ReadResponse) => {\n                console.log(`mkcd: read received`)\n                const cfg = JSONTryParse(resp.json)\n                console.log({ resp, cfg })\n                if (cfg) setConfiguration(cfg)\n            }),\n        [client]\n    )\n    const hasMakeCodeService = (srv: jdspec.ServiceSpec) =>\n        !!resolveMakecodeService(srv)\n    const update = () => {\n        setConfiguration(clone(configuration))\n    }\n    const handleAddService = (service: jdspec.ServiceSpec) => {\n        if (!configuration.roles) configuration.roles = []\n        const names = configuration.roles\n            .map(c => c.name)\n            .concat(serviceSpecifications().map(spec => spec.camelName))\n            .filter(n => !!n)\n        configuration.roles.push({\n            name: uniqueName(names, service.camelName || service.shortId),\n            service: service.classIdentifier,\n        })\n        update()\n    }\n    const handleSave = async () => {\n        const ts = toTypescript(configuration)\n        const json = toJSON(configuration)\n        const deps = toDependencies(configuration)\n        console.log(`mkcd: saving...`)\n        await client.write(ts, json, undefined, deps)\n    }\n\n    return (\n        <Grid container direction=\"row\" spacing={2}>\n            {configuration.roles?.map((c, i) => (\n                <ClientRoleRow\n                    key={\"config\" + i}\n                    config={configuration}\n                    component={c}\n                    onUpdate={update}\n                />\n            ))}\n            <Grid item xs={12}>\n                <AddServiceIconButton\n                    serviceFilter={hasMakeCodeService}\n                    onAdd={handleAddService}\n                />\n            </Grid>\n            <Grid item xs={12}>\n                <CmdButton\n                    trackName=\"makecode.save\"\n                    variant=\"contained\"\n                    disabled={!connected}\n                    icon={<SaveIcon />}\n                    onClick={handleSave}\n                >\n                    save\n                </CmdButton>\n            </Grid>\n        </Grid>\n    )\n}\n","import React, { useContext, useEffect } from \"react\"\nimport {\n    createMuiTheme,\n    createStyles,\n    responsiveFontSizes,\n} from \"@material-ui/core\"\nimport ThemedLayout from \"../../components/ui/ThemedLayout\"\nimport MakeCodeEditorExtension from \"../../components/makecode/MakeCodeEditorExtension\"\nimport { makeStyles } from \"@material-ui/core\"\nimport PaperBox from \"../../components/ui/PaperBox\"\nimport DarkModeContext from \"../../components/ui/DarkModeContext\"\n\nconst useStyles = makeStyles(theme =>\n    createStyles({\n        content: {\n            display: \"flex\",\n            minHeight: \"100vh\",\n            minWidth: \"10rem\",\n            flexDirection: \"column\",\n            padding: theme.spacing(3),\n            transition: theme.transitions.create(\"margin\", {\n                easing: theme.transitions.easing.sharp,\n                duration: theme.transitions.duration.leavingScreen,\n            }),\n            flexGrow: 1,\n        },\n    })\n)\n\nexport default function MakeCodeEditorExtensionPage() {\n    const { toggleDarkMode, darkModeMounted } = useContext(DarkModeContext)\n    const rawTheme = createMuiTheme({\n        palette: {\n            primary: {\n                main: \"#2e7d32\",\n            },\n            secondary: {\n                main: \"#ffc400\",\n            },\n            contrastThreshold: 5.1,\n            type: \"dark\",\n        },\n    })\n    const classes = useStyles()\n    const theme = responsiveFontSizes(rawTheme)\n    useEffect(() => {\n        if (darkModeMounted) toggleDarkMode(\"light\")\n    }, [darkModeMounted])\n    return (\n        <ThemedLayout theme={theme}>\n            <div className={classes.content}>\n                <PaperBox>\n                    <MakeCodeEditorExtension />\n                </PaperBox>\n            </div>\n        </ThemedLayout>\n    )\n}\n"],"sourceRoot":""}