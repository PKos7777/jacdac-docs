{"version":3,"file":"3867-f5b0ad7f862fdb4adaf0.js","mappings":"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","sources":["webpack://jacdac-docs/./src/components/dashboard/DashboardLEDMatrix.tsx","webpack://jacdac-docs/./src/components/hooks/useArrowKeys.ts","webpack://jacdac-docs/./src/components/hooks/useKeyboardNavigation.ts","webpack://jacdac-docs/./src/components/hooks/useKeyboardNavigationProps.ts"],"sourcesContent":["import React from \"react\"\nimport { LedMatrixReg } from \"../../../jacdac-ts/src/jdom/constants\"\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\"\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\"\nimport useServiceServer from \"../hooks/useServiceServer\"\nimport useChange from \"../../jacdac/useChange\"\nimport LEDMatrixWidget from \"../widgets/LEDMatrixWidget\"\nimport useRegister from \"../hooks/useRegister\"\n\nexport default function DashboardLEDMatrixDisplay(\n    props: DashboardServiceProps\n) {\n    const { service } = props\n\n    const ledsRegister = useRegister(service, LedMatrixReg.Leds)\n    const brightnessRegister = useRegister(service, LedMatrixReg.Brightness)\n    const rowsRegister = useRegister(service, LedMatrixReg.Rows)\n    const columnsRegister = useRegister(service, LedMatrixReg.Columns)\n\n    const [leds] = useRegisterUnpackedValue<[Uint8Array]>(ledsRegister, props)\n    const [brightness = 0] = useRegisterUnpackedValue<[number]>(\n        brightnessRegister,\n        props\n    )\n    const [rows] = useRegisterUnpackedValue<[number]>(rowsRegister, props)\n    const [columns] = useRegisterUnpackedValue<[number]>(columnsRegister, props)\n    const server = useServiceServer(service)\n    const color = server ? \"secondary\" : \"primary\"\n    useChange(server)\n    const handleChange = (newLeds: Uint8Array) => {\n        ledsRegister.sendSetAsync(newLeds, true)\n    }\n    return (\n        <LEDMatrixWidget\n            leds={leds}\n            brightness={brightness}\n            rows={rows}\n            columns={columns}\n            color={color}\n            onChange={handleChange}\n        />\n    )\n}\n","import React, { KeyboardEvent } from \"react\"\nimport { keyCodeFromEvent } from \"./useFireKey\";\n\nconst LEFT_KEY = 37;\nconst UP_KEY = 38;\nconst RIGHT_KEY = 39;\nconst DOWN_KEY = 40;\n\nexport default function useArrowKeys(options: {\n    onLeft?: () => void,\n    onRight?: () => void,\n    onUp?: () => void,\n    onDown?: () => void,\n    symmetric?: boolean;\n}) {\n    const { onLeft, onUp, onRight, onDown, symmetric } = options;\n\n    if (!onLeft && !onUp && !onRight && !onDown)\n        return undefined;\n\n    const handlers = {\n        [LEFT_KEY]: onLeft,\n        [RIGHT_KEY]: onRight,\n        [UP_KEY]: onUp || (symmetric && onRight),\n        [DOWN_KEY]: onDown || (symmetric && onLeft)\n    }\n\n    return (e: KeyboardEvent<Element>) => {\n        const charCode = keyCodeFromEvent(e);\n        const handler = handlers[charCode];\n        if (handler) {\n            e.preventDefault();\n            handler();\n        }\n    }\n}\n","import React from \"react\"\n\nexport default function useKeyboardNavigation(parentRef: Element) {\n    const query = '[tabindex=\"0\"]';\n    const onMove = (offset: number) => () => {\n        console.log('keyboard move', { offset })\n        const focusable = Array.from<SVGElement>(parentRef?.querySelectorAll(query) || []);\n        if (focusable.length) {\n            const me = focusable.findIndex(f => f === document.activeElement);\n            const next = ((me + offset) + focusable.length) % focusable.length;\n            focusable[next].focus();\n        }\n    }\n    return onMove;\n}","import useArrowKeys from \"./useArrowKeys\";\nimport useKeyboardNavigation from \"./useKeyboardNavigation\";\n\nexport default function useKeyboardNavigationProps(parentRef: Element, vertical?: boolean) {\n    const onMove = useKeyboardNavigation(parentRef);\n\n    const onKeyDown = useArrowKeys({\n        onLeft: !vertical && onMove(-1),\n        onRight: !vertical && onMove(1),\n        onDown: vertical && onMove(1),\n        onUp: vertical && onMove(-1),\n    });\n\n    return {\n        onKeyDown: parentRef && onKeyDown\n    }\n}"],"names":["React","LedMatrixReg","useRegisterUnpackedValue","useServiceServer","useChange","LEDMatrixWidget","useRegister","DashboardLEDMatrixDisplay","props","service","ledsRegister","Leds","brightnessRegister","Brightness","rowsRegister","Rows","columnsRegister","Columns","leds","brightness","rows","columns","server","color","handleChange","newLeds","sendSetAsync","keyCodeFromEvent","LEFT_KEY","UP_KEY","RIGHT_KEY","DOWN_KEY","useArrowKeys","options","onLeft","onUp","onRight","onDown","symmetric","undefined","handlers","e","charCode","handler","preventDefault","useKeyboardNavigation","parentRef","query","onMove","offset","console","log","focusable","Array","from","querySelectorAll","length","me","findIndex","f","document","activeElement","next","focus","useKeyboardNavigationProps","vertical","onKeyDown"],"sourceRoot":""}