{"version":3,"sources":["webpack://jacdac-docs/./src/components/ServiceSpecificationSelect.tsx","webpack://jacdac-docs/./src/components/semver.ts","webpack://jacdac-docs/./src/components/useFetch.ts","webpack://jacdac-docs/./src/components/github.ts","webpack://jacdac-docs/./src/components/select/SelectServiceGrid.tsx","webpack://jacdac-docs/./src/components/test/ServiceTest.tsx","webpack://jacdac-docs/./src/components/ui/GridHeader.tsx","webpack://jacdac-docs/./jacdac-ts/jacdac-spec/spectool/jdtest.ts","webpack://jacdac-docs/./src/components/tools/ServiceTestEditor.tsx","webpack://jacdac-docs/./src/pages/tools/service-test-editor.tsx"],"names":["useStyles","makeStyles","createStyles","root","minWidth","ServiceSpecificationSelect","props","label","serviceClass","setServiceClass","variant","fullWidth","error","useState","Math","random","labelId","classes","specs","serviceSpecifications","filter","spec","test","shortId","handleChange","event","parseInt","target","value","map","classIdentifier","name","cmp","a","b","d","major","minor","patch","pre","length","i","aa","bb","strcmp","tryParse","v","Number","MAX_SAFE_INTEGER","build","slice","m","exec","split","semverCmp","useFetch","url","options","undefined","response","setResponse","setError","status","setStatus","loading","setLoading","useEffectAsync","mounted","fetch","res","json","ROOT","GITHUB_API_KEY","contentToFirmwareRelease","content","version","type","sha","size","html_url","download_url","contentsToFirmwareReleases","contents","r","sort","l","normalizeSlug","slug","cleaned","replace","parts","repoPath","folder","join","parseRepoUrl","owner","fetchLatestRelease","uri","resp","releases","ignoreThrottled","Error","fetchReleaseBinary","downloadUrl","headers","Accept","req","blob","firmware","fetchText","tag","path","mimeType","text","src","useFetchApi","console","log","useFetchJSON","useRepository","useLatestRelease","useLatestReleases","SelectServiceGrid","useContext","JacdacContext","bus","buttonText","onSelect","disabled","services","useChange","n","gridBreakpoints","useGridBreakpoints","handleSelect","service","id","device","Diagnostics","hostDefinition","serviceProviderDefinitionFromServiceClass","handleStartSimulator","addServiceProvider","ServiceTestRunnerSelect","ServiceTest","serviceSpec","showStartSimulator","serviceTest","serviceTestFromServiceClass","setService","useEffect","subscribe","DISCONNECT","Flags","theme","hr","background","palette","marginBottom","start","width","spacing","GridHeader","title","count","action","clsx","supportedExpressions","parseSpecificationTestMarkdownToJSON","filecontent","filename","info","description","serviceClassIdentifier","tests","backticksType","errors","lineNo","currentTest","testHeading","testPrompt","symbolResolver","SpecSymbolResolver","jsep","e","line","processLine","message","finishTest","trim","interpret","hd","cont","expanded","processCommand","prompt","registers","events","testCommands","ret","getTestCommandFunctions","command","processCalls","push","call","args","arguments","testExpressionFunctions","getTestExpressionFunctions","forEach","arg","argType","exprVisitor","parent","callExpr","callee","tef","find","context","ce","expected","s","reset","msg","some","file","SERVICE_TEST_SERVICE_STORAGE_KEY","SERVICE_TEST_SOURCE_STORAGE_KEY","SERVICE_MARKDOWN_SOURCE_STORAGE_KEY","ServiceTestEditor","AppContext","useLocalStorage","SRV_BUTTON","source","setSource","markdownSource","setMarkdownSource","useMemo","serviceSpecificationFromClassIdentifier","servicePath","camelName","toString","toLowerCase","handleLoadFromGithub","ghSource","Page"],"mappings":"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","file":"component---src-pages-tools-service-test-editor-tsx-69e4d261c9b2233ab4d0.js","sourcesContent":["import { createStyles, makeStyles, MenuItem, TextField, Theme } from \"@material-ui/core\";\nimport React, { ChangeEvent, useState } from \"react\";\nimport { serviceSpecifications } from \"../../jacdac-ts/src/jdom/spec\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        root: {\n            minWidth: \"18rem\",\n        }\n    }),\n);\n\nexport default function ServiceSpecificationSelect(props: {\n    label: string,\n    serviceClass: number;\n    setServiceClass: (serviceClass: number) => void;\n    variant?: \"outlined\" | \"filled\" | \"standard\";\n    fullWidth?: boolean;\n    error?: string;\n}) {\n    const { label, serviceClass, setServiceClass, variant, fullWidth, error } = props;\n    const [labelId] = useState('select-' + Math.random());\n    const classes = useStyles();\n    const specs = serviceSpecifications().filter(spec => !/^_/.test(spec.shortId))\n\n    const handleChange = (event: ChangeEvent<HTMLInputElement>) =>\n        setServiceClass(parseInt(event.target.value));\n\n    return <TextField\n        id={labelId}\n        className={classes.root}\n        label={label}\n        error={!!error}\n        helperText={error}\n        value={serviceClass}\n        select\n        variant={variant}\n        fullWidth={fullWidth}\n        onChange={handleChange}>\n        <MenuItem key=\"none\" value=\"NaN\">No service selected</MenuItem>\n        {specs.map(spec => <MenuItem\n            key={spec.classIdentifier}\n            value={spec.classIdentifier}>{spec.name}</MenuItem>)}\n    </TextField>\n}","interface Version {\n    major: number\n    minor: number\n    patch: number\n    pre: string[]\n    build: string[]\n}\n\nfunction cmp(a: Version, b: Version) {\n    if (!a)\n        if (!b) return 0\n        else return 1\n    else if (!b) return -1\n    else {\n        let d = a.major - b.major || a.minor - b.minor || a.patch - b.patch\n        if (d) return d\n        if (a.pre.length == 0 && b.pre.length > 0) return 1\n        if (a.pre.length > 0 && b.pre.length == 0) return -1\n        for (let i = 0; i < a.pre.length + 1; ++i) {\n            const aa = a.pre[i]\n            const bb = b.pre[i]\n            if (!aa)\n                if (!bb) return 0\n                else return -1\n            else if (!bb) return 1\n            else if (/^\\d+$/.test(aa))\n                if (/^\\d+$/.test(bb)) {\n                    d = parseInt(aa) - parseInt(bb)\n                    if (d) return d\n                } else return -1\n            else if (/^\\d+$/.test(bb)) return 1\n            else {\n                d = strcmp(aa, bb)\n                if (d) return d\n            }\n        }\n        return 0\n    }\n}\n\nfunction tryParse(v: string): Version {\n    if (!v) return null\n    if (\"*\" === v) {\n        return {\n            major: Number.MAX_SAFE_INTEGER,\n            minor: Number.MAX_SAFE_INTEGER,\n            patch: Number.MAX_SAFE_INTEGER,\n            pre: [],\n            build: [],\n        }\n    }\n    if (/^v\\d/i.test(v)) v = v.slice(1)\n    const m = /^(\\d+)\\.(\\d+)\\.(\\d+)(-([0-9a-zA-Z\\-\\.]+))?(\\+([0-9a-zA-Z\\-\\.]+))?$/.exec(\n        v\n    )\n    if (m)\n        return {\n            major: parseInt(m[1]),\n            minor: parseInt(m[2]),\n            patch: parseInt(m[3]),\n            pre: m[5] ? m[5].split(\".\") : [],\n            build: m[7] ? m[7].split(\".\") : [],\n        }\n    return null\n}\n\nfunction strcmp(a: string, b: string) {\n    if (a === b) return 0\n    if (a < b) return -1\n    else return 1\n}\n\nexport function semverCmp(a: string, b: string) {\n    const aa = tryParse(a)\n    const bb = tryParse(b)\n    if (!aa && !bb) return strcmp(a, b)\n    else return cmp(aa, bb)\n}\n","import { useState } from \"react\"\nimport useEffectAsync from \"./useEffectAsync\"\n\nexport default function useFetch<T>(url: RequestInfo, options?: RequestInit) {\n    const [response, setResponse] = useState<T>(undefined)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const [error, setError] = useState<any>(undefined)\n    const [status, setStatus] = useState<number>(undefined)\n    const [loading, setLoading] = useState(true) // start in loading mode\n\n    useEffectAsync(\n        async mounted => {\n            setLoading(true)\n            try {\n                const res = await fetch(url, options)\n                if (!mounted()) return\n                const status = res.status\n                setStatus(status)\n                if (status >= 200 && status <= 204) {\n                    const json = await res.json()\n                    if (!mounted()) return\n                    setResponse(json)\n                }\n            } catch (error) {\n                if (!mounted()) return\n                setError(error)\n            } finally {\n                if (mounted()) setLoading(false)\n            }\n        },\n        [url]\n    )\n\n    return {\n        response,\n        error,\n        status,\n        loading,\n    }\n}\n","import { useMemo } from \"react\"\nimport { semverCmp } from \"./semver\"\nimport useFetch from \"./useFetch\"\n\nconst ROOT = \"https://api.github.com/\"\nexport const GITHUB_API_KEY = \"githubtoken\"\n\ninterface GithubContent {\n    name: string\n    sha: string\n    size: number\n    html_url: string\n    download_url: string\n    type: \"file\" | \"dir\" | \"symlink\"\n}\n\nexport interface GithubFirmwareRelease {\n    version: string\n    sha: string\n    size: number\n    html_url: string\n    download_url: string\n}\n\nexport interface GithubUser {\n    login: string\n    avatar_url: string\n    html_url: string\n}\n\nexport interface GithubRepository {\n    name: string\n    full_name: string\n    private: boolean\n    owner: GithubUser\n    description: string\n    fork: boolean\n    homepage: string\n    default_branch: string\n    organization: GithubUser\n    html_url: string\n}\n\nfunction contentToFirmwareRelease(\n    content: GithubContent\n): GithubFirmwareRelease {\n    // filter out non-file, non-uf2\n    const version =\n        content?.type === \"file\" &&\n        /^fw-(\\d+\\.\\d+.\\d+)\\.uf2$/.exec(content.name)?.[1]\n    if (!version) return undefined\n\n    return {\n        version,\n        sha: content.sha,\n        size: content.size,\n        html_url: content.html_url,\n        download_url: content.download_url,\n    }\n}\n\nfunction contentsToFirmwareReleases(contents: GithubContent[]) {\n    return contents\n        ?.map(contentToFirmwareRelease)\n        .filter(r => !!r)\n        .sort((l, r) => -semverCmp(l.version, r.version))\n}\n\nexport function normalizeSlug(slug: string) {\n    const cleaned = slug.replace(/^https:\\/\\/github.com\\//, \"\")\n    const parts = cleaned.split(\"/\")\n    return {\n        repoPath: `${parts[0]}/${parts[1]}`,\n        folder: parts.slice(2).join(\"/\"),\n    }\n}\n\nexport interface GitHubApiOptions {\n    ignoreThrottled?: boolean\n}\n\nexport function parseRepoUrl(url: string): { owner: string; name: string } {\n    const m = /^https:\\/\\/github\\.com\\/([^/ \\t]+)\\/([^/ \\t]+)\\/?$/.exec(\n        url || \"\"\n    )\n    if (m) return { owner: m[1], name: m[2] }\n    return undefined\n}\n\nexport async function fetchLatestRelease(\n    slug: string,\n    options?: GitHubApiOptions\n): Promise<GithubFirmwareRelease> {\n    // https://api.github.com/repos/microsoft/jacdac-msr-modules/contents/dist\n    const { repoPath } = normalizeSlug(slug)\n    const uri = `${ROOT}repos/${repoPath}/contents/dist`\n    const resp = await fetch(uri)\n    //    console.log(resp)\n    switch (resp.status) {\n        case 200:\n        case 204: {\n            const contents: GithubContent[] = await resp.json()\n            const releases = contentsToFirmwareReleases(contents)\n            return releases[0]\n        }\n        case 404:\n            // unknow repo or no access\n            return undefined\n        case 403:\n            // throttled\n            if (options?.ignoreThrottled) return undefined\n            throw new Error(\"Too many calls to GitHub, try again later\")\n    }\n    throw new Error(`unknown status code ${resp.status}`)\n}\n\nexport async function fetchReleaseBinary(\n    slug: string,\n    version: string\n): Promise<Blob> {\n    // we are not using the release api because of CORS.\n    const { repoPath } = normalizeSlug(slug)\n    const downloadUrl = `https://raw.githubusercontent.com/${repoPath}/main/dist/fw-${version}.uf2`\n    const req = await fetch(downloadUrl, {\n        headers: { Accept: \"application/octet-stream\" },\n    })\n    if (req.status == 200) {\n        const firmware = await req.blob()\n        return firmware\n    }\n    return undefined\n}\n\nexport async function fetchText(\n    slug: string,\n    tag: string,\n    path: string,\n    mimeType: string\n) {\n    const { repoPath, folder } = normalizeSlug(slug)\n    const downloadUrl = `https://raw.githubusercontent.com/${repoPath}/${tag}/${\n        folder ? `${folder}/` : \"\"\n    }${path}`\n    const req = await fetch(downloadUrl, {\n        headers: { Accept: mimeType },\n    })\n    if (req.status == 200) {\n        const src = await req.text()\n        return src\n    }\n    return undefined\n}\n\nfunction useFetchApi<T>(path: string, options?: GitHubApiOptions) {\n    const res = useFetch<T>(`${ROOT}${path}`)\n    if (res.status !== undefined)\n        switch (res.status) {\n            case 200:\n            case 201:\n            case 202:\n            case 203:\n            case 204:\n                break\n            case 404:\n                // unknow repo or no access\n                res.response = undefined\n                break\n            case 403:\n                // throttled\n                if (options?.ignoreThrottled) {\n                    res.response = undefined\n                    return res\n                } else\n                    throw new Error(\"Too many calls to GitHub, try again later\")\n\n            default:\n                console.log(`unknown status`, res)\n                throw new Error(`Unknown response from GitHub ${res.status}`)\n        }\n    return res\n}\n\nexport function useFetchJSON<T>(\n    slug: string,\n    tag: string,\n    path: string,\n    mimeType: \"text/plain\" | \"application/json\"\n) {\n    const { repoPath, folder } = normalizeSlug(slug)\n    const downloadUrl = `https://raw.githubusercontent.com/${repoPath}/${tag}/${\n        folder ? `${folder}/` : \"\"\n    }${path}`\n    return useFetch<T>(downloadUrl, {\n        headers: { Accept: mimeType },\n    })\n}\n\nexport function useRepository(slug: string) {\n    const { repoPath } = normalizeSlug(slug)\n    const path = `repos/${repoPath}`\n    const res = useFetchApi<GithubRepository>(path, { ignoreThrottled: true })\n    return res\n}\n\nexport function useLatestRelease(slug: string, options?: GitHubApiOptions) {\n    const resp = useLatestReleases(slug, options)\n    return {\n        ...resp,\n        response: resp.response?.[0],\n    }\n}\n\nexport function useLatestReleases(slug: string, options?: GitHubApiOptions) {\n    if (!slug)\n        return {\n            response: undefined,\n            loading: false,\n            error: undefined,\n            status: undefined,\n        }\n    const { repoPath } = normalizeSlug(slug)\n    const uri = `repos/${repoPath}/contents/dist`\n    const res = useFetchApi<GithubContent[]>(uri, {\n        ...(options || {}),\n        ignoreThrottled: true,\n    })\n    return {\n        ...res,\n        response: contentsToFirmwareReleases(res.response),\n    }\n}\n","import React, { useContext } from \"react\"\nimport useGridBreakpoints from \"../useGridBreakpoints\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport useChange from \"../../jacdac/useChange\"\nimport { Grid, Card, CardActions, Button } from \"@material-ui/core\"\nimport DeviceCardHeader from \"../DeviceCardHeader\"\nimport Alert from \"../ui/Alert\"\nimport { JDService } from \"../../../jacdac-ts/src/jdom/service\"\n\nexport default function SelectServiceGrid(props: {\n    serviceClass: number\n    buttonText?: string\n    disabled?: boolean\n    onSelect: (service: JDService) => void\n}) {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { serviceClass, buttonText, onSelect, disabled } = props\n    const services = useChange(bus, n => n.services({ serviceClass }), [])\n    const gridBreakpoints = useGridBreakpoints()\n\n    const handleSelect = (service: JDService) => () => onSelect(service)\n\n    return (\n        <>\n            {!!services.length && (\n                <Grid container spacing={2}>\n                    {services.map(service => (\n                        <Grid key={service.id} item {...gridBreakpoints}>\n                            <Card>\n                                <DeviceCardHeader\n                                    device={service.device}\n                                    showAvatar={true}\n                                />\n                                <CardActions>\n                                    <Button\n                                        variant=\"contained\"\n                                        color=\"primary\"\n                                        onClick={handleSelect(service)}\n                                        disabled={disabled}\n                                    >\n                                        {buttonText || \"Select\"}\n                                    </Button>\n                                </CardActions>\n                            </Card>\n                        </Grid>\n                    ))}\n                </Grid>\n            )}\n            {!services?.length && (\n                <Alert severity=\"info\">\n                    Not seeing your device? Try some of the following.\n                    <ul>\n                        <li>Check that your device is connected</li>\n                        <li>\n                            Use the <strong>packet console</strong> to monitor\n                            packets on the bus\n                        </li>\n                        <li>\n                            Check the class identifier in your annoucement\n                            packets\n                        </li>\n                    </ul>\n                </Alert>\n            )}\n        </>\n    )\n}\n","import React, { useContext, useEffect, useState } from \"react\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport { Button } from \"@material-ui/core\"\n// tslint:disable-next-line: no-submodule-imports\nimport { AlertTitle } from \"@material-ui/lab\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport InfoIcon from \"@material-ui/icons/Info\"\nimport Alert from \"../ui/Alert\"\nimport IconButtonWithTooltip from \"../ui/IconButtonWithTooltip\"\nimport {\n    addServiceProvider,\n    serviceProviderDefinitionFromServiceClass,\n} from \"../../../jacdac-ts/src/servers/servers\"\nimport Flags from \"../../../jacdac-ts/src/jdom/flags\"\nimport { JDService } from \"../../../jacdac-ts/src/jdom/service\"\nimport { serviceTestFromServiceClass } from \"../../../jacdac-ts/src/test/testspec\"\nimport SelectServiceGrid from \"../select/SelectServiceGrid\"\nimport ServiceTestRunner from \"./ServiceTestRunner\"\nimport { DISCONNECT } from \"../../../jacdac-ts/src/jdom/constants\"\n\nfunction Diagnostics(props: { serviceClass: number }) {\n    const { serviceClass } = props\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n\n    const hostDefinition = serviceProviderDefinitionFromServiceClass(serviceClass)\n    const handleStartSimulator = () => addServiceProvider(bus, hostDefinition)\n\n    if (!hostDefinition) return null\n\n    return (\n        <Alert severity=\"info\">\n            <AlertTitle>Developer zone</AlertTitle>\n            <Button variant=\"outlined\" onClick={handleStartSimulator}>\n                start simulator\n            </Button>\n        </Alert>\n    )\n}\n\nfunction ServiceTestRunnerSelect(props: {\n    serviceClass: number\n    onSelect: (service: JDService) => void\n}) {\n    const { serviceClass, onSelect } = props\n    return (\n        <>\n            <h3>Select a device to test</h3>\n            <SelectServiceGrid serviceClass={serviceClass} onSelect={onSelect} />\n        </>\n    )\n}\n\nexport default function ServiceTest(props: {\n    serviceSpec: jdspec.ServiceSpec\n    serviceTest?: jdtest.ServiceTestSpec\n    showStartSimulator?: boolean\n}) {\n    const {\n        serviceSpec,\n        showStartSimulator,\n        serviceTest = serviceTestFromServiceClass(serviceSpec?.classIdentifier),\n    } = props\n    const { classIdentifier: serviceClass } = serviceSpec\n    const [service, setService] = useState<JDService>(undefined)\n    const handleSelect = (service: JDService) => setService(service)\n    // clear selected service when json changes\n    useEffect(() => {\n        setService(undefined)\n    }, [serviceTest])\n    // clear service if device disconnects\n    useEffect(() => service?.device?.subscribe(DISCONNECT, () => {\n        setService(undefined)\n    }), [service])\n\n    return (\n        <>\n            <h1>\n                {`${serviceSpec.name} tests`}\n                <IconButtonWithTooltip\n                    title=\"go to specification\"\n                    to={`/services/${serviceSpec.shortId}/`}\n                >\n                    <InfoIcon />\n                </IconButtonWithTooltip>\n            </h1>\n            {(Flags.diagnostics || showStartSimulator) && (\n                <Diagnostics serviceClass={serviceClass} />\n            )}\n            {!service && (\n                <ServiceTestRunnerSelect\n                    serviceClass={serviceClass}\n                    onSelect={handleSelect}\n                />\n            )}\n            {service && (\n                <ServiceTestRunner\n                    service={service}\n                    serviceTest={serviceTest}\n                />\n            )}\n        </>\n    )\n}\n","import { Box, Chip, createStyles, Grid, makeStyles, Typography, useTheme } from \"@material-ui/core\";\nimport React from \"react\";\nimport clsx from 'clsx';\n\nconst useStyles = makeStyles((theme) => createStyles({\n    hr: {\n        background: theme.palette.text.disabled,\n        marginBottom: \"unset\"\n    },\n    start: {\n        width: theme.spacing(2)\n    },\n}));\n\nexport default function GridHeader(props: {\n    title?: string,\n    count?: number,\n    variant?: \"subtitle1\" | \"caption\" | \"subtitle2\",\n    action?: JSX.Element\n}) {\n    const { title, count, variant, action } = props;\n    const classes = useStyles();\n    return <Grid item xs={12}>\n        <Grid container direction=\"row\" spacing={1} justify=\"center\" alignItems=\"center\">\n            <Grid item>\n                <hr className={clsx(classes.hr, classes.start)} />\n            </Grid>\n            <Grid item>\n                {action && <Box component=\"span\" mr={1}>{action}</Box>}\n                <Typography component=\"span\" variant={variant || \"subtitle1\"}>{title}</Typography>\n                {count !== undefined && <Box component=\"span\" ml={0.5}><Chip label={count} /></Box>}\n            </Grid>\n            <Grid item xs>\n                <hr className={classes.hr} />\n            </Grid>\n        </Grid>\n    </Grid>\n}\n","import { \n    exprVisitor,\n    SpecSymbolResolver\n} from \"./jdutils\"\nimport { getTestCommandFunctions, getTestExpressionFunctions } from \"./jdtestfuns\"\nimport jsep from \"jsep\"\n\nconst supportedExpressions: jsep.ExpressionType[] = [\n    \"MemberExpression\",\n    \"ArrayExpression\",\n    \"BinaryExpression\",\n    \"CallExpression\",\n    \"Identifier\",\n    \"Literal\",\n    \"UnaryExpression\",\n    \"LogicalExpression\",\n]\n\n// we parse a test with respect to an existing ServiceSpec\nexport function parseSpecificationTestMarkdownToJSON(\n    filecontent: string,\n    spec: jdspec.ServiceSpec,\n    filename = \"\"\n): jdtest.ServiceTestSpec {\n    if (!spec)\n        return undefined;\n\n    filecontent = (filecontent || \"\").replace(/\\r/g, \"\")\n    const info: jdtest.ServiceTestSpec = {\n        description: \"\",\n        serviceClassIdentifier: spec.classIdentifier,\n        tests: [],\n    }\n\n    let backticksType = \"\"\n    const errors: jdspec.Diagnostic[] = []\n    let lineNo = 0\n    let currentTest: jdtest.TestSpec = null\n    let testHeading = \"\"\n    let testPrompt = \"\"\n    const symbolResolver = new SpecSymbolResolver(spec, undefined, supportedExpressions, jsep, (e) => error(e))\n\n    try {\n        for (const line of filecontent.split(/\\n/)) {\n            lineNo++\n            processLine(line)\n        }\n    } catch (e) {\n        error(\"exception: \" + e.message)\n    }\n\n    if (currentTest) finishTest(symbolResolver)\n\n    if (errors.length) info.errors = errors\n\n    return info\n\n    function processLine(line: string) {\n        if (backticksType) {\n            if (line.trim() == \"```\") {\n                backticksType = null\n                if (backticksType == \"default\") return\n            }\n        } else {\n            const m = /^```(.*)/.exec(line)\n            if (m) {\n                backticksType = m[1] || \"default\"\n                if (backticksType == \"default\") return\n            }\n        }\n\n        const interpret =\n            backticksType == \"default\" || \n            line.slice(0, 4) == \"    \" ||\n            /^\\t/.exec(line)\n\n        if (!interpret) {\n            const m = /^(#+)\\s*(.*)/.exec(line)\n            if (m) {\n                testHeading = \"\"\n                testPrompt = \"\"\n                const [, hd, cont] = m\n                if (hd == \"#\") {\n                    if (!info.description)\n                        info.description = cont.trim()\n                    else \n                        error(\"use ## to start a test, not #\")\n                } else if (hd == \"##\") {\n                    if (currentTest) finishTest(symbolResolver)\n                    testHeading = cont.trim()\n                }\n            } else {\n                testPrompt += line\n            }\n        } else {\n            const expanded = line.replace(/\\/\\/.*/, \"\").trim()\n            if (!expanded) return\n            processCommand(expanded)\n        }\n    }\n\n    function processCommand(expanded: string) {\n        // TODO: if there is a prompt, the test has no commands, and\n        // TODO: the first command is not ask/say\n        // TODO: then add a say command\n\n        if (!currentTest) {\n            if (!testHeading)\n                error(`every test must have a description (via ##)`)\n            currentTest = {\n                description: testHeading,\n                prompt: testPrompt,\n                registers: [],\n                events: [],\n                testCommands: [],\n            }\n            testHeading = \"\"\n            testPrompt = \"\"\n        }\n \n        const ret = symbolResolver.processLine(expanded, getTestCommandFunctions());\n\n        if (ret) {\n            const [command, root] = ret\n            // check all calls in subexpressions\n            processCalls(command, root)\n            currentTest.testCommands.push({ prompt: testPrompt, call: root })\n            testPrompt = \"\"\n        }\n\n        // this checking is specific to test functions (for now)\n        function processCalls(command: jdtest.TestFunctionDescription, root: jsep.CallExpression) {\n            const args = root.arguments\n            const testExpressionFunctions = getTestExpressionFunctions()\n            args.forEach((arg, a) => {\n                const argType = command.args[a]\n                exprVisitor(root, arg, (parent, callExpr: jsep.CallExpression) => {\n                    if (callExpr.type !== 'CallExpression')\n                        return;\n                    if (callExpr.callee.type !== \"Identifier\")\n                        error(`all calls must be direct calls`)\n                    const id = (<jsep.Identifier>callExpr.callee).name\n                    const tef = testExpressionFunctions.find(r => id == r.id)\n                    if (!tef)\n                        error(\n                            `${id} is not a registered test expression function.`\n                        )\n                    if (tef.context === \"expression\" || tef.context === \"either\") {\n                        if (argType != \"boolean\")\n                            error(`${id} expression function can only be used inside a boolean expression`)\n                        // no nested calls\n                        if (command.context === \"expression\" || command.context === \"either\") \n                            error(`cannot nest ${tef.id} underneath ${command.id}`)\n                        // look under tef\n                        exprVisitor(null, callExpr, (parent, ce: jsep.CallExpression) => {\n                            if (ce.type !== 'CallExpression')\n                                return;\n                            if (ce.callee.type === \"Identifier\" && (<jsep.Identifier>ce.callee).name)\n                                error(`cannot nest ${(<jsep.Identifier>ce.callee).name} underneath ${id}`)\n                        })\n                    }\n                    const expected = tef.args.length\n                    if (expected !== callExpr.arguments.length)\n                        error(\n                            `Expected ${expected} arguments; got ${callExpr.arguments.length}`\n                        )\n                })\n            })\n        }\n    }\n\n    function finishTest(s: SpecSymbolResolver) {\n        currentTest.registers = s.registers\n        currentTest.events = s.events\n        s.reset()\n        info.tests.push(currentTest)\n        currentTest = null\n    }\n\n    function error(msg: string) {\n        if (!msg) msg = \"syntax error\"\n        if (errors.some(e => e.line == lineNo && e.message == msg)) return\n        errors.push({ file: filename, line: lineNo, message: msg })\n    }\n}\n","import React, { useContext, useEffect, useMemo } from \"react\"\nimport { Button, Grid } from \"@material-ui/core\"\nimport { parseSpecificationTestMarkdownToJSON } from \"../../../jacdac-ts/jacdac-spec/spectool/jdtest\"\nimport { serviceSpecificationFromClassIdentifier } from \"../../../jacdac-ts/src/jdom/spec\"\nimport useLocalStorage from \"../useLocalStorage\"\nimport HighlightTextField from \"../ui/HighlightTextField\"\nimport ServiceSpecificationSelect from \"../ServiceSpecificationSelect\"\nimport { SRV_BUTTON } from \"../../../jacdac-ts/src/jdom/constants\"\nimport ServiceTest from \"../test/ServiceTest\"\nimport { fetchText } from \"../github\"\nimport AppContext from \"../AppContext\"\nimport Markdown from \"../ui/Markdown\"\nimport GridHeader from \"../ui/GridHeader\"\n\nconst SERVICE_TEST_SERVICE_STORAGE_KEY = \"jacdac:servicetesteditor:service\"\nconst SERVICE_TEST_SOURCE_STORAGE_KEY = \"jacdac:servicetesteditorsource\"\nconst SERVICE_MARKDOWN_SOURCE_STORAGE_KEY =\n    \"jacdac:servicetesteditorsource:markdown\"\n\nexport default function ServiceTestEditor() {\n    const { setError } = useContext(AppContext)\n    const [serviceClass, setServiceClass] = useLocalStorage<number>(\n        SERVICE_TEST_SERVICE_STORAGE_KEY,\n        SRV_BUTTON\n    )\n    const [source, setSource] = useLocalStorage(\n        SERVICE_TEST_SOURCE_STORAGE_KEY,\n        \"\"\n    )\n    const [markdownSource, setMarkdownSource] = useLocalStorage(\n        SERVICE_MARKDOWN_SOURCE_STORAGE_KEY,\n        \"\"\n    )\n    const serviceSpec = useMemo(\n        () => serviceSpecificationFromClassIdentifier(serviceClass),\n        [serviceClass]\n    )\n    const json = useMemo(\n        () => parseSpecificationTestMarkdownToJSON(source, serviceSpec),\n        [source, serviceSpec]\n    )\n    const servicePath =\n        json &&\n        `services/tests/${(\n            serviceSpec.camelName ||\n            serviceSpec.shortId ||\n            `0x${serviceSpec.classIdentifier.toString(16)}`\n        ).toLowerCase()}`\n    const handleLoadFromGithub = async () => {\n        try {\n            const ghSource = await fetchText(\n                \"microsoft/jacdac\",\n                \"main\",\n                `services/tests/${serviceSpec.shortId}.md`,\n                \"text/plain\"\n            )\n            setSource(ghSource || \"\")\n        } catch (e) {\n            setError(e)\n        }\n        try {\n            const ghSource = await fetchText(\n                \"microsoft/jacdac\",\n                \"main\",\n                `services/${serviceSpec.shortId}.md`,\n                \"text/plain\"\n            )\n            if (ghSource) setMarkdownSource(ghSource)\n            else setError(\"Specification source not found\")\n        } catch (e) {\n            setError(e)\n        }\n    }\n    return (\n        <Grid spacing={2} container>\n            <Grid item xs={12}>\n                <Grid container spacing={2} direction=\"row\">\n                    <Grid item>\n                        <ServiceSpecificationSelect\n                            label={\"Select a service to test\"}\n                            serviceClass={serviceClass}\n                            setServiceClass={setServiceClass}\n                        />\n                    </Grid>\n                    <Grid item>\n                        <Button\n                            variant=\"outlined\"\n                            disabled={!serviceSpec}\n                            onClick={handleLoadFromGithub}\n                        >\n                            Load from GitHub\n                        </Button>\n                    </Grid>\n                </Grid>\n            </Grid>\n            <Grid spacing={2} container>\n                <Grid item xs={12} sm={7}>\n                    <HighlightTextField\n                        code={source}\n                        language={\"markdown\"}\n                        onChange={setSource}\n                        annotations={json?.errors}\n                        pullRequestTitle={\n                            json && `Service test: ${serviceSpec.name}`\n                        }\n                        pullRequestPath={servicePath}\n                    />\n                </Grid>\n                <Grid item xs={12} sm={5}>\n                    <Markdown source={markdownSource} />\n                </Grid>\n            </Grid>\n            <GridHeader title=\"Preview\" />\n            {json && (\n                <Grid item xs={12} xl={7}>\n                    <ServiceTest\n                        showStartSimulator={true}\n                        serviceSpec={serviceSpec}\n                        serviceTest={json}\n                    />\n                </Grid>\n            )}\n        </Grid>\n    )\n}\n","import { Link } from \"gatsby-theme-material-ui\"\nimport React from \"react\"\nimport ServiceTestEditor from \"../../components/tools/ServiceTestEditor\"\n\nexport default function Page() {\n    return (\n        <>\n            <h1>Service Test Editor</h1>\n            <p>\n                Read the{\" \"}\n                <Link to=\"/reference/service-tests\">\n                    service test\n                </Link>{\" \"}\n                documentation.\n            </p>\n            <ServiceTestEditor />\n        </>\n    )\n}\n"],"sourceRoot":""}