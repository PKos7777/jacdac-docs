{"version":3,"sources":["webpack:///./src/components/hooks/useArrowKeys.ts","webpack:///./src/components/hooks/useKeyboardNavigation.ts","webpack:///./src/components/hooks/useKeyboardNavigationProps.ts","webpack:///./src/components/dashboard/DashboardLEDMatrix.tsx"],"names":["LEFT_KEY","UP_KEY","RIGHT_KEY","DOWN_KEY","useArrowKeys","options","onLeft","onUp","onRight","onDown","symmetric","undefined","handlers","e","charCode","keyCodeFromEvent","handler","preventDefault","useKeyboardNavigation","parentRef","query","onMove","offset","console","log","focusable","Array","from","querySelectorAll","length","me","findIndex","f","document","activeElement","next","focus","useKeyboardNavigationProps","vertical","onKeyDown","DashboardLEDMatrixDisplay","props","service","services","variant","widgetRef","useRef","ledsRegister","register","LedMatrixReg","Leds","useRegisterUnpackedValue","leds","Brightness","brightness","Rows","rows","Columns","columns","host","useServiceHost","color","useWidgetTheme","background","controlBackground","active","minOpacity","pw","ph","ps","pr","m","w","h","columnspadded","handleLedClick","bitindex","ev","buttons","newLeds","slice","toggle","sendSetAsync","render","boxEls","ledEls","onFill","onStroke","offFill","offStroke","ledProps","className","role","tabIndex","y","row","x","col","box","push","byte","bit","on","handleClick","fireClick","useFireKey","navProps","current"],"mappings":"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","file":"103-48cf0e2d7e30f2a32af3.js","sourcesContent":["import React, { KeyboardEvent } from \"react\"\nimport { keyCodeFromEvent } from \"./useFireKey\";\n\nconst LEFT_KEY = 37;\nconst UP_KEY = 38;\nconst RIGHT_KEY = 39;\nconst DOWN_KEY = 40;\n\nexport default function useArrowKeys(options: {\n    onLeft?: () => void,\n    onRight?: () => void,\n    onUp?: () => void,\n    onDown?: () => void,\n    symmetric?: boolean;\n}) {\n    const { onLeft, onUp, onRight, onDown, symmetric } = options;\n\n    if (!onLeft && !onUp && !onRight && !onDown)\n        return undefined;\n\n    const handlers = {\n        [LEFT_KEY]: onLeft,\n        [RIGHT_KEY]: onRight,\n        [UP_KEY]: onUp || (symmetric && onRight),\n        [DOWN_KEY]: onDown || (symmetric && onLeft)\n    }\n\n    return (e: KeyboardEvent<Element>) => {\n        const charCode = keyCodeFromEvent(e);\n        const handler = handlers[charCode];\n        if (handler) {\n            e.preventDefault();\n            handler();\n        }\n    }\n}\n","import React from \"react\"\n\nexport default function useKeyboardNavigation(parentRef: Element) {\n    const query = '[tabindex=\"0\"]';\n    const onMove = (offset: number) => () => {\n        console.log('keyboard move', { offset })\n        const focusable = Array.from<SVGElement>(parentRef?.querySelectorAll(query) || []);\n        if (focusable.length) {\n            const me = focusable.findIndex(f => f === document.activeElement);\n            const next = ((me + offset) + focusable.length) % focusable.length;\n            focusable[next].focus();\n        }\n    }\n    return onMove;\n}","import useArrowKeys from \"./useArrowKeys\";\nimport useKeyboardNavigation from \"./useKeyboardNavigation\";\n\nexport default function useKeyboardNavigationProps(parentRef: Element, vertical?: boolean) {\n    const onMove = useKeyboardNavigation(parentRef);\n\n    const onKeyDown = useArrowKeys({\n        onLeft: !vertical && onMove(-1),\n        onRight: !vertical && onMove(1),\n        onDown: vertical && onMove(1),\n        onUp: vertical && onMove(-1),\n    });\n\n    return {\n        onKeyDown: parentRef && onKeyDown\n    }\n}","import React, { SVGProps, useRef } from \"react\";\nimport { LedMatrixReg } from \"../../../jacdac-ts/src/jdom/constants\";\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\";\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\";\nimport SvgWidget from \"../widgets/SvgWidget\";\nimport useWidgetTheme from \"../widgets/useWidgetTheme\";\nimport useServiceHost from \"../hooks/useServiceHost\";\nimport useFireKey from \"../hooks/useFireKey\";\nimport useKeyboardNavigationProps from \"../hooks/useKeyboardNavigationProps\";\nimport { toggle } from \"../../../jacdac-ts/src/hosts/ledmatrixservicehost\";\nimport LoadingProgress from \"../ui/LoadingProgress\";\n\nexport default function DashboardLEDMatrixDisplay(props: DashboardServiceProps) {\n    const { service, services, variant } = props;\n    \n    const widgetRef = useRef<SVGGElement>();\n    const ledsRegister = service.register(LedMatrixReg.Leds);\n    const [leds] = useRegisterUnpackedValue<[Uint8Array]>(ledsRegister);\n    const [brightness] = useRegisterUnpackedValue<[number]>(service.register(LedMatrixReg.Brightness));\n    const [rows] = useRegisterUnpackedValue<[number]>(service.register(LedMatrixReg.Rows));\n    const [columns] = useRegisterUnpackedValue<[number]>(service.register(LedMatrixReg.Columns));\n    const host = useServiceHost(service);\n    const color = host ? \"secondary\" : \"primary\";\n    const { background, controlBackground, active } = useWidgetTheme(color)\n\n    // no data about layout\n    if (rows === undefined || columns === undefined)\n        return <LoadingProgress />;\n\n    // compute size\n    const minOpacity = 0.3;\n    const pw = 8;\n    const ph = 8;\n    const ps = 0.5;\n    const pr = 2;\n    const m = 2;\n    const w = columns * pw + (columns + 1) * m;\n    const h = rows * ph + (rows + 1) * m;\n\n    const columnspadded = columns + (8 - columns % 8)\n    const handleLedClick = (bitindex: number) => (ev: React.PointerEvent<SVGRectElement>) => {\n        if (ev && !ev.buttons) return;\n        const newLeds = leds.slice(0);\n        toggle(newLeds, bitindex);\n        ledsRegister.sendSetAsync(newLeds, true)\n    }\n\n    // add leds\n    const render = () => {\n        const boxEls: JSX.Element[] = [];\n        const ledEls: JSX.Element[] = [];\n        const onFill = active;\n        const onStroke = undefined;\n        const offFill = controlBackground;\n        const offStroke = \"transparent\";\n        const ledProps: SVGProps<SVGRectElement> = {\n            className: \"clickeable\",\n            role: \"button\",\n            tabIndex: 0\n        }\n\n        let y = m;\n        for (let row = 0; row < rows; row++) {\n            let x = m;\n            for (let col = 0; col < columns; col++) {\n                const box = <rect key={`b${row}-${col}`} x={x} y={y} width={pw} height={ph} rx={pr} ry={pr}\n                    fill={controlBackground} />;\n                boxEls.push(box)\n\n                const bitindex = (row * columnspadded) + col;\n                const byte = leds?.[bitindex >> 3];\n                const bit = bitindex % 8;\n                const on = 1 === ((byte >> bit) & 1)\n                const handleClick = handleLedClick(bitindex)\n                const fireClick = useFireKey(handleClick);\n\n                ledEls.push(<rect key={`l${row}-${col}`} x={x} y={y} width={pw} height={ph} rx={pr} ry={pr}\n                    fill={on ? onFill : offFill}\n                    stroke={on ? onStroke : offStroke}\n                    strokeWidth={ps}\n                    {...ledProps}\n                    aria-label={`led ${row}, ${col} ${on ? \"on\" : \"off\"}`}\n                    onPointerDown={handleClick}\n                    onPointerEnter={handleClick}\n                    onKeyDown={fireClick}\n                />);\n                x += pw + m;\n            }\n            y += ph + m;\n        }\n        return { boxEls, ledEls }\n    }\n\n    const { boxEls, ledEls } = render();\n    const navProps = useKeyboardNavigationProps(widgetRef.current)\n    return <SvgWidget width={w} height={h}>\n        <rect x={0} y={0} width={w} height={h} rx={2} ry={2} fill={background} />\n        <g ref={widgetRef} {...navProps}>\n            {boxEls}\n            {ledEls.length && <g opacity={minOpacity + brightness * (1 - minOpacity)}>\n                {ledEls}\n            </g>}\n        </g>\n    </SvgWidget>\n}"],"sourceRoot":""}