{"version":3,"sources":["webpack:///./src/pages/tools/edge-impulse.tsx"],"names":["EDGE_IMPULSE_API_KEY","IDLE","STARTING","SAMPLING","UPLOADING","SAMPLING_STATE","EdgeImpulseClient","apiKey","aggregator","inputRegisters","palette","connectionState","DISCONNECT","samplingState","handleMessage","bind","handleOpen","handleError","handleReport","handlePing","aggregatorClient","SensorAggregatorClient","subscribeSample","mount","disconnect","unmount","clearSampling","_pingInterval","clearInterval","undefined","_ws","w","close","e","console","debug","setConnectionState","state","emit","CONNECTION_STATE","log","setSamplingState","CHANGE","send","msg","JSON","stringify","service","device","resolveFirmwareIdentifier","firmwareIdentifier","deviceSpec","deviceSpecificationFromFirmwareIdentifier","_hello","deviceId","name","toString","map","reg","serviceName","serviceClass","join","reconnect","connect","data","pong","parse","hello","ERROR","err","CONNECT","sample","startSampling","row","connected","sampling","some","r","bus","timestamp","_sample","startTimestamp","lastProgressTimestamp","ds","dataSet","addRow","REPORT_RECEIVE","PROGRESS","progress","length","stopSampling","uploadData","payload","Date","now","deviceType","interval","headers","h","i","units","fetch","path","method","label","body","then","resp","text","filename","generatedFilename","finally","ev","FieldDataSet","create","unsubscribers","aggregatorConfig","samplingInterval","samplesInWindow","inputs","serviceIndex","setInputs","collect","forEach","unsub","CONNECTING","WebSocket","onmessage","onopen","onerror","setInterval","currentProjectInfo","valid","apiFetch","rsj","success","errorStatus","projectId","projects","id","project","API_ROOT","url","options","status","error","statusText","json","message","deviceInfo","renameDevice","JDClient","ApiKeyManager","validateKey","key","statusCode","useEdgeImpulseProjectInfo","useState","info","setInfo","useEffectAsync","mounted","ProjectInfo","props","disabled","dataSummary","dataCount","logo","ModelDownloadButton","setModel","theme","useTheme","downloading","setDownloading","setError","download","downloads","find","type","handleDownload","blob","res","readBlobToUint8Array","bytes","spacing","link","AggregatorCard","selected","onChecked","handleChecked","Acquisition","client","setClient","samplingProgress","setSamplingProgress","setDeviceInfo","deviceName","useDeviceName","useChartPalette","generatedSampleName","useEffect","c","ip","subscribe","v","p","rename","EdgeImpulse","useDbValue","value","useContext","JacdacContext","model","registerIdsChecked","setRegisterIdsChecked","aggregatorId","setAggregatorId","gridBreakPoints","useGridBreakpoints","aggregators","useChange","services","SRV_SENSOR_AGGREGATOR","currentAggregator","srv","readingRegisters","devices","isSensor","specification","readingRegister","filter","indexOf","handleAggregatorChecked","handleRegisterCheck","splice","push","sort","SRV_MODEL_RUNNER"],"mappings":"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","file":"component---src-pages-tools-edge-impulse-tsx-023f0a96c8dfc71798e1.js","sourcesContent":["import React, { useContext, useEffect, useState } from \"react\"\nimport { Box, Button, Card, CardActions, CardContent, CardHeader, CardMedia, CircularProgress, Grid, Switch, Typography, useTheme } from '@material-ui/core';\nimport { Link } from 'gatsby-theme-material-ui';\nimport useDbValue from \"../../components/useDbValue\";\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\";\nimport useChange from \"../../jacdac/useChange\";\nimport useGridBreakpoints from \"../../components/useGridBreakpoints\";\nimport { JDRegister } from \"../../../jacdac-ts/src/jdom/register\";\nimport { JDClient } from \"../../../jacdac-ts/src/jdom/client\";\nimport DeviceCardHeader from \"../../components/DeviceCardHeader\";\nimport Alert from \"../../components/ui/Alert\";\nimport useEffectAsync from \"../../components/useEffectAsync\";\nimport { CHANGE, CONNECT, CONNECTING, CONNECTION_STATE, DISCONNECT, ERROR, PROGRESS, REPORT_RECEIVE, SRV_MODEL_RUNNER, SRV_SENSOR_AGGREGATOR } from \"../../../jacdac-ts/src/jdom/constants\";\nimport FieldDataSet from \"../../components/FieldDataSet\";\nimport { deviceSpecificationFromFirmwareIdentifier, isSensor } from \"../../../jacdac-ts/src/jdom/spec\";\nimport CircularProgressWithLabel from \"../../components/ui/CircularProgressWithLabel\";\nimport Trend from \"../../components/Trend\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport GetAppIcon from '@material-ui/icons/GetApp';\nimport ServiceList from \"../../components/ServiceList\";\nimport { ModelActions, ModelContent } from \"../../components/tools/ModelUploader\";\nimport { readBlobToUint8Array } from \"../../../jacdac-ts/src/jdom/utils\";\nimport useDeviceName from \"../../components/useDeviceName\";\nimport { JDService } from \"../../../jacdac-ts/src/jdom/service\";\nimport ReadingFieldGrid from \"../../components/ReadingFieldGrid\";\nimport useChartPalette from '../../components/useChartPalette';\nimport { SensorAggregatorClient, SensorAggregatorConfig } from \"../../../jacdac-ts/src/jdom/sensoraggregatorclient\";\nimport { AlertTitle } from \"@material-ui/lab\";\nimport { serviceName } from \"../../../jacdac-ts/src/jdom/pretty\";\nimport ConnectAlert from \"../../components/alert/ConnectAlert\";\nimport ApiKeyAccordion from \"../../components/ApiKeyAccordion\";\n\nconst EDGE_IMPULSE_API_KEY = \"edgeimpulseapikey\"\n\nconst IDLE = \"idle\";\nconst STARTING = \"starting\";\nconst SAMPLING = \"sampling\";\nconst UPLOADING = \"uploading\";\n\nconst SAMPLING_STATE = \"samplingState\";\n\ninterface EdgeImpulseResponse {\n    success: boolean;\n    error?: string;\n    // HTTP status code\n    errorStatus?: number;\n}\n\ninterface EdgeImpulseHello {\n    hello?: boolean;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    err?: any;\n}\n\ninterface EdgeImpulseSensorInfo {\n    \"name\": string,\n    \"maxSampleLengthS\": number,\n    \"frequencies\": number[]\n}\n\ninterface EdgeImpulseRemoteManagementInfo {\n    version: number;\n    apiKey: string;\n    deviceId: string;\n    deviceType: string;\n    connection: string;\n    sensors: EdgeImpulseSensorInfo[]\n}\n\ninterface EdgeImpulseDeviceInfo {\n    id: number;\n    deviceId: string;\n    name: string;\n    created: string;\n    lastSeen: string;\n    deviceType: string;\n    sensors: EdgeImpulseSensorInfo[]\n}\n\ninterface EdgeImpulseDeviceResponse extends EdgeImpulseResponse {\n    device?: EdgeImpulseDeviceInfo;\n}\n\ninterface EdgeImpulseSample extends EdgeImpulseResponse {\n    \"label\": string;\n    \"length\": number;\n    \"path\": string;\n    \"hmacKey\": string;\n    \"interval\": number;\n    \"sensor\": string;\n}\n\ninterface EdgeImpulseSampling extends EdgeImpulseSample {\n    dataSet?: FieldDataSet;\n    startTimestamp?: number;\n    lastProgressTimestamp?: number;\n    generatedFilename?: string;\n    aggregatorConfig?: SensorAggregatorConfig;\n    unsubscribers?: (() => void)[];\n}\n\ninterface EdgeImpulseProjectInfo {\n    id: number;\n    name: string;\n    logo?: string;\n}\n\ninterface EdgeImpulseProject extends EdgeImpulseResponse {\n    project: EdgeImpulseProjectInfo,\n    devices: EdgeImpulseDeviceInfo[],\n    impulse: {\n        created: boolean;\n        configured: boolean;\n        complete: boolean;\n    },\n    dataSummary: {\n        totalLengthMs: number;\n        labels: string[];\n        dataCount: number;\n    },\n    downloads: {\n        name: string;\n        type: string;\n        size: string;\n        link: string;\n    }[];\n}\n\ninterface EdgeImpulseProjects extends EdgeImpulseResponse {\n    projects: EdgeImpulseProjectInfo[];\n}\n\n/*\nA client for the EdgeImpulse remote management\nhttps://docs.edgeimpulse.com/reference#remote-management\n*/\nclass EdgeImpulseClient extends JDClient {\n    private _ws: WebSocket;\n    public connectionState = DISCONNECT;\n    public samplingState = IDLE;\n    private _hello: EdgeImpulseRemoteManagementInfo;\n    private _sample: EdgeImpulseSampling;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    private _pingInterval: any;\n    private pong: boolean;\n    private aggregatorClient: SensorAggregatorClient;\n\n    constructor(\n        private readonly apiKey: string,\n        private readonly aggregator: JDService,\n        private readonly inputRegisters: JDRegister[],\n        private readonly palette: string[]\n    ) {\n        super()\n\n        this.handleMessage = this.handleMessage.bind(this);\n        this.handleOpen = this.handleOpen.bind(this)\n        this.handleError = this.handleError.bind(this);\n        this.handleReport = this.handleReport.bind(this);\n        this.handlePing = this.handlePing.bind(this);\n\n        this.aggregatorClient = new SensorAggregatorClient(this.aggregator);\n        this.aggregatorClient.subscribeSample(this.handleReport);\n\n        this.mount(() => this.disconnect());\n        this.mount(() => this.aggregatorClient.unmount());\n    }\n\n    get dataSet() {\n        return this._sample?.dataSet;\n    }\n\n    disconnect() {\n        this.clearSampling();\n        if (this._pingInterval) {\n            clearInterval(this._pingInterval)\n            this._pingInterval = undefined;\n        }\n        // stop socket\n        if (this._ws) {\n            const w = this._ws;\n            this._ws = undefined;\n            try {\n                w.close();\n            }\n            catch (e) {\n                console.debug(e)\n            }\n            finally {\n                this.setConnectionState(DISCONNECT);\n            }\n        }\n    }\n\n    private setConnectionState(state: string) {\n        if (this.connectionState !== state) {\n            this.connectionState = state;\n            this.emit(CONNECTION_STATE, this.connectionState);\n            console.log(`ei: connection state changed`, this.connectionState)\n        }\n    }\n\n    private setSamplingState(state: string) {\n        if (this.samplingState !== state) {\n            this.samplingState = state;\n            this.emit(SAMPLING_STATE, this.samplingState)\n            this.emit(CHANGE)\n            console.log(`ei: sampling state changed`, this.samplingState)\n        }\n    }\n\n    private send(msg: unknown) {\n        this._ws?.send(JSON.stringify(msg))\n    }\n\n    private async handleOpen() {\n        console.log(`ws: open`)\n        const service = this.aggregator;\n        const { device } = service;\n\n        // fetch device spec\n        const firmwareIdentifier = await service.device.resolveFirmwareIdentifier();\n        const deviceSpec = deviceSpecificationFromFirmwareIdentifier(firmwareIdentifier);\n\n        this._hello = {\n            \"version\": 2,\n            \"apiKey\": this.apiKey,\n            \"deviceId\": device.deviceId,\n            \"deviceType\": deviceSpec?.name || firmwareIdentifier?.toString(16) || \"Jacdac device\",\n            \"connection\": \"ip\", // direct connection\n            \"sensors\": [{\n                \"name\": this.inputRegisters.map(reg => serviceName(reg.service.serviceClass)).join(','),\n                \"maxSampleLengthS\": 10000,\n                \"frequencies\": [50, 30, 20, 10]\n            }]\n        };\n        this.send({\n            \"hello\": this._hello\n        })\n    }\n\n    private reconnect() {\n        this.disconnect();\n        this.connect();\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    private handleMessage(msg: any) {\n        // response to ping?\n        if (msg.data === \"pong\") {\n            this.pong = true;\n            return;\n        }\n\n        const data = JSON.parse(msg.data)\n        if (data.hello !== undefined) {\n            const hello = data as EdgeImpulseHello;\n            if (!hello.hello) {\n                this.emit(ERROR, hello.err)\n                this.disconnect();\n            } else {\n                this.setConnectionState(CONNECT);\n            }\n        } else if (data.sample) {\n            const sample = data.sample as EdgeImpulseSample;\n            this.startSampling(sample);\n        }\n    }\n\n    get connected() {\n        return this.connectionState === CONNECT;\n    }\n\n    get sampling() {\n        return this.samplingState !== IDLE;\n    }\n\n    get generatedSampleName() {\n        return this._sample?.generatedFilename;\n    }\n\n    get aggregatorConfig() {\n        return this._sample?.aggregatorConfig;\n    }\n\n    private handleReport(row: number[]) {\n        console.log(`ei: aggregator report`, this.connected, this.sampling)\n        if (!this.connected) return; // ignore\n\n        // partial data? ignore\n        if (row.some(r => r === undefined))\n            return;\n\n        const { bus } = this.aggregator.device\n        const { timestamp } = bus;\n        // first sample, notify we're started\n        if (this.samplingState == STARTING) {\n            this._sample.startTimestamp = this._sample.lastProgressTimestamp = timestamp;\n            this.send({ \"sampleStarted\": true });\n            this.setSamplingState(SAMPLING);\n        }\n        // store sample\n        if (this.samplingState == SAMPLING) {\n            const ds = this.dataSet;\n            ds.addRow(row);\n            this.emit(REPORT_RECEIVE);\n\n            // debounced progress update\n            if (timestamp - this._sample.lastProgressTimestamp > 100) {\n                this._sample.lastProgressTimestamp = timestamp;\n                this.emit(PROGRESS, this.progress)\n            }\n\n            if (timestamp - this._sample.startTimestamp >= this._sample.length) {\n                // first stop the sampling\n                this.stopSampling();\n                // we're done!\n                this.emit(PROGRESS, this.progress)\n                // and upload...\n                this.uploadData();\n            }\n        }\n    }\n\n    private uploadData(): Promise<void> {\n        this.setSamplingState(UPLOADING);\n        const ds = this.dataSet;\n        const payload = {\n            \"protected\": {\n                \"ver\": \"v1\",\n                \"alg\": \"none\",\n                \"iat\": Date.now()\n            },\n            \"signature\": \"\",\n            \"payload\": {\n                \"device_name\": this._hello.deviceId,\n                \"device_type\": this._hello.deviceType,\n                \"interval_ms\": this._sample.interval,\n                \"sensors\": ds.headers.map((h, i) => ({\n                    \"name\": ds.headers[i],\n                    \"units\": ds.units[i] || \"/\"\n                })\n                ),\n                \"values\": ds.data(true)\n            }\n        }\n        console.log(`payload`, payload)\n        // upload dataset\n        // https://docs.edgeimpulse.com/reference#ingestion-api\n        return fetch(`https://ingestion.edgeimpulse.com${this._sample.path}`, {\n            method: \"POST\",\n            headers: {\n                \"x-api-key\": this.apiKey,\n                \"x-label\": this._sample.label,\n                \"x-file-name\": ds.name,\n                \"x-disallow-duplicates\": \"true\",\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(payload)\n        }).then(async (resp) => {\n            // response contains the filename\n            const filename = await resp.text();\n            this._sample.generatedFilename = filename;\n        }).finally(() => {\n            this.send({\n                \"sampleFinished\": true\n            })\n            this.setSamplingState(IDLE);\n        })\n    }\n\n    private handleError(ev: Event) {\n        this.emit(ERROR, ev)\n        this.reconnect();\n    }\n\n    private async startSampling(sample: EdgeImpulseSample) {\n        this._sample = sample;\n        this._sample.dataSet = FieldDataSet.create(this.aggregator.device.bus, this.inputRegisters, \"sample\", this.palette)\n        this._sample.unsubscribers = [];\n        this.send({ \"sample\": true })\n        this.setSamplingState(STARTING);\n\n        // prepare configuration\n        this._sample.aggregatorConfig = {\n            samplingInterval: this._sample.interval,\n            samplesInWindow: 10,\n            inputs: this.inputRegisters.map(reg => ({\n                serviceClass: reg.service.serviceClass,\n                deviceId: reg.service.device.deviceId,\n                serviceIndex: reg.service.serviceIndex\n            }))\n        }\n\n        console.log(`ei: input`, this._sample.aggregatorConfig)\n        // setup aggregator client\n        await this.aggregatorClient.setInputs(this._sample.aggregatorConfig)\n        // schedule data collection, ask a few more samples\n        await this.aggregatorClient.collect(this._sample.length * 1.1);\n    }\n\n    private stopSampling() {\n        const sample = this._sample;\n        if (sample) {\n            sample.unsubscribers.forEach(unsub => {\n                try {\n                    unsub();\n                }\n                catch (e) {\n                    console.log(e)\n                }\n            })\n            sample.unsubscribers = [];\n        }\n    }\n\n    private clearSampling() {\n        this.stopSampling();\n        if (this._sample) {\n            this._sample = undefined;\n            this._hello = undefined;\n            this.setSamplingState(IDLE);\n        }\n    }\n\n    connect() {\n        if (this._ws) return; // already connected\n\n        console.log(`ei: connect`)\n        this.setConnectionState(CONNECTING)\n        this._ws = new WebSocket(\"wss://remote-mgmt.edgeimpulse.com\")\n        this._ws.onmessage = this.handleMessage;\n        this._ws.onopen = this.handleOpen;\n        this._ws.onerror = this.handleError;\n\n        this.pong = true;\n        this._pingInterval = setInterval(this.handlePing, 3000);\n    }\n\n    private handlePing() {\n        if (!this.connected) return;\n\n        if (!this.pong) {\n            // the socket did not response\n            console.log(`missing pong`)\n            this.reconnect();\n        } else {\n            // send a new ping and wait for pong\n            this.pong = false;\n            this._ws.send(\"ping\");\n        }\n    }\n\n    get progress() {\n        const timestamp = this.aggregator.device.bus.timestamp;\n        return this.samplingState !== IDLE\n            && (timestamp - this._sample.startTimestamp) / this._sample.length;\n    }\n\n    static async currentProjectInfo(apiKey: string): Promise<{\n        valid: boolean,\n        errorStatus?: number,\n        project?: EdgeImpulseProject\n    }> {\n        if (!apiKey) return { valid: false };\n\n        const rsj = await EdgeImpulseClient.apiFetch<EdgeImpulseProjects>(apiKey, \"projects\");\n        if (!rsj.success) {\n            return {\n                valid: false,\n                errorStatus: rsj.errorStatus\n            }\n        }\n\n        // the API returns the current project when using the API key\n        const projectId = rsj.projects?.[0]?.id;\n        if (!rsj?.success || projectId === undefined) {\n            return {\n                valid: true,\n                errorStatus: 402\n            }\n        }\n\n        const project = await EdgeImpulseClient.apiFetch<EdgeImpulseProject>(apiKey, projectId);\n        return {\n            valid: true,\n            errorStatus: project.errorStatus,\n            project\n        }\n    }\n\n    static async apiFetch<T extends EdgeImpulseResponse>(apiKey: string, path: string | number, body?: unknown): Promise<T> {\n        const API_ROOT = \"https://studio.edgeimpulse.com/v1/api/\"\n        const url = `${API_ROOT}${path}`\n        const options: RequestInit = {\n            method: body ? \"POST\" : \"GET\",\n            headers: {\n                \"x-api-key\": apiKey,\n                \"Accept\": \"application/json\"\n            },\n            body: body && JSON.stringify(body)\n        }\n        if (options.method === \"POST\")\n            options.headers[\"Content-Type\"] = \"application/json\"\n\n        const resp = await fetch(url, options)\n        if (resp.status !== 200)\n            return {\n                success: false,\n                errorStatus: resp.status,\n                error: resp.statusText\n            } as T;\n        try {\n            const payload = await resp.json() as T;\n            return payload;\n        } catch (e) {\n            return {\n                success: false,\n                errorStatus: 500,\n                error: e.message\n            } as T;\n        }\n    }\n\n    static async deviceInfo(apiKey: string, projectId: number, deviceId: string): Promise<EdgeImpulseDeviceResponse> {\n        return await EdgeImpulseClient.apiFetch<EdgeImpulseDeviceResponse>(apiKey, `${projectId}/device/${deviceId}`)\n    }\n\n    static async renameDevice(apiKey: string, projectId: number, deviceId: string, name: string): Promise<EdgeImpulseResponse> {\n        return await EdgeImpulseClient.apiFetch<EdgeImpulseResponse>(apiKey, `${projectId}/devices/${deviceId}/rename`, { name })\n    }\n}\n\nfunction ApiKeyManager() {\n    const validateKey = async (key: string) => {\n        const r = await EdgeImpulseClient.currentProjectInfo(key)\n        return {\n            statusCode: (r?.valid && 200) || r?.errorStatus || 500\n        }\n    };\n    return <ApiKeyAccordion\n        apiName={EDGE_IMPULSE_API_KEY}\n        validateKey={validateKey}\n        instructions={<p>To get an <b>API key</b>, navigate to &nbsp;\n            <Link to=\"https://studio.edgeimpulse.com/studio/8698/keys\" target=\"_blank\">https://studio.edgeimpulse.com/studio/8698/keys</Link>\n            &nbsp; and generate a new key.</p>}\n    />\n}\n\nfunction useEdgeImpulseProjectInfo(apiKey: string) {\n    const [info, setInfo] = useState<EdgeImpulseProject>(undefined);\n\n    useEffectAsync(async (mounted) => {\n        if (!apiKey) {\n            if (mounted())\n                setInfo(undefined);\n        } else {\n            const r = await EdgeImpulseClient.currentProjectInfo(apiKey)\n            if (mounted())\n                setInfo(r?.project);\n        }\n    }, [apiKey])\n\n    return info;\n}\n\nfunction ProjectInfo(props: { info: EdgeImpulseProject }) {\n    const { info } = props;\n    const disabled = !info?.success;\n\n    return <Card>\n        <CardHeader title={info?.project?.name || \"...\"}\n            subheader={info?.dataSummary && `${info?.dataSummary?.dataCount} samples`}\n        />\n        {info?.project?.logo && <CardMedia image={info?.project?.logo} />}\n        <CardActions>\n            <Button disabled={disabled} target=\"_blank\" href={`https://studio.edgeimpulse.com/studio/${info?.project?.id}/`} variant=\"contained\" color=\"primary\">Open EdgeImpulse</Button>\n        </CardActions>\n    </Card >\n}\n\nfunction ModelDownloadButton(props: { apiKey: string, info: EdgeImpulseProject, setModel: (blob: Uint8Array) => void }) {\n    const { apiKey, info, setModel } = props;\n    const theme = useTheme();\n    const [downloading, setDownloading] = useState(false)\n    const [error, setError] = useState(\"\")\n    const download = info?.downloads.find(download => download.type === \"TensorFlow Lite (float32)\");\n\n    const handleDownload = (url: string) => async () => {\n        try {\n            setDownloading(true)\n            setError(\"\")\n            const resp = await fetch(url, {\n                headers: {\n                    \"x-api-key\": apiKey\n                }\n            })\n            const res = await resp.blob()\n            const bytes = await readBlobToUint8Array(res);\n            setModel(bytes)\n        }\n        catch (e) {\n            console.log(e)\n            setError(\"Oops, download failed.\")\n        }\n        finally {\n            setDownloading(false)\n        }\n    }\n\n    return <Box mb={1}>\n        {error && <Alert severity=\"error\">{error}</Alert>}\n        <Button\n            variant=\"contained\"\n            disabled={!download || downloading}\n            startIcon={downloading ? <CircularProgress size={theme.spacing(2)} /> : <GetAppIcon />}\n            onClick={handleDownload(`https://studio.edgeimpulse.com${download?.link}`)}>DOWNLOAD MODEL</Button>\n    </Box>\n}\n\nfunction AggregatorCard(props: {\n    aggregator: JDService,\n    selected: boolean,\n    onChecked: () => void\n}) {\n    const { aggregator, selected, onChecked } = props;\n    const { device } = aggregator;\n\n    const handleChecked = () => onChecked();\n\n    return <Card>\n        <DeviceCardHeader device={device} showMedia={true} />\n        <CardContent>\n            <Switch checked={selected} onChange={handleChecked} />\n        </CardContent>\n    </Card>\n}\n\nfunction Acquisition(props: {\n    aggregator: JDService,\n    inputs: JDRegister[],\n    apiKey: string,\n    info: EdgeImpulseProjectInfo\n}) {\n    const { aggregator, inputs, apiKey, info } = props;\n\n    const { device } = aggregator;\n    const [client, setClient] = useState<EdgeImpulseClient>(undefined)\n    const [error, setError] = useState(\"\")\n    const [connectionState, setConnectionState] = useState(DISCONNECT)\n    const [samplingState, setSamplingState] = useState(IDLE)\n    const [samplingProgress, setSamplingProgress] = useState(0)\n    const [, setDeviceInfo] = useState<EdgeImpulseDeviceInfo>(undefined);\n    const { deviceId } = device;\n    const deviceName = useDeviceName(device, false);\n    const projectId = info?.id;\n    const palette = useChartPalette()\n\n    const connected = connectionState === CONNECT;\n    const sampling = samplingState !== IDLE\n    const dataSet = client?.dataSet;\n    const generatedSampleName = client?.generatedSampleName;\n    const aggregatorConfig = client?.aggregatorConfig;\n\n    useEffect(() => {\n        if (!apiKey || !aggregator || !inputs?.length) {\n            setClient(undefined);\n            setError(undefined);\n            return undefined;\n        }\n        else {\n            console.log(`ei: start client`)\n            const c = new EdgeImpulseClient(apiKey, aggregator, inputs, palette)\n            c.connect();\n            setClient(c);\n            setError(undefined);\n            return () => c.unmount();\n        }\n    }, [apiKey, aggregator, inputs?.map(ip => ip.id).join(\",\")])\n    // subscribe to client changes\n    useEffect(() => client?.subscribe(CONNECTION_STATE,\n        (v: string) => setConnectionState(v))\n        , [client])\n    // subscribe to client changes\n    useEffect(() => client?.subscribe(SAMPLING_STATE,\n        (v: string) => setSamplingState(v))\n        , [client])\n    // listen to errors\n    useEffect(() => client?.subscribe(ERROR, (e: string) => setError(e))\n        , [client])\n    // progress\n    useEffect(() => client?.subscribe(PROGRESS, (p: number) => setSamplingProgress(p * 100))\n        , [client])\n\n    // name checking\n    useEffectAsync(async () => {\n        if (!apiKey || projectId === undefined) {\n            setDeviceInfo(undefined)\n        } else {\n            const resp = await EdgeImpulseClient.deviceInfo(apiKey, projectId, deviceId);\n            const info = resp.success && resp.device;\n            if (info && info.name !== deviceName) {\n                // no name assigned, use current\n                if (info.name === deviceId) {\n                    console.log(`ei: sync name`)\n                    const rename = await EdgeImpulseClient.renameDevice(apiKey, projectId, deviceId, deviceName)\n                    if (rename.success) {\n                        info.name = deviceName;\n                    }\n                } else {\n                    // name assigned in EI, pull it in\n                    console.log(`ei: pull name`)\n                    device.name = info.name;\n                }\n            }\n            setDeviceInfo(info)\n        }\n    }, [apiKey, projectId, deviceName])\n\n    return <Box>\n        {connected && <Alert severity={\"success\"}>Connected to EdgeImpulse</Alert>}\n        {error && <Alert severity={\"error\"}>{error}</Alert>}\n        {sampling && <Alert severity={\"info\"}>\n            <AlertTitle>Sampling...</AlertTitle>\n            <CircularProgressWithLabel value={samplingProgress} />\n        </Alert>}\n        {!!dataSet && <Trend dataSet={dataSet} />}\n        {generatedSampleName && <Typography variant=\"body2\">sample name: {generatedSampleName}</Typography>}\n        {aggregatorConfig && <pre>{JSON.stringify(aggregatorConfig, null, 2)}</pre>}\n    </Box>\n}\n\nexport default function EdgeImpulse() {\n    const { value: apiKey } = useDbValue(EDGE_IMPULSE_API_KEY, \"\")\n    const { bus } = useContext<JacdacContextProps>(JacdacContext);\n    const [model, setModel] = useState<Uint8Array>(undefined)\n    const [registerIdsChecked, setRegisterIdsChecked] = useState<string[]>([])\n    const [aggregatorId, setAggregatorId] = useState<string>(\"\")\n    const gridBreakPoints = useGridBreakpoints()\n    const info = useEdgeImpulseProjectInfo(apiKey);\n\n    const aggregators: JDService[] = useChange(bus, bus => bus.services({ serviceClass: SRV_SENSOR_AGGREGATOR }))\n    const currentAggregator: JDService = aggregators.find(srv => srv.id == aggregatorId) || aggregators[0]\n    const readingRegisters = useChange(bus, bus =>\n        bus.devices().map(device => device\n            .services().find(srv => isSensor(srv.specification))\n            ?.readingRegister\n        ).filter(reg => !!reg))\n    const inputs = readingRegisters.filter(reg => registerIdsChecked.indexOf(reg.id) > -1)\n\n    const handleAggregatorChecked = (srv: JDService) => () => {\n        const id = srv?.id == aggregatorId ? '' : srv?.id\n        setAggregatorId(id);\n    }\n    const handleRegisterCheck = (reg: JDRegister) => {\n        const i = registerIdsChecked.indexOf(reg.id)\n        if (i > -1)\n            registerIdsChecked.splice(i, 1)\n        else\n            registerIdsChecked.push(reg.id)\n        registerIdsChecked.sort()\n        setRegisterIdsChecked([...registerIdsChecked])\n    }\n\n    return <>\n        <h1>Edge Impulse</h1>\n        <p>\n            Use Jacdac to inject data and download models into <Link href=\"https://studio.edgeimpulse.com\">https://studio.edgeimpulse.com</Link>.\n        </p>\n        <ConnectAlert />\n        <ApiKeyManager />\n        <Box mb={1} />\n        <ProjectInfo info={info} />\n        <h3>Data</h3>\n        <h4>Select Sensors</h4>\n        {!readingRegisters?.length && <Alert severity=\"info\">No sensor found...</Alert>}\n        {!!readingRegisters.length && <ReadingFieldGrid\n            readingRegisters={readingRegisters}\n            registerIdsChecked={registerIdsChecked}\n            handleRegisterCheck={handleRegisterCheck}\n        />}\n        <h4>Select Sensor Aggregator</h4>\n        {!aggregators?.length && <Alert severity=\"info\">No data aggregator found...</Alert>}\n        <Grid container spacing={2}>\n            {aggregators.map(aggregator => <Grid key={aggregator.id} item {...gridBreakPoints}>\n                <AggregatorCard\n                    aggregator={aggregator}\n                    selected={currentAggregator === aggregator}\n                    onChecked={handleAggregatorChecked(aggregator)} />\n            </Grid>)}\n        </Grid>\n        <h4>Acquisition status</h4>\n        {!currentAggregator && <Alert severity=\"info\">No data aggregator selected...</Alert>}\n        {!inputs?.length && <Alert severity=\"info\">Select sensors to collect data from...</Alert>}\n        {currentAggregator && !!inputs?.length && <Acquisition aggregator={currentAggregator} inputs={inputs} apiKey={apiKey} info={info?.project} />}\n        <h3>Deployment</h3>\n        {model && <Box mb={1}><Alert severity=\"success\">Model downloaded!</Alert></Box>}\n        <ModelDownloadButton apiKey={apiKey} info={info} setModel={setModel} />\n        <ServiceList\n            serviceClass={SRV_MODEL_RUNNER}\n            content={service => <ModelContent service={service} />}\n            actions={service => <ModelActions\n                service={service}\n                model={model}\n            />}\n            alertMissing={\"No model runner found...\"}\n        />\n    </>\n}"],"sourceRoot":""}