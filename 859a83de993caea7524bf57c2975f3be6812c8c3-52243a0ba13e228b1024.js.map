{"version":3,"sources":["webpack:///./node_modules/@material-ui/core/esm/ListItemIcon/ListItemIcon.js","webpack:///./src/components/ui/CardMediaWithSkeleton.tsx","webpack:///./src/components/DeviceCardMedia.tsx","webpack:///./src/components/DeviceCardHeader.tsx","webpack:///./node_modules/@material-ui/core/esm/ListItemSecondaryAction/ListItemSecondaryAction.js","webpack:///./jacdac-ts/src/test/testrunner.ts","webpack:///./src/components/test/ServiceTestRunner.tsx","webpack:///./node_modules/@material-ui/core/esm/CardMedia/CardMedia.js","webpack:///./node_modules/@material-ui/core/esm/ListItemText/ListItemText.js","webpack:///./src/components/useGridBreakpoints.ts","webpack:///./node_modules/@material-ui/icons/PlayCircleFilled.js","webpack:///./jacdac-ts/jacdac-spec/spectool/jdtestfuns.ts","webpack:///./node_modules/@material-ui/core/esm/ListSubheader/ListSubheader.js","webpack:///./node_modules/@material-ui/core/esm/CardActions/CardActions.js","webpack:///./jacdac-ts/src/test/testspec.ts","webpack:///./node_modules/@material-ui/icons/HourglassEmpty.js","webpack:///./src/components/useServiceClient.ts"],"names":["useStyles","makeStyles","theme","createStyles","media","height","paddingTop","CardMediaWithSkeleton","props","image","src","className","others","classes","hasImage","DeviceCardMedia","device","specification","useDeviceSpecification","imageUrl","useDeviceImage","name","DeviceFirmwareVersionChip","firmwareVersionRegister","service","register","ControlReg","FirmwareVersion","firmwareVersion","useRegisterStringValue","DeviceTemperatureChip","tempRegister","McuTemperature","temperature","useRegisterIntValue","undefined","DeviceCardHeader","showFirmware","showTemperature","showMedia","showDeviceId","showAvatar","identifierToUrlPath","id","deviceId","filter","s","join","JDTestCommandStatus","JDTestStatus","commandStatusToTestStatus","status","Active","Passed","Failed","NotReady","RequiresUserInput","cmdToTestFunction","cmd","call","callee","testCommandFunctions","find","t","unparse","e","type","ae","elements","map","caller","arguments","be","left","operator","right","ue","argument","raw","JDExprEvaluator","env","start","exprStack","tos","length","eval","visitExpression","pop","push","r","v","le","lit","value","JDCommandEvaluator","testRunner","command","_prompt","_progress","_status","_startExpressions","_rangeComplete","_eventsComplete","_eventsQueue","testFun","args","startExprs","getExpressionsOfType","ce","eventList","serviceTestRunner","environment","forEach","child","findIndex","exprEval","createPrompt","replaceId","a","i","replaceVal","aStart","toString","prompt","slice","p","replace","setEvent","ev","evaluate","expr","reg","regSaved","regValue","amt","amtSaved","beginSaved","end","endSaved","shift","jdreg","registers","sendSetIntAsync","JDTestCommandRunner","_output","message","progress","_timeOut","_timeLeft","_commmandEvaluator","reset","output","envChange","finish","newOutput","eventChange","event","cancel","finishCommand","emit","CHANGE","JDEventSource","JDTestRunner","testSpec","commands","testCommands","c","_commandIndex","commandIndex","refreshEnvironment","next","newStatus","currentCommand","description","index","refresh_env","k","refresh","unpackedValue","intValue","JDServiceTestRunner","_testIndex","_registers","_environment","events","tests","serviceSpec","serviceSpecificationFromClassIdentifier","serviceClass","eventName","pkt","packets","isEvent","identifier","mount","subscribe","EVENT","currentTest","regName","isRegister","stats","total","success","failed","indeterminate","test","testIndex","ct","indexOf","JDServiceClient","TestStatusIcon","useChange","TestListItem","onSelectTest","selected","handleSelectTest","TestList","CommandStatusIcon","CommandListItem","handleAnswer","ActiveTest","handleRestart","handleNext","useEffect","ServiceTestRunner","serviceTest","serviceTestFromServiceClass","factory","useCallback","useServiceClient","useGridBreakpoints","itemCount","useContext","AppContext","drawerType","xs","sm","md","lg","xl","DrawerType","None","testExpressionFunctions","_serviceTests","serviceTestData","serviceClassIdentifier","deps","useState","client","setClient","unmount"],"mappings":";;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA0D;AACgC;AAC3D;AACP;AACsB;AACA;AACvC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gCAAgC,gDAAgB;AAChD;AACA;AACA,cAAc,0GAAwB;;AAEtC,gBAAgB,gDAAgB,CAAC,iEAAW;AAC5C,sBAAsB,mDAAmB,QAAQ,0FAAQ;AACzD,eAAe,4DAAI;AACnB;AACA,GAAG;AACH,CAAC;AACD,MAAqC,GAAG,SAAM;AAC/B,mIAAU;AACzB;AACA,CAAC,eAAe,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxChB;AACA;AAEA,IAAMA,SAAS,GAAGC,qCAAU,CAAC,UAACC,KAAD;AAAA,SAAkBC,uCAAY,CAAC;AACxDC,SAAK,EAAE;AACHC,YAAM,EAAE,CADL;AAEHC,gBAAU,EAAE,KAFT,CAEgB;;AAFhB;AADiD,GAAD,CAA9B;AAAA,CAAD,CAA5B;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEe,SAASC,qBAAT,CAA+BC,KAA/B,EAAsD;AAAA,MACzDC,KADyD,GACpBD,KADoB,CACzDC,KADyD;AAAA,MAClDC,GADkD,GACpBF,KADoB,CAClDE,GADkD;AAAA,MAC7CC,SAD6C,GACpBH,KADoB,CAC7CG,SAD6C;AAAA,MAC/BC,MAD+B,2DACpBJ,KADoB;;AAEjE,MAAMK,OAAO,GAAGb,SAAS,EAAzB;AACA,MAAMc,QAAQ,GAAG,CAAC,CAACL,KAAF,IAAW,CAAC,CAACC,GAA9B;AACA,SAAOI,QAAQ,gBACX,8BAAC,4BAAD;AAAW,aAAS,EAAEH,SAAS,IAAIE,OAAO,CAACT;AAA3C,KAAsDQ,MAAtD;AAA8D,SAAK,EAAEH,KAArE;AAA4E,OAAG,EAAEC;AAAjF,KADW,gBAET,6DAFN;AAGH,C;;AC7BD;AAEA;AACA;AACA;AAEe,SAASK,eAAT,CAAyBP,KAAzB,EAAsD;AAAA,MACzDQ,MADyD,GAC9CR,KAD8C,CACzDQ,MADyD;AAEjE,MAAMC,aAAa,GAAGC,iDAAsB,CAACF,MAAD,CAA5C;AACA,MAAMG,QAAQ,GAAGC,yCAAc,CAACH,aAAD,CAA/B;AAEA,sBAAO,8BAAC,qBAAD;AACH,SAAK,EAAEE,QADJ;AAEH,SAAK,EAAEF,aAAF,aAAEA,aAAF,uBAAEA,aAAa,CAAEI;AAFnB,IAAP;AAIH,C;;;;;;;;ACfD;CAEA;;AACA;AAEA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASC,yBAAT,CAAmCd,KAAnC,EAAgE;AAAA;;AAAA,MACpDQ,MADoD,GACzCR,KADyC,CACpDQ,MADoD;AAE5D,MAAMO,uBAAuB,GAAGP,MAAH,aAAGA,MAAH,0CAAGA,MAAM,CAChCQ,OAD0B,CAClB,CADkB,CAAH,oDAAG,gBAE1BC,QAF0B,CAEjBC,+BAAU,CAACC,eAFM,CAAhC;AAGA,MAAMC,eAAe,GAAGC,0DAAsB,CAACN,uBAAD,CAA9C;AAEA,SACKK,eAAe,iBAAI,8BAAC,uBAAD;AAAM,QAAI,EAAC,OAAX;AAAmB,SAAK,EAAEA;AAA1B,IAApB,iBACI,6DAFR;AAKH;;AAED,SAASE,qBAAT,CAA+BtB,KAA/B,EAA4D;AAAA;;AAAA,MAChDQ,MADgD,GACrCR,KADqC,CAChDQ,MADgD;AAExD,MAAMe,YAAY,GAAGf,MAAH,aAAGA,MAAH,2CAAGA,MAAM,CAAEQ,OAAR,CAAgB,CAAhB,CAAH,qDAAG,iBAAoBC,QAApB,CAA6BC,+BAAU,CAACM,cAAxC,CAArB;AACA,MAAMC,WAAW,GAAGC,uDAAmB,CAACH,YAAD,CAAvC;AACA,SACKE,WAAW,KAAKE,SAAhB,iBACG,8BAAC,uBAAD;AAAM,QAAI,EAAC,OAAX;AAAmB,SAAK,EAAKF,WAAL;AAAxB,IADJ,iBAEM,6DAHV;AAKH;;AAEc,SAASG,gBAAT,CAA0B5B,KAA1B,EAOZ;AAAA,MAEKQ,MAFL,GAQKR,KARL,CAEKQ,MAFL;AAAA,MAGKqB,YAHL,GAQK7B,KARL,CAGK6B,YAHL;AAAA,MAIKC,eAJL,GAQK9B,KARL,CAIK8B,eAJL;AAAA,MAKKC,SALL,GAQK/B,KARL,CAKK+B,SALL;AAAA,MAMKC,YANL,GAQKhC,KARL,CAMKgC,YANL;AAAA,MAOKC,UAPL,GAQKjC,KARL,CAOKiC,UAPL;AASC,MAAMxB,aAAa,GAAGC,iDAAsB,CAACF,MAAD,CAA5C;AAEA,sBACI,8DACKuB,SAAS,iBAAI,8BAAC,eAAD;AAAiB,UAAM,EAAEvB;AAAzB,IADlB,eAEI,8BAAC,6BAAD;AACI,UAAM,EAAEyB,UAAU,iBAAI,8BAAC,+BAAD;AAAc,YAAM,EAAEzB;AAAtB,MAD1B;AAEI,UAAM,eAAE,8BAAC,gCAAD;AAAe,YAAM,EAAEA,MAAvB;AAA+B,eAAS,EAAE;AAA1C,MAFZ;AAGI,SAAK,eACD,8BAAC,gCAAD;AACI,WAAK,EAAC,aADV;AAEI,QAAE,iBACE0B,2CAAmB,CAACzB,aAAD,aAACA,aAAD,uBAACA,aAAa,CAAE0B,EAAhB,CAAnB,IAA0C,EAD5C;AAFN,oBAMI,8BAAC,6BAAD;AAAY,YAAM,EAAE3B;AAApB,MANJ,CAJR;AAaI,aAAS,eACL,2EACI,8BAAC,6BAAD;AAAY,aAAO,EAAC,SAApB;AAA8B,kBAAY;AAA1C,OACK,CACGC,aADH,aACGA,aADH,uBACGA,aAAa,CAAEI,IADlB,EAEGmB,YAAY,IAAIxB,MAAM,CAAC4B,QAF1B,EAIIC,MAJJ,CAIW,UAAAC,CAAC;AAAA,aAAI,CAAC,CAACA,CAAN;AAAA,KAJZ,EAKIC,IALJ,CAKS,IALT,CADL,CADJ,EASKV,YAAY,iBACT,8BAAC,yBAAD;AAA2B,YAAM,EAAErB;AAAnC,MAVR,EAYKsB,eAAe,iBACZ,8BAAC,qBAAD;AAAuB,YAAM,EAAEtB;AAA/B,MAbR;AAdR,IAFJ,CADJ;AAqCH,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjGyD;AACgC;AAC3D;AACP;AACsB;AACvC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAI,+CAAuB,gBAAgB,mBAAgB;AAC3D;AACA;AACA,cAAc,kDAAwB;;AAEtC,sBAAsB,sBAAmB,QAAQ,sCAAQ;AACzD,eAAe,iCAAI;AACnB;AACA,GAAG;AACH,CAAC;AACD,MAAqC,GAAG,SAAM;AAC9C,+CAAuB;AACR,6HAAU;AACzB;AACA,CAAC,EAAE,+CAAuB,CAAC,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChC3B;AAIA;AAEA;AACA;AAIA;AACA;AAEO,IAAKgC,mBAAZ;;WAAYA,mB;AAAAA,qB,CAAAA,mB;AAAAA,qB,CAAAA,mB;AAAAA,qB,CAAAA,mB;AAAAA,qB,CAAAA,mB;AAAAA,qB,CAAAA,mB;GAAAA,mB,KAAAA,mB;;AAQL,IAAKC,YAAZ;;WAAYA,Y;AAAAA,c,CAAAA,Y;AAAAA,c,CAAAA,Y;AAAAA,c,CAAAA,Y;AAAAA,c,CAAAA,Y;GAAAA,Y,KAAAA,Y;;AAOZ,SAASC,yBAAT,CAAmCC,MAAnC,EAAgE;AAC5D,UAAQA,MAAR;AACI,SAAKH,mBAAmB,CAACI,MAAzB;AACI,aAAOH,YAAY,CAACG,MAApB;;AACJ,SAAKJ,mBAAmB,CAACK,MAAzB;AACI,aAAOJ,YAAY,CAACI,MAApB;;AACJ,SAAKL,mBAAmB,CAACM,MAAzB;AACI,aAAOL,YAAY,CAACK,MAApB;;AACJ,SAAKN,mBAAmB,CAACO,QAAzB;AACI,aAAON,YAAY,CAACM,QAApB;;AACJ,SAAKP,mBAAmB,CAACQ,iBAAzB;AACI,aAAOP,YAAY,CAACG,MAApB;AAVR;AAYH;;AAED,SAASK,iBAAT,CAA2BC,GAA3B,EAAwD;AACpD,MAAMf,EAAE,GAAqBe,GAAG,CAACC,IAAJ,CAASC,MAA3B,CAAmCvC,IAA9C;AACA,SAAOwC,0CAAoB,CAACC,IAArB,CAA0B,UAAAC,CAAC;AAAA,WAAIA,CAAC,CAACpB,EAAF,IAAQA,EAAZ;AAAA,GAA3B,CAAP;AACH;;AAED,SAASqB,OAAT,CAAiBC,CAAjB,EAA6C;AACzC,UAAQA,CAAC,CAACC,IAAV;AACI,SAAK,iBAAL;AAAwB;AACpB,YAAMC,EAAE,GAAGF,CAAX;AACA,qBAAWE,EAAE,CAACC,QAAH,CACNC,GADM,CACFL,OADE,EAENjB,IAFM,CAED,IAFC,CAAX;AAGH;;AACD,SAAK,gBAAL;AAAuB;AACnB,YAAMuB,MAAM,GAAGL,CAAf;AACA,eAAUD,OAAO,CAACM,MAAM,CAACV,MAAR,CAAjB,SAAoCU,MAAM,CAACC,SAAP,CAC/BF,GAD+B,CAC3BL,OAD2B,EAE/BjB,IAF+B,CAE1B,IAF0B,CAApC;AAGH;;AACD,SAAK,kBAAL;AACA,SAAK,mBAAL;AAA0B;AACtB,YAAMyB,EAAE,GAAGP,CAAX;AACA,qBAAWD,OAAO,CAACQ,EAAE,CAACC,IAAJ,CAAlB,SAA+BD,EAAE,CAACE,QAAlC,SAA8CV,OAAO,CAACQ,EAAE,CAACG,KAAJ,CAArD;AACH;;AACD,SAAK,iBAAL;AAAwB;AACpB,YAAMC,EAAE,GAAGX,CAAX;AACA,oBAAUW,EAAE,CAACF,QAAb,GAAwBV,OAAO,CAACY,EAAE,CAACC,QAAJ,CAA/B;AACH;;AACD,SAAK,YAAL;AAAmB;AACf,eAAQZ,CAAD,CAAuB5C,IAA9B;AACH;;AACD,SAAK,SAAL;AAAgB;AACZ,eAAQ4C,CAAD,CAAoBa,GAA3B;AACH;;AACD;AACI,aAAO,MAAP;AA7BR;AA+BH;;IAKKC,e;AAGF,2BAAoBC,GAApB,EAA4CC,KAA5C,EAA6D;AAAA,SAFrDC,SAEqD,GAFlC,EAEkC;AAAA,SAAzCF,GAAyC,GAAzCA,GAAyC;AAAA,SAAjBC,KAAiB,GAAjBA,KAAiB;AAAE;;;;SAEvDE,G,GAAR,eAAc;AACV,WAAO,KAAKD,SAAL,CAAe,KAAKA,SAAL,CAAeE,MAAf,GAAwB,CAAvC,CAAP;AACH,G;;SAEMC,I,GAAP,eAAYpB,CAAZ,EAAgC;AAC5B,SAAKiB,SAAL,GAAiB,EAAjB;AACA,SAAKI,eAAL,CAAqBrB,CAArB;AACA,WAAO,KAAKiB,SAAL,CAAeK,GAAf,EAAP;AACH,G;;SAEOD,e,GAAR,yBAAwBrB,CAAxB,EAA4C;AACxC,YAAQA,CAAC,CAACC,IAAV;AACI,WAAK,iBAAL;AAAwB;AACpB;AACA;AACH;;AAED,WAAK,gBAAL;AAAuB;AACnB,cAAMI,MAAM,GAAwBL,CAApC;AACA,cAAML,MAAM,GAAoBU,MAAM,CAACV,MAAvC;;AACA,kBAAQA,MAAM,CAACvC,IAAf;AACI,iBAAK,OAAL;AACI,mBAAK6D,SAAL,CAAeM,IAAf,CACI,KAAKP,KAAL,CAAWnB,IAAX,CAAgB,UAAA2B,CAAC;AAAA,uBAAIA,CAAC,CAACxB,CAAF,KAAQK,MAAZ;AAAA,eAAjB,EAAqCoB,CADzC;AAGA;;AACJ,oBANJ,CAMa;;AANb;;AAQA;AACH;;AAED,WAAK,kBAAL;AAAyB;AACrB,cAAMlB,EAAE,GAA0BP,CAAlC;AACA,eAAKqB,eAAL,CAAqBd,EAAE,CAACC,IAAxB;AACA,eAAKa,eAAL,CAAqBd,EAAE,CAACG,KAAxB;AACA,cAAMA,KAAK,GAAG,KAAKO,SAAL,CAAeK,GAAf,EAAd;AACA,cAAMd,IAAI,GAAG,KAAKS,SAAL,CAAeK,GAAf,EAAb;;AACA,kBAAQf,EAAE,CAACE,QAAX;AACI,iBAAK,GAAL;AACI,mBAAKQ,SAAL,CAAeM,IAAf,CAAoBf,IAAI,GAAGE,KAA3B;AACA;;AACJ,iBAAK,GAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,GAAGE,KAA3B;AACA;;AACJ,iBAAK,GAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,GAAGE,KAA3B;AACA;;AACJ,iBAAK,GAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,GAAGE,KAA3B;AACA;;AACJ,iBAAK,GAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,GAAGE,KAA3B;AACA;;AACJ,iBAAK,IAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,IAAIE,KAA5B;AACA;;AACJ,iBAAK,KAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,KAAKE,KAA7B;AACA;;AACJ,iBAAK,IAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,IAAIE,KAA5B;AACA;;AACJ,iBAAK,GAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,GAAGE,KAA3B;AACA;;AACJ,iBAAK,GAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,GAAGE,KAA3B;AACA;;AACJ,iBAAK,GAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,GAAGE,KAA3B;AACA;;AACJ,iBAAK,IAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,IAAIE,KAA5B;AACA;;AACJ,iBAAK,IAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,IAAIE,KAA5B;AACA;;AACJ,iBAAK,KAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,KAAKE,KAA7B;AACA;;AACJ,iBAAK,KAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,KAAKE,KAA7B;AACA;;AAEJ,iBAAK,GAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,GAAGE,KAA3B;AACA;;AACJ,iBAAK,GAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,GAAGE,KAA3B;AACA;;AACJ,iBAAK,IAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,IAAIE,KAA5B;AACA;;AACJ,iBAAK,IAAL;AACI,mBAAKO,SAAL,CAAeM,IAAf,CAAoBf,IAAI,IAAIE,KAA5B;AACA;AA1DR;;AA4DA;AACH;;AAED,WAAK,iBAAL;AACA,WAAK,mBAAL;AAA0B;AACtB,cAAMgB,EAAE,GAA2B1B,CAAnC;AACA,eAAKqB,eAAL,CAAqBK,EAAE,CAAClB,IAAxB;;AACA,kBAAQkB,EAAE,CAACjB,QAAX;AACI,iBAAK,IAAL;AACI,kBAAI,KAAKS,GAAL,EAAJ,EAAgB,OAAhB,KACK,KAAKG,eAAL,CAAqBK,EAAE,CAAChB,KAAxB;AACL;;AACJ,iBAAK,IAAL;AACI,kBAAI,CAAC,KAAKQ,GAAL,EAAL,EAAiB,OAAjB,KACK,KAAKG,eAAL,CAAqBK,EAAE,CAAChB,KAAxB;AACL;;AACJ;AATJ;;AAWA;AACH;;AAED,WAAK,YAAL;AAAmB;AACf,cAAMhC,EAAE,GAAoBsB,CAA5B;AACA,eAAKiB,SAAL,CAAeM,IAAf,CAAoB,KAAKR,GAAL,CAASrC,EAAE,CAACtB,IAAZ,CAApB;AACA;AACH;;AACD,WAAK,SAAL;AAAgB;AACZ,cAAMuE,GAAG,GAAiB3B,CAA1B;AACA,eAAKiB,SAAL,CAAeM,IAAf,CAAoBI,GAAG,CAACC,KAAxB;AACA;AACH;;AACD;AArHJ;AAuHH,G;;;;;IAGCC,6B;AASF,8BACqBC,UADrB,EAEqBC,OAFrB,EAGE;AAAA,SAXMC,OAWN,GAXgB,EAWhB;AAAA,SAVMC,SAUN,GAVkB,EAUlB;AAAA,SATMC,OASN,GATgBnD,mBAAmB,CAACI,MASpC;AAAA,SARMgD,iBAQN,GARoC,EAQpC;AAAA,SAPMC,cAON,GAP+BlE,SAO/B;AAAA,SANMmE,eAMN,GANkCnE,SAMlC;AAAA,SALMoE,YAKN,GAL+BpE,SAK/B;AAAA,SAFmB4D,UAEnB,GAFmBA,UAEnB;AAAA,SADmBC,OACnB,GADmBA,OACnB;AAED;;;;UAYMf,K,GAAP,iBAAe;AAAA;;AACX,SAAKmB,iBAAL,GAAyB,EAAzB;AACA,QAAMI,OAAO,GAAG/C,iBAAiB,CAAC,KAAKuC,OAAN,CAAjC;AACA,QAAMS,IAAI,GAAG,KAAKT,OAAL,CAAarC,IAAb,CAAkBY,SAA/B;AACA,QAAImC,UAA6B,GAAG,EAApC;;AACA,YAAQF,OAAO,CAAC7D,EAAhB;AACI,WAAK,OAAL;AAAc;AACV+D,oBAAU,GAA2BC,+CAAoB,CAACF,IAAD,EAAM,gBAAN,CAA5C,CACR5D,MADQ,CACD,UAAA+D,EAAE;AAAA,mBAAsBA,EAAE,CAAChD,MAArB,CAA6BvC,IAA7B,KAAsC,OAA1C;AAAA,WADD,EAERgD,GAFQ,CAEJ,UAAAuC,EAAE;AAAA,mBAAIA,EAAE,CAACrC,SAAH,CAAa,CAAb,CAAJ;AAAA,WAFE,CAAb;AAGA;AACH;;AACD,WAAK,SAAL;AACA,WAAK,WAAL;AACA,WAAK,WAAL;AAAkB;AACdmC,oBAAU,CAAClB,IAAX,CAAgBiB,IAAI,CAAC,CAAD,CAApB;AACA;AACH;;AACD,WAAK,aAAL;AACA,WAAK,aAAL;AACA,WAAK,WAAL;AACA,WAAK,aAAL;AAAoB;AAChBC,oBAAU,CAAClB,IAAX,CAAgBiB,IAAI,CAAC,CAAD,CAApB;AACAC,oBAAU,CAAClB,IAAX,CAAgBiB,IAAI,CAAC,CAAD,CAApB;AACA;AACH;;AACD,WAAK,QAAL;AAAe;AACXC,oBAAU,CAAClB,IAAX,CAAgBiB,IAAI,CAAC,CAAD,CAApB;AACA;AACH;;AACD,WAAK,QAAL;AAAe;AACX,cAAMI,SAAS,GAAG,KAAKb,OAAL,CAAarC,IAAb,CAAkBY,SAAlB,CAA4B,CAA5B,CAAlB;AACA,eAAK+B,eAAL,GAAwBO,SAAS,CAACzC,QAAX,CAA0CC,GAA1C,CAA8C,UAAA1B,EAAE;AAAA,mBAAIA,EAAE,CAACtB,IAAP;AAAA,WAAhD,CAAvB;AACA,eAAKkF,YAAL,GAAoB,EAApB;AACA;AACH;AA9BL,KALW,CAqCX;;;AACA,QAAMvB,GAAG,GAAG,KAAKe,UAAL,CAAgBe,iBAAhB,CAAkCC,WAA9C;AACAL,cAAU,CAACM,OAAX,CAAmB,UAAAC,KAAK,EAAI;AACxB,UAAI,KAAI,CAACb,iBAAL,CAAuBc,SAAvB,CAAiC,UAAAzB,CAAC;AAAA,eAAIA,CAAC,CAACxB,CAAF,KAAQgD,KAAZ;AAAA,OAAlC,IAAuD,CAA3D,EAA8D;AAC1D,YAAME,QAAQ,GAAG,IAAIpC,eAAJ,CAAoBC,GAApB,EAAyB,EAAzB,CAAjB;;AACA,aAAI,CAACoB,iBAAL,CAAuBZ,IAAvB,CAA4B;AACxBvB,WAAC,EAAEgD,KADqB;AAExBvB,WAAC,EAAEyB,QAAQ,CAAC9B,IAAT,CAAc4B,KAAd;AAFqB,SAA5B;AAIH;AACJ,KARD;AASA,SAAKG,YAAL;AACH,G;;UAEOA,Y,GAAR,wBAAuB;AAAA;;AACnB,QAAMZ,OAAO,GAAG/C,iBAAiB,CAAC,KAAKuC,OAAN,CAAjC;AACA,QAAMqB,SAAS,GAAG,KAAKrB,OAAL,CAAarC,IAAb,CAAkBY,SAAlB,CAA4BF,GAA5B,CAAgC,UAACiD,CAAD,EAAIC,CAAJ,EAAU;AACxD,aAAO,QAAKA,CAAC,GAAG,CAAT,SAAevD,OAAO,CAACsD,CAAD,CAAtB,CAAP;AACH,KAFiB,CAAlB;AAGA,QAAME,UAAU,GAAG,KAAKxB,OAAL,CAAarC,IAAb,CAAkBY,SAAlB,CAA4BF,GAA5B,CAAgC,UAACiD,CAAD,EAAIC,CAAJ,EAAU;AACzD,UAAME,MAAM,GAAG,MAAI,CAACrB,iBAAL,CAAuBtC,IAAvB,CAA4B,UAAA2B,CAAC;AAAA,eAAIA,CAAC,CAACxB,CAAF,KAAQqD,CAAZ;AAAA,OAA7B,CAAf;;AACA,aAAO,QAAKC,CAAC,GAAG,CAAT,aAAmBE,MAAM,IAAIA,MAAM,CAAC/B,CAAjB,GAAqB+B,MAAM,CAAC/B,CAAP,CAASgC,QAAT,EAArB,GAA2C,IAA9D,CAAP;AACH,KAHkB,CAAnB;AAIA,SAAKzB,OAAL,GACIO,OAAO,CAAC7D,EAAR,KAAe,KAAf,IAAwB6D,OAAO,CAAC7D,EAAR,KAAe,KAAvC,GACM,KAAKqD,OAAL,CAAa2B,MAAb,CAAoBC,KAApB,CAA0B,CAA1B,CADN,GAEMpB,OAAO,CAACmB,MAAR,CAAeC,KAAf,CAAqB,CAArB,CAHV;AAIAP,aAAS,CAACL,OAAV,CAAkB,UAAAa,CAAC;AAAA,aAAK,MAAI,CAAC5B,OAAL,GAAe,MAAI,CAACA,OAAL,CAAa6B,OAAb,CAAqBD,CAAC,CAAC,CAAD,CAAtB,EAA2BA,CAAC,CAAC,CAAD,CAA5B,CAApB;AAAA,KAAnB;AACAL,cAAU,CAACR,OAAX,CAAmB,UAAAa,CAAC;AAAA,aAAK,MAAI,CAAC5B,OAAL,GAAe,MAAI,CAACA,OAAL,CAAa6B,OAAb,CAAqBD,CAAC,CAAC,CAAD,CAAtB,EAA2BA,CAAC,CAAC,CAAD,CAA5B,CAApB;AAAA,KAApB;AACH,G;;UAEME,Q,GAAP,kBAAgBC,EAAhB,EAA4B;AACxB,SAAKzB,YAAL,CAAkBf,IAAlB,CAAuBwC,EAAvB;AACH,G;;UAEMC,Q,GAAP,oBAAkB;AACd,QAAMjD,GAAG,GAAG,KAAKe,UAAL,CAAgBe,iBAAhB,CAAkCC,WAA9C;AACA,QAAMP,OAAO,GAAG/C,iBAAiB,CAAC,KAAKuC,OAAN,CAAjC;AACA,SAAKG,OAAL,GAAenD,mBAAmB,CAACI,MAAnC;AACA,SAAK8C,SAAL,GAAiB,EAAjB;;AACA,YAAQM,OAAO,CAAC7D,EAAhB;AACI,WAAK,KAAL;AAAY;AACR,eAAKwD,OAAL,GAAenD,mBAAmB,CAACQ,iBAAnC;AACA;AACH;;AACD,WAAK,OAAL;AAAc;AACV,cAAM0E,IAAI,GAAG,IAAInD,eAAJ,CACTC,GADS,EAET,KAAKoB,iBAFI,CAAb;AAIA,cAAM4B,EAAE,GAAGE,IAAI,CAAC7C,IAAL,CAAU,KAAKW,OAAL,CAAarC,IAAb,CAAkBY,SAAlB,CAA4B,CAA5B,CAAV,CAAX;AACA,eAAK4B,OAAL,GAAe6B,EAAE,GACXhF,mBAAmB,CAACK,MADT,GAEXL,mBAAmB,CAACI,MAF1B;AAGA;AACH;;AACD,WAAK,SAAL;AACA,WAAK,WAAL;AACA,WAAK,WAAL;AAAkB;AACd,cAAM+E,GAAG,GAAG,KAAKnC,OAAL,CAAarC,IAAb,CAAkBY,SAAlB,CAA4B,CAA5B,CAAZ;;AACA,cAAM6D,QAAQ,GAAG,KAAKhC,iBAAL,CAAuBtC,IAAvB,CAA4B,UAAA2B,CAAC;AAAA,mBAAIA,CAAC,CAACxB,CAAF,KAAQkE,GAAZ;AAAA,WAA7B,CAAjB;;AACA,cAAME,QAAQ,GAAGrD,GAAG,CAAChB,OAAO,CAACmE,GAAD,CAAR,CAApB;AACA,cAAMhF,MAAM,GACPqD,OAAO,CAAC7D,EAAR,KAAe,SAAf,IAA4B0F,QAAQ,KAAKD,QAAQ,CAAC1C,CAAnD,IACCc,OAAO,CAAC7D,EAAR,KAAe,WAAf,IAA8B0F,QAAQ,GAAGD,QAAQ,CAAC1C,CADnD,IAECc,OAAO,CAAC7D,EAAR,KAAe,WAAf,IAA8B0F,QAAQ,GAAGD,QAAQ,CAAC1C,CAFnD,GAGM1C,mBAAmB,CAACK,MAH1B,GAIML,mBAAmB,CAACI,MAL9B;AAMA,eAAK+C,OAAL,GAAehD,MAAf;AACAiF,kBAAQ,CAAC1C,CAAT,GAAa2C,QAAb;AACA;AACH;;AACD,WAAK,aAAL;AACA,WAAK,aAAL;AAAoB;AAChB,cAAMF,IAAG,GAAG,KAAKnC,OAAL,CAAarC,IAAb,CAAkBY,SAAlB,CAA4B,CAA5B,CAAZ;;AACA,cAAM6D,SAAQ,GAAG,KAAKhC,iBAAL,CAAuBtC,IAAvB,CAA4B,UAAA2B,CAAC;AAAA,mBAAIA,CAAC,CAACxB,CAAF,KAAQkE,IAAZ;AAAA,WAA7B,CAAjB;;AACA,cAAMG,GAAG,GAAG,KAAKtC,OAAL,CAAarC,IAAb,CAAkBY,SAAlB,CAA4B,CAA5B,CAAZ;;AACA,cAAMgE,QAAQ,GAAG,KAAKnC,iBAAL,CAAuBtC,IAAvB,CAA4B,UAAA2B,CAAC;AAAA,mBAAIA,CAAC,CAACxB,CAAF,KAAQqE,GAAZ;AAAA,WAA7B,CAAjB;;AACA,cAAMD,SAAQ,GAAGrD,GAAG,CAAChB,OAAO,CAACmE,IAAD,CAAR,CAApB;;AACA,cAAI3B,OAAO,CAAC7D,EAAR,KAAe,aAAnB,EAAkC;AAC9B,gBAAI0F,SAAQ,IAAID,SAAQ,CAAC1C,CAAT,GAAa6C,QAAQ,CAAC7C,CAAtC,EAAyC;AACrC,mBAAKS,OAAL,GAAenD,mBAAmB,CAACK,MAAnC;AACH,aAFD,MAEO,IACHgF,SAAQ,IAAID,SAAQ,CAAC1C,CAArB,IACA2C,SAAQ,GAAGD,SAAQ,CAAC1C,CAAT,GAAa6C,QAAQ,CAAC7C,CAF9B,EAGL;AACE,mBAAKS,OAAL,GAAenD,mBAAmB,CAACI,MAAnC;AACA,mBAAK8C,SAAL,iBAA6BmC,SAA7B,iBAAgDD,SAAQ,CAAC1C,CAAT,GAAa6C,QAAQ,CAAC7C,CAAtE;AACH,aANM,MAMA;AACH,mBAAKS,OAAL,GAAenD,mBAAmB,CAACI,MAAnC;AACH;AACJ,WAZD,MAYO;AACH,gBAAIiF,SAAQ,IAAID,SAAQ,CAAC1C,CAAT,GAAa6C,QAAQ,CAAC7C,CAAtC,EAAyC;AACrC,mBAAKS,OAAL,GAAenD,mBAAmB,CAACK,MAAnC;AACA,mBAAK6C,SAAL,GAAiB,WAAjB;AACH,aAHD,MAGO,IACHmC,SAAQ,IAAID,SAAQ,CAAC1C,CAArB,IACA2C,SAAQ,GAAGD,SAAQ,CAAC1C,CAAT,GAAa6C,QAAQ,CAAC7C,CAF9B,EAGL;AACE,mBAAKS,OAAL,GAAenD,mBAAmB,CAACI,MAAnC;AACA,mBAAK8C,SAAL,iBAA6BmC,SAA7B,gBAA+CD,SAAQ,CAAC1C,CAAT,GAAa6C,QAAQ,CAAC7C,CAArE;AACH,aANM,MAMA;AACH,mBAAKS,OAAL,GAAenD,mBAAmB,CAACI,MAAnC;AACH;AACJ;;AACD;AACH;;AACD,WAAK,WAAL;AACA,WAAK,aAAL;AAAoB;AAChB,eAAK+C,OAAL,GAAenD,mBAAmB,CAACI,MAAnC;AACA,cAAM+E,KAAG,GAAG,KAAKnC,OAAL,CAAarC,IAAb,CAAkBY,SAAlB,CAA4B,CAA5B,CAAZ;AACA,cAAM8D,UAAQ,GAAGrD,GAAG,CAAChB,OAAO,CAACmE,KAAD,CAAR,CAApB;;AACA,cAAMK,UAAU,GAAG,KAAKpC,iBAAL,CAAuBtC,IAAvB,CAA4B,UAAA2B,CAAC;AAAA,mBAAIA,CAAC,CAACxB,CAAF,KAAQkE,KAAZ;AAAA,WAA7B,CAAnB;;AACA,cAAMM,GAAG,GAAG,KAAKzC,OAAL,CAAarC,IAAb,CAAkBY,SAAlB,CAA4B,CAA5B,CAAZ;;AACA,cAAMmE,QAAQ,GAAG,KAAKtC,iBAAL,CAAuBtC,IAAvB,CAA4B,UAAA2B,CAAC;AAAA,mBAAIA,CAAC,CAACxB,CAAF,KAAQwE,GAAZ;AAAA,WAA7B,CAAjB;;AACA,cAAI,KAAKpC,cAAL,KAAwBlE,SAA5B,EAAuC;AACnC,iBAAKkE,cAAL,GAAsBgC,UAAtB;AACH,WAFD,MAEO;AACH,gBAAIA,UAAQ,KAAK,KAAKhC,cAAL,IAAuBG,OAAO,CAAC7D,EAAR,IAAc,WAAd,GAA4B,CAA5B,GAAgC,CAAC,CAAxD,CAAjB,EACI,KAAK0D,cAAL,GAAsBgC,UAAtB;;AACJ,gBAAI,KAAKhC,cAAL,KAAwBqC,QAAQ,CAAChD,CAArC,EAAwC;AACpC,mBAAKS,OAAL,GAAgBnD,mBAAmB,CAACK,MAApC;AACH;AACJ;;AACD,cAAI,KAAKgD,cAAL,IAAuBlE,SAA3B,EAAsC;AAClC,iBAAK+D,SAAL,GACIM,OAAO,CAAC7D,EAAR,IAAc,WAAd,aACe6F,UAAU,CAAC9C,CAD1B,eACsC,KAAKW,cAD3C,aAEemC,UAAU,CAAC9C,CAF1B,iBAEwC,KAAKW,cAHjD;AAIH;;AACD;AACH;;AACD,WAAK,QAAL;AAAe;AAAA;;AACX,cAAI,4BAAKE,YAAL,0EAAmBnB,MAAnB,IAA4B,CAA5B,IAAiC,+BAAKkB,eAAL,gFAAsBlB,MAAtB,IAA+B,CAApE,EAAuE;AACnE,gBAAM4C,GAAE,GAAG,KAAKzB,YAAL,CAAkBhB,GAAlB,EAAX;;AACA,gBAAIyC,GAAE,KAAK,KAAK1B,eAAL,CAAqB,CAArB,CAAX,EAAoC;AAChC,mBAAKA,eAAL,CAAqBqC,KAArB;;AACA,kBAAI,KAAKrC,eAAL,CAAqBlB,MAArB,KAAgC,CAApC,EACI,KAAKe,OAAL,GAAenD,mBAAmB,CAACK,MAAnC;AACP,aAJD,MAIO;AACH,mBAAK8C,OAAL,GAAenD,mBAAmB,CAACM,MAAnC;AACH;;AACD,iBAAK4C,SAAL,kBAA8B8B,GAA9B,uBAAkD,KAAK1B,eAAvD;AACH,WAVD,MAUO;AACH,iBAAKJ,SAAL,yCAAqD,KAAKI,eAA1D;AACH;;AACD;AACH;;AACD,WAAK,QAAL;AAAe;AACX,cAAM6B,KAAG,GAAG,KAAKnC,OAAL,CAAarC,IAAb,CAAkBY,SAAlB,CAA4B,CAA5B,CAAZ;AACA,cAAMqE,KAAK,GAAG,KAAK7C,UAAL,CAAgBe,iBAAhB,CAAkC+B,SAAlC,CAA4CV,KAAG,CAAC9G,IAAhD,CAAd;;AACA,cAAM6G,KAAI,GAAG,IAAInD,eAAJ,CACTC,GADS,EAET,KAAKoB,iBAFI,CAAb;;AAIA,cAAM4B,IAAE,GAAGE,KAAI,CAAC7C,IAAL,CAAU,KAAKW,OAAL,CAAarC,IAAb,CAAkBY,SAAlB,CAA4B,CAA5B,CAAV,CAAX,CAPW,CAQX;;;AACAqE,eAAK,CAACE,eAAN,CAAsBd,IAAtB;AACA,eAAK7B,OAAL,GAAenD,mBAAmB,CAACK,MAAnC;AACH;AAvHL;AAyHH,G;;;;SAhND,eAAoB;AAChB,aAAO,KAAK4C,OAAZ;AACH;;;SACD,eAAoB;AAChB,aAAO,KAAKE,OAAZ;AACH;;;SACD,eAAsB;AAClB,aAAO,KAAKD,SAAZ;AACH;;;;;;AAgNE,IAAM6C,8BAAb;AAAA;;AAGqC;AAIjC,+BACqBhD,UADrB,EAEqBC,OAFrB,EAGE;AAAA;;AACE;AADF,WATMG,OASN,GATgBnD,mBAAmB,CAACO,QASpC;AAAA,WARMyF,OAQN,GARiC;AAAEC,aAAO,EAAE,EAAX;AAAeC,cAAQ,EAAE;AAAzB,KAQjC;AAAA,WAPeC,QAOf,GAP0B,IAO1B;AAAA,WANMC,SAMN,GANkB,IAMlB;AAAA,WALMC,kBAKN,GAL+C,IAK/C;AAAA,WAFmBtD,UAEnB,GAFmBA,UAEnB;AAAA,WADmBC,OACnB,GADmBA,OACnB;AAAA;AAED;;AAZL;;AAAA,UA+CIsD,KA/CJ,GA+CI,iBAAQ;AACJ,SAAKC,MAAL,GAAc;AAAEN,aAAO,EAAE,EAAX;AAAeC,cAAQ,EAAE;AAAzB,KAAd;AACA,SAAK/F,MAAL,GAAcH,mBAAmB,CAACO,QAAlC;AACA,SAAK8F,kBAAL,GAA0B,IAA1B;AACH,GAnDL;;AAAA,UAqDIpE,KArDJ,GAqDI,iBAAQ;AACJ,SAAK9B,MAAL,GAAcH,mBAAmB,CAACI,MAAlC;AACA,SAAKiG,kBAAL,GAA0B,IAAIvD,6BAAJ,CAAuB,KAAKC,UAA5B,EAAwC,KAAKC,OAA7C,CAA1B;;AACA,SAAKqD,kBAAL,CAAwBpE,KAAxB;;AACA,SAAKuE,SAAL,CAAe,KAAf;AACA,SAAKA,SAAL,CAAe,IAAf;AACH,GA3DL;;AAAA,UA6DIA,SA7DJ,GA6DI,mBAAUC,MAAV,EAAyB;AAAA,QAAfA,MAAe;AAAfA,YAAe,GAAN,IAAM;AAAA;;AACrB,QAAI,KAAKJ,kBAAT,EAA6B;AACzB,WAAKA,kBAAL,CAAwBpB,QAAxB;;AACA,UAAMyB,SAA0B,GAAG;AAC/BT,eAAO,EAAE,KAAKI,kBAAL,CAAwB1B,MADF;AAE/BuB,gBAAQ,EAAE,KAAKG,kBAAL,CAAwBH;AAFH,OAAnC;AAIA,WAAKK,MAAL,GAAcG,SAAd;AACA,UAAI,KAAKL,kBAAL,CAAwBlG,MAAxB,KAAmCH,mBAAmB,CAACQ,iBAA3D,EACI,KAAKL,MAAL,GAAaH,mBAAmB,CAACQ,iBAAjC,CADJ,KAEK,IAAIiG,MAAJ,EACD,KAAKA,MAAL,CAAY,KAAKJ,kBAAL,CAAwBlG,MAApC;AACP;AACJ,GA1EL;;AAAA,UA4EIwG,WA5EJ,GA4EI,qBAAYC,KAAZ,EAA2B;AACvB,SAAKP,kBAAL,CAAwBtB,QAAxB,CAAiC6B,KAAjC;;AACA,SAAKJ,SAAL;AACH,GA/EL;;AAAA,UAiFIK,MAjFJ,GAiFI,kBAAS;AACL,SAAKJ,MAAL,CAAYzG,mBAAmB,CAACM,MAAhC;AACH,GAnFL;;AAAA,UAqFImG,MArFJ,GAqFI,gBAAO3G,CAAP,EAA+B;AAC3B,QACI,CAACA,CAAC,KAAKE,mBAAmB,CAACM,MAA1B,IAAoCR,CAAC,KAAKE,mBAAmB,CAACK,MAA/D,MACC,KAAKF,MAAL,KAAgBH,mBAAmB,CAACI,MAApC,IACG,KAAKD,MAAL,KAAgBH,mBAAmB,CAACQ,iBAFxC,CADJ,EAIE;AACE,WAAKL,MAAL,GAAcL,CAAd;AACA,WAAKiD,UAAL,CAAgB+D,aAAhB;AACH;AACJ,GA9FL;;AAAA;AAAA;AAAA,SAcI,eAAa;AACT,aAAO,KAAK3D,OAAZ;AACH,KAhBL;AAAA,SAkBI,aAAWrD,CAAX,EAAmC;AAC/B,UAAIA,CAAC,IAAI,KAAKqD,OAAd,EAAuB;AACnB,aAAKA,OAAL,GAAerD,CAAf;AACA,aAAKiH,IAAL,CAAUC,2BAAV;AACH;AACJ;AAvBL;AAAA;AAAA,SAyBI,eAA6B;AACzB,aACI,KAAK7G,MAAL,KAAgBH,mBAAmB,CAACM,MAApC,IACA,KAAKH,MAAL,KAAgBH,mBAAmB,CAACK,MAFxC;AAIH;AA9BL;AAAA;AAAA,SAgCI,eAAa;AACT,aAAO,KAAK2F,OAAZ;AACH,KAlCL;AAAA,SAoCI,aAAWnD,KAAX,EAAmC;AAC/B,UACI,CAAC,KAAKmD,OAAN,IACA,KAAKA,OAAL,CAAaC,OAAb,KAAyBpD,KAAK,CAACoD,OAD/B,IAEA,KAAKD,OAAL,CAAaE,QAAb,KAA0BrD,KAAK,CAACqD,QAHpC,EAIE;AACE,aAAKF,OAAL,GAAenD,KAAf;AACA,aAAKkE,IAAL,CAAUC,2BAAV;AACH;AACJ;AA7CL;;AAAA;AAAA,EAAyCC,oCAAzC;AAiGO,IAAMC,uBAAb;AAAA;;AAKI,wBACoBpD,iBADpB,EAEqBqD,QAFrB,EAGE;AAAA;;AACE;AADF,WAPMhE,OAON,GAPgBlD,YAAY,CAACM,QAO7B;AAAA,WAFkBuD,iBAElB,GAFkBA,iBAElB;AAAA,WADmBqD,QACnB,GADmBA,QACnB;AAEE,WAAKC,QAAL,GAAgBD,QAAQ,CAACE,YAAT,CAAsBhG,GAAtB,CACZ,UAAAiG,CAAC;AAAA,aAAI,IAAIvB,8BAAJ,2DAA8BuB,CAA9B,CAAJ;AAAA,KADW,CAAhB;AAFF;AAKD;;AAbL;;AAAA,UAeIhB,KAfJ,GAeI,iBAAQ;AACJ,QAAI,KAAKnG,MAAL,KAAgBF,YAAY,CAACM,QAAjC,EAA2C;AACvC,WAAK4C,OAAL,GAAelD,YAAY,CAACM,QAA5B;AACA,WAAKgH,aAAL,GAAqBpI,SAArB;AACA,WAAKiI,QAAL,CAAcpD,OAAd,CAAsB,UAAAjD,CAAC;AAAA,eAAIA,CAAC,CAACuF,KAAF,EAAJ;AAAA,OAAvB;AACA,WAAKS,IAAL,CAAUC,2BAAV;AACH;AACJ,GAtBL;;AAAA,UAwBI/E,KAxBJ,GAwBI,iBAAQ;AACJ,SAAKqE,KAAL;AACA,SAAKnG,MAAL,GAAcF,YAAY,CAACG,MAA3B;AACA,SAAKoH,YAAL,GAAoB,CAApB;AACA,SAAK1D,iBAAL,CAAuB2D,kBAAvB;AACH,GA7BL;;AAAA,UA+BIC,IA/BJ,GA+BI,gBAAO;AACH,SAAK5D,iBAAL,CAAuB4D,IAAvB;AACH,GAjCL;;AAAA,UAmCIb,MAnCJ,GAmCI,kBAAS;AACL,SAAKJ,MAAL,CAAYxG,YAAY,CAACK,MAAzB;AACH,GArCL;;AAAA,UAiEImG,MAjEJ,GAiEI,gBAAOkB,SAAP,EAAgC;AAC5B,QAAI,KAAKxH,MAAL,KAAgBF,YAAY,CAACG,MAAjC,EAAyC;AACrC,WAAKD,MAAL,GAAcwH,SAAd;AACH;AACJ,GArEL;;AAAA,UAmFWnB,SAnFX,GAmFI,qBAAmB;AAAA;;AACf,iCAAKoB,cAAL,8EAAqBpB,SAArB;AACH,GArFL;;AAAA,UAuFWG,WAvFX,GAuFI,qBAAmBC,KAAnB,EAAkC;AAAA;;AAC9B,kCAAKgB,cAAL,gFAAqBjB,WAArB,CAAiCC,KAAjC;AACH,GAzFL;;AAAA,UA2FWE,aA3FX,GA2FI,yBAAuB;AACnB,QAAI,KAAKU,YAAL,KAAsB,KAAKJ,QAAL,CAAchF,MAAd,GAAuB,CAAjD,EACI,KAAKqE,MAAL,CAAYvG,yBAAyB,CAAC,KAAK0H,cAAL,CAAoBzH,MAArB,CAArC,EADJ,CAEA;AAFA,SAGK,KAAKqH,YAAL;AACR,GAhGL;;AAAA;AAAA;AAAA,SAuCI,eAAa;AACT,aAAO,KAAKrE,OAAZ;AACH,KAzCL;AAAA,SA2CI,aAAWrD,CAAX,EAA4B;AACxB,UAAIA,CAAC,IAAI,KAAKqD,OAAd,EAAuB;AACnB,aAAKA,OAAL,GAAerD,CAAf;AACA,aAAKiH,IAAL,CAAUC,2BAAV;AACH;AACJ;AAhDL;AAAA;AAAA,SAkDI,eAA6B;AACzB,aACI,KAAK7G,MAAL,KAAgBF,YAAY,CAACK,MAA7B,IACA,KAAKH,MAAL,KAAgBF,YAAY,CAACI,MAFjC;AAIH;AAvDL;AAAA;AAAA,SAyDI,eAAkB;AACd,aAAO,KAAK8G,QAAL,CAAcU,WAArB;AACH;AA3DL;AAAA;AAAA,SA6DI,eAAa;AACT,aAAO,KAAKV,QAAL,CAAcxC,MAArB;AACH;AA/DL;AAAA;AAAA,SAuEI,eAA2B;AACvB,aAAO,KAAK4C,aAAZ;AACH,KAzEL;AAAA,SA2EI,aAAyBO,KAAzB,EAAwC;AACpC,UAAI,KAAKP,aAAL,KAAuBO,KAA3B,EAAkC;AAAA;;AAC9B,aAAKP,aAAL,GAAqBO,KAArB;AACA,sCAAKF,cAAL,gFAAqB3F,KAArB;AACA,aAAK8E,IAAL,CAAUC,2BAAV;AACH;AACJ;AAjFL;AAAA;AAAA,SAkGI,eAAqB;AACjB,aAAO,KAAKI,QAAL,CAAc,KAAKG,aAAnB,CAAP;AACH;AApGL;;AAAA;AAAA,EAAkCN,oCAAlC;;SAuGec,W;;;;;sGAAf,iBAA2BlC,SAA3B,EAAwD9B,WAAxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qDAEmBA,WAFnB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEciE,aAFd;AAGcvJ,oBAHd,GAGyBoH,SAAS,CAACmC,CAAD,CAHlC;AAAA;AAAA,mBAIcvJ,QAAQ,CAACwJ,OAAT,EAJd;;AAAA;AAKQlE,uBAAW,CAACiE,CAAD,CAAX,GAAiBvJ,QAAQ,CAACyJ,aAAT,GAAyBzJ,QAAQ,CAACyJ,aAAT,CAAuB,CAAvB,CAAzB,GAAqDzJ,QAAQ,CAAC0J,QAA/E;AALR;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AASO,IAAMC,8BAAb;AAAA;;AAOI,+BACoBjB,QADpB,EAEI3I,OAFJ,EAGE;AAAA;;AACE,yCAAMA,OAAN;AADF,WATM6J,UASN,GATmB,CAAC,CASpB;AAAA,WARMC,UAQN,GARqC,EAQrC;AAAA,WAPMC,YAON,GAPgC,EAOhC;AAAA,WANMC,MAMN,GAN8B,EAM9B;AAAA,WAFkBrB,QAElB,GAFkBA,QAElB;AAEE,WAAKsB,KAAL,GAAa,OAAKtB,QAAL,CAAcsB,KAAd,CAAoBpH,GAApB,CACT,UAAAN,CAAC;AAAA,aAAI,IAAImG,uBAAJ,2DAAuBnG,CAAvB,CAAJ;AAAA,KADQ,CAAb;AAGA,QAAM2H,WAAW,GAAGC,+DAAuC,CACvDnK,OAAO,CAACoK,YAD+C,CAA3D;;AAGA,WAAKzB,QAAL,CAAcsB,KAAd,CAAoBzE,OAApB,CAA4B,UAAAjD,CAAC,EAAI;AAC7BA,OAAC,CAACyH,MAAF,CAASxE,OAAT,CAAiB,UAAA6E,SAAS,EAAI;AAC1B,YAAI,CAAC,OAAKL,MAAL,CAAYK,SAAZ,CAAL,EAA6B;AACzB,cAAMC,GAAG,GAAGJ,WAAW,CAACK,OAAZ,CAAoBjI,IAApB,CACR,UAAAgI,GAAG;AAAA,mBAAIE,+BAAO,CAACF,GAAD,CAAP,IAAgBA,GAAG,CAACzK,IAAJ,KAAawK,SAAjC;AAAA,WADK,CAAZ;AAGA,cAAMjC,KAAK,GAAGpI,OAAO,CAACoI,KAAR,CAAckC,GAAG,CAACG,UAAlB,CAAd;AACA,iBAAKT,MAAL,CAAYK,SAAZ,IAAyBjC,KAAzB;;AACA,iBAAKsC,KAAL,CACItC,KAAK,CAACuC,SAAN,CAAgBC,2BAAhB,EAAuB,YAAM;AAAA;;AACzB,yCAAKC,WAAL,0EAAkB1C,WAAlB,CAA8BkC,SAA9B;AACH,WAFD,CADJ;AAKH;AACJ,OAbD;AAcA9H,OAAC,CAAC8E,SAAF,CAAY7B,OAAZ,CAAoB,UAAAsF,OAAO,EAAI;AAC3B,YAAI,CAAC,OAAKhB,UAAL,CAAgBgB,OAAhB,CAAL,EAA+B;AAC3B,cAAMR,GAAG,GAAGJ,WAAW,CAACK,OAAZ,CAAoBjI,IAApB,CACR,UAAAgI,GAAG;AAAA,mBAAIS,kCAAU,CAACT,GAAD,CAAV,IAAmBA,GAAG,CAACzK,IAAJ,KAAaiL,OAApC;AAAA,WADK,CAAZ;AAGA,cAAM7K,QAAQ,GAAGD,OAAO,CAACC,QAAR,CAAiBqK,GAAG,CAACG,UAArB,CAAjB;AACA,iBAAKX,UAAL,CAAgBgB,OAAhB,IAA2B7K,QAA3B;AACA,iBAAK8J,YAAL,CAAkBe,OAAlB,IAA6B7K,QAAQ,CAACyJ,aAAT,GAAyBzJ,QAAQ,CAACyJ,aAAT,CAAuB,CAAvB,CAAzB,GAAqDzJ,QAAQ,CAAC0J,QAA3F;;AACA,iBAAKe,KAAL,CACIzK,QAAQ,CAAC0K,SAAT,CAAmBnC,2BAAnB,EAA2B,YAAM;AAAA;;AAC7B,mBAAKuB,YAAL,CAAkBe,OAAlB,IAA6B7K,QAAQ,CAACyJ,aAAT,GAAyBzJ,QAAQ,CAACyJ,aAAT,CAAuB,CAAvB,CAAzB,GAAqDzJ,QAAQ,CAAC0J,QAA3F;AACA,0CAAKkB,WAAL,4EAAkB7C,SAAlB;AACH,WAHD,CADJ;AAMH;AACJ,OAfD;AAgBH,KA/BD;;AAgCA,WAAKvE,KAAL;;AAxCF;AAyCD;;AAnDL;;AAAA,UAqDWwF,kBArDX,GAqDI,8BAA4B;AACxBM,eAAW,CAAC,KAAKlC,SAAN,EAAiB,KAAK9B,WAAtB,CAAX;AACH,GAvDL;;AAAA,UAqFWyF,KArFX,GAqFI,iBAAe;AACX,QAAM/G,CAAC,GAAG;AACNgH,WAAK,EAAE,KAAKhB,KAAL,CAAWrG,MADZ;AAENsH,aAAO,EAAE,CAFH;AAGNC,YAAM,EAAE,CAHF;AAINC,mBAAa,EAAE;AAJT,KAAV;;AAMA,yDAAmB,KAAKnB,KAAxB,wCAA+B;AAAA,UAApBoB,IAAoB;;AAC3B,cAAQA,IAAI,CAAC1J,MAAb;AACI,aAAKF,YAAY,CAACK,MAAlB;AACImC,WAAC,CAACkH,MAAF;AACA;;AACJ,aAAK1J,YAAY,CAACI,MAAlB;AACIoC,WAAC,CAACiH,OAAF;AACA;;AACJ;AACIjH,WAAC,CAACmH,aAAF;AARR;AAUH;;AACD,WAAOnH,CAAP;AACH,GAzGL;;AAAA,UA2GWR,KA3GX,GA2GI,iBAAe;AACX,SAAKwG,KAAL,CAAWzE,OAAX,CAAmB,UAAAjD,CAAC;AAAA,aAAIA,CAAC,CAACuF,KAAF,EAAJ;AAAA,KAApB;AACA,SAAKwD,SAAL,GAAiB,CAAjB;AACH,GA9GL;;AAAA,UAgHWpC,IAhHX,GAgHI,gBAAc;AACV,SAAKoC,SAAL;AACH,GAlHL;;AAAA;AAAA;AAAA,SAyDI,eAAyB;AACrB,aAAO,KAAKvB,YAAZ;AACH;AA3DL;AAAA;AAAA,SA6DI,eAAuB;AACnB,aAAO,KAAKD,UAAZ;AACH;AA/DL;AAAA;AAAA,SAiEI,eAAwB;AACpB,aAAO,KAAKD,UAAZ;AACH,KAnEL;AAAA,SAqEI,aAAsBP,KAAtB,EAAqC;AACjC,UAAI,KAAKO,UAAL,KAAoBP,KAAxB,EAA+B;AAC3B;AACA,YAAMiC,EAAE,GAAG,KAAKV,WAAhB;;AACA,YAAIU,EAAJ,EAAQ;AACJ,cAAIA,EAAE,CAAC5J,MAAH,KAAcF,YAAY,CAACG,MAA/B,EAAuC;AACnC2J,cAAE,CAAClD,MAAH;AACH;AACJ,SAP0B,CAS3B;;;AACA,aAAKwB,UAAL,GAAkBP,KAAlB;AACA,aAAKf,IAAL,CAAUC,2BAAV;AACH;AACJ;AAnFL;AAAA;AAAA,SAoHI,eAAkB;AACd,aAAO,KAAKyB,KAAL,CAAW,KAAKJ,UAAhB,CAAP;AACH,KAtHL;AAAA,SAwHI,aAAgBwB,IAAhB,EAAoC;AAChC,UAAM/B,KAAK,GAAG,KAAKW,KAAL,CAAWuB,OAAX,CAAmBH,IAAnB,CAAd;AACA,UAAI/B,KAAK,GAAG,CAAC,CAAb,EAAgB,KAAKgC,SAAL,GAAiBhC,KAAjB;AACnB;AA3HL;;AAAA;AAAA,EAAyCmC,wCAAzC,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzpBA;AACA;CAgBA;;AACA;AAEA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASC,cAAT,CAAwB1M,KAAxB,EAAuD;AAAA,MAC3CqM,IAD2C,GAClCrM,KADkC,CAC3CqM,IAD2C;AAEnD,MAAM1J,MAAM,GAAGgK,oCAAS,CAACN,IAAD,EAAO,UAAA9I,CAAC;AAAA,WAAIA,CAAC,CAACZ,MAAN;AAAA,GAAR,CAAxB;;AAEA,UAAQA,MAAR;AACI,SAAKF,YAAY,CAACG,MAAlB;AACI,0BAAO,8BAAC,0BAAD;AAAsB,aAAK,EAAC;AAA5B,QAAP;;AACJ,SAAKH,YAAY,CAACK,MAAlB;AACI,0BAAO,8BAAC,eAAD;AAAW,aAAK,EAAC;AAAjB,QAAP;;AACJ,SAAKL,YAAY,CAACI,MAAlB;AACI,0BAAO,8BAAC,qBAAD;AAAiB,aAAK,EAAC;AAAvB,QAAP;;AACJ;AACI,0BAAO,8BAAC,wBAAD;AAAoB,aAAK,EAAC;AAA1B,QAAP;AARR;AAUH;;AAED,SAAS+J,YAAT,CAAsB5M,KAAtB,EAIG;AAAA,MACSqM,IADT,GAC6CrM,KAD7C,CACSqM,IADT;AAAA,MACeR,WADf,GAC6C7L,KAD7C,CACe6L,WADf;AAAA,MAC4BgB,YAD5B,GAC6C7M,KAD7C,CAC4B6M,YAD5B;AAEC,MAAMxC,WAAW,GAAGsC,oCAAS,CAACN,IAAD,EAAO,UAAA9I,CAAC;AAAA,WAAIA,CAAC,CAAC8G,WAAN;AAAA,GAAR,CAA7B;AACA,MAAMyC,QAAQ,GAAGT,IAAI,KAAKR,WAA1B;;AACA,MAAMkB,gBAAgB,GAAG,SAAnBA,gBAAmB;AAAA,WAAMF,YAAY,CAACR,IAAD,CAAlB;AAAA,GAAzB;;AAEA,sBACI,8BAAC,2BAAD;AAAU,YAAQ,EAAES,QAApB;AAA8B,UAAM,MAApC;AAAqC,WAAO,EAAEC;AAA9C,kBACI,8BAAC,+BAAD,qBACI,8BAAC,cAAD;AAAgB,QAAI,EAAEV;AAAtB,IADJ,CADJ,eAII,8BAAC,+BAAD;AAAc,WAAO,EAAEhC;AAAvB,IAJJ,CADJ;AAQH;;AAED,SAAS2C,QAAT,CAAkBhN,KAAlB,EAIG;AAAA,MACSuF,UADT,GACmDvF,KADnD,CACSuF,UADT;AAAA,MACqBsG,WADrB,GACmD7L,KADnD,CACqB6L,WADrB;AAAA,MACkCgB,YADlC,GACmD7M,KADnD,CACkC6M,YADlC;AAAA,MAES5B,KAFT,GAEmB1F,UAFnB,CAES0F,KAFT;AAGC,MAAMe,KAAK,GAAGW,oCAAS,CAACpH,UAAD,EAAa,UAAAN,CAAC;AAAA,WAAIA,CAAC,CAAC+G,KAAF,EAAJ;AAAA,GAAd,CAAvB;AAEA,sBACI,8BAAC,uBAAD,qBACI,8BAAC,8BAAD,qBACI,8BAAC,uBAAD;AACI,SAAK,EAAE,IADX;AAEI,aAAS,eACL,8BAAC,gCAAD,QACQA,KAAK,CAACC,KADd,gBAC8BD,KAAK,CAACE,OADpC,kBACwDF,KAAK,CAACG,MAD9D;AAHR,KAQKlB,KARL,aAQKA,KARL,uBAQKA,KAAK,CAAEpH,GAAP,CAAW,UAACwI,IAAD,EAAOtF,CAAP;AAAA,wBACR,8BAAC,YAAD;AACI,SAAG,EAAEA,CADT;AAEI,UAAI,EAAEsF,IAFV;AAGI,iBAAW,EAAER,WAHjB;AAII,kBAAY,EAAEgB;AAJlB,MADQ;AAAA,GAAX,CARL,CADJ,CADJ,CADJ;AAuBH;;AAED,SAASI,iBAAT,CAA2BjN,KAA3B,EAAoE;AAAA,MACxDwF,OADwD,GAC5CxF,KAD4C,CACxDwF,OADwD;AAEhE,MAAM7C,MAAM,GAAGgK,oCAAS,CAACnH,OAAD,EAAU,UAAAsE,CAAC;AAAA,WAAIA,CAAC,CAACnH,MAAN;AAAA,GAAX,CAAxB;;AAEA,UAAQA,MAAR;AACI,SAAKH,mBAAmB,CAACI,MAAzB;AACA,SAAKJ,mBAAmB,CAACQ,iBAAzB;AACI,0BAAO,8BAAC,0BAAD;AAAsB,aAAK,EAAC;AAA5B,QAAP;;AACJ,SAAKR,mBAAmB,CAACM,MAAzB;AACI,0BAAO,8BAAC,eAAD;AAAW,aAAK,EAAC;AAAjB,QAAP;;AACJ,SAAKN,mBAAmB,CAACK,MAAzB;AACI,0BAAO,8BAAC,qBAAD;AAAiB,aAAK,EAAC;AAAvB,QAAP;;AACJ;AACI,0BAAO,8BAAC,wBAAD;AAAoB,aAAK,EAAC;AAA1B,QAAP;AATR;AAWH;;AAED,SAASqK,eAAT,CAAyBlN,KAAzB,EAAkE;AAAA,MACtDwF,OADsD,GAC1CxF,KAD0C,CACtDwF,OADsD;;AAAA,mBAEhCmH,oCAAS,CAACnH,OAAD,EAAU,UAAAsE,CAAC;AAAA,WAAIA,CAAC,CAACf,MAAN;AAAA,GAAX,CAFuB;AAAA,MAEtDN,OAFsD,cAEtDA,OAFsD;AAAA,MAE7CC,QAF6C,cAE7CA,QAF6C;;AAG9D,MAAM/F,MAAM,GAAGgK,oCAAS,CAACnH,OAAD,EAAU,UAAAsE,CAAC;AAAA,WAAIA,CAAC,CAACnH,MAAN;AAAA,GAAX,CAAxB;;AACA,MAAMwK,YAAY,GAAG,SAAfA,YAAe,CAACxK,MAAD;AAAA,WAAiC;AAAA,aAClD6C,OAAO,CAACyD,MAAR,CAAetG,MAAf,CADkD;AAAA,KAAjC;AAAA,GAArB;;AAEA,sBACI,8BAAC,2BAAD;AAAU,YAAQ,EAAEA,MAAM,KAAKH,mBAAmB,CAACI;AAAnD,kBACI,8BAAC,+BAAD,qBACI,8BAAC,iBAAD;AAAmB,WAAO,EAAE4C;AAA5B,IADJ,CADJ,eAII,8BAAC,+BAAD;AACI,WAAO,EAAEiD,OADb;AAEI,aAAS,EAAEC;AAFf,IAJJ,EAQK/F,MAAM,KAAKH,mBAAmB,CAACQ,iBAA/B,iBACG,8BAAC,mDAAD,qBACI,8BAAC,yBAAD;AACI,WAAO,EAAC,UADZ;AAEI,WAAO,EAAEmK,YAAY,CAAC3K,mBAAmB,CAACK,MAArB;AAFzB,WADJ,eAOI,8BAAC,yBAAD;AACI,WAAO,EAAC,UADZ;AAEI,WAAO,EAAEsK,YAAY,CAAC3K,mBAAmB,CAACM,MAArB;AAFzB,UAPJ,CATR,CADJ;AA2BH;;AAED,SAASsK,UAAT,CAAoBpN,KAApB,EAAmD;AAAA,MACvCqM,IADuC,GAC9BrM,KAD8B,CACvCqM,IADuC;AAAA,MAEvCzC,QAFuC,GAE1ByC,IAF0B,CAEvCzC,QAFuC;AAG/C,MAAMjH,MAAM,GAAGgK,oCAAS,CAACN,IAAD,EAAO,UAAA9I,CAAC;AAAA,WAAIA,CAAC,CAACZ,MAAN;AAAA,GAAR,CAAxB;;AACA,MAAM0K,aAAa,GAAG,SAAhBA,aAAgB;AAAA,WAAMhB,IAAI,CAAC5H,KAAL,EAAN;AAAA,GAAtB;;AACA,MAAM6I,UAAU,GAAG,SAAbA,UAAa;AAAA,WAAMjB,IAAI,CAACnC,IAAL,EAAN;AAAA,GAAnB,CAL+C,CAM/C;;;AACAqD,4BAAS,CAAC;AAAA,WAAMlB,IAAI,CAAC5H,KAAL,EAAN;AAAA,GAAD,EAAqB,CAAC4H,IAAD,CAArB,CAAT;AAEA,sBACI,8BAAC,uBAAD,qBACI,8BAAC,8BAAD,qBACI,8BAAC,6BAAD;AAAY,WAAO,EAAC;AAApB,UADJ,eAEI,8BAAC,sBAAD;AAAK,KAAC,EAAE;AAAR,kBACI,8BAAC,6BAAD;AAAY,WAAO,EAAC;AAApB,KAA6BA,IAAI,CAAClF,MAAlC,CADJ,CAFJ,eAKI,8BAAC,6BAAD;AAAY,WAAO,EAAC;AAApB,YALJ,eAMI,8BAAC,uBAAD;AAAM,SAAK,EAAE;AAAb,KACKyC,QAAQ,CAAC/F,GAAT,CAAa,UAACX,GAAD,EAAM6D,CAAN;AAAA,wBACV,8BAAC,eAAD;AAAiB,SAAG,EAAEA,CAAtB;AAAyB,aAAO,EAAE7D;AAAlC,MADU;AAAA,GAAb,CADL,CANJ,EAWKP,MAAM,KAAKF,YAAY,CAACI,MAAxB,iBACG,8BAAC,wBAAD;AAAO,YAAQ,EAAC;AAAhB,mBAZR,EAcKF,MAAM,KAAKF,YAAY,CAACK,MAAxB,iBACG,8BAAC,wBAAD;AAAO,YAAQ,EAAC;AAAhB,mBAfR,CADJ,eAmBI,8BAAC,8BAAD,qBACI,8BAAC,yBAAD;AACI,WAAO,EACHH,MAAM,KAAKF,YAAY,CAACG,MAAxB,GACM,UADN,GAEM,WAJd;AAMI,SAAK,EACDD,MAAM,KAAKF,YAAY,CAACI,MAAxB,GAAiC,SAAjC,GAA6ClB,SAPrD;AASI,WAAO,EAAE2L;AATb,YADJ,eAcI,8BAAC,yBAAD;AAAQ,WAAO,EAAC,UAAhB;AAA2B,WAAO,EAAED;AAApC,eAdJ,CAnBJ,CADJ;AAwCH;;AAEc,SAASG,iBAAT,CAA2BxN,KAA3B,EAGZ;AAAA,MAEKgB,OAFL,GAIKhB,KAJL,CAEKgB,OAFL;AAAA,2BAIKhB,KAJL,CAGKyN,WAHL;AAAA,MAGKA,WAHL,mCAGmBC,uDAA2B,CAAC1M,OAAO,CAACoK,YAAT,CAH9C;AAKC,MAAMuC,OAAO,GAAGC,4BAAW,CACvB,UAAA5M,OAAO;AAAA,WAAIyM,WAAW,IAAI,IAAI7C,8BAAJ,CAAwB6C,WAAxB,EAAqCzM,OAArC,CAAnB;AAAA,GADgB,EAEvB,CAACA,OAAD,EAAUyM,WAAV,CAFuB,CAA3B;AAIA,MAAMlI,UAAU,GAAGsI,2CAAgB,CAAC7M,OAAD,EAAU2M,OAAV,CAAnC;AACA,MAAM9B,WAAW,GAAGc,oCAAS,CAACpH,UAAD,EAAa,UAAAhC,CAAC;AAAA,WAAIA,CAAJ,aAAIA,CAAJ,uBAAIA,CAAC,CAAEsI,WAAP;AAAA,GAAd,CAA7B;;AACA,MAAMkB,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACV,IAAD,EAAwB;AAC7C9G,cAAU,CAACsG,WAAX,GAAyBQ,IAAzB;AACH,GAFD;;AAIA,MAAI,CAACoB,WAAL,EACI,oBACI,8BAAC,wBAAD;AAAO,YAAQ,EAAC;AAAhB,wDACoD,GADpD,EAEKzM,OAAO,CAACP,aAAR,CAAsBI,IAF3B,MADJ;AAOJ,MAAI,CAAC0E,UAAL,EAAiB,oBAAO,8BAAC,kCAAD,OAAP;AAEjB,sBACI,8BAAC,uBAAD;AAAM,aAAS,MAAf;AAAgB,WAAO,EAAE;AAAzB,kBACI,8BAAC,uBAAD;AAAM,QAAI,MAAV;AAAW,MAAE;AAAb,kBACI,8BAAC,QAAD;AACI,cAAU,EAAEA,UADhB;AAEI,eAAW,EAAEsG,WAFjB;AAGI,gBAAY,EAAEkB;AAHlB,IADJ,CADJ,EAQKlB,WAAW,iBACR,8BAAC,uBAAD;AAAM,QAAI,MAAV;AAAW,MAAE;AAAb,kBACI,8BAAC,UAAD;AAAY,QAAI,EAAEA;AAAlB,IADJ,CATR,EAaK7K,OAAO,iBACJ,8BAAC,uBAAD;AAAM,QAAI,MAAV;AAAW,MAAE;AAAb,kBACI,8BAAC,kCAAD;AACI,cAAU,EAAE,IADhB;AAEI,cAAU,EAAE,IAFhB;AAGI,UAAM,EAAEA,OAAO,CAACR;AAHpB,IADJ,CAdR,CADJ;AAyBH,C;;;;;;;;ACtQD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA0D;AACgC;AAC3D;AACP;AACsB;AACM;AAC7C;AACP;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,gDAAgB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,0GAAwB;;AAEtC;AACA,mDAAmD,0FAAQ;AAC3D;AACA,GAAG;AACH,sBAAsB,mDAAmB,YAAY,0FAAQ;AAC7D,eAAe,4DAAI;AACnB;AACA;AACA;AACA,GAAG;AACH,CAAC;AACD,MAAqC,GAAG,SAAM;AAC/B,mIAAU;AACzB;AACA,CAAC,YAAY,E;;;;;;;;ACpDb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA0D;AACgC;AAC3D;AACP;AACsB;AACP;AACO;AACvC;AACP;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,WAAW;;AAEX,mDAAmD,KAAK;AACxD;AACA;AACA,GAAG;;AAEH;AACA,aAAa;;AAEb;AACA;AACA;AACA,gCAAgC,gDAAgB;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,0GAAwB;;AAEtC,0BAA0B,gDAAgB,CAAC,iEAAW;AACtD;;AAEA;;AAEA,0CAA0C,2DAAU;AACpD,2BAA2B,mDAAmB,CAAC,2DAAU,EAAE,0FAAQ;AACnE;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;;AAEA,8CAA8C,2DAAU;AACxD,6BAA6B,mDAAmB,CAAC,2DAAU,EAAE,0FAAQ;AACrE;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA,sBAAsB,mDAAmB,QAAQ,0FAAQ;AACzD,eAAe,4DAAI;AACnB;AACA,GAAG;AACH,CAAC;AACD,MAAqC,GAAG,SAAM;AAC/B,mIAAU;AACzB;AACA,CAAC,eAAe,E;;;;;;;;AClFhB;AAAA;AAAA;AAAA;AAAA;AACA;AAUe,SAASsN,kBAAT,CAA4BC,SAA5B,EAAiE;AAAA,oBACrDC,wDAAU,CAACC,2DAAD,CAD2C;AAAA,MACpEC,UADoE,eACpEA,UADoE;;AAG5E,MAAIH,SAAS,KAAKpM,SAAlB,EAA6B;AACzB,YAAQoM,SAAR;AACI,WAAK,CAAL;AACA,WAAK,CAAL;AAAQ,eAAO;AAAEI,YAAE,EAAE,EAAN;AAAUC,YAAE,EAAE,CAAd;AAAiBC,YAAE,EAAE,CAArB;AAAwBC,YAAE,EAAE,CAA5B;AAA+BC,YAAE,EAAE;AAAnC,SAAP;;AACR,WAAK,CAAL;AAAQ,eAAO;AAAEJ,YAAE,EAAE,EAAN;AAAUC,YAAE,EAAE,CAAd;AAAiBC,YAAE,EAAE,CAArB;AAAwBC,YAAE,EAAE,CAA5B;AAA+BC,YAAE,EAAE;AAAnC,SAAP;AAHZ;AAKH;;AAED,MAAIL,UAAU,IAAIM,8DAAU,CAACC,IAA7B,EACI,OAAO;AAAEN,MAAE,EAAE,EAAN;AAAUE,MAAE,EAAE,CAAd;AAAiBD,MAAE,EAAE,CAArB;AAAwBE,MAAE,EAAE,CAA5B;AAA+BC,MAAE,EAAE;AAAnC,GAAP,CADJ,KAEK,OAAO;AACRJ,MAAE,EAAE,EADI;AAERC,MAAE,EAAE,CAFI;AAGRC,MAAE,EAAE,CAHI;AAIRC,MAAE,EAAE,CAJI;AAKRC,MAAE,EAAE;AALI,GAAP;AAOR,C;;;;;;;;AChCY;;AAEb,6BAA6B,mBAAO,CAAC,MAA8C;;AAEnF,8BAA8B,mBAAO,CAAC,MAA+C;;AAErF;AACA;AACA,CAAC;AACD;;AAEA,oCAAoC,mBAAO,CAAC,MAAO;;AAEnD,4CAA4C,mBAAO,CAAC,MAAuB;;AAE3E;AACA;AACA,CAAC;;AAED,2B;;;;;;;;ACnBA;AAAA;AAAA;AACA;AAeO,IAAMlL,oBAAsD,GAAG,CAClE;AAAElB,IAAE,EAAE,SAAN;AAAiB8D,MAAI,EAAE,CAAC,UAAD,CAAvB;AAAqCkB,QAAM;AAA3C,CADkE,EAElE;AAAEhF,IAAE,EAAE,KAAN;AAAa8D,MAAI,EAAE,EAAnB;AAAuBkB,QAAM,EAAExF;AAA/B,CAFkE,EAGlE;AAAEQ,IAAE,EAAE,QAAN;AAAgB8D,MAAI,EAAE,CAAC,OAAD,CAAtB;AAAiCkB,QAAM;AAAvC,CAHkE,EAIlE;AAAEhF,IAAE,EAAE,QAAN;AAAgB8D,MAAI,EAAE,CAAC,UAAD,EAAa,QAAb,CAAtB;AAA8CkB,QAAM;AAApD,CAJkE,EAKlE;AAAEhF,IAAE,EAAE,OAAN;AAAe8D,MAAI,EAAE,CAAC,SAAD,CAArB;AAAkCkB,QAAM;AAAxC,CALkE,EAMlE;AACIhF,IAAE,EAAE,WADR;AAEI8D,MAAI,EAAE,CAAC,UAAD,CAFV;AAGIkB,QAAM;AAHV,CANkE,EAWlE;AACIhF,IAAE,EAAE,WADR;AAEI8D,MAAI,EAAE,CAAC,UAAD,CAFV;AAGIkB,QAAM;AAHV,CAXkE,EAgBlE;AACIhF,IAAE,EAAE,aADR;AAEI8D,MAAI,EAAE,CAAC,UAAD,EAAa,QAAb,CAFV;AAGIkB,QAAM;AAHV,CAhBkE,EAqBlE;AACIhF,IAAE,EAAE,aADR;AAEI8D,MAAI,EAAE,CAAC,UAAD,EAAa,QAAb,CAFV;AAGIkB,QAAM;AAHV,CArBkE,EA0BlE;AACIhF,IAAE,EAAE,WADR;AAEI8D,MAAI,EAAE,CAAC,UAAD,EAAa,QAAb,CAFV;AAGIkB,QAAM;AAHV,CA1BkE,EA+BlE;AACIhF,IAAE,EAAE,aADR;AAEI8D,MAAI,EAAE,CAAC,UAAD,EAAa,QAAb,CAFV;AAGIkB,QAAM;AAHV,CA/BkE,CAA/D;AAsCA,IAAMuH,uBAAyD,GAAG,CACrE;AAAEvM,IAAE,EAAE,OAAN;AAAe8D,MAAI,EAAE,CAAC,KAAD,CAArB;AAA8BkB,QAAM,EAAExF;AAAtC,CADqE,CAAlE,C;;;;;;;;ACtDP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA0D;AACgC;AAC3D;AACP;AACsB;AACD;AACtC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL,2EAA2E,MAAM;AACjF;AACA;AACA;AACA,KAAK;;AAEL,qDAAqD,KAAK;AAC1D;AACA;AACA,KAAK;;AAEL,6DAA6D,MAAM;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,gDAAgB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,0GAAwB;;AAEtC,sBAAsB,mDAAmB,YAAY,0FAAQ;AAC7D,eAAe,4DAAI,wEAAwE,yEAAU;AACrG;AACA,GAAG;AACH,CAAC;AACD,MAAqC,GAAG,SAAM;AAC/B,mIAAU;AACzB;AACA,CAAC,gBAAgB,E;;;;;;;;ACxEjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA0D;AACgC;AAC3D;AACP;AACsB;AACvC;AACP;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH,4DAA4D,MAAM;AAClE;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,gDAAgB;AAC/C;AACA;AACA;AACA;AACA,cAAc,0GAAwB;;AAEtC,sBAAsB,mDAAmB,QAAQ,0FAAQ;AACzD,eAAe,4DAAI;AACnB;AACA,GAAG;AACH,CAAC;AACD,MAAqC,GAAG,SAAM;AAC/B,mIAAU;AACzB;AACA,CAAC,cAAc,E;;;;;;;;ACnCf;AAAA;AAAA;AAAA;AACA;AACA;AACA;CAIA;;AACA,IAAMgN,aAAuC,GAAGC,kEAAhD;AAEA;AACA;AACA;AACA;;AACO,SAASlB,2BAAT,CACHtC,YADG,EAEmB;AACtB,SACIA,YAAY,KAAKzJ,SAAjB,IACAgN,aAAa,CAACrL,IAAd,CAAmB,UAAA+I,IAAI;AAAA,WAAIA,IAAI,CAACwC,sBAAL,KAAgCzD,YAApC;AAAA,GAAvB,CAFJ;AAIH,C;;;;;;;;ACrBY;;AAEb,6BAA6B,mBAAO,CAAC,MAA8C;;AAEnF,8BAA8B,mBAAO,CAAC,MAA+C;;AAErF;AACA;AACA,CAAC;AACD;;AAEA,oCAAoC,mBAAO,CAAC,MAAO;;AAEnD,4CAA4C,mBAAO,CAAC,MAAuB;;AAE3E;AACA;AACA,CAAC;;AAED,2B;;;;;;;;;;;;;;;;;;;;ACnBA;AAIe,SAASyC,gBAAT,CAAqD7M,OAArD,EAAyE2M,OAAzE,EAA6GmB,IAA7G,EAA8I;AAAA,MAAjCA,IAAiC;AAAjCA,QAAiC,GAAJ,EAAI;AAAA;;AAAA,kBAC7HC,sDAAQ,CAAIpN,SAAJ,CADqH;AAAA,MAClJqN,MADkJ;AAAA,MAC1IC,SAD0I;;AAGzJ1B,yDAAS,CAAC,YAAM;AACZ,QAAMzD,CAAC,GAAG9I,OAAO,IAAI2M,OAAO,CAAC3M,OAAD,CAA5B;AACAiO,aAAS,CAACnF,CAAD,CAAT;AACA,WAAO;AAAA,aAAMA,CAAN,aAAMA,CAAN,uBAAMA,CAAC,CAAEoF,OAAH,EAAN;AAAA,KAAP;AACH,GAJQ,GAILlO,OAJK,8GAIO8N,IAJP,GAAT,CAHyJ,CAOlI;;AAEvB,SAAOE,MAAP;AACH,C","file":"859a83de993caea7524bf57c2975f3be6812c8c3-52243a0ba13e228b1024.js","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport withStyles from '../styles/withStyles';\nimport ListContext from '../List/ListContext';\nexport var styles = function styles(theme) {\n  return {\n    /* Styles applied to the root element. */\n    root: {\n      minWidth: 56,\n      color: theme.palette.action.active,\n      flexShrink: 0,\n      display: 'inline-flex'\n    },\n\n    /* Styles applied to the root element when the parent `ListItem` uses `alignItems=\"flex-start\"`. */\n    alignItemsFlexStart: {\n      marginTop: 8\n    }\n  };\n};\n/**\n * A simple wrapper to apply `List` styles to an `Icon` or `SvgIcon`.\n */\n\nvar ListItemIcon = /*#__PURE__*/React.forwardRef(function ListItemIcon(props, ref) {\n  var classes = props.classes,\n      className = props.className,\n      other = _objectWithoutProperties(props, [\"classes\", \"className\"]);\n\n  var context = React.useContext(ListContext);\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    className: clsx(classes.root, className, context.alignItems === 'flex-start' && classes.alignItemsFlexStart),\n    ref: ref\n  }, other));\n});\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nexport default withStyles(styles, {\n  name: 'MuiListItemIcon'\n})(ListItemIcon);","import { CardMedia, CardMediaProps, createStyles, makeStyles, Theme } from \"@material-ui/core\";\nimport React from \"react\";\n\nconst useStyles = makeStyles((theme: Theme) => createStyles({\n    media: {\n        height: 0,\n        paddingTop: '75%', // 4:3\n    }\n}));\n\n/*\n        [theme.breakpoints.down('lg')]: {\n            paddingTop: '56.72%', // 16:9\n        },\n        [theme.breakpoints.down('xs')]: {\n            paddingTop: '18%',\n        },\n        [theme.breakpoints.down('md')]: { // 6:3\n            paddingTop: '50%',\n        }\n*/\n\nexport default function CardMediaWithSkeleton(props: CardMediaProps) {\n    const { image, src, className, ...others } = props;\n    const classes = useStyles();\n    const hasImage = !!image || !!src;\n    return hasImage ?\n        <CardMedia className={className || classes.media} {...others} image={image} src={src} />\n        : <></>;\n}","import React from \"react\";\nimport { JDDevice } from \"../../jacdac-ts/src/jdom/device\";\nimport useDeviceSpecification from \"../jacdac/useDeviceSpecification\";\nimport useDeviceImage from \"./devices/useDeviceImage\";\nimport CardMediaWithSkeleton from \"./ui/CardMediaWithSkeleton\";\n\nexport default function DeviceCardMedia(props: { device: JDDevice }) {\n    const { device } = props;\n    const specification = useDeviceSpecification(device)\n    const imageUrl = useDeviceImage(specification)\n\n    return <CardMediaWithSkeleton\n        image={imageUrl}\n        title={specification?.name}\n    />\n}","import { ControlReg } from \"../../jacdac-ts/src/jdom/constants\"\nimport { CardHeader, Chip, Typography } from \"@material-ui/core\"\n// tslint:disable-next-line: no-submodule-imports\nimport { Link } from \"gatsby-theme-material-ui\"\nimport { JDDevice } from \"../../jacdac-ts/src/jdom/device\"\nimport React from \"react\"\nimport {\n    useRegisterIntValue,\n    useRegisterStringValue,\n} from \"../jacdac/useRegisterValue\"\nimport DeviceActions from \"./DeviceActions\"\nimport DeviceName from \"./devices/DeviceName\"\nimport DeviceCardMedia from \"./DeviceCardMedia\"\nimport useDeviceSpecification from \"../jacdac/useDeviceSpecification\"\nimport { identifierToUrlPath } from \"../../jacdac-ts/src/jdom/spec\"\nimport DeviceAvatar from \"./devices/DeviceAvatar\"\n\nfunction DeviceFirmwareVersionChip(props: { device: JDDevice }) {\n    const { device } = props\n    const firmwareVersionRegister = device\n        ?.service(0)\n        ?.register(ControlReg.FirmwareVersion)\n    const firmwareVersion = useRegisterStringValue(firmwareVersionRegister)\n\n    return (\n        (firmwareVersion && <Chip size=\"small\" label={firmwareVersion} />) || (\n            <></>\n        )\n    )\n}\n\nfunction DeviceTemperatureChip(props: { device: JDDevice }) {\n    const { device } = props\n    const tempRegister = device?.service(0)?.register(ControlReg.McuTemperature)\n    const temperature = useRegisterIntValue(tempRegister)\n    return (\n        (temperature !== undefined && (\n            <Chip size=\"small\" label={`${temperature}°`} />\n        )) || <></>\n    )\n}\n\nexport default function DeviceCardHeader(props: {\n    device: JDDevice\n    showAvatar?: boolean\n    showDeviceId?: boolean\n    showFirmware?: boolean\n    showTemperature?: boolean\n    showMedia?: boolean\n}) {\n    const {\n        device,\n        showFirmware,\n        showTemperature,\n        showMedia,\n        showDeviceId,\n        showAvatar,\n    } = props\n    const specification = useDeviceSpecification(device)\n\n    return (\n        <>\n            {showMedia && <DeviceCardMedia device={device} />}\n            <CardHeader\n                avatar={showAvatar && <DeviceAvatar device={device} />}\n                action={<DeviceActions device={device} showReset={true} />}\n                title={\n                    <Link\n                        color=\"textPrimary\"\n                        to={`/devices/${\n                            identifierToUrlPath(specification?.id) || \"\"\n                        }`}\n                    >\n                        <DeviceName device={device} />\n                    </Link>\n                }\n                subheader={\n                    <>\n                        <Typography variant=\"caption\" gutterBottom>\n                            {[\n                                specification?.name,\n                                showDeviceId && device.deviceId,\n                            ]\n                                .filter(s => !!s)\n                                .join(\", \")}\n                        </Typography>\n                        {showFirmware && (\n                            <DeviceFirmwareVersionChip device={device} />\n                        )}\n                        {showTemperature && (\n                            <DeviceTemperatureChip device={device} />\n                        )}\n                    </>\n                }\n            />\n        </>\n    )\n}\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport withStyles from '../styles/withStyles';\nexport var styles = {\n  /* Styles applied to the root element. */\n  root: {\n    position: 'absolute',\n    right: 16,\n    top: '50%',\n    transform: 'translateY(-50%)'\n  }\n};\n/**\n * Must be used as the last child of ListItem to function properly.\n */\n\nvar ListItemSecondaryAction = /*#__PURE__*/React.forwardRef(function ListItemSecondaryAction(props, ref) {\n  var classes = props.classes,\n      className = props.className,\n      other = _objectWithoutProperties(props, [\"classes\", \"className\"]);\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    className: clsx(classes.root, className),\n    ref: ref\n  }, other));\n});\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nListItemSecondaryAction.muiName = 'ListItemSecondaryAction';\nexport default withStyles(styles, {\n  name: 'MuiListItemSecondaryAction'\n})(ListItemSecondaryAction);","import {\n    Commands,\n    testCommandFunctions,\n} from \"../../jacdac-spec/spectool/jdtestfuns\"\nimport { getExpressionsOfType } from \"../../jacdac-spec/spectool/jdutils\"\n\nimport { CHANGE, EVENT } from \"../jdom/constants\"\nimport { JDEventSource } from \"../jdom/eventsource\"\nimport { JDService } from \"../jdom/service\"\nimport { JDRegister } from \"../jdom/register\"\nimport { JDEvent } from \"../jdom/event\"\nimport { JDServiceClient } from \"../jdom/serviceclient\"\nimport { isEvent, isRegister, serviceSpecificationFromClassIdentifier } from \"../jdom/spec\"\n\nexport enum JDTestCommandStatus {\n    NotReady,\n    Active,\n    RequiresUserInput,\n    Passed,\n    Failed,\n}\n\nexport enum JDTestStatus {\n    NotReady,\n    Active,\n    Passed,\n    Failed,\n}\n\nfunction commandStatusToTestStatus(status: JDTestCommandStatus) {\n    switch (status) {\n        case JDTestCommandStatus.Active:\n            return JDTestStatus.Active\n        case JDTestCommandStatus.Passed:\n            return JDTestStatus.Passed\n        case JDTestCommandStatus.Failed:\n            return JDTestStatus.Failed\n        case JDTestCommandStatus.NotReady:\n            return JDTestStatus.NotReady\n        case JDTestCommandStatus.RequiresUserInput:\n            return JDTestStatus.Active\n    }\n}\n\nfunction cmdToTestFunction(cmd: jdtest.TestCommandSpec) {\n    const id = (<jsep.Identifier>cmd.call.callee).name\n    return testCommandFunctions.find(t => t.id == id)\n}\n\nfunction unparse(e: jsep.Expression): string {\n    switch (e.type) {\n        case \"ArrayExpression\": {\n            const ae = e as jsep.ArrayExpression\n            return `[${ae.elements\n                .map(unparse)\n                .join(\", \")}]`\n        }\n        case \"CallExpression\": {\n            const caller = e as jsep.CallExpression\n            return `${unparse(caller.callee)}(${caller.arguments\n                .map(unparse)\n                .join(\", \")})`\n        }\n        case \"BinaryExpression\":\n        case \"LogicalExpression\": {\n            const be = e as any\n            return `(${unparse(be.left)} ${be.operator} ${unparse(be.right)})`\n        }\n        case \"UnaryExpression\": {\n            const ue = e as jsep.UnaryExpression\n            return `${ue.operator}${unparse(ue.argument)}`\n        }\n        case \"Identifier\": {\n            return (e as jsep.Identifier).name\n        }\n        case \"Literal\": {\n            return (e as jsep.Literal).raw\n        }\n        default:\n            return \"TODO\"\n    }\n}\n\ntype SMap<T> = { [v: string]: T }\ntype StartMap = { e: jsep.Expression; v: any }[]\n\nclass JDExprEvaluator {\n    private exprStack: any[] = []\n\n    constructor(private env: SMap<any>, private start: StartMap) {}\n\n    private tos() {\n        return this.exprStack[this.exprStack.length - 1]\n    }\n\n    public eval(e: jsep.Expression) {\n        this.exprStack = []\n        this.visitExpression(e)\n        return this.exprStack.pop()\n    }\n\n    private visitExpression(e: jsep.Expression) {\n        switch (e.type) {\n            case \"ArrayExpression\": {\n                // nothing to do here yet (only used for event function)\n                break\n            }\n\n            case \"CallExpression\": {\n                const caller = <jsep.CallExpression>e\n                const callee = <jsep.Identifier>caller.callee\n                switch (callee.name) {\n                    case \"start\":\n                        this.exprStack.push(\n                            this.start.find(r => r.e === caller).v\n                        )\n                        return\n                    default: // ERROR\n                }\n                break\n            }\n\n            case \"BinaryExpression\": {\n                const be = <jsep.BinaryExpression>e\n                this.visitExpression(be.left)\n                this.visitExpression(be.right)\n                const right = this.exprStack.pop()\n                const left = this.exprStack.pop()\n                switch (be.operator) {\n                    case \"+\":\n                        this.exprStack.push(left + right)\n                        return\n                    case \"-\":\n                        this.exprStack.push(left - right)\n                        return\n                    case \"/\":\n                        this.exprStack.push(left / right)\n                        return\n                    case \"*\":\n                        this.exprStack.push(left * right)\n                        return\n                    case \"%\":\n                        this.exprStack.push(left % right)\n                        return\n                    case \">>\":\n                        this.exprStack.push(left >> right)\n                        return\n                    case \">>>\":\n                        this.exprStack.push(left >>> right)\n                        return\n                    case \"<<\":\n                        this.exprStack.push(left << right)\n                        return\n                    case \"|\":\n                        this.exprStack.push(left | right)\n                        return\n                    case \"&\":\n                        this.exprStack.push(left & right)\n                        return\n                    case \"^\":\n                        this.exprStack.push(left ^ right)\n                        return\n                    case \"==\":\n                        this.exprStack.push(left == right)\n                        return\n                    case \"!=\":\n                        this.exprStack.push(left != right)\n                        return\n                    case \"===\":\n                        this.exprStack.push(left === right)\n                        return\n                    case \"!==\":\n                        this.exprStack.push(left !== right)\n                        return\n\n                    case \"<\":\n                        this.exprStack.push(left < right)\n                        return\n                    case \">\":\n                        this.exprStack.push(left > right)\n                        return\n                    case \"<=\":\n                        this.exprStack.push(left <= right)\n                        return\n                    case \">=\":\n                        this.exprStack.push(left >= right)\n                        return\n                }\n                break\n            }\n\n            case \"UnaryExpression\":\n            case \"LogicalExpression\": {\n                const le = <jsep.LogicalExpression>e\n                this.visitExpression(le.left)\n                switch (le.operator) {\n                    case \"||\":\n                        if (this.tos()) return\n                        else this.visitExpression(le.right)\n                        break\n                    case \"&&\":\n                        if (!this.tos()) return\n                        else this.visitExpression(le.right)\n                        break\n                    default:\n                }\n                break\n            }\n\n            case \"Identifier\": {\n                const id = <jsep.Identifier>e\n                this.exprStack.push(this.env[id.name])\n                break\n            }\n            case \"Literal\": {\n                const lit = <jsep.Literal>e\n                this.exprStack.push(lit.value)\n                break\n            }\n            default:\n        }\n    }\n}\n\nclass JDCommandEvaluator {\n    private _prompt = \"\"\n    private _progress = \"\"\n    private _status = JDTestCommandStatus.Active\n    private _startExpressions: StartMap = []\n    private _rangeComplete: number = undefined\n    private _eventsComplete: string[] = undefined\n    private _eventsQueue: string[] = undefined\n\n    constructor(\n        private readonly testRunner: JDTestRunner,\n        private readonly command: jdtest.TestCommandSpec\n    ) {\n\n    }\n\n    public get prompt() {\n        return this._prompt\n    }\n    public get status() {\n        return this._status\n    }\n    public get progress() {\n        return this._progress\n    }\n\n    public start() {\n        this._startExpressions = []\n        const testFun = cmdToTestFunction(this.command)\n        const args = this.command.call.arguments\n        let startExprs: jsep.Expression[] = []\n        switch (testFun.id as Commands) {\n            case \"check\": {\n                startExprs = (<jsep.CallExpression[]>getExpressionsOfType(args,'CallExpression'))\n                    .filter(ce => (<jsep.Identifier>ce.callee).name === \"start\")\n                    .map(ce => ce.arguments[0])\n                break\n            }\n            case \"changes\":\n            case \"increases\":\n            case \"decreases\": {\n                startExprs.push(args[0])\n                break\n            }\n            case \"increasesBy\":\n            case \"decreasesBy\": \n            case \"stepsUpTo\":\n            case \"stepsDownTo\": {\n                startExprs.push(args[0])\n                startExprs.push(args[1])\n                break\n            }\n            case \"assign\": {\n                startExprs.push(args[1])\n                break\n            }\n            case \"events\": {\n                const eventList = this.command.call.arguments[0] as jsep.ArrayExpression\n                this._eventsComplete = (eventList.elements as jsep.Identifier[]).map(id => id.name)\n                this._eventsQueue = []\n                break\n            }\n        }\n        // evaluate the start expressions and store the results\n        const env = this.testRunner.serviceTestRunner.environment;\n        startExprs.forEach(child => {\n            if (this._startExpressions.findIndex(r => r.e === child) < 0) {\n                const exprEval = new JDExprEvaluator(env, [])\n                this._startExpressions.push({\n                    e: child,\n                    v: exprEval.eval(child),\n                })\n            }\n        })\n        this.createPrompt()\n    }\n\n    private createPrompt() {\n        const testFun = cmdToTestFunction(this.command)\n        const replaceId = this.command.call.arguments.map((a, i) => {\n            return [`{${i + 1}}`, unparse(a) ]\n        })\n        const replaceVal = this.command.call.arguments.map((a, i) => {\n            const aStart = this._startExpressions.find(r => r.e === a)\n            return [`{${i + 1}:val}`, aStart && aStart.v ? aStart.v.toString() : \"NA\" ]\n        })\n        this._prompt =\n            testFun.id === \"ask\" || testFun.id === \"say\"\n                ? this.command.prompt.slice(0)\n                : testFun.prompt.slice(0)\n        replaceId.forEach(p => (this._prompt = this._prompt.replace(p[0], p[1])))\n        replaceVal.forEach(p => (this._prompt = this._prompt.replace(p[0], p[1])))\n    }\n\n    public setEvent(ev: string) {\n        this._eventsQueue.push(ev)\n    }\n\n    public evaluate() {\n        const env = this.testRunner.serviceTestRunner.environment;\n        const testFun = cmdToTestFunction(this.command)\n        this._status = JDTestCommandStatus.Active\n        this._progress = \"\"\n        switch (testFun.id as Commands) {\n            case \"ask\": {\n                this._status = JDTestCommandStatus.RequiresUserInput\n                break\n            }\n            case \"check\": {\n                const expr = new JDExprEvaluator(\n                    env,\n                    this._startExpressions\n                )\n                const ev = expr.eval(this.command.call.arguments[0])\n                this._status = ev\n                    ? JDTestCommandStatus.Passed\n                    : JDTestCommandStatus.Active\n                break\n            }\n            case \"changes\":\n            case \"increases\":\n            case \"decreases\": {\n                const reg = this.command.call.arguments[0]\n                const regSaved = this._startExpressions.find(r => r.e === reg)\n                const regValue = env[unparse(reg)]\n                const status =\n                    (testFun.id === \"changes\" && regValue !== regSaved.v) ||\n                    (testFun.id === \"increases\" && regValue > regSaved.v) ||\n                    (testFun.id === \"decreases\" && regValue < regSaved.v)\n                        ? JDTestCommandStatus.Passed\n                        : JDTestCommandStatus.Active\n                this._status = status\n                regSaved.v = regValue\n                break\n            }\n            case \"increasesBy\":\n            case \"decreasesBy\": {\n                const reg = this.command.call.arguments[0]\n                const regSaved = this._startExpressions.find(r => r.e === reg)\n                const amt = this.command.call.arguments[1]\n                const amtSaved = this._startExpressions.find(r => r.e === amt)\n                const regValue = env[unparse(reg)]\n                if (testFun.id === \"increasesBy\") {\n                    if (regValue >= regSaved.v + amtSaved.v) {\n                        this._status = JDTestCommandStatus.Passed\n                    } else if (\n                        regValue >= regSaved.v &&\n                        regValue < regSaved.v + amtSaved.v\n                    ) {\n                        this._status = JDTestCommandStatus.Active\n                        this._progress = `current: ${regValue}, goal: ${regSaved.v + amtSaved.v}`\n                    } else {\n                        this._status = JDTestCommandStatus.Active\n                    }\n                } else {\n                    if (regValue <= regSaved.v - amtSaved.v) {\n                        this._status = JDTestCommandStatus.Passed\n                        this._progress = \"completed\"\n                    } else if (\n                        regValue <= regSaved.v &&\n                        regValue > regSaved.v - amtSaved.v\n                    ) {\n                        this._status = JDTestCommandStatus.Active\n                        this._progress = `current: ${regValue} goal: ${regSaved.v - amtSaved.v}`\n                    } else {\n                        this._status = JDTestCommandStatus.Active\n                    }\n                }\n                break\n            }\n            case \"stepsUpTo\":\n            case \"stepsDownTo\": {\n                this._status = JDTestCommandStatus.Active\n                const reg = this.command.call.arguments[0]\n                const regValue = env[unparse(reg)]\n                const beginSaved = this._startExpressions.find(r => r.e === reg)\n                const end = this.command.call.arguments[1]\n                const endSaved = this._startExpressions.find(r => r.e === end)\n                if (this._rangeComplete === undefined) {\n                    this._rangeComplete = regValue\n                } else {\n                    if (regValue === this._rangeComplete + (testFun.id == 'stepsUpTo' ? 1 : -1))\n                        this._rangeComplete = regValue\n                    if (this._rangeComplete === endSaved.v) {\n                        this._status =  JDTestCommandStatus.Passed\n                    }\n                }\n                if (this._rangeComplete != undefined) {\n                    this._progress = \n                        testFun.id == 'stepsUpTo' \n                            ? `from ${(beginSaved.v)} up to ${this._rangeComplete}`\n                            : `from ${(beginSaved.v)} down to ${this._rangeComplete}`\n                }\n                break\n            }\n            case \"events\": {\n                if (this._eventsQueue?.length > 0 && this._eventsComplete?.length > 0) {\n                    const ev = this._eventsQueue.pop()\n                    if (ev === this._eventsComplete[0]) {\n                        this._eventsComplete.shift()\n                        if (this._eventsComplete.length === 0)\n                            this._status = JDTestCommandStatus.Passed\n                    } else {\n                        this._status = JDTestCommandStatus.Failed\n                    }\n                    this._progress = `got event ${ev}; remaining = [${this._eventsComplete}]`\n                } else {\n                    this._progress = `no events received; remaining = [${this._eventsComplete}]`\n                }\n                break\n            }\n            case \"assign\": {\n                const reg = this.command.call.arguments[0] as jsep.Identifier\n                const jdreg = this.testRunner.serviceTestRunner.registers[reg.name]\n                const expr = new JDExprEvaluator(\n                    env,\n                    this._startExpressions\n                )\n                const ev = expr.eval(this.command.call.arguments[1])\n                // TODO: generalize\n                jdreg.sendSetIntAsync(ev)\n                this._status = JDTestCommandStatus.Passed\n            }\n        }\n    }\n}\n\nexport interface JDCommandOutput {\n    message: string\n    progress: string\n}\n\nexport class JDTestCommandRunner extends JDEventSource {\n    private _status = JDTestCommandStatus.NotReady\n    private _output: JDCommandOutput = { message: \"\", progress: \"\" }\n    private readonly _timeOut = 5000 // timeout\n    private _timeLeft = 5000\n    private _commmandEvaluator: JDCommandEvaluator = null\n\n    constructor(\n        private readonly testRunner: JDTestRunner,\n        private readonly command: jdtest.TestCommandSpec\n    ) {\n        super()\n    }\n\n    get status() {\n        return this._status\n    }\n\n    set status(s: JDTestCommandStatus) {\n        if (s != this._status) {\n            this._status = s\n            this.emit(CHANGE)\n        }\n    }\n\n    get indeterminate(): boolean {\n        return (\n            this.status !== JDTestCommandStatus.Failed &&\n            this.status !== JDTestCommandStatus.Passed\n        )\n    }\n\n    get output() {\n        return this._output\n    }\n\n    set output(value: JDCommandOutput) {\n        if (\n            !this._output ||\n            this._output.message !== value.message ||\n            this._output.progress !== value.progress\n        ) {\n            this._output = value\n            this.emit(CHANGE)\n        }\n    }\n\n    reset() {\n        this.output = { message: \"\", progress: \"\" }\n        this.status = JDTestCommandStatus.NotReady\n        this._commmandEvaluator = null\n    }\n\n    start() {\n        this.status = JDTestCommandStatus.Active\n        this._commmandEvaluator = new JDCommandEvaluator(this.testRunner, this.command)\n        this._commmandEvaluator.start()\n        this.envChange(false)\n        this.envChange(true)\n    }\n\n    envChange(finish = true) {\n        if (this._commmandEvaluator) {\n            this._commmandEvaluator.evaluate()\n            const newOutput: JDCommandOutput = {\n                message: this._commmandEvaluator.prompt,\n                progress: this._commmandEvaluator.progress,\n            }\n            this.output = newOutput\n            if (this._commmandEvaluator.status === JDTestCommandStatus.RequiresUserInput)\n                this.status= JDTestCommandStatus.RequiresUserInput\n            else if (finish) \n                this.finish(this._commmandEvaluator.status)\n        }\n    }\n\n    eventChange(event: string) {\n        this._commmandEvaluator.setEvent(event)\n        this.envChange()\n    }\n\n    cancel() {\n        this.finish(JDTestCommandStatus.Failed)\n    }\n\n    finish(s: JDTestCommandStatus) {\n        if (\n            (s === JDTestCommandStatus.Failed || s === JDTestCommandStatus.Passed) &&\n            (this.status === JDTestCommandStatus.Active ||\n                this.status === JDTestCommandStatus.RequiresUserInput)\n        ) {\n            this.status = s\n            this.testRunner.finishCommand()\n        }\n    }\n}\n\nexport class JDTestRunner extends JDEventSource {\n    private _status = JDTestStatus.NotReady\n    private _commandIndex: number\n    public readonly commands: JDTestCommandRunner[]\n\n    constructor(\n        public readonly serviceTestRunner: JDServiceTestRunner,\n        private readonly testSpec: jdtest.TestSpec\n    ) {\n        super()\n        this.commands = testSpec.testCommands.map(\n            c => new JDTestCommandRunner(this, c)\n        )\n    }\n\n    reset() {\n        if (this.status !== JDTestStatus.NotReady) {\n            this._status = JDTestStatus.NotReady\n            this._commandIndex = undefined\n            this.commands.forEach(t => t.reset())\n            this.emit(CHANGE)\n        }\n    }\n\n    start() {\n        this.reset()\n        this.status = JDTestStatus.Active\n        this.commandIndex = 0\n        this.serviceTestRunner.refreshEnvironment()\n    }\n\n    next() {\n        this.serviceTestRunner.next()\n    }\n\n    cancel() {\n        this.finish(JDTestStatus.Failed)\n    }\n\n    get status() {\n        return this._status\n    }\n\n    set status(s: JDTestStatus) {\n        if (s != this._status) {\n            this._status = s\n            this.emit(CHANGE)\n        }\n    }\n\n    get indeterminate(): boolean {\n        return (\n            this.status !== JDTestStatus.Failed &&\n            this.status !== JDTestStatus.Passed\n        )\n    }\n\n    get description() {\n        return this.testSpec.description\n    }\n\n    get prompt() {\n        return this.testSpec.prompt\n    }\n\n    finish(newStatus: JDTestStatus) {\n        if (this.status === JDTestStatus.Active) {\n            this.status = newStatus\n        }\n    }\n\n    private get commandIndex() {\n        return this._commandIndex\n    }\n\n    private set commandIndex(index: number) {\n        if (this._commandIndex !== index) {\n            this._commandIndex = index\n            this.currentCommand?.start()\n            this.emit(CHANGE)\n        }\n    }\n\n    public envChange() {\n        this.currentCommand?.envChange()\n    }\n\n    public eventChange(event: string) {\n        this.currentCommand?.eventChange(event)\n    }\n\n    public finishCommand() {\n        if (this.commandIndex === this.commands.length - 1)\n            this.finish(commandStatusToTestStatus(this.currentCommand.status))\n        // (this.commandIndex < this.commands.length)\n        else this.commandIndex++\n    }\n\n    get currentCommand() {\n        return this.commands[this._commandIndex]\n    }\n}\n\nasync function refresh_env(registers: SMap<JDRegister>, environment: SMap<any>)\n{\n    for(const k in environment) {\n        const register = registers[k]\n        await register.refresh()\n        environment[k] = register.unpackedValue ? register.unpackedValue[0] : register.intValue\n    }\n}\n\nexport class JDServiceTestRunner extends JDServiceClient {\n    private _testIndex = -1\n    private _registers: SMap<JDRegister> = {}\n    private _environment: SMap<any> = {}\n    private events: SMap<JDEvent> = {}\n    public readonly tests: JDTestRunner[]\n\n    constructor(\n        public readonly testSpec: jdtest.ServiceTestSpec,\n        service: JDService\n    ) {\n        super(service)\n        this.tests = this.testSpec.tests.map(\n            t => new JDTestRunner(this, t)\n        )\n        const serviceSpec = serviceSpecificationFromClassIdentifier(\n            service.serviceClass\n        )\n        this.testSpec.tests.forEach(t => {\n            t.events.forEach(eventName => {\n                if (!this.events[eventName]) {\n                    const pkt = serviceSpec.packets.find(\n                        pkt => isEvent(pkt) && pkt.name === eventName\n                    )\n                    const event = service.event(pkt.identifier)\n                    this.events[eventName] = event\n                    this.mount(\n                        event.subscribe(EVENT, () => {\n                            this.currentTest?.eventChange(eventName)\n                        })\n                    )\n                }\n            })\n            t.registers.forEach(regName => {\n                if (!this._registers[regName]) {\n                    const pkt = serviceSpec.packets.find(\n                        pkt => isRegister(pkt) && pkt.name === regName\n                    )\n                    const register = service.register(pkt.identifier)\n                    this._registers[regName] = register\n                    this._environment[regName] = register.unpackedValue ? register.unpackedValue[0] : register.intValue\n                    this.mount(\n                        register.subscribe(CHANGE, () => {\n                            this._environment[regName] = register.unpackedValue ? register.unpackedValue[0] : register.intValue\n                            this.currentTest?.envChange()\n                        })\n                    )\n                }\n            })\n        })\n        this.start()\n    }\n\n    public refreshEnvironment() {\n        refresh_env(this.registers, this.environment)\n    }\n\n    public get environment() {\n        return this._environment\n    }\n\n    public get registers() {\n        return this._registers\n    }\n\n    private get testIndex() {\n        return this._testIndex\n    }\n\n    private set testIndex(index: number) {\n        if (this._testIndex !== index) {\n            // stop previous test if needed\n            const ct = this.currentTest\n            if (ct) {\n                if (ct.status === JDTestStatus.Active) {\n                    ct.cancel()\n                }\n            }\n\n            // update test\n            this._testIndex = index\n            this.emit(CHANGE)\n        }\n    }\n\n    public stats() {\n        const r = {\n            total: this.tests.length,\n            success: 0,\n            failed: 0,\n            indeterminate: 0,\n        }\n        for (const test of this.tests) {\n            switch (test.status) {\n                case JDTestStatus.Failed:\n                    r.failed++\n                    break\n                case JDTestStatus.Passed:\n                    r.success++\n                    break\n                default:\n                    r.indeterminate++\n            }\n        }\n        return r\n    }\n\n    public start() {\n        this.tests.forEach(t => t.reset())\n        this.testIndex = 0\n    }\n\n    public next() {\n        this.testIndex++\n    }\n\n    get currentTest() {\n        return this.tests[this._testIndex]\n    }\n\n    set currentTest(test: JDTestRunner) {\n        const index = this.tests.indexOf(test)\n        if (index > -1) this.testIndex = index\n    }\n}\n","import React, { useCallback, useEffect } from \"react\"\nimport useServiceClient from \"../useServiceClient\"\nimport {\n    Grid,\n    Button,\n    List,\n    ListItemText,\n    ListItem,\n    ListItemIcon,\n    ListItemSecondaryAction,\n    Typography,\n    Card,\n    CardContent,\n    CardActions,\n    Box,\n    ListSubheader,\n} from \"@material-ui/core\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport Alert from \"../ui/Alert\"\nimport { JDService } from \"../../../jacdac-ts/src/jdom/service\"\nimport {\n    JDServiceTestRunner,\n    JDTestRunner,\n    JDTestStatus,\n    JDTestCommandRunner,\n    JDTestCommandStatus,\n} from \"../../../jacdac-ts/src/test/testrunner\"\nimport ErrorIcon from \"@material-ui/icons/Error\"\nimport CheckCircleIcon from \"@material-ui/icons/CheckCircle\"\nimport HourglassEmptyIcon from \"@material-ui/icons/HourglassEmpty\"\nimport PlayCircleFilledIcon from \"@material-ui/icons/PlayCircleFilled\"\nimport useChange from \"../../jacdac/useChange\"\nimport DashboardDevice from \"../dashboard/DashboardDevice\"\nimport LoadingProgress from \"../ui/LoadingProgress\"\nimport { serviceTestFromServiceClass } from \"../../../jacdac-ts/src/test/testspec\"\n\nfunction TestStatusIcon(props: { test: JDTestRunner }) {\n    const { test } = props\n    const status = useChange(test, t => t.status)\n\n    switch (status) {\n        case JDTestStatus.Active:\n            return <PlayCircleFilledIcon color=\"action\" />\n        case JDTestStatus.Failed:\n            return <ErrorIcon color=\"error\" />\n        case JDTestStatus.Passed:\n            return <CheckCircleIcon color=\"primary\" />\n        default:\n            return <HourglassEmptyIcon color=\"disabled\" />\n    }\n}\n\nfunction TestListItem(props: {\n    test: JDTestRunner\n    currentTest: JDTestRunner\n    onSelectTest: (test: JDTestRunner) => void\n}) {\n    const { test, currentTest, onSelectTest } = props\n    const description = useChange(test, t => t.description)\n    const selected = test === currentTest\n    const handleSelectTest = () => onSelectTest(test)\n\n    return (\n        <ListItem selected={selected} button onClick={handleSelectTest}>\n            <ListItemIcon>\n                <TestStatusIcon test={test} />\n            </ListItemIcon>\n            <ListItemText primary={description} />\n        </ListItem>\n    )\n}\n\nfunction TestList(props: {\n    testRunner: JDServiceTestRunner\n    currentTest: JDTestRunner\n    onSelectTest: (test: JDTestRunner) => void\n}) {\n    const { testRunner, currentTest, onSelectTest } = props\n    const { tests } = testRunner\n    const stats = useChange(testRunner, r => r.stats())\n\n    return (\n        <Card>\n            <CardContent>\n                <List\n                    dense={true}\n                    subheader={\n                        <ListSubheader>\n                            {`${stats.total} tests, ${stats.success} success, ${stats.failed} failed`}\n                        </ListSubheader>\n                    }\n                >\n                    {tests?.map((test, i) => (\n                        <TestListItem\n                            key={i}\n                            test={test}\n                            currentTest={currentTest}\n                            onSelectTest={onSelectTest}\n                        />\n                    ))}\n                </List>\n            </CardContent>\n        </Card>\n    )\n}\n\nfunction CommandStatusIcon(props: { command: JDTestCommandRunner }) {\n    const { command } = props\n    const status = useChange(command, c => c.status)\n\n    switch (status) {\n        case JDTestCommandStatus.Active:\n        case JDTestCommandStatus.RequiresUserInput:\n            return <PlayCircleFilledIcon color=\"action\" />\n        case JDTestCommandStatus.Failed:\n            return <ErrorIcon color=\"error\" />\n        case JDTestCommandStatus.Passed:\n            return <CheckCircleIcon color=\"primary\" />\n        default:\n            return <HourglassEmptyIcon color=\"disabled\" />\n    }\n}\n\nfunction CommandListItem(props: { command: JDTestCommandRunner }) {\n    const { command } = props\n    const { message, progress } = useChange(command, c => c.output)\n    const status = useChange(command, c => c.status)\n    const handleAnswer = (status: JDTestCommandStatus) => () =>\n        command.finish(status)\n    return (\n        <ListItem selected={status === JDTestCommandStatus.Active}>\n            <ListItemIcon>\n                <CommandStatusIcon command={command} />\n            </ListItemIcon>\n            <ListItemText\n                primary={message}\n                secondary={progress}\n            />\n            {status === JDTestCommandStatus.RequiresUserInput && (\n                <ListItemSecondaryAction>\n                    <Button\n                        variant=\"outlined\"\n                        onClick={handleAnswer(JDTestCommandStatus.Passed)}\n                    >\n                        Yes\n                    </Button>\n                    <Button\n                        variant=\"outlined\"\n                        onClick={handleAnswer(JDTestCommandStatus.Failed)}\n                    >\n                        No\n                    </Button>\n                </ListItemSecondaryAction>\n            )}\n        </ListItem>\n    )\n}\n\nfunction ActiveTest(props: { test: JDTestRunner }) {\n    const { test } = props\n    const { commands } = test\n    const status = useChange(test, t => t.status)\n    const handleRestart = () => test.start()\n    const handleNext = () => test.next()\n    // auto start\n    useEffect(() => test.start(), [test])\n\n    return (\n        <Card>\n            <CardContent>\n                <Typography variant=\"h5\">DO</Typography>\n                <Box m={2}>\n                    <Typography variant=\"body1\">{test.prompt}</Typography>\n                </Box>\n                <Typography variant=\"h5\">TEST</Typography>\n                <List dense={false}>\n                    {commands.map((cmd, i) => (\n                        <CommandListItem key={i} command={cmd} />\n                    ))}\n                </List>\n                {status === JDTestStatus.Passed && (\n                    <Alert severity=\"success\">Test passed</Alert>\n                )}\n                {status === JDTestStatus.Failed && (\n                    <Alert severity=\"error\">Test failed</Alert>\n                )}\n            </CardContent>\n            <CardActions>\n                <Button\n                    variant={\n                        status === JDTestStatus.Active\n                            ? \"outlined\"\n                            : \"contained\"\n                    }\n                    color={\n                        status === JDTestStatus.Passed ? \"primary\" : undefined\n                    }\n                    onClick={handleNext}\n                >\n                    Next\n                </Button>\n                <Button variant=\"outlined\" onClick={handleRestart}>\n                    Restart\n                </Button>\n            </CardActions>\n        </Card>\n    )\n}\n\nexport default function ServiceTestRunner(props: {\n    service: JDService\n    serviceTest?: jdtest.ServiceTestSpec\n}) {\n    const {\n        service,\n        serviceTest = serviceTestFromServiceClass(service.serviceClass),\n    } = props\n    const factory = useCallback(\n        service => serviceTest && new JDServiceTestRunner(serviceTest, service),\n        [service, serviceTest]\n    )\n    const testRunner = useServiceClient(service, factory)\n    const currentTest = useChange(testRunner, t => t?.currentTest)\n    const handleSelectTest = (test: JDTestRunner) => {\n        testRunner.currentTest = test\n    }\n\n    if (!serviceTest)\n        return (\n            <Alert severity=\"warning\">\n                Sorry, there are no tests available for service{\" \"}\n                {service.specification.name}.\n            </Alert>\n        )\n\n    if (!testRunner) return <LoadingProgress />\n\n    return (\n        <Grid container spacing={2}>\n            <Grid item xs>\n                <TestList\n                    testRunner={testRunner}\n                    currentTest={currentTest}\n                    onSelectTest={handleSelectTest}\n                />\n            </Grid>\n            {currentTest && (\n                <Grid item xs>\n                    <ActiveTest test={currentTest} />\n                </Grid>\n            )}\n            {service && (\n                <Grid item xs>\n                    <DashboardDevice\n                        showAvatar={true}\n                        showHeader={true}\n                        device={service.device}\n                    />\n                </Grid>\n            )}\n        </Grid>\n    )\n}\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport withStyles from '../styles/withStyles';\nimport { chainPropTypes } from '@material-ui/utils';\nexport var styles = {\n  /* Styles applied to the root element. */\n  root: {\n    display: 'block',\n    backgroundSize: 'cover',\n    backgroundRepeat: 'no-repeat',\n    backgroundPosition: 'center'\n  },\n\n  /* Styles applied to the root element if `component=\"video, audio, picture, iframe, or img\"`. */\n  media: {\n    width: '100%'\n  },\n\n  /* Styles applied to the root element if `component=\"picture or img\"`. */\n  img: {\n    // ⚠️ object-fit is not supported by IE 11.\n    objectFit: 'cover'\n  }\n};\nvar MEDIA_COMPONENTS = ['video', 'audio', 'picture', 'iframe', 'img'];\nvar CardMedia = /*#__PURE__*/React.forwardRef(function CardMedia(props, ref) {\n  var children = props.children,\n      classes = props.classes,\n      className = props.className,\n      _props$component = props.component,\n      Component = _props$component === void 0 ? 'div' : _props$component,\n      image = props.image,\n      src = props.src,\n      style = props.style,\n      other = _objectWithoutProperties(props, [\"children\", \"classes\", \"className\", \"component\", \"image\", \"src\", \"style\"]);\n\n  var isMediaComponent = MEDIA_COMPONENTS.indexOf(Component) !== -1;\n  var composedStyle = !isMediaComponent && image ? _extends({\n    backgroundImage: \"url(\\\"\".concat(image, \"\\\")\")\n  }, style) : style;\n  return /*#__PURE__*/React.createElement(Component, _extends({\n    className: clsx(classes.root, className, isMediaComponent && classes.media, \"picture img\".indexOf(Component) !== -1 && classes.img),\n    ref: ref,\n    style: composedStyle,\n    src: isMediaComponent ? image || src : undefined\n  }, other), children);\n});\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nexport default withStyles(styles, {\n  name: 'MuiCardMedia'\n})(CardMedia);","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport withStyles from '../styles/withStyles';\nimport Typography from '../Typography';\nimport ListContext from '../List/ListContext';\nexport var styles = {\n  /* Styles applied to the root element. */\n  root: {\n    flex: '1 1 auto',\n    minWidth: 0,\n    marginTop: 4,\n    marginBottom: 4\n  },\n\n  /* Styles applied to the `Typography` components if primary and secondary are set. */\n  multiline: {\n    marginTop: 6,\n    marginBottom: 6\n  },\n\n  /* Styles applied to the `Typography` components if dense. */\n  dense: {},\n\n  /* Styles applied to the root element if `inset={true}`. */\n  inset: {\n    paddingLeft: 56\n  },\n\n  /* Styles applied to the primary `Typography` component. */\n  primary: {},\n\n  /* Styles applied to the secondary `Typography` component. */\n  secondary: {}\n};\nvar ListItemText = /*#__PURE__*/React.forwardRef(function ListItemText(props, ref) {\n  var children = props.children,\n      classes = props.classes,\n      className = props.className,\n      _props$disableTypogra = props.disableTypography,\n      disableTypography = _props$disableTypogra === void 0 ? false : _props$disableTypogra,\n      _props$inset = props.inset,\n      inset = _props$inset === void 0 ? false : _props$inset,\n      primaryProp = props.primary,\n      primaryTypographyProps = props.primaryTypographyProps,\n      secondaryProp = props.secondary,\n      secondaryTypographyProps = props.secondaryTypographyProps,\n      other = _objectWithoutProperties(props, [\"children\", \"classes\", \"className\", \"disableTypography\", \"inset\", \"primary\", \"primaryTypographyProps\", \"secondary\", \"secondaryTypographyProps\"]);\n\n  var _React$useContext = React.useContext(ListContext),\n      dense = _React$useContext.dense;\n\n  var primary = primaryProp != null ? primaryProp : children;\n\n  if (primary != null && primary.type !== Typography && !disableTypography) {\n    primary = /*#__PURE__*/React.createElement(Typography, _extends({\n      variant: dense ? 'body2' : 'body1',\n      className: classes.primary,\n      component: \"span\",\n      display: \"block\"\n    }, primaryTypographyProps), primary);\n  }\n\n  var secondary = secondaryProp;\n\n  if (secondary != null && secondary.type !== Typography && !disableTypography) {\n    secondary = /*#__PURE__*/React.createElement(Typography, _extends({\n      variant: \"body2\",\n      className: classes.secondary,\n      color: \"textSecondary\",\n      display: \"block\"\n    }, secondaryTypographyProps), secondary);\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    className: clsx(classes.root, className, dense && classes.dense, inset && classes.inset, primary && secondary && classes.multiline),\n    ref: ref\n  }, other), primary, secondary);\n});\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nexport default withStyles(styles, {\n  name: 'MuiListItemText'\n})(ListItemText);","import { GridSize } from \"@material-ui/core\"\nimport React, { useContext } from \"react\"\nimport AppContext, { DrawerType } from \"./AppContext\"\n\nexport interface GridBreakpoints {\n    xs?: GridSize,\n    md?: GridSize,\n    sm?: GridSize,\n    lg?: GridSize,\n    xl?: GridSize\n}\n\nexport default function useGridBreakpoints(itemCount?: number): GridBreakpoints {\n    const { drawerType } = useContext(AppContext)\n\n    if (itemCount !== undefined) {\n        switch (itemCount) {\n            case 1:\n            case 2: return { xs: 12, sm: 6, md: 6, lg: 6, xl: 6 }\n            case 3: return { xs: 12, sm: 6, md: 6, lg: 4, xl: 4 }\n        }\n    }\n\n    if (drawerType != DrawerType.None)\n        return { xs: 12, md: 6, sm: 6, lg: 6, xl: 4 }\n    else return {\n        xs: 12,\n        sm: 6,\n        md: 4,\n        lg: 4,\n        xl: 3\n    }\n}","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z\"\n}), 'PlayCircleFilled');\n\nexports.default = _default;","/* eslint-disable @typescript-eslint/triple-slash-reference */\n/// <reference path=\"jdtest.d.ts\" />\n\nexport type Commands =\n    | \"changes\"\n    | \"ask\"\n    | \"check\"\n    | \"increases\"\n    | \"decreases\"\n    | \"increasesBy\"\n    | \"decreasesBy\"\n    | \"stepsUpTo\"\n    | \"stepsDownTo\"\n    | \"events\"\n    | \"assign\"\n\nexport const testCommandFunctions: jdtest.TestFunctionDescription[] = [\n    { id: \"changes\", args: [\"register\"], prompt: `did the value of {1} change?` },\n    { id: \"ask\", args: [], prompt: undefined },\n    { id: \"events\", args: [\"array\"], prompt: `was the event trace {1} observed?` },\n    { id: \"assign\", args: [\"register\", \"number\"], prompt: `write value {2:val} to {1}` },\n    { id: \"check\", args: [\"boolean\"], prompt: `does the condition {1} hold?` },\n    {\n        id: \"increases\",\n        args: [\"register\"],\n        prompt: `did the value of {1} increase?`,\n    },\n    {\n        id: \"decreases\",\n        args: [\"register\"],\n        prompt: `did the value of {1} decrease?`,\n    },\n    {\n        id: \"increasesBy\",\n        args: [\"register\", \"number\"],\n        prompt: `did the value of {1} (initially {1:val}) increase by {2:val}?`,\n    },\n    {\n        id: \"decreasesBy\",\n        args: [\"register\", \"number\"],\n        prompt: `did the value of {1} (initially {1:val}) decrease by {2:val}?`,\n    },\n    {\n        id: \"stepsUpTo\",\n        args: [\"register\", \"number\"],\n        prompt: `{1} should step up (by ones) from {1:val} to {2:val}`,\n    },\n    {\n        id: \"stepsDownTo\",\n        args: [\"register\", \"number\"],\n        prompt: `{1} should step down (by ones) from {1:val} to {2:val}`,\n    },\n]\n\nexport const testExpressionFunctions: jdtest.TestFunctionDescription[] = [\n    { id: \"start\", args: [\"any\"], prompt: undefined },\n]\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport withStyles from '../styles/withStyles';\nimport capitalize from '../utils/capitalize';\nexport var styles = function styles(theme) {\n  return {\n    /* Styles applied to the root element. */\n    root: {\n      boxSizing: 'border-box',\n      lineHeight: '48px',\n      listStyle: 'none',\n      color: theme.palette.text.secondary,\n      fontFamily: theme.typography.fontFamily,\n      fontWeight: theme.typography.fontWeightMedium,\n      fontSize: theme.typography.pxToRem(14)\n    },\n\n    /* Styles applied to the root element if `color=\"primary\"`. */\n    colorPrimary: {\n      color: theme.palette.primary.main\n    },\n\n    /* Styles applied to the root element if `color=\"inherit\"`. */\n    colorInherit: {\n      color: 'inherit'\n    },\n\n    /* Styles applied to the inner `component` element if `disableGutters={false}`. */\n    gutters: {\n      paddingLeft: 16,\n      paddingRight: 16\n    },\n\n    /* Styles applied to the root element if `inset={true}`. */\n    inset: {\n      paddingLeft: 72\n    },\n\n    /* Styles applied to the root element if `disableSticky={false}`. */\n    sticky: {\n      position: 'sticky',\n      top: 0,\n      zIndex: 1,\n      backgroundColor: 'inherit'\n    }\n  };\n};\nvar ListSubheader = /*#__PURE__*/React.forwardRef(function ListSubheader(props, ref) {\n  var classes = props.classes,\n      className = props.className,\n      _props$color = props.color,\n      color = _props$color === void 0 ? 'default' : _props$color,\n      _props$component = props.component,\n      Component = _props$component === void 0 ? 'li' : _props$component,\n      _props$disableGutters = props.disableGutters,\n      disableGutters = _props$disableGutters === void 0 ? false : _props$disableGutters,\n      _props$disableSticky = props.disableSticky,\n      disableSticky = _props$disableSticky === void 0 ? false : _props$disableSticky,\n      _props$inset = props.inset,\n      inset = _props$inset === void 0 ? false : _props$inset,\n      other = _objectWithoutProperties(props, [\"classes\", \"className\", \"color\", \"component\", \"disableGutters\", \"disableSticky\", \"inset\"]);\n\n  return /*#__PURE__*/React.createElement(Component, _extends({\n    className: clsx(classes.root, className, color !== 'default' && classes[\"color\".concat(capitalize(color))], inset && classes.inset, !disableSticky && classes.sticky, !disableGutters && classes.gutters),\n    ref: ref\n  }, other));\n});\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nexport default withStyles(styles, {\n  name: 'MuiListSubheader'\n})(ListSubheader);","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport withStyles from '../styles/withStyles';\nexport var styles = {\n  /* Styles applied to the root element. */\n  root: {\n    display: 'flex',\n    alignItems: 'center',\n    padding: 8\n  },\n\n  /* Styles applied to the root element if `disableSpacing={false}`. */\n  spacing: {\n    '& > :not(:first-child)': {\n      marginLeft: 8\n    }\n  }\n};\nvar CardActions = /*#__PURE__*/React.forwardRef(function CardActions(props, ref) {\n  var _props$disableSpacing = props.disableSpacing,\n      disableSpacing = _props$disableSpacing === void 0 ? false : _props$disableSpacing,\n      classes = props.classes,\n      className = props.className,\n      other = _objectWithoutProperties(props, [\"disableSpacing\", \"classes\", \"className\"]);\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    className: clsx(classes.root, className, !disableSpacing && classes.spacing),\n    ref: ref\n  }, other));\n});\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nexport default withStyles(styles, {\n  name: 'MuiCardActions'\n})(CardActions);","// eslint-disable-next-line @typescript-eslint/triple-slash-reference\n/// <reference path=\"../../jacdac-spec/spectool/jdspec.d.ts\" />\n// eslint-disable-next-line @typescript-eslint/triple-slash-reference\n/// <reference path=\"../../jacdac-spec/spectool/jdtest.d.ts\" />\n\nimport serviceTestData from \"../../jacdac-spec/dist/services-tests.json\"\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst _serviceTests: jdtest.ServiceTestSpec[] = serviceTestData as any\n\n/**\n * Given a service specification, see if it has a test\n * @param spec\n */\nexport function serviceTestFromServiceClass(\n    serviceClass: number\n): jdtest.ServiceTestSpec {\n    return (\n        serviceClass !== undefined &&\n        _serviceTests.find(test => test.serviceClassIdentifier === serviceClass)\n    )\n}\n","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2H6zm10 14.5V20H8v-3.5l4-4 4 4zm-4-5l-4-4V4h8v3.5l-4 4z\"\n}), 'HourglassEmpty');\n\nexports.default = _default;","import { useEffect, useState } from \"react\"\nimport { JDService } from \"../../jacdac-ts/src/jdom/service\"\nimport { JDServiceClient } from \"../../jacdac-ts/src/jdom/serviceclient\"\n\nexport default function useServiceClient<T extends JDServiceClient>(service: JDService, factory: (service: JDService) => T, deps: React.DependencyList = []) {\n    const [client, setClient] = useState<T>(undefined)\n\n    useEffect(() => {\n        const c = service && factory(service)\n        setClient(c)\n        return () => c?.unmount()\n    }, [service, ...deps]) // don't use factory in cache!\n\n    return client;\n}"],"sourceRoot":""}