{"version":3,"sources":["webpack://jacdac-docs/./src/components/EnumSpecification.tsx","webpack://jacdac-docs/./src/components/ServiceSpecification.tsx","webpack://jacdac-docs/./src/components/services/useServiceRole.ts","webpack://jacdac-docs/./src/components/services/ServiceRole.tsx","webpack://jacdac-docs/./src/components/dashboard/DashboardServiceWidgetItem.tsx","webpack://jacdac-docs/./src/components/dashboard/DashboardServiceDetails.tsx","webpack://jacdac-docs/./src/components/hooks/useIntersectionObserver.ts","webpack://jacdac-docs/./src/components/dashboard/DashboardDevice.tsx","webpack://jacdac-docs/./src/components/dashboard/DashboardDeviceItem.tsx","webpack://jacdac-docs/./src/components/hooks/useServiceProviderFromServiceClass.ts","webpack://jacdac-docs/./src/components/services/useRoleManager.ts"],"names":["EnumSpecification","props","serviceClass","spec","serviceSpecificationFromClassIdentifier","enums","Object","values","filter","en","derived","length","map","e","name","isFlags","keys","members","toString","DashboardServiceDevices","useContext","JacdacContext","bus","devices","useChange","b","device","id","ServiceSpecification","node","service","showSource","showDevices","showDerived","shortId","classIdentifier","packets","pkt","registers","isRegister","events","isEvent","commands","isCommand","reports","r","secondary","pipeReports","isPipeReport","others","indexOf","useServiceProviderFromServiceClass","reportOf","find","rep","isReportOf","pipeReportOf","isPipeReportOf","notes","short","extends","extend","i","serviceSpecificationFromName","long","note","group","sort","l","useServiceRole","useState","role","setRole","useEffect","subscribe","ROLE_CHANGE","ServiceRole","AppContext","showSelectRoleDialog","roleManager","useRoleManager","handleClick","hasRoleForService","_","DashboardServiceWidgetItem","useRegisterUnpackedValue","register","SystemReg","instanceName","float","ignoreRegisters","collapsedRegisters","DashboardServiceDetails","expanded","visible","specification","useMemo","ids","identifier","slice","reg","optional","kind","lastGetAttempts","REGISTER_OPTIONAL_POLL_COUNT","useIntersectionObserver","elementRef","options","entry","setEntry","threshold","root","rootMargin","freezeOnceVisible","frozen","isIntersecting","updateEntry","current","hasIOSupport","window","IntersectionObserver","observerParams","observer","observe","disconnect","ignoredServices","SRV_CONTROL","SRV_LOGGER","SRV_SETTINGS","SRV_PROTO_TEST","DashboardDevice","serviceFilter","toggleExpanded","variant","showAvatar","showHeader","useDeviceName","services","useDeviceSpecification","useMediaQueries","mobile","serviceGridRef","useRef","intersection","useSnackbar","enqueueSnackbar","RESTART","console","debug","ServiceWidgets","useCallback","srv","isMixin","dependencyId","padding","paddingBottom","paddingTop","serviceIndex","DashboardDeviceItem","other","drawerType","breakpoints","breakpointWeight","dashboardServiceWeight","readingRegister","valueRegister","intensityRegister","reduce","c","v","DrawerType","xs","sm","md","lg","xl","def","serviceProviderDefinitionFromServiceClass","provider","addServiceProvider","removeServiceProvider","mgr","setMgr","ROLE_MANAGER_CHANGE"],"mappings":"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","file":"4a1ae24c5787588155db61b49605b5d07aa26ddb-62b044c9b485fd1b80d6.js","sourcesContent":["import React, { Fragment } from \"react\"\nimport { serviceSpecificationFromClassIdentifier } from \"../../jacdac-ts/src/jdom/spec\"\nimport { Chip } from \"@material-ui/core\"\n\nexport default function EnumSpecification(props: { serviceClass: number }) {\n    const { serviceClass } = props\n    const spec = serviceSpecificationFromClassIdentifier(serviceClass)\n    const enums = Object.values(spec?.enums || {}).filter(en => !en.derived)\n    if (!enums.length)\n        return <></>\n\n    return <Fragment>\n        <h2>Enums</h2>\n        {enums.map(e => <Fragment key={e.name}>\n            <h3>{e.name} {e.isFlags && <Chip label=\"flags\" size=\"small\" />}</h3>\n            <ul>\n                {Object.keys(e.members).map(en => <li key={en}>{en}: <code>0x{e.members[en].toString(16)}</code></li>)}\n            </ul>\n        </Fragment>)}\n    </Fragment>\n}\n","import React, { Fragment, useContext } from \"react\"\nimport { Link } from \"gatsby-theme-material-ui\"\nimport {\n    serviceSpecificationFromName,\n    isRegister,\n    isEvent,\n    isCommand,\n    isPipeReport,\n    isReportOf,\n    isPipeReportOf,\n} from \"../../jacdac-ts/src/jdom/spec\"\nimport PacketSpecification from \"../components/PacketSpecification\"\nimport IDChip from \"./IDChip\"\nimport Markdown from \"./ui/Markdown\"\nimport EnumSpecification from \"./EnumSpecification\"\nimport { Box, Grid } from \"@material-ui/core\"\nimport ServiceSpecificationStatusAlert from \"./ServiceSpecificationStatusAlert\"\nimport useServiceProviderFromServiceClass from \"./hooks/useServiceProviderFromServiceClass\"\nimport JacdacContext, { JacdacContextProps } from \"../jacdac/Context\"\nimport useChange from \"../jacdac/useChange\"\nimport DashbardDeviceItem from \"./dashboard/DashboardDeviceItem\"\n\nfunction DashboardServiceDevices(props: { serviceClass: number }) {\n    const { serviceClass } = props\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const devices = useChange(bus, b => b.devices({ serviceClass }))\n    return (\n        <Grid container spacing={2}>\n            {devices.map(device => (\n                <DashbardDeviceItem\n                    key={device.id}\n                    device={device}\n                    showAvatar={true}\n                    showHeader={true}\n                />\n            ))}\n        </Grid>\n    )\n}\n\nexport default function ServiceSpecification(props: {\n    service: jdspec.ServiceSpec\n    showSource?: boolean\n    showDevices?: boolean\n    showDerived?: boolean\n}) {\n    const { service: node, showSource, showDevices, showDerived } = props\n    const { shortId, name, classIdentifier } = node\n    const packets = node.packets.filter(pkt => showDerived || !pkt.derived)\n    const registers = packets.filter(isRegister)\n    const events = packets.filter(isEvent)\n    const commands = packets.filter(isCommand)\n    const reports = packets.filter(r => r.secondary)\n    const pipeReports = packets.filter(isPipeReport)\n    const others = packets.filter(\n        r =>\n            registers.indexOf(r) < 0 &&\n            events.indexOf(r) < 0 &&\n            commands.indexOf(r) < 0 &&\n            reports.indexOf(r) < 0 &&\n            pipeReports.indexOf(r) < 0\n    )\n    // spin up provider on demand\n    useServiceProviderFromServiceClass(node.classIdentifier)\n\n    const reportOf = (pkt: jdspec.PacketInfo) =>\n        reports.find(rep => isReportOf(pkt, rep))\n    const pipeReportOf = (pkt: jdspec.PacketInfo) =>\n        pipeReports.find(rep => isPipeReportOf(pkt, rep))\n\n    return (\n        <Fragment key={`servicespec${shortId}`}>\n            <h1 key=\"title\">\n                {name}\n                <Box ml={1} component=\"span\">\n                    <IDChip\n                        id={node.classIdentifier}\n                        filter={`srv:${shortId}`}\n                    />\n                </Box>\n            </h1>\n            <ServiceSpecificationStatusAlert specification={node} />\n            <Markdown key=\"notesshort\" source={node.notes.short} />\n            {!!node.extends?.length && (\n                <p key=\"extends\">\n                    <span>Extends </span>\n                    {node.extends.map((extend, i) => (\n                        <Fragment key={`extend${extend}`}>\n                            {i > 0 && <span>, </span>}\n                            <Link\n                                key={`extend${extend}`}\n                                to={`/services/${extend}/`}\n                            >\n                                {serviceSpecificationFromName(extend).name}\n                            </Link>\n                        </Fragment>\n                    ))}\n                    .\n                </p>\n            )}\n            <Markdown key=\"noteslong\" source={node.notes.long || \"\"} />\n            <DashboardServiceDevices serviceClass={classIdentifier} />\n            <EnumSpecification key=\"enums\" serviceClass={classIdentifier} />\n            {[\n                {\n                    name: \"Registers\",\n                    packets: registers,\n                    note: node.notes[\"registers\"],\n                },\n                { name: \"Events\", packets: events, note: node.notes[\"events\"] },\n                {\n                    name: \"Commands\",\n                    packets: commands,\n                    note: node.notes[\"commands\"],\n                },\n                { name: \"Others\", packets: others, note: node.notes[\"others\"] },\n            ]\n                .filter(group => group.packets.length)\n                .map(group => (\n                    <Fragment key={`group${group.name}`}>\n                        <h2>{group.name}</h2>\n                        {group.note && (\n                            <Markdown\n                                key={`node${group.name}`}\n                                source={group.note}\n                            />\n                        )}\n                        {group.packets\n                            .sort(\n                                (l, r) =>\n                                    (l.derived ? 1 : -1) - (r.derived ? 1 : -1)\n                            )\n                            .map((pkt, i) => (\n                                <PacketSpecification\n                                    key={`pkt${pkt.name}`}\n                                    serviceClass={node.classIdentifier}\n                                    packetInfo={pkt}\n                                    reportInfo={reportOf(pkt)}\n                                    pipeReportInfo={pipeReportOf(pkt)}\n                                    showDevices={true}\n                                />\n                            ))}\n                    </Fragment>\n                ))}\n        </Fragment>\n    )\n}\n","import { useEffect, useState } from \"react\"\nimport { ROLE_CHANGE } from \"../../../jacdac-ts/src/jdom/constants\"\nimport { JDService } from \"../../../jacdac-ts/src/jdom/service\"\n\nexport default function useServiceRole(service: JDService) {\n    const [role, setRole] = useState<string>(service?.role);\n    useEffect(() => service?.subscribe(ROLE_CHANGE, () => {\n        setRole(service.role)\n    }), [service])\n    return role;\n}","import { Button } from \"@material-ui/core\"\nimport React, { useContext } from \"react\"\nimport { JDService } from \"../../../jacdac-ts/src/jdom/service\"\nimport useChange from \"../../jacdac/useChange\"\nimport AppContext from \"../AppContext\"\nimport useRoleManager from \"./useRoleManager\"\nimport useServiceRole from \"./useServiceRole\"\n\nexport default function ServiceRole(props: { service: JDService }) {\n    const { service } = props\n    const { showSelectRoleDialog } = useContext(AppContext)\n    const roleManager = useRoleManager()\n    const role = useServiceRole(service)\n    const handleClick = () => showSelectRoleDialog(service)\n\n    const hasRoleForService = useChange(roleManager, _ => _?.hasRoleForService(service))\n    // hide if no role manager or role not compatible with required roles\n    if (!hasRoleForService)\n        return null;\n\n    return <Button size=\"small\" onClick={handleClick}>{role || \"...\"}</Button>\n}\n","import { Grid, Typography } from \"@material-ui/core\"\nimport React from \"react\"\nimport DashboardServiceWidget, {\n    DashboardServiceProps,\n} from \"./DashboardServiceWidget\"\nimport ServiceRole from \"../services/ServiceRole\"\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\"\nimport { SystemReg } from \"../../../jacdac-ts/src/jdom/constants\"\n\nexport default function DashboardServiceWidgetItem(\n    props: React.Attributes & DashboardServiceProps\n): JSX.Element {\n    const { service } = props\n    const [instanceName] = useRegisterUnpackedValue<[number]>(\n        service.register(SystemReg.InstanceName),\n        props\n    )\n\n    return (\n        <Grid item>\n            <Grid container spacing={1} alignItems=\"center\">\n                <Grid item xs>\n                    <ServiceRole service={service} />\n                </Grid>\n                {instanceName && (\n                    <Grid item>\n                        <Typography\n                            className=\"no-pointer-events\"\n                            variant=\"caption\"\n                            component=\"span\"\n                            style={{ float: \"right\" }}\n                        >\n                            {instanceName}\n                        </Typography>\n                    </Grid>\n                )}\n            </Grid>\n            <DashboardServiceWidget {...props} />\n        </Grid>\n    )\n}\n","import React, { useMemo } from \"react\"\nimport {\n    REGISTER_OPTIONAL_POLL_COUNT,\n    SystemReg,\n} from \"../../../jacdac-ts/src/jdom/constants\"\nimport useChange from \"../../jacdac/useChange\"\nimport RegisterInput from \"../RegisterInput\"\nimport { isRegister } from \"../../../jacdac-ts/src/jdom/spec\"\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\"\nimport { Grid } from \"@material-ui/core\"\nimport { JDRegister } from \"../../../jacdac-ts/src/jdom/register\"\n\n// filter out common registers\nconst ignoreRegisters = [\n    SystemReg.StatusCode,\n    SystemReg.StreamingPreferredInterval,\n    SystemReg.StreamingSamples,\n    SystemReg.StreamingInterval,\n]\nconst collapsedRegisters = [\n    SystemReg.Reading,\n    SystemReg.Value,\n    SystemReg.Intensity,\n]\n\nexport default function DashboardServiceDetails(props: DashboardServiceProps) {\n    const { service, expanded, visible } = props\n    const specification = useChange(service, spec => spec.specification)\n    const registers: JDRegister[] = useMemo(() => {\n        const packets = specification?.packets\n        let ids =\n            packets\n                ?.filter(pkt => isRegister(pkt))\n                ?.map(pkt => pkt.identifier) || []\n        ids = ids.filter(id => ignoreRegisters.indexOf(id) < 0)\n        if (!expanded)\n            // grab the first interresting register\n            ids = ids\n                .filter(id => collapsedRegisters.indexOf(id) > -1)\n                .slice(0, 1)\n        return (\n            ids\n                .map(id => service.register(id))\n                .filter(reg => !!reg)\n                // hide optional const register without values\n                .filter(\n                    reg =>\n                        !reg.specification?.optional ||\n                        (reg.specification?.kind === \"const\" &&\n                            reg.lastGetAttempts < REGISTER_OPTIONAL_POLL_COUNT)\n                )\n        )\n    }, [specification, expanded])\n\n    if (!registers?.length)\n        // nothing to see here\n        return null\n\n    return (\n        <>\n            {registers.map(register => {\n                return (\n                    <Grid key={register.id} item xs={true}>\n                        <RegisterInput\n                            register={register}\n                            showServiceName={true}\n                            showRegisterName={true}\n                            hideMissingValues={false}\n                            showTrend={false}\n                            visible={visible}\n                        />\n                    </Grid>\n                )\n            })}\n        </>\n    )\n}\n","import { useEffect, useState, RefObject } from 'react'\n\nexport interface Args extends IntersectionObserverInit {\n  freezeOnceVisible?: boolean\n}\n\nexport default function useIntersectionObserver(\n  elementRef: RefObject<Element>,\n  options?: { freezeOnceVisible?: boolean } & IntersectionObserverInit\n): IntersectionObserverEntry | undefined {\n  const [entry, setEntry] = useState<IntersectionObserverEntry>()\n  const { threshold = 0, root = null, rootMargin = '0%', freezeOnceVisible } = options || {};\n\n  const frozen = entry?.isIntersecting && freezeOnceVisible\n\n  const updateEntry = ([entry]: IntersectionObserverEntry[]): void => {\n    setEntry(entry)\n  }\n\n  useEffect(() => {\n    const node = elementRef?.current // DOM Ref\n    const hasIOSupport = !!window.IntersectionObserver\n\n    if (!hasIOSupport || frozen || !node) return\n\n    const observerParams = { threshold, root, rootMargin }\n    const observer = new IntersectionObserver(updateEntry, observerParams)\n\n    //console.log(`observe`, { node })\n    observer.observe(node)\n\n    return () => observer.disconnect()\n\n  }, [elementRef, threshold, root, rootMargin, frozen])\n\n  return entry\n}\n","import {\n    Card,\n    CardContent,\n    CardHeader,\n    Grid,\n    Paper,\n    Typography,\n} from \"@material-ui/core\"\nimport React, { useCallback, useEffect, useRef } from \"react\"\nimport {\n    RESTART,\n    SRV_CONTROL,\n    SRV_LOGGER,\n    SRV_PROTO_TEST,\n    SRV_SETTINGS,\n} from \"../../../jacdac-ts/src/jdom/constants\"\nimport { JDDevice } from \"../../../jacdac-ts/src/jdom/device\"\nimport useChange from \"../../jacdac/useChange\"\nimport DeviceName from \"../devices/DeviceName\"\nimport IconButtonWithTooltip from \"../ui/IconButtonWithTooltip\"\n// tslint:disable-next-line: no-submodule-imports match-default-export-name\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\"\n// tslint:disable-next-line: no-submodule-imports match-default-export-name\nimport ExpandLessIcon from \"@material-ui/icons/ExpandLess\"\nimport useDeviceSpecification from \"../../jacdac/useDeviceSpecification\"\nimport DeviceAvatar from \"../devices/DeviceAvatar\"\nimport DashboardServiceWidgetItem from \"./DashboardServiceWidgetItem\"\nimport DeviceActions from \"../DeviceActions\"\nimport DashboardServiceDetails from \"./DashboardServiceDetails\"\nimport useDeviceName from \"../devices/useDeviceName\"\nimport { DashboardDeviceProps } from \"./Dashboard\"\nimport useIntersectionObserver from \"../hooks/useIntersectionObserver\"\nimport { dependencyId } from \"../../../jacdac-ts/src/jdom/node\"\nimport useMediaQueries from \"../hooks/useMediaQueries\"\nimport { useSnackbar } from \"notistack\"\n\nconst ignoredServices = [SRV_CONTROL, SRV_LOGGER, SRV_SETTINGS, SRV_PROTO_TEST]\n\nexport default function DashboardDevice(\n    props: {\n        device: JDDevice\n        expanded?: boolean\n        toggleExpanded?: () => void\n        variant?: \"icon\" | \"\"\n    } & DashboardDeviceProps\n) {\n    const {\n        device,\n        serviceFilter,\n        expanded,\n        toggleExpanded,\n        variant,\n        showAvatar,\n        showHeader,\n    } = props\n    const name = useDeviceName(device)\n    const services = useChange(device, () =>\n        device\n            .services({ specification: true })\n            .filter(\n                service => ignoredServices.indexOf(service.serviceClass) < 0\n            )\n    )\n    const specification = useDeviceSpecification(device)\n    const { mobile } = useMediaQueries()\n    const serviceGridRef = useRef<HTMLDivElement>()\n    const intersection = useIntersectionObserver(serviceGridRef)\n    const visible = !!intersection?.isIntersecting\n    const { enqueueSnackbar } = useSnackbar()\n\n    useEffect(() =>\n        device?.subscribe(RESTART, () => {\n            console.debug(`${device.shortId} restarted...`)\n            enqueueSnackbar(`${device.shortId} restarted...`, {\n                variant: \"warning\",\n            })\n        })\n    )\n\n    const ServiceWidgets = useCallback(\n        () => (\n            <Grid\n                ref={serviceGridRef}\n                component=\"div\"\n                container\n                spacing={2}\n                justify=\"center\"\n                alignItems=\"flex-end\"\n                alignContent=\"space-between\"\n            >\n                {services\n                    ?.filter(srv => expanded || !srv.isMixin)\n                    ?.filter(srv => !serviceFilter || serviceFilter(srv))\n                    ?.map(service => (\n                        <DashboardServiceWidgetItem\n                            key={service.id}\n                            service={service}\n                            expanded={expanded}\n                            services={services}\n                            variant={variant}\n                            visible={visible}\n                        />\n                    ))}\n            </Grid>\n        ),\n        [dependencyId(services), expanded, variant, visible]\n    )\n\n    if (!showHeader)\n        return (\n            <Paper style={{ padding: \"0.25em\" }} variant=\"outlined\">\n                <ServiceWidgets />\n            </Paper>\n        )\n\n    return (\n        <Card aria-live=\"polite\" aria-label={`device ${name} started`}>\n            <CardHeader\n                style={{ paddingBottom: 0 }}\n                avatar={showAvatar && <DeviceAvatar device={device} />}\n                action={\n                    <DeviceActions\n                        device={device}\n                        showStop={expanded}\n                        hideIdentity={!expanded}\n                        showReset={expanded && !mobile}\n                        showSettings={expanded && !mobile}\n                    >\n                        {toggleExpanded && (\n                            <IconButtonWithTooltip\n                                onClick={toggleExpanded}\n                                title={expanded ? \"Collapse\" : \"Expand\"}\n                            >\n                                {expanded ? (\n                                    <ExpandLessIcon />\n                                ) : (\n                                    <ExpandMoreIcon />\n                                )}\n                            </IconButtonWithTooltip>\n                        )}\n                    </DeviceActions>\n                }\n                title={<DeviceName showShortId={false} device={device} />}\n                subheader={\n                    <>\n                        {!mobile && specification && (\n                            <Typography variant=\"caption\" gutterBottom>\n                                {specification.name}\n                            </Typography>\n                        )}\n                    </>\n                }\n            />\n            <CardContent style={{ paddingTop: 0 }}>\n                <ServiceWidgets />\n                {expanded && (\n                    <Grid\n                        container\n                        direction=\"column\"\n                        spacing={1}\n                        alignContent=\"stretch\"\n                    >\n                        {services?.map(service => (\n                            <DashboardServiceDetails\n                                key={\"details\" + service.serviceIndex}\n                                service={service}\n                                services={services}\n                                expanded={expanded}\n                                variant={variant}\n                                visible={visible}\n                            />\n                        ))}\n                    </Grid>\n                )}\n            </CardContent>\n        </Card>\n    )\n}\n","import { Grid } from \"@material-ui/core\";\nimport React, { useContext } from \"react\";\nimport { JDDevice } from \"../../../jacdac-ts/src/jdom/device\";\nimport DashboardDevice from \"./DashboardDevice\";\nimport { GridBreakpoints } from \"../useGridBreakpoints\";\nimport { DashboardDeviceProps } from \"./Dashboard\";\nimport useChange from \"../../jacdac/useChange\";\nimport { dashboardServiceWeight } from \"./DashboardServiceWidget\";\nimport AppContext, { DrawerType } from \"../AppContext\";\n\nexport default function DashboardDeviceItem(props: {\n    device: JDDevice,\n    expanded?: boolean,\n    toggleExpanded?: () => void,\n    variant?: \"icon\" | \"\"\n} & DashboardDeviceProps) {\n    const { device, expanded, toggleExpanded, variant, ...other } = props;\n    const { drawerType } = useContext(AppContext)\n    const breakpoints: GridBreakpoints = useChange(device, () => {\n        const breakpointWeight = device.services()\n            .map(srv => {\n                return dashboardServiceWeight(srv)\n                    || (srv.readingRegister || srv.valueRegister || srv.intensityRegister ? 1 : 0)\n            })\n            .reduce((c: number, v) => c + v, 0);\n\n        if (breakpointWeight > 3 || drawerType !== DrawerType.None)\n            return { xs: 12, sm: 12, md: 12, lg: 6, xl: 6 };\n        else if (breakpointWeight == 3)\n            return { xs: 12, sm: 12, md: 4, lg: 4, xl: 4 };\n        else if (breakpointWeight == 2)\n            return { xs: 12, sm: 6, md: 4, lg: 3, xl: 4 };\n        else\n            return { xs: expanded ? 12 : 6, sm: 4, md: 3, lg: 2, xl: \"auto\" };\n    }, [expanded, drawerType]);\n\n    // based on size, expanded or reduce widget size\n    return <Grid item {...breakpoints}>\n        <DashboardDevice\n            device={device}\n            expanded={expanded}\n            toggleExpanded={toggleExpanded}\n            variant={variant}\n            {...other}\n        />\n    </Grid>\n}","import { useContext, useEffect } from \"react\"\nimport {\n    addServiceProvider,\n    serviceProviderDefinitionFromServiceClass,\n} from \"../../../jacdac-ts/src/servers/servers\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\n\nexport default function useServiceProviderFromServiceClass(\n    serviceClass: number\n): void {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n\n    // run once\n    useEffect(() => {\n        const devices = bus.devices({ serviceClass })\n        const def =\n            !devices.length && serviceProviderDefinitionFromServiceClass(serviceClass)\n        const provider = def && addServiceProvider(bus, def)\n        return () => bus.removeServiceProvider(provider)\n    }, [serviceClass])\n}\n","import { useContext, useEffect, useState } from \"react\"\nimport { ROLE_MANAGER_CHANGE } from \"../../../jacdac-ts/src/jdom/constants\"\nimport { RoleManagerClient } from \"../../../jacdac-ts/src/jdom/rolemanagerclient\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\n\nexport default function useRoleManager(): RoleManagerClient {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const [mgr, setMgr] = useState<RoleManagerClient>(bus.roleManager)\n    useEffect(() =>\n        bus.subscribe(ROLE_MANAGER_CHANGE, () => setMgr(bus.roleManager))\n    )\n    return mgr\n}\n"],"sourceRoot":""}