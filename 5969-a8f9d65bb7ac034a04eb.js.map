{"version":3,"sources":["webpack://jacdac-docs/./node_modules/@material-ui/icons/Clear.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/Keyboard.js","webpack://jacdac-docs/./src/components/dashboard/DashboardHIDKeyboard.tsx","webpack://jacdac-docs/./src/components/ui/KeyboardKeyInput.tsx"],"names":["DashboardHIDKeyboard","props","service","useState","selector","setSelector","HidKeyboardModifiers","modifiers","setModifiers","handleKeyChange","newSelector","newModifiers","handleClear","sendCmdAsync","HidKeyboardCmd","handleClick","unpacked","HidKeyboardAction","data","jdpack","disabled","useStyles","makeStyles","theme","createStyles","capture","cursor","borderColor","palette","primary","main","action","active","darkKeyboard","backgroundColor","color","background","dark","keyboard","KeyboardKeyInput","initialSelector","initialModifiers","onChange","uncontrolled","useMemo","undefined","selector_","setSelector_","modifiers_","setModifiters_","useContext","DarkModeContext","darkMode","keyboardRef","useRef","classes","keyboardId","useId","layout","default","display","handleKeyboardKeyPress","code","toLowerCase","replace","msel","selectors","mcode","modifierCodes","useEffect","console","warn","value","renderKeyboardKey","current","addButtonTheme","removeButtonTheme","r"],"mappings":"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","file":"5969-a8f9d65bb7ac034a04eb.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"\n}), 'Clear');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z\"\n}), 'Keyboard');\n\nexports.default = _default;","import React, { useState } from \"react\"\nimport { Grid } from \"@material-ui/core\"\nimport {\n    HidKeyboardAction,\n    HidKeyboardCmd,\n    HidKeyboardModifiers,\n} from \"../../../jacdac-ts/jacdac-spec/dist/specconstants\"\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\"\nimport { jdpack } from \"../../../jacdac-ts/src/jdom/pack\"\nimport CmdButton from \"../CmdButton\"\nimport ClearIcon from \"@material-ui/icons/Clear\"\nimport KeyboardKeyInput from \"../ui/KeyboardKeyInput\"\nimport KeyboardIcon from \"@material-ui/icons/Keyboard\"\nexport default function DashboardHIDKeyboard(props: DashboardServiceProps) {\n    const { service } = props\n    const [selector, setSelector] = useState(0)\n    const [modifiers, setModifiers] = useState(HidKeyboardModifiers.None)\n\n    const handleKeyChange = (\n        newSelector: number,\n        newModifiers: HidKeyboardModifiers\n    ) => {\n        setSelector(newSelector)\n        setModifiers(newModifiers)\n    }\n\n    const handleClear = async () => {\n        setSelector(0)\n        setModifiers(HidKeyboardModifiers.None)\n        await service.sendCmdAsync(HidKeyboardCmd.Clear)\n    }\n\n    const handleClick = async () => {\n        const unpacked: [[number, HidKeyboardModifiers, HidKeyboardAction][]] =\n            [[[selector, modifiers, HidKeyboardAction.Press]]]\n        const data = jdpack(\"r: u16 u8 u8\", unpacked)\n        await service.sendCmdAsync(HidKeyboardCmd.Key, data)\n    }\n\n    const disabled = !selector && !modifiers\n\n    return (\n        <Grid container direction=\"column\" spacing={1}>\n            <Grid item xs={12}>\n                <KeyboardKeyInput\n                    selector={selector}\n                    modifiers={modifiers}\n                    onChange={handleKeyChange}\n                />\n            </Grid>\n            <Grid item xs={12}>\n                <CmdButton\n                    title=\"send keys\"\n                    disabled={disabled}\n                    onClick={handleClick}\n                    icon={<KeyboardIcon />}\n                />\n                <CmdButton\n                    title=\"clear keys\"\n                    disabled={disabled}\n                    onClick={handleClear}\n                    icon={<ClearIcon />}\n                />\n            </Grid>\n        </Grid>\n    )\n}\n","import React, { useContext, useEffect, useMemo, useRef, useState } from \"react\"\nimport { createStyles, makeStyles } from \"@material-ui/core\"\nimport { HidKeyboardModifiers } from \"../../../jacdac-ts/jacdac-spec/dist/specconstants\"\nimport Keyboard from \"react-simple-keyboard\"\nimport \"react-simple-keyboard/build/css/index.css\"\nimport DarkModeContext from \"./DarkModeContext\"\nimport { useId } from \"react-use-id-hook\"\nimport {\n    modifierCodes,\n    renderKeyboardKey,\n    selectors,\n} from \"../../../jacdac-ts/src/servers/hidkeyboardserver\"\n\nconst useStyles = makeStyles(theme =>\n    createStyles({\n        capture: {\n            cursor: \"pointer\",\n            \"&:hover\": {\n                borderColor: theme.palette.primary.main,\n            },\n            \"&:focus\": {\n                borderColor: theme.palette.action.active,\n            },\n        },\n        darkKeyboard: {\n            backgroundColor: \"#333 !important\",\n            borderColor: \"#777 !important\",\n            color: \"white !important\",\n            \"& .hg-button\": {\n                background: \"rgba(0, 0, 0, 0.5) !important\",\n                color: \"white\",\n            },\n            \"& .hg-button.buttonSelected\": {\n                background: `${theme.palette.primary.dark} !important`,\n                color: \"white !important\",\n            },\n        },\n        keyboard: {\n            \"& .buttonSelected\": {\n                background: `${theme.palette.primary.dark} !important`,\n                color: \"white !important\",\n            },\n        },\n    })\n)\n\nexport default function KeyboardKeyInput(props: {\n    initialSelector?: number\n    initialModifiers?: HidKeyboardModifiers\n    selector?: number\n    modifiers?: HidKeyboardModifiers\n    onChange: (newSelector: number, newModifiers: HidKeyboardModifiers) => void\n}) {\n    const { initialSelector, initialModifiers, selector, modifiers, onChange } =\n        props\n    const uncontrolled = useMemo(\n        () => selector === undefined || modifiers === undefined,\n        []\n    )\n    const [selector_, setSelector_] = useState<number>(initialSelector || 0)\n    const [modifiers_, setModifiters_] = useState<HidKeyboardModifiers>(\n        initialModifiers || HidKeyboardModifiers.None\n    )\n    const { darkMode } = useContext(DarkModeContext)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const keyboardRef = useRef<any>()\n    const classes = useStyles()\n    const theme = `hg-theme-default hg-layout-default ${\n        darkMode === \"dark\" ? classes.darkKeyboard : classes.keyboard\n    }`\n    const keyboardId = useId()\n\n    const layout = {\n        default: [\n            \"{escape} {f1} {f2} {f3} {f4} {f5} {f6} {f7} {f8} {f9} {f10} {f11} {f12}\",\n            \"` 1 2 3 4 5 6 7 8 9 0 - = {backspace}\",\n            \"{tab} q w e r t y u i o p [ ] \\\\\",\n            \"{capslock} a s d f g h j k l ; ' {enter}\",\n            \"{shiftleft} z x c v b n m , . / {shiftright}\",\n            \"{controlleft} {altleft} {metaleft} {space} {metaright} {altright}\",\n        ],\n    }\n    const display = {\n        \"{escape}\": \"esc ⎋\",\n        \"{tab}\": \"tab ⇥\",\n        \"{backspace}\": \"backspace ⌫\",\n        \"{enter}\": \"enter ↵\",\n        \"{capslock}\": \"caps lock ⇪\",\n        \"{shiftleft}\": \"shift ⇧\",\n        \"{shiftright}\": \"shift ⇧\",\n        \"{controlleft}\": \"ctrl ⌃\",\n        \"{controlright}\": \"ctrl ⌃\",\n        \"{altleft}\": \"alt ⌥\",\n        \"{altright}\": \"alt ⌥\",\n        \"{metaleft}\": \"cmd ⌘\",\n        \"{metaright}\": \"cmd ⌘\",\n    }\n    const handleKeyboardKeyPress = (code: string) => {\n        code = code.toLowerCase().replace(/[{}]/g, \"\")\n        let newSelector = selector_\n        let newModifiers = modifiers_\n        const msel = selectors[code]\n        const mcode = modifierCodes[code]\n        if (msel) {\n            if (msel === selector) newSelector = undefined\n            else newSelector = msel\n        } else {\n            if (mcode) {\n                if (newModifiers & mcode) newModifiers &= ~mcode\n                else newModifiers |= mcode\n            }\n        }\n        setSelector_(newSelector)\n        setModifiters_(newModifiers)\n        onChange(newSelector, newModifiers)\n    }\n\n    // update external values\n    useEffect(() => {\n        if (selector !== undefined) {\n            if (uncontrolled)\n                console.warn(`trying to set an uncontrolled selector`)\n            setSelector_(selector)\n        }\n    }, [selector])\n    useEffect(() => {\n        if (modifiers !== undefined) {\n            if (uncontrolled)\n                console.warn(`trying to set an uncontrolled modifier`)\n            setModifiters_(modifiers)\n        }\n    }, [modifiers])\n\n    const value = renderKeyboardKey(selector_, modifiers_, false)\n    useEffect(() => {\n        keyboardRef.current?.addButtonTheme(value, \"buttonSelected\")\n        return () =>\n            keyboardRef.current?.removeButtonTheme(value, \"buttonSelected\")\n    }, [value])\n\n    return (\n        <Keyboard\n            baseClass={keyboardId}\n            keyboardRef={r => (keyboardRef.current = r)}\n            onKeyPress={handleKeyboardKeyPress}\n            layout={layout}\n            theme={theme}\n            display={display}\n            mergeDisplay={true}\n        />\n    )\n}\n"],"sourceRoot":""}