{"version":3,"sources":["webpack:///./src/components/dashboard/DashboardLED.tsx"],"names":["DashboardLED","props","useContext","JacdacContext","bus","service","services","variant","host","useServiceHost","color","brightnessRegister","register","LedReg","Brightness","useRegisterUnpackedValue","brightness","animationData","Animation","WaveLength","waveLength","LedCount","ledCount","animation","useMemo","LedAnimation","useAnimationFrame","update","timestamp","hsv","useChange","a","handleBrightnessChange","ev","newValue","sendSetPackedAsync","undefined","opacity","fill","hsvToCss","ln","Math","min","lw","m","w","h","Array","map","_","i"],"mappings":"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","file":"115-b100646a226513af76a1.js","sourcesContent":["import React, { useContext, useMemo } from \"react\"\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\"\nimport useWidgetSize from \"../widgets/useWidgetSize\"\nimport useServiceHost from \"../hooks/useServiceHost\"\nimport SvgWidget from \"../widgets/SvgWidget\"\nimport useWidgetTheme from \"../widgets/useWidgetTheme\"\nimport useChange from \"../../jacdac/useChange\"\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\"\nimport useAnimationFrame from \"../hooks/useAnimationFrame\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport { Grid, Slider } from \"@material-ui/core\"\nimport LEDServiceHost, {\n    LedAnimation,\n    LedAnimationData,\n} from \"../../../jacdac-ts/src/hosts/ledservicehost\"\nimport { LedReg } from \"../../../jacdac-ts/src/jdom/constants\"\nimport { hsvToCss } from \"../../../jacdac-ts/src/jdom/color\"\nimport LoadingProgress from \"../ui/LoadingProgress\"\n\nexport default function DashboardLED(props: DashboardServiceProps) {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { service, services, variant } = props\n    const host = useServiceHost<LEDServiceHost>(service)\n    const color = host ? \"secondary\" : \"primary\"\n    const brightnessRegister = service.register(LedReg.Brightness)\n    const [brightness] = useRegisterUnpackedValue<[number]>(brightnessRegister)\n    const animationData = useRegisterUnpackedValue<LedAnimationData>(\n        service.register(LedReg.Animation)\n    )\n    const [waveLength] = useRegisterUnpackedValue<[number]>(\n        service.register(LedReg.WaveLength)\n    )\n    const [ledCount] = useRegisterUnpackedValue<[number]>(\n        service.register(LedReg.LedCount)\n    )\n\n    // restart animation with steps\n    const animation = useMemo(() => new LedAnimation(animationData), [\n        animationData,\n    ])\n    // animate\n    useAnimationFrame(() => {\n        animation.update(bus.timestamp)\n        return true\n    }, [animation])\n\n    const hsv = useChange(animation, a => a?.hsv)\n\n    const handleBrightnessChange = async (\n        ev: unknown,\n        newValue: number | number[]\n    ) => {\n        await brightnessRegister.sendSetPackedAsync(\n            \"u0.16\",\n            [newValue as number],\n            true\n        )\n    }\n\n    // nothing to see\n    if (hsv === undefined) return <LoadingProgress />\n\n    const opacity = brightness\n    const fill = hsvToCss(\n        hsv[0],\n        hsv[1],\n        hsv[2],\n        brightness * 0xff,\n        waveLength !== undefined\n    )\n\n    const ln = Math.min(ledCount || 1, 5)\n    const lw = 15.5\n    const m = 1\n    const w = (lw + m) * ln\n    const h = 42\n    return (\n        <Grid container spacing={1}>\n            <Grid item xs={12}>\n                <SvgWidget width={w} height={h} size={\"5em\"}>\n                    {Array(ln)\n                        .fill(0)\n                        .map((_, i) => (\n                            <g\n                                key={i}\n                                transform={`translate(${i * (lw + m)}, 0)`}\n                            >\n                                <path\n                                    fill=\"#999\"\n                                    d=\"M14.2 13V7.1C14.2 3.2 11 0 7.1 0 3.2 0 0 3.2 0 7.1v13.7c1.9 1.9 4.4 2.9 7.1 2.8 4.6 0 8.4-2.6 8.4-5.9v-1.5c0-1.2-.5-2.3-1.3-3.2z\"\n                                    opacity=\".65\"\n                                />\n                                <path\n                                    fill=\"#8c8c8c\"\n                                    d=\"M2.8 17.5l-1.2-1.4h1L5 17.5v18.6c0 .3-.5.5-1.1.5-.6 0-1.1-.2-1.1-.5zm10.1 6.7c0-.7-1.1-1.3-2.1-1.8-.4-.2-1.2-.6-1.2-.9v-3.4l2.5-2h-.9l-3.7 2v3.5c0 .7.9 1.2 1.9 1.7.4.2 1.3.8 1.3 1.1v16.9c0 .4.5.7 1.1.7.6 0 1.1-.3 1.1-.7z\"\n                                />\n                                <path\n                                    opacity={opacity}\n                                    fill={fill}\n                                    d=\"M14.2 13V7.1C14.2 3.2 11 0 7.1 0 3.2 0 0 3.2 0 7.1v13.7c1.9 1.9 4.4 2.9 7.1 2.8 4.6 0 8.4-2.6 8.4-5.9v-1.5c0-1.2-.5-2.3-1.3-3.2z\"\n                                />\n                                <path\n                                    fill=\"#d1d1d1\"\n                                    d=\"M14.2 13v3.1c0 2.7-3.2 5-7.1 5-3.9 0-7.1-2.2-7.1-5v4.6c1.9 1.9 4.4 2.9 7.1 2.8 4.6 0 8.4-2.6 8.4-5.9v-1.5c0-1.1-.5-2.2-1.3-3.1z\"\n                                    opacity=\".9\"\n                                />\n                                <path\n                                    fill=\"#e6e6e6\"\n                                    d=\"M14.2 13v3.1c0 2.7-3.2 5-7.1 5-3.9 0-7.1-2.2-7.1-5v4.6c1.9 1.9 4.4 2.9 7.1 2.8 4.6 0 8.4-2.6 8.4-5.9v-1.5c0-1.1-.5-2.2-1.3-3.1z\"\n                                    opacity=\".7\"\n                                />\n                                <path\n                                    fill=\"#e6e6e6\"\n                                    d=\"M14.2 13v3.1c0 2.7-3.2 5-7.1 5-3.9 0-7.1-2.2-7.1-5v3.1c1.9 1.9 4.4 2.9 7.1 2.8 4.6 0 8.4-2.6 8.4-5.9 0-1.1-.5-2.2-1.3-3.1z\"\n                                    opacity=\".25\"\n                                />\n                                <ellipse\n                                    cx=\"-7.2\"\n                                    cy=\"-16.1\"\n                                    fill=\"#e6e6e6\"\n                                    opacity=\".25\"\n                                    rx=\"7.1\"\n                                    ry=\"5\"\n                                    transform=\"scale(-1)\"\n                                />\n                                <ellipse\n                                    cx=\"-7.2\"\n                                    cy=\"-16.1\"\n                                    fill=\"#e6e6e6\"\n                                    opacity=\".25\"\n                                    rx=\"7.1\"\n                                    ry=\"5\"\n                                    transform=\"scale(-1)\"\n                                />\n                                <path\n                                    opacity=\".61\"\n                                    fill=\"#fff\"\n                                    d=\"M7.2 22c-4.3 0-6.1-2-6.1-2l.7-.7S3.4 21 7.2 21c2.4.1 4.7-.9 6.3-2.7l.8.6C12.4 21 9.9 22.1 7.2 22z\"\n                                />\n                                <path\n                                    opacity=\".61\"\n                                    fill=\"#fff\"\n                                    d=\"M2.6 3.2C1.5 4.3.9 5.8.9 7.4v10.3l1.9 1.5V8.8c-.9-2.8-.3-4.2.7-5.2-.3-.1-.6-.2-.9-.4zm7.3-1.6l-.3.9c1.5.7 2.6 2.1 2.8 3.7h1c-.3-2-1.6-3.7-3.5-4.6z\"\n                                />\n                            </g>\n                        ))}\n                </SvgWidget>\n            </Grid>\n            {brightness !== undefined && (\n                <Grid item xs>\n                    <Slider\n                        min={0}\n                        max={1}\n                        step={0.01}\n                        color={color}\n                        valueLabelDisplay=\"off\"\n                        value={brightness}\n                        onChange={handleBrightnessChange}\n                    />\n                </Grid>\n            )}\n        </Grid>\n    )\n}\n"],"sourceRoot":""}