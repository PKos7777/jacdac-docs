{"version":3,"file":"1931-5e6099e3495df8a16d10.js","mappings":"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","sources":["webpack://jacdac-docs/./src/jacdac/useServiceClient.ts","webpack://jacdac-docs/./jacdac-ts/src/clients/azureiothubhealthclient.ts","webpack://jacdac-docs/./src/components/dashboard/DashboardAzureIoTHubHealth.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\"\nimport JDService from \"../../jacdac-ts/src/jdom/service\"\nimport { JDServiceClient } from \"../../jacdac-ts/src/jdom/serviceclient\"\n\nexport default function useServiceClient<\n    TServiceClient extends JDServiceClient\n>(service: JDService, factory: (service: JDService) => TServiceClient) {\n    const [client, setClient] = useState<TServiceClient>(undefined)\n\n    useEffect(() => {\n        const c = service && factory(service)\n        setClient(c)\n        return () => c?.unmount()\n    }, [service, factory])\n\n    return client\n}\n","import {\n    AzureIotHubHealthCmd,\n    AzureIotHubHealthConnectionStatus,\n    AzureIotHubHealthEvent,\n    AzureIotHubHealthReg,\n    CHANGE,\n    EVENT,\n    REPORT_UPDATE,\n    SRV_AZURE_IOT_HUB_HEALTH,\n} from \"../jdom/constants\"\nimport { jdpack } from \"../jdom/pack\"\nimport JDRegister from \"../jdom/register\"\nimport JDService from \"../jdom/service\"\nimport { JDServiceClient } from \"../jdom/serviceclient\"\nimport { parseDeviceId } from \"../jdom/spec\"\nimport { assert } from \"../jdom/utils\"\n\nexport class AzureIoTHubHealthClient extends JDServiceClient {\n    readonly connectionStatusRegister: JDRegister\n    readonly statisticsRegister: JDRegister\n\n    constructor(service: JDService) {\n        super(service)\n        assert(service.serviceClass === SRV_AZURE_IOT_HUB_HEALTH)\n\n        // tell the bus to refresh these register\n        this.connectionStatusRegister = this.service.register(\n            AzureIotHubHealthReg.ConnectionStatus\n        )\n        this.statisticsRegister = this.service.register(\n            AzureIotHubHealthReg.Statistics\n        )\n        this.mount(() =>\n            this.connectionStatusRegister.subscribe(REPORT_UPDATE, () =>\n                this.emit(CHANGE)\n            )\n        )\n        this.mount(() =>\n            this.statisticsRegister.subscribe(REPORT_UPDATE, () =>\n                this.emit(CHANGE)\n            )\n        )\n        this.mount(() =>\n            this.service\n                .event(AzureIotHubHealthEvent.ConnectionStatusChange)\n                .on(EVENT, () => {\n                    this.connectionStatusRegister.refresh()\n                    this.emit(CHANGE)\n                })\n        )\n    }\n\n    get hub() {\n        const reg = this.service.register(AzureIotHubHealthReg.Hub)\n        reg.refresh(true)\n        return reg.stringValue\n    }\n\n    get connectionStatus(): AzureIotHubHealthConnectionStatus {\n        const reg = this.connectionStatusRegister\n        return reg.unpackedValue[0] as AzureIotHubHealthConnectionStatus\n    }\n\n    get statistics() {\n        const [reading, event, twinReported, twinDesired] =\n            this.statisticsRegister.unpackedValue\n        return {\n            reading,\n            event,\n            twinReported,\n            twinDesired,\n        }\n    }\n\n    async connect() {\n        await this.service.sendCmdAsync(\n            AzureIotHubHealthCmd.Connect,\n            undefined,\n            true\n        )\n    }\n\n    async disconnect() {\n        await this.service.sendCmdAsync(\n            AzureIotHubHealthCmd.Disconnect,\n            undefined,\n            true\n        )\n    }\n\n    async identify(deviceId: string) {\n        await this.service.sendCmdAsync(\n            AzureIotHubHealthCmd.Identify,\n            parseDeviceId(deviceId),\n            true\n        )\n    }\n\n    async reset(deviceId: string) {\n        await this.service.sendCmdAsync(\n            AzureIotHubHealthCmd.Reset,\n            parseDeviceId(deviceId),\n            true\n        )\n    }\n\n    async ping(value: number) {\n        const data = jdpack<[number]>(\"u32\", [value])\n        await this.service.sendCmdAsync(AzureIotHubHealthCmd.Ping, data, true)\n    }\n}\nexport default AzureIoTHubHealthClient\n","import React from \"react\"\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\"\nimport { Grid, Switch, Typography } from \"@material-ui/core\"\nimport useChange from \"../../jacdac/useChange\"\nimport useServiceClient from \"../../jacdac/useServiceClient\"\nimport AzureIoTHubHealthClient from \"../../../jacdac-ts/src/clients/azureiothubhealthclient\"\nimport useWidgetTheme from \"../widgets/useWidgetTheme\"\nimport { AzureIotHubHealthConnectionStatus } from \"../../../jacdac-ts/jacdac-spec/dist/specconstants\"\nimport { useId } from \"react-use-id-hook\"\n\nexport default function DashboardAzureIoTHubHealth(\n    props: DashboardServiceProps\n) {\n    const { service } = props\n    const connectId = useId()\n\n    const client = useServiceClient(\n        service,\n        () => new AzureIoTHubHealthClient(service)\n    )\n    const hub = useChange(client, _ => _?.hub)\n    const connectionStatus = useChange(client, _ => _?.connectionStatus)\n    const color = \"primary\"\n    const { textPrimary } = useWidgetTheme(color)\n    const connected =\n        connectionStatus === AzureIotHubHealthConnectionStatus.Connected\n\n    return (\n        <Grid\n            container\n            spacing={1}\n            style={{ color: textPrimary, minWidth: \"16rem\" }}\n        >\n            <Grid item xs={12}>\n                <Typography component=\"span\" variant=\"subtitle1\">\n                    hub: {hub}\n                </Typography>\n                <Switch checked={connected} aria-labelledby={connectId} />\n                <label className=\".no-pointer-events\" id={connectId}>\n                    {AzureIotHubHealthConnectionStatus[connectionStatus]}\n                </label>\n            </Grid>\n        </Grid>\n    )\n}\n"],"names":["useEffect","useState","useServiceClient","service","factory","client","setClient","undefined","c","unmount","AzureIotHubHealthCmd","AzureIotHubHealthEvent","AzureIotHubHealthReg","CHANGE","EVENT","REPORT_UPDATE","SRV_AZURE_IOT_HUB_HEALTH","jdpack","JDServiceClient","parseDeviceId","assert","AzureIoTHubHealthClient","serviceClass","connectionStatusRegister","register","ConnectionStatus","statisticsRegister","Statistics","mount","subscribe","emit","event","ConnectionStatusChange","on","refresh","connect","sendCmdAsync","Connect","disconnect","Disconnect","identify","deviceId","Identify","reset","Reset","ping","value","data","Ping","reg","Hub","stringValue","unpackedValue","reading","twinReported","twinDesired","React","Grid","Switch","Typography","useChange","useWidgetTheme","AzureIotHubHealthConnectionStatus","useId","DashboardAzureIoTHubHealth","props","connectId","hub","_","connectionStatus","color","textPrimary","connected","Connected","minWidth"],"sourceRoot":""}