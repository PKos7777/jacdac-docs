{"version":3,"sources":["webpack:///./src/components/dashboard/DashboardArcadeGamepad.tsx"],"names":["buttonLabels","ArcadeGamepadButton","Left","Up","Down","Right","ArcadeButton","props","cx","cy","ro","color","pressure","ri","button","host","onRefresh","useWidgetTheme","textProps","active","background","controlBackground","checked","title","label","handleDown","down","handleUp","up","buttonProps","useSvgButtonProps","DashboardArcadeGamepad","service","services","variant","useRegisterUnpackedValue","register","ArcadeGamepadReg","AvailableButtons","available","pressedRegister","Buttons","pressed","useServiceHost","length","w","h","cw","ch","sro","sri","scy","pos","small","A","B","Menu","Select","Exit","Reset","handleRefresh","refresh","abx","aby","abr","abw","map","find","p"],"mappings":"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","file":"110-a9a3f29efd587d83c112.js","sourcesContent":["\nimport React from \"react\";\nimport { ArcadeGamepadButton, ArcadeGamepadReg } from \"../../../jacdac-ts/src/jdom/constants\";\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\";\nimport { useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\";\nimport SvgWidget from \"../widgets/SvgWidget\";\nimport useWidgetSize from \"../widgets/useWidgetSize\";\nimport useServiceHost from \"../hooks/useServiceHost\";\nimport useWidgetTheme from \"../widgets/useWidgetTheme\";\nimport ArcadeGamepadServiceHost from \"../../../jacdac-ts/src/hosts/arcadegamepadservicehost\";\nimport useSvgButtonProps from \"../hooks/useSvgButtonProps\";\nimport LoadingProgress from \"../ui/LoadingProgress\";\n\nconst buttonLabels = {\n    [ArcadeGamepadButton.Left]: \"\\u25C0\",\n    [ArcadeGamepadButton.Up]: \"\\u25B2\",\n    [ArcadeGamepadButton.Down]: \"\\u25BC\",\n    [ArcadeGamepadButton.Right]: \"\\u25B6\",\n}\n\nfunction ArcadeButton(props: {\n    cx: number,\n    cy: number,\n    ro: number,\n    ri: number,\n    pressure: number,\n    button: ArcadeGamepadButton,\n    host: ArcadeGamepadServiceHost,\n    onRefresh: () => void,\n    color?: \"primary\" | \"secondary\"\n}) {\n    const { cx, cy, ro, color, pressure, ri, button, host, onRefresh } = props;\n    const { textProps, active, background, controlBackground } = useWidgetTheme(color);\n    const checked = (pressure || 0) > 0;\n    const title = ArcadeGamepadButton[button]\n    const label = buttonLabels[button] || title[0]\n\n    const handleDown = () => {\n        host?.down(button, 0.7);\n        onRefresh()\n    }\n    const handleUp = () => {\n        host?.up(button);\n        onRefresh()\n    }\n    const buttonProps = useSvgButtonProps<SVGCircleElement>(title, handleDown, handleUp)\n\n    return <g transform={`translate(${cx},${cy})`} aria-label={`button ${title} ${checked ? \"down\" : \"up\"}`}>\n        <circle cx={0} cy={0} r={ro} fill={background} />\n        <circle\n            cx={0} cy={0} r={ri}\n            fill={checked ? active : controlBackground}\n            {...buttonProps}\n        >\n            <title>{title}</title>\n        </circle>\n        <text cx={0} cy={0} fontSize={ri} {...textProps}>{label}</text>\n    </g>\n}\n\nexport default function DashboardArcadeGamepad(props: DashboardServiceProps) {\n    const { service, services, variant } = props;\n    const [available] = useRegisterUnpackedValue<[[ArcadeGamepadButton][]]>(service.register(ArcadeGamepadReg.AvailableButtons))\n    const pressedRegister = service.register(ArcadeGamepadReg.Buttons);\n    const [pressed] = useRegisterUnpackedValue<[[ArcadeGamepadButton, number][]]>(pressedRegister);\n    const host = useServiceHost<ArcadeGamepadServiceHost>(service);\n    const color = host ? \"secondary\" : \"primary\";\n    const { background } = useWidgetTheme(color);\n\n    if (!available?.length)\n        return <LoadingProgress />\n\n    const w = 256\n    const h = 128\n\n    const cw = w / 12\n    const ch = h / 4\n\n    const ro = cw - 2\n    const ri = ro - 4\n\n    const sro = ro - 10\n    const sri = sro - 2\n    const scy = sro\n\n    const pos = {\n        [ArcadeGamepadButton.Left]: { cx: cw * 1.5, cy: 2 * ch, small: false },\n        [ArcadeGamepadButton.Up]: { cx: cw * 3, cy: ch, small: false },\n        [ArcadeGamepadButton.Right]: { cx: cw * 4.5, cy: 2 * ch, small: false },\n        [ArcadeGamepadButton.Down]: { cx: cw * 3, cy: 3 * ch, small: false },\n\n        [ArcadeGamepadButton.A]: { cx: cw * 10.5, cy: ch * 1.25, small: false },\n        [ArcadeGamepadButton.B]: { cx: cw * 9.5, cy: ch * 2.75, small: false },\n\n        [ArcadeGamepadButton.Menu]: { cx: cw * 7, cy: scy, small: true },\n        [ArcadeGamepadButton.Select]: { cx: cw * 6, cy: scy, small: true },\n\n        [ArcadeGamepadButton.Exit]: { cx: cw * 8, cy: scy, small: true },\n        [ArcadeGamepadButton.Reset]: { cx: cw * 9, cy: scy, small: true },\n    }\n\n    const handleRefresh = async () => await pressedRegister.refresh();\n\n    const abx = cw * 8 + 1\n    const aby = ch * 3 + 4\n    const abr = cw / 2;\n    const abw = cw * 5 - 6;\n    return <SvgWidget width={w} height={h}>\n        <circle cx={cw * 3} cy={2 * ch} r={2.6 * cw} fill=\"none\" stroke={background} strokeWidth={4} />\n        <rect transform={`rotate(-66, ${abx}, ${aby})`} x={abx} y={aby} rx={abr} ry={abr} width={abw} height={cw * 2.2} fill=\"none\" stroke={background} strokeWidth={4} />\n        {available.map(button => ({ button: button[0], pos: pos[button[0]] }))\n            .map(({ button, pos }) => <ArcadeButton\n                key={button}\n                cx={pos.cx}\n                cy={pos.cy}\n                ro={pos.small ? sro : ro}\n                ri={pos.small ? sri : ri}\n                button={button}\n                host={host}\n                onRefresh={handleRefresh}\n                pressure={pressed?.find(p => p[0] === button)?.[1] || 0}\n                color={color}\n            />)}\n    </SvgWidget>\n}"],"sourceRoot":""}