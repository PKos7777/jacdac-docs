{"version":3,"sources":["webpack:///./src/components/ui/CircularProgressWithLabel.tsx","webpack:///./src/components/alert/ConnectAlert.tsx","webpack:///./src/components/alert/DeviceLostAlert.tsx","webpack:///./src/components/useGridBreakpoints.ts","webpack:///./node_modules/@material-ui/core/esm/internal/SwitchBase.js","webpack:///./node_modules/@material-ui/core/esm/Switch/Switch.js","webpack:///./src/components/firmware/useFirmwareRepos.ts","webpack:///./src/components/firmware/LocalFileFirmwareCard.tsx","webpack:///./src/components/firmware/FirmwareCardGrid.tsx","webpack:///./src/components/UpdateDeviceList.tsx","webpack:///./src/components/firmware/SafeBootAlert.tsx","webpack:///./src/components/tools/Flash.tsx","webpack:///./src/pages/tools/updater.tsx","webpack:///./node_modules/@material-ui/icons/DeleteForever.js","webpack:///./src/components/ServiceButton.tsx","webpack:///./src/components/DeviceCard.tsx"],"names":["CircularProgressWithLabel","props","Math","round","value","useStyles","makeStyles","theme","createStyles","button","marginLeft","spacing","NoSsrConnectAlert","classes","serviceClass","useContext","JacdacContext","bus","transports","devices","useChange","b","ignoreSelf","spec","serviceSpecificationFromClassIdentifier","length","name","map","transport","type","ConnectAlert","DeviceLostAlert","device","lost","useEventRaised","LOST","FOUND","dev","useGridBreakpoints","itemCount","AppContext","drawerType","undefined","xs","sm","md","lg","xl","DrawerType","None","useFirmwareRepos","showAllRepos","useState","repos","setRepos","DEVICE_CHANGE","filter","announced","bootloaders","hasService","SRV_BOOTLOADER","registers","service","register","ControlReg","FirmwareIdentifier","reg","useEffectAsync","mounted","deviceSpecifications","repo","firmwares","refresh","firmwareIdentifier","intValue","indexOf","push","bootloader","boot","services","bl_announce","Packet","onlyHeader","BootloaderCmd","Info","sendCmdAwaitResponseAsync","resp","jdunpack","console","warn","fw","deviceSpecificationFromFirmwareIdentifier","unique","id","join","ImportButton","lazy","LOCAL_FILE_SLUG","LocalFileFirmwareCard","slug","downloading","setDownloading","error","setError","useFirmwareBlob","setFirmwareFile","firmwareBlobs","disabled","version","handleFiles","files","file","handleClear","blob","toString","FirmwareCardGrid","gridBreakpoints","safeBoot","firmwareRepos","firmwareRepo","UpdateDeviceCard","progress","setProgress","blobs","useFirmwareBlobs","firmwareInfo","d","find","update","updateApplicable","flashing","useMounted","handleFlashing","updateCandidates","flashFirmwareBlob","prog","UpdateDeviceList","scanning","useRef","useDevices","ignoreSimulators","isFlashing","some","scan","current","log","scanFirmwares","useEffect","subscribe","FIRMWARE_BLOBS_CHANGE","SafeBootAlert","DbContext","db","useSnackbar","enqueueSnackbar","setSafeBoot","handleRecovery","v","clear","variant","Flash","tab","setTab","handleTabChange","event","newValue","a11yProps","Page","ServiceButton","onClick","others","root","bullet","display","margin","transform","title","fontSize","pos","marginBottom","navigateToService","specification","navigate","shortId","DeviceDescription","useRegisterUnpackedValue","description","DeviceCard","children","action","content","showDeviceId","showDescription","showTemperature","showFirmware","showServices","SRV_CTRL","SRV_LOGGER"],"mappings":"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AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,sBAAsB,sBAAmB,CAAC,6BAAU,EAAE,sCAAQ;AAC9D;AACA,eAAe,iCAAI;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,uBAAuB,sBAAmB,UAAU,sCAAQ;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,CAAC,EAAE;AACH;;AAEA,MAAqC,GAAG,SAAM;AAC/B,6FAAU,CAAC,iBAAM;AAChC;AACA,CAAC,EAAE,qBAAU,CAAC,E;;AC1I4C;AACgC;;AAE3D;AACP;AACqB;AACC;AACI;AACL;AACG;AACzC,IAAI,aAAM;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,2BAA2B,wCAAI;AAC/B;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,2BAA2B,wCAAI;AAC/B;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA,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","file":"component---src-pages-tools-updater-tsx-23c301d626ed577fc53d.js","sourcesContent":["import React from \"react\"\nimport { CircularProgressProps, Box, CircularProgress, Typography } from \"@material-ui/core\";\n\nexport default function CircularProgressWithLabel(props: CircularProgressProps & { value: number }) {\n    return (\n        <Box position=\"relative\" display=\"inline-flex\">\n            <CircularProgress variant=\"determinate\" {...props} />\n            <Box\n                top={0}\n                left={0}\n                bottom={0}\n                right={0}\n                position=\"absolute\"\n                display=\"flex\"\n                alignItems=\"center\"\n                justifyContent=\"center\"\n            >\n                <Typography variant=\"caption\" component=\"div\" color=\"textSecondary\">{`${Math.round(\n                    props.value,\n                )}%`}</Typography>\n            </Box>\n        </Box>\n    );\n}","// tslint:disable-next-line: no-submodule-imports\nimport { Box, createStyles, makeStyles } from \"@material-ui/core\"\n// tslint:disable-next-line: no-submodule-imports\nimport Alert from \"../ui/Alert\"\nimport React, { useContext } from \"react\"\nimport { serviceSpecificationFromClassIdentifier } from \"../../../jacdac-ts/src/jdom/spec\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport ConnectButton from \"../../jacdac/ConnectButton\"\nimport { NoSsr } from \"@material-ui/core\"\nimport useChange from \"../../jacdac/useChange\"\n\nconst useStyles = makeStyles(theme =>\n    createStyles({\n        button: {\n            marginLeft: theme.spacing(2),\n        },\n    })\n)\n\nfunction NoSsrConnectAlert(props: { serviceClass?: number }) {\n    const classes = useStyles()\n    const { serviceClass } = props\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { transports } = bus\n    const devices = useChange(bus, b => b.devices({ serviceClass, ignoreSelf: true }))\n    const spec = serviceSpecificationFromClassIdentifier(serviceClass)\n\n    // don't show if no transport, some devices\n    if (!transports.length || devices?.length) return null\n\n    return (\n        <Box displayPrint=\"none\">\n            <Alert severity=\"info\" closeable={true}>\n                {!spec && <span>Did you connect your device?</span>}\n                {spec && <span>Did you connect a {spec.name} device?</span>}\n                {transports.map(transport => (\n                    <ConnectButton\n                        key={transport.type}\n                        transport={transport}\n                        className={classes.button}\n                        full={true}\n                        transparent={true}\n                    />\n                ))}\n            </Alert>\n        </Box>\n    )\n}\n\nexport default function ConnectAlert(props: { serviceClass?: number }) {\n    return (\n        <NoSsr>\n            <NoSsrConnectAlert {...props} />\n        </NoSsr>\n    )\n}\n","import React from \"react\";\nimport { LOST, FOUND } from \"../../../jacdac-ts/src/jdom/constants\";\nimport { JDDevice } from \"../../../jacdac-ts/src/jdom/device\";\nimport useEventRaised from \"../../jacdac/useEventRaised\";\nimport Alert from \"../ui/Alert\";\n\nexport function DeviceLostAlert(props: { device: JDDevice }) {\n    const { device } = props;\n    const lost = useEventRaised([LOST, FOUND], device, dev => !!dev?.lost)\n    return <>\n        {lost && <Alert severity=\"info\">Device lost...</Alert>}\n    </>\n}","import { GridSize } from \"@material-ui/core\"\nimport React, { useContext } from \"react\"\nimport AppContext, { DrawerType } from \"./AppContext\"\n\nexport interface GridBreakpoints {\n    xs?: GridSize,\n    md?: GridSize,\n    sm?: GridSize,\n    lg?: GridSize,\n    xl?: GridSize\n}\n\nexport default function useGridBreakpoints(itemCount?: number): GridBreakpoints {\n    const { drawerType } = useContext(AppContext)\n\n    if (itemCount !== undefined) {\n        switch (itemCount) {\n            case 1:\n            case 2: return { xs: 12, sm: 6, md: 6, lg: 6, xl: 6 }\n            case 3: return { xs: 12, sm: 6, md: 6, lg: 4, xl: 4 }\n        }\n    }\n\n    if (drawerType != DrawerType.None)\n        return { xs: 12, md: 6, sm: 6, lg: 6, xl: 4 }\n    else return {\n        xs: 12,\n        sm: 6,\n        md: 4,\n        lg: 4,\n        xl: 3\n    }\n}","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport { refType } from '@material-ui/utils';\nimport useControlled from '../utils/useControlled';\nimport useFormControl from '../FormControl/useFormControl';\nimport withStyles from '../styles/withStyles';\nimport IconButton from '../IconButton';\nexport var styles = {\n  root: {\n    padding: 9\n  },\n  checked: {},\n  disabled: {},\n  input: {\n    cursor: 'inherit',\n    position: 'absolute',\n    opacity: 0,\n    width: '100%',\n    height: '100%',\n    top: 0,\n    left: 0,\n    margin: 0,\n    padding: 0,\n    zIndex: 1\n  }\n};\n/**\n * @ignore - internal component.\n */\n\nvar SwitchBase = /*#__PURE__*/React.forwardRef(function SwitchBase(props, ref) {\n  var autoFocus = props.autoFocus,\n      checkedProp = props.checked,\n      checkedIcon = props.checkedIcon,\n      classes = props.classes,\n      className = props.className,\n      defaultChecked = props.defaultChecked,\n      disabledProp = props.disabled,\n      icon = props.icon,\n      id = props.id,\n      inputProps = props.inputProps,\n      inputRef = props.inputRef,\n      name = props.name,\n      onBlur = props.onBlur,\n      onChange = props.onChange,\n      onFocus = props.onFocus,\n      readOnly = props.readOnly,\n      required = props.required,\n      tabIndex = props.tabIndex,\n      type = props.type,\n      value = props.value,\n      other = _objectWithoutProperties(props, [\"autoFocus\", \"checked\", \"checkedIcon\", \"classes\", \"className\", \"defaultChecked\", \"disabled\", \"icon\", \"id\", \"inputProps\", \"inputRef\", \"name\", \"onBlur\", \"onChange\", \"onFocus\", \"readOnly\", \"required\", \"tabIndex\", \"type\", \"value\"]);\n\n  var _useControlled = useControlled({\n    controlled: checkedProp,\n    default: Boolean(defaultChecked),\n    name: 'SwitchBase',\n    state: 'checked'\n  }),\n      _useControlled2 = _slicedToArray(_useControlled, 2),\n      checked = _useControlled2[0],\n      setCheckedState = _useControlled2[1];\n\n  var muiFormControl = useFormControl();\n\n  var handleFocus = function handleFocus(event) {\n    if (onFocus) {\n      onFocus(event);\n    }\n\n    if (muiFormControl && muiFormControl.onFocus) {\n      muiFormControl.onFocus(event);\n    }\n  };\n\n  var handleBlur = function handleBlur(event) {\n    if (onBlur) {\n      onBlur(event);\n    }\n\n    if (muiFormControl && muiFormControl.onBlur) {\n      muiFormControl.onBlur(event);\n    }\n  };\n\n  var handleInputChange = function handleInputChange(event) {\n    var newChecked = event.target.checked;\n    setCheckedState(newChecked);\n\n    if (onChange) {\n      // TODO v5: remove the second argument.\n      onChange(event, newChecked);\n    }\n  };\n\n  var disabled = disabledProp;\n\n  if (muiFormControl) {\n    if (typeof disabled === 'undefined') {\n      disabled = muiFormControl.disabled;\n    }\n  }\n\n  var hasLabelFor = type === 'checkbox' || type === 'radio';\n  return /*#__PURE__*/React.createElement(IconButton, _extends({\n    component: \"span\",\n    className: clsx(classes.root, className, checked && classes.checked, disabled && classes.disabled),\n    disabled: disabled,\n    tabIndex: null,\n    role: undefined,\n    onFocus: handleFocus,\n    onBlur: handleBlur,\n    ref: ref\n  }, other), /*#__PURE__*/React.createElement(\"input\", _extends({\n    autoFocus: autoFocus,\n    checked: checkedProp,\n    defaultChecked: defaultChecked,\n    className: classes.input,\n    disabled: disabled,\n    id: hasLabelFor && id,\n    name: name,\n    onChange: handleInputChange,\n    readOnly: readOnly,\n    ref: inputRef,\n    required: required,\n    tabIndex: tabIndex,\n    type: type,\n    value: value\n  }, inputProps)), checked ? checkedIcon : icon);\n}); // NB: If changed, please update Checkbox, Switch and Radio\n// so that the API documentation is updated.\n\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nexport default withStyles(styles, {\n  name: 'PrivateSwitchBase'\n})(SwitchBase);","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\"; // @inheritedComponent IconButton\n\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport { refType } from '@material-ui/utils';\nimport withStyles from '../styles/withStyles';\nimport { fade } from '../styles/colorManipulator';\nimport capitalize from '../utils/capitalize';\nimport SwitchBase from '../internal/SwitchBase';\nexport var styles = function styles(theme) {\n  return {\n    /* Styles applied to the root element. */\n    root: {\n      display: 'inline-flex',\n      width: 34 + 12 * 2,\n      height: 14 + 12 * 2,\n      overflow: 'hidden',\n      padding: 12,\n      boxSizing: 'border-box',\n      position: 'relative',\n      flexShrink: 0,\n      zIndex: 0,\n      // Reset the stacking context.\n      verticalAlign: 'middle',\n      // For correct alignment with the text.\n      '@media print': {\n        colorAdjust: 'exact'\n      }\n    },\n\n    /* Styles applied to the root element if `edge=\"start\"`. */\n    edgeStart: {\n      marginLeft: -8\n    },\n\n    /* Styles applied to the root element if `edge=\"end\"`. */\n    edgeEnd: {\n      marginRight: -8\n    },\n\n    /* Styles applied to the internal `SwitchBase` component's `root` class. */\n    switchBase: {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      zIndex: 1,\n      // Render above the focus ripple.\n      color: theme.palette.type === 'light' ? theme.palette.grey[50] : theme.palette.grey[400],\n      transition: theme.transitions.create(['left', 'transform'], {\n        duration: theme.transitions.duration.shortest\n      }),\n      '&$checked': {\n        transform: 'translateX(20px)'\n      },\n      '&$disabled': {\n        color: theme.palette.type === 'light' ? theme.palette.grey[400] : theme.palette.grey[800]\n      },\n      '&$checked + $track': {\n        opacity: 0.5\n      },\n      '&$disabled + $track': {\n        opacity: theme.palette.type === 'light' ? 0.12 : 0.1\n      }\n    },\n\n    /* Styles applied to the internal SwitchBase component's root element if `color=\"primary\"`. */\n    colorPrimary: {\n      '&$checked': {\n        color: theme.palette.primary.main,\n        '&:hover': {\n          backgroundColor: fade(theme.palette.primary.main, theme.palette.action.hoverOpacity),\n          '@media (hover: none)': {\n            backgroundColor: 'transparent'\n          }\n        }\n      },\n      '&$disabled': {\n        color: theme.palette.type === 'light' ? theme.palette.grey[400] : theme.palette.grey[800]\n      },\n      '&$checked + $track': {\n        backgroundColor: theme.palette.primary.main\n      },\n      '&$disabled + $track': {\n        backgroundColor: theme.palette.type === 'light' ? theme.palette.common.black : theme.palette.common.white\n      }\n    },\n\n    /* Styles applied to the internal SwitchBase component's root element if `color=\"secondary\"`. */\n    colorSecondary: {\n      '&$checked': {\n        color: theme.palette.secondary.main,\n        '&:hover': {\n          backgroundColor: fade(theme.palette.secondary.main, theme.palette.action.hoverOpacity),\n          '@media (hover: none)': {\n            backgroundColor: 'transparent'\n          }\n        }\n      },\n      '&$disabled': {\n        color: theme.palette.type === 'light' ? theme.palette.grey[400] : theme.palette.grey[800]\n      },\n      '&$checked + $track': {\n        backgroundColor: theme.palette.secondary.main\n      },\n      '&$disabled + $track': {\n        backgroundColor: theme.palette.type === 'light' ? theme.palette.common.black : theme.palette.common.white\n      }\n    },\n\n    /* Styles applied to the root element if `size=\"small\"`. */\n    sizeSmall: {\n      width: 40,\n      height: 24,\n      padding: 7,\n      '& $thumb': {\n        width: 16,\n        height: 16\n      },\n      '& $switchBase': {\n        padding: 4,\n        '&$checked': {\n          transform: 'translateX(16px)'\n        }\n      }\n    },\n\n    /* Pseudo-class applied to the internal `SwitchBase` component's `checked` class. */\n    checked: {},\n\n    /* Pseudo-class applied to the internal SwitchBase component's disabled class. */\n    disabled: {},\n\n    /* Styles applied to the internal SwitchBase component's input element. */\n    input: {\n      left: '-100%',\n      width: '300%'\n    },\n\n    /* Styles used to create the thumb passed to the internal `SwitchBase` component `icon` prop. */\n    thumb: {\n      boxShadow: theme.shadows[1],\n      backgroundColor: 'currentColor',\n      width: 20,\n      height: 20,\n      borderRadius: '50%'\n    },\n\n    /* Styles applied to the track element. */\n    track: {\n      height: '100%',\n      width: '100%',\n      borderRadius: 14 / 2,\n      zIndex: -1,\n      transition: theme.transitions.create(['opacity', 'background-color'], {\n        duration: theme.transitions.duration.shortest\n      }),\n      backgroundColor: theme.palette.type === 'light' ? theme.palette.common.black : theme.palette.common.white,\n      opacity: theme.palette.type === 'light' ? 0.38 : 0.3\n    }\n  };\n};\nvar Switch = /*#__PURE__*/React.forwardRef(function Switch(props, ref) {\n  var classes = props.classes,\n      className = props.className,\n      _props$color = props.color,\n      color = _props$color === void 0 ? 'secondary' : _props$color,\n      _props$edge = props.edge,\n      edge = _props$edge === void 0 ? false : _props$edge,\n      _props$size = props.size,\n      size = _props$size === void 0 ? 'medium' : _props$size,\n      other = _objectWithoutProperties(props, [\"classes\", \"className\", \"color\", \"edge\", \"size\"]);\n\n  var icon = /*#__PURE__*/React.createElement(\"span\", {\n    className: classes.thumb\n  });\n  return /*#__PURE__*/React.createElement(\"span\", {\n    className: clsx(classes.root, className, {\n      'start': classes.edgeStart,\n      'end': classes.edgeEnd\n    }[edge], size === \"small\" && classes[\"size\".concat(capitalize(size))])\n  }, /*#__PURE__*/React.createElement(SwitchBase, _extends({\n    type: \"checkbox\",\n    icon: icon,\n    checkedIcon: icon,\n    classes: {\n      root: clsx(classes.switchBase, classes[\"color\".concat(capitalize(color))]),\n      input: classes.input,\n      checked: classes.checked,\n      disabled: classes.disabled\n    },\n    ref: ref\n  }, other)), /*#__PURE__*/React.createElement(\"span\", {\n    className: classes.track\n  }));\n});\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nexport default withStyles(styles, {\n  name: 'MuiSwitch'\n})(Switch);","import { useContext, useState } from \"react\";\nimport { deviceSpecificationFromFirmwareIdentifier, deviceSpecifications } from \"../../../jacdac-ts/src/jdom/spec\";\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\";\nimport useEffectAsync from \"../useEffectAsync\";\nimport { unique } from \"../../../jacdac-ts/src/jdom/utils\";\nimport { BootloaderCmd, ControlReg, DEVICE_CHANGE, SRV_BOOTLOADER } from \"../../../jacdac-ts/src/jdom/constants\";\nimport useEventRaised from \"../../jacdac/useEventRaised\";\nimport Packet from \"../../../jacdac-ts/src/jdom/packet\";\n\nexport default function useFirmwareRepos(showAllRepos?: boolean) {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const [repos, setRepos] = useState<string[]>([])\n\n    const devices = useEventRaised(DEVICE_CHANGE, bus, () => bus.devices().filter(dev => dev.announced))\n    const bootloaders = devices.filter(device => device?.hasService(SRV_BOOTLOADER));\n    const registers = devices\n        .filter(device => !device?.hasService(SRV_BOOTLOADER)) // not a bootloader\n        .map(device => device?.service(0)?.register(ControlReg.FirmwareIdentifier))\n        .filter(reg => !!reg);\n\n    useEffectAsync(async (mounted) => {\n        let repos: string[] = [];\n        if (showAllRepos)\n            repos = deviceSpecifications().map(spec => spec.repo);\n        else {\n            const firmwares: number[] = [];\n            // ask firmware registers\n            for (const register of registers) {\n                await register.refresh(true)\n                const firmwareIdentifier = register.intValue;\n                if (firmwareIdentifier !== undefined && firmwares.indexOf(firmwareIdentifier) < 0)\n                    firmwares.push(firmwareIdentifier);\n            }\n            // ask bootloaders\n            for (const bootloader of bootloaders) {\n                const boot = bootloader.services({ serviceClass: SRV_BOOTLOADER })[0];\n                const bl_announce = Packet.onlyHeader(BootloaderCmd.Info)\n                try {\n                    const resp = await boot.sendCmdAwaitResponseAsync(bl_announce);\n                    const [, , , firmwareIdentifier] = resp.jdunpack<[number, number, number, number]>(\"u32 u32 u32 u32\");\n                    if (firmwareIdentifier !== undefined && firmwares.indexOf(firmwareIdentifier) < 0)\n                        firmwares.push(firmwareIdentifier);\n                }\n                catch (e) {\n                    console.warn(`bootloader firmware identifier failed`, e)\n                }\n            }\n            repos = firmwares.map(fw => deviceSpecificationFromFirmwareIdentifier(fw)?.repo)\n                .filter(repo => !!repo);\n        }\n        if (mounted)\n            setRepos(unique(repos))\n    }, [devices.map(dev => dev.id).join(), registers.map(reg => reg.id).join(), showAllRepos])\n    return repos;\n}","import React, { lazy, useState } from \"react\"\nimport { Button, Card, CardHeader, CardActions, CardContent, ListItem, List, ListItemText, Typography } from \"@material-ui/core\";\nimport { useFirmwareBlob } from \"./useFirmwareBlobs\";\nimport Alert from \"../ui/Alert\";\nimport Suspense from \"../ui/Suspense\"\nconst ImportButton = lazy(() => import(\"../ImportButton\"))\n\nconst LOCAL_FILE_SLUG = \"local file\";\n\nexport default function LocalFileFirmwareCard() {\n    const slug = LOCAL_FILE_SLUG;\n    const [downloading, setDownloading] = useState(false)\n    const [error, setError] = useState(\"\")\n    const { setFirmwareFile, firmwareBlobs } = useFirmwareBlob(slug)\n    const disabled = downloading;\n    const version = firmwareBlobs?.[0].version\n\n    const handleFiles = async (files: File[]) => {\n        const file = files[0]\n        if (file) {\n            try {\n                setDownloading(true)\n                await setFirmwareFile(undefined, file)\n            } finally {\n                setDownloading(false)\n            }\n        }\n    }\n\n    const handleClear = async () => {\n        try {\n            setError(\"\")\n            setDownloading(true)\n            setFirmwareFile(undefined, undefined)\n        }\n        finally {\n            setDownloading(false)\n        }\n    }\n\n    return <Card>\n        <CardHeader\n            title={slug} />\n        <CardContent>\n            {error && <Alert severity=\"error\">{error}</Alert>}\n            {version && <Typography variant=\"body2\">version <code>{version}</code></Typography>}\n            {!!firmwareBlobs?.length && <List dense>\n                {firmwareBlobs.map(blob => <ListItem key={blob.firmwareIdentifier}>\n                    <ListItemText primary={blob.name} secondary={`0x${blob.firmwareIdentifier.toString(16)}`} />\n                </ListItem>)}\n            </List>}\n        </CardContent>\n        <CardActions>\n            {!downloading && <Suspense><ImportButton text={\"Import UF2 file\"} onFilesUploaded={handleFiles} /></Suspense>}\n            {!downloading && firmwareBlobs?.length && <Button disabled={disabled} variant=\"text\" arial-label={\"Clear\"} onClick={handleClear}>\n                Clear\n            </Button>}\n        </CardActions>\n    </Card>\n}","import { Grid } from \"@material-ui/core\"\nimport React, { useContext } from \"react\"\nimport useGridBreakpoints from \"../useGridBreakpoints\"\nimport FirmwareCard from \"./FirmwareCard\"\n// tslint:disable-next-line: no-submodule-imports\nimport useFirmwareRepos from \"./useFirmwareRepos\"\nimport LocalFileFirmwareCard from \"./LocalFileFirmwareCard\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport useChange from \"../../jacdac/useChange\"\n\nexport default function FirmwareCardGrid() {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const gridBreakpoints = useGridBreakpoints()\n    const safeBoot = useChange(bus, b => b.safeBoot)\n    const firmwareRepos = useFirmwareRepos(safeBoot)\n\n    return (\n        <Grid container spacing={2}>\n            <Grid {...gridBreakpoints} item key=\"localfile\">\n                <LocalFileFirmwareCard />\n            </Grid>\n            {firmwareRepos.map(firmwareRepo => (\n                <Grid\n                    {...gridBreakpoints}\n                    item\n                    key={`firmwarerepo${firmwareRepo}`}\n                >\n                    <FirmwareCard slug={firmwareRepo} />\n                </Grid>\n            ))}\n        </Grid>\n    )\n}\n","import { Button, Grid } from \"@material-ui/core\"\nimport { Alert } from \"@material-ui/lab\"\nimport React, { useContext, useEffect, useRef, useState } from \"react\"\nimport {\n    DEVICE_CHANGE,\n    FIRMWARE_BLOBS_CHANGE,\n    SRV_BOOTLOADER,\n} from \"../../jacdac-ts/src/jdom/constants\"\nimport { JDDevice } from \"../../jacdac-ts/src/jdom/device\"\nimport {\n    scanFirmwares,\n    flashFirmwareBlob,\n    updateApplicable,\n} from \"../../jacdac-ts/src/jdom/flashing\"\nimport JacdacContext, { JacdacContextProps } from \"../jacdac/Context\"\nimport CircularProgressWithLabel from \"./ui/CircularProgressWithLabel\"\nimport DeviceCard from \"./DeviceCard\"\nimport useGridBreakpoints from \"./useGridBreakpoints\"\nimport AppContext from \"./AppContext\"\nimport useChange from \"../jacdac/useChange\"\nimport useDevices from \"./hooks/useDevices\"\nimport useFirmwareBlobs from \"./firmware/useFirmwareBlobs\"\nimport useMounted from \"./hooks/useMounted\"\n\nfunction UpdateDeviceCard(props: { device: JDDevice }) {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { device } = props\n    const { setError } = useContext(AppContext)\n    const [progress, setProgress] = useState(0)\n    const blobs = useFirmwareBlobs()\n    const firmwareInfo = useChange(device, d => d.firmwareInfo)\n    const blob =\n        firmwareInfo &&\n        blobs?.find(\n            b => firmwareInfo.firmwareIdentifier == b.firmwareIdentifier\n        )\n    const update = blob && firmwareInfo && updateApplicable(firmwareInfo, blob)\n    const flashing = useChange(device, d => d.flashing)\n    const mounted = useMounted()\n\n    const handleFlashing = async () => {\n        if (device.flashing) return\n        try {\n            setProgress(0)\n            device.flashing = true // don't refresh registers while flashing\n            const updateCandidates = [firmwareInfo]\n            await flashFirmwareBlob(bus, blob, updateCandidates, prog => {\n                if (mounted())\n                    setProgress(prog)\n            })\n            // trigger info\n            device.firmwareInfo = undefined\n        } catch (e) {\n            if (mounted())\n                setError(e)\n        } finally {\n            device.flashing = false\n        }\n    }\n\n    return (\n        <DeviceCard\n            device={device}\n            showFirmware={true}\n            content={update && <span>Update to {blob.version}</span>}\n            // tslint:disable-next-line: react-this-binding-issue\n            action={\n                flashing ? (\n                    <CircularProgressWithLabel value={progress} />\n                ) : update ? (\n                    <Button\n                        aria-label=\"deploy new firmware to device\"\n                        disabled={flashing}\n                        variant=\"contained\"\n                        color=\"primary\"\n                        onClick={handleFlashing}\n                    >\n                        Flash\n                    </Button>\n                ) : firmwareInfo ? (\n                    <Alert severity=\"success\">Up to date!</Alert>\n                ) : undefined\n            }\n        />\n    )\n}\n\nexport default function UpdateDeviceList() {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const scanning = useRef(false)\n    const gridBreakpoints = useGridBreakpoints()\n    const safeBoot = useChange(bus, b => b.safeBoot)\n    const devices = useDevices(\n        {\n            announced: true,\n            ignoreSelf: true,\n            ignoreSimulators: true,\n            firmwareIdentifier: true,\n        },\n        [safeBoot]\n    ).filter(dev => safeBoot || !dev.hasService(SRV_BOOTLOADER))\n    const isFlashing = useChange(bus, () => devices.some(dev => dev.flashing))\n    const blobs = useFirmwareBlobs()\n    async function scan() {\n        if (!blobs?.length || isFlashing || scanning.current) return\n        console.log(`start scanning bus`)\n        try {\n            scanning.current = true\n            await scanFirmwares(bus)\n        } finally {\n            scanning.current = false\n        }\n    }\n    // load indexed db file once\n    useEffect(() => {\n        scan()\n    }, [isFlashing, blobs])\n    useEffect(\n        () =>\n            bus.subscribe([DEVICE_CHANGE, FIRMWARE_BLOBS_CHANGE], () => scan()),\n        []\n    )\n\n    return (\n        <Grid container spacing={2}>\n            {devices.map(device => (\n                <Grid key={device.id} item {...gridBreakpoints}>\n                    <UpdateDeviceCard device={device} />\n                </Grid>\n            ))}\n        </Grid>\n    )\n}\n","import { Box, Button, Switch, Typography } from \"@material-ui/core\";\nimport React, { useContext, useEffect, useState } from \"react\";\n// tslint:disable-next-line: no-submodule-imports\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\";\nimport Alert from \"../ui/Alert\";\nimport DbContext, { DbContextProps } from \"../DbContext\";\n// tslint:disable-next-line: match-default-export-name tslint:disable-next-line: no-submodule-imports\nimport DeleteForeverIcon from '@material-ui/icons/DeleteForever';\nimport { useSnackbar } from \"notistack\";\n\nexport default function SafeBootAlert() {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { db } = useContext<DbContextProps>(DbContext)\n    const { enqueueSnackbar } = useSnackbar();\n    const [safeBoot, setSafeBoot] = useState(bus.safeBoot);\n    const firmwares = db?.firmwares;\n\n    const handleRecovery = async () => {\n        const v = !safeBoot;\n        setSafeBoot(v);\n    }\n    const handleClear = async () => {\n        await firmwares.clear();\n        enqueueSnackbar(\"firmwares cleared\", {\n            variant: \"info\"\n        })\n    }\n\n    // turn on and off safeboot mode\n    useEffect(() => {\n        bus.safeBoot = safeBoot;\n        return () => { bus.safeBoot = false }\n    }, [safeBoot]);\n\n    return (<>\n        <Alert severity=\"info\">\n            <Switch value={safeBoot} onChange={handleRecovery} />\n            <Typography component=\"span\" variant=\"body1\">\n                recovery mode\n                </Typography>\n            <Box mr={1}>\n                <Typography component=\"span\" variant=\"caption\">\n                    If your module is malfunctioning from the start, you can flash it in bootloader mode.\n                    Turn on recovery mode and unplug/replug any malfunctioning device to switch it to bootloader mode (glowing status LED).\n                    Once your module is flashed, turn off recovery mode and unplug/replug your module again.\n                    </Typography>\n            </Box>\n        </Alert>\n        {safeBoot && <Alert severity=\"warning\">\n            <Button size=\"small\" variant=\"outlined\" disabled={!firmwares} onClick={handleClear} startIcon={<DeleteForeverIcon />}>\n                clear cache\n            </Button>\n            <Box mr={1}>\n                <Typography component=\"span\" variant=\"caption\">\n                    Delete all firmware cached in the browser. The firmware will have to be deleted again from this interface.\n                    </Typography>\n            </Box>\n        </Alert>}\n    </>)\n}\n","import { Box, Tab, Tabs } from \"@material-ui/core\";\nimport React, { useState } from \"react\";\nimport TabPanel, { a11yProps } from '../ui/TabPanel';\nimport ConnectAlert from \"../alert/ConnectAlert\";\nimport FirmwareCardGrid from \"../firmware/FirmwareCardGrid\";\n// tslint:disable-next-line: no-submodule-imports\nimport UpdateDeviceList from \"../UpdateDeviceList\";\nimport SafeBootAlert from \"../firmware/SafeBootAlert\";\n\nexport default function Flash() {\n    const [tab, setTab] = useState(0);\n    const handleTabChange = (event: React.ChangeEvent<unknown>, newValue: number) => {\n        setTab(newValue);\n    }\n\n    return (\n        <Box mb={2}>\n            <ConnectAlert />\n            <Tabs value={tab} onChange={handleTabChange} aria-label=\"View specification formats\">\n                <Tab label={`Updates`} {...a11yProps(1)} />\n                <Tab label={`Firmwares`} {...a11yProps(0)} />\n            </Tabs>\n            <TabPanel value={tab} index={0}>\n                <UpdateDeviceList />\n            </TabPanel>\n            <TabPanel value={tab} index={1}>\n                <FirmwareCardGrid />\n            </TabPanel>\n            <SafeBootAlert />\n        </Box>\n    )\n}\n","import React from \"react\"\nimport Flash from \"../../components/tools/Flash\"\n\nexport default function Page() {\n    return <>\n        <h1>Firmware Updater</h1>\n        <p>\n        This page allows you to update your Jacdac module with new firmware. Find the latest UF2 firmware file from your manufacturer \nand import it with the button below.\n            \n        </p>\n        <Flash />\n    </>\n}","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12l1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z\"\n}), 'DeleteForever');\n\nexports.default = _default;","import { ButtonProps } from \"@material-ui/core\"\nimport { Button } from \"gatsby-theme-material-ui\"\nimport React from \"react\"\nimport { JDService } from \"../../jacdac-ts/src/jdom/service\"\n\nexport default function ServiceButton(\n    props: { service: JDService; onClick?: () => void } & ButtonProps\n) {\n    const { service, onClick, ...others } = props\n    return (\n        <Button\n            {...others}\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={onClick}\n        >\n            {service.name}\n        </Button>\n    )\n}\n","import React, { ReactNode } from 'react';\n// tslint:disable-next-line: no-submodule-imports\nimport { makeStyles } from '@material-ui/core/styles';\n// tslint:disable-next-line: no-submodule-imports\nimport Card from '@material-ui/core/Card';\n// tslint:disable-next-line: no-submodule-imports\nimport CardContent from '@material-ui/core/CardContent';\nimport { JDDevice } from '../../jacdac-ts/src/jdom/device';\nimport { SRV_CTRL, SRV_LOGGER, ControlReg } from '../../jacdac-ts/src/jdom/constants';\nimport ServiceButton from './ServiceButton';\nimport useChange from '../jacdac/useChange';\nimport { navigate } from \"gatsby\";\nimport { JDService } from '../../jacdac-ts/src/jdom/service';\nimport { CardActions, createStyles } from '@material-ui/core';\nimport DeviceCardHeader from './DeviceCardHeader';\nimport { useRegisterUnpackedValue } from '../jacdac/useRegisterValue';\nimport { DeviceLostAlert } from './alert/DeviceLostAlert';\n\nconst useStyles = makeStyles(() => createStyles({\n    root: {\n    },\n    bullet: {\n        display: 'inline-block',\n        margin: '0 2px',\n        transform: 'scale(0.8)',\n    },\n    title: {\n        fontSize: 14,\n    },\n    pos: {\n        marginBottom: 12,\n    },\n}));\n\nfunction navigateToService(service: JDService) {\n    const spec = service.specification;\n    if (spec)\n        navigate(`/services/${spec.shortId}/`) // todo spec\n}\n\nfunction DeviceDescription(props: { device: JDDevice }) {\n    const { device } = props;\n    const register = device?.service(0)?.register(ControlReg.DeviceDescription)\n    const [description] = useRegisterUnpackedValue<[string]>(register)\n    return <span>{description || \"\"}</span>\n}\n\nexport default function DeviceCard(props: {\n    device: JDDevice,\n    children?: ReactNode,\n    action?: JSX.Element | JSX.Element[],\n    content?: JSX.Element | JSX.Element[],\n    showDeviceId?: boolean,\n    showServices?: boolean,\n    showTemperature?: boolean,\n    showFirmware?: boolean,\n    showDescription?: boolean\n}) {\n    const { device, children, action, content,\n        showDeviceId,\n        showDescription, showTemperature, showFirmware, showServices } = props;\n    const classes = useStyles();\n    const services = useChange(device, () => device.services()\n        .filter(service => service.serviceClass != SRV_CTRL && service.serviceClass != SRV_LOGGER));\n\n    return (\n        <Card className={classes.root}>\n            <DeviceCardHeader device={device}\n                showDeviceId={showDeviceId}\n                showTemperature={showTemperature}\n                showFirmware={showFirmware}\n                showMedia={true} />\n            {(showDescription || content) &&\n                <CardContent>\n                    {<DeviceLostAlert device={device} />}\n                    {showDescription && <DeviceDescription device={device} />}\n                    {content}\n                </CardContent>}\n            <CardActions>\n                {action}\n                {showServices && services?.map(service => <ServiceButton key={service.id} service={service} onClick={() => navigateToService(service)} />)}\n            </CardActions>\n            {children}\n        </Card>\n    );\n}\n"],"sourceRoot":""}