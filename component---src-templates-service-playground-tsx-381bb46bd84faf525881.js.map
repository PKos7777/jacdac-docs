{"version":3,"sources":["webpack://jacdac-docs/./jacdac-ts/src/vm/utils.ts","webpack://jacdac-docs/./src/components/EnumSpecification.tsx","webpack://jacdac-docs/./src/components/ServiceSpecification.tsx","webpack://jacdac-docs/./src/components/dashboard/DashboardDeviceItem.tsx","webpack://jacdac-docs/./src/templates/service-playground.tsx"],"names":["VM_ERROR","VM_WATCH_CHANGE","VM_MISSING_ROLE_WARNING","VM_MISSING_DEVICE_WARNING","VM_BREAKPOINT","VM_COMMAND_ATTEMPTED","VM_COMMAND_COMPLETED","VM_WAKE_SLEEPER","VMError","message","jacdacName","name","Error","errorPath","e","Mutex","promises","shift","acquire","f","Promise","resolve","reject","push","then","v","length","EnumSpecification","props","serviceClass","spec","serviceSpecificationFromClassIdentifier","enums","Object","values","filter","en","derived","map","isFlags","keys","members","toString","DashboardServiceDevices","useContext","JacdacContext","bus","devices","useChange","b","device","id","ServiceSpecification","node","service","showDerived","shortId","classIdentifier","packets","pkt","registers","isRegister","events","isEvent","commands","isCommand","reports","r","secondary","pipeReports","isPipeReport","others","indexOf","useServiceProviderFromServiceClass","reportOf","find","rep","isReportOf","pipeReportOf","isPipeReportOf","notes","short","extends","extend","i","serviceSpecificationFromName","long","note","group","sort","l","DashboardDeviceItem","expanded","toggleExpanded","variant","other","AppContext","drawerType","breakpoints","breakpointWeight","services","srv","dashboardServiceWeight","readingRegister","valueRegister","intensityRegister","reduce","c","DrawerType","xs","sm","md","lg","xl","Page","pageContext"],"mappings":"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","file":"component---src-templates-service-playground-tsx-381bb46bd84faf525881.js","sourcesContent":["export const VM_ERROR = \"vmError\"\nexport const VM_WATCH_CHANGE = \"vmWatchChange\"\nexport const VM_MISSING_ROLE_WARNING = \"vmMissingRole\"\nexport const VM_MISSING_DEVICE_WARNING = \"vmMissingDevice\"\nexport const VM_BREAKPOINT = \"vmBreakpoint\"\nexport const VM_COMMAND_ATTEMPTED = \"vmCommandAttempted\"\nexport const VM_COMMAND_COMPLETED = \"vmCommandCompleted\"\nexport const VM_WAKE_SLEEPER = \"vmWakeSleeper\"\n\nexport class VMError extends Error {\n    constructor(message: string, readonly jacdacName?: string) {\n        super(message)\n        this.name = VM_ERROR\n    }\n}\n\nexport default function errorPath(e: VMError): string {\n    return (e as VMError)?.jacdacName\n}\n\n\nexport class Mutex {\n    private promises: (() => Promise<any>)[] = []\n    private shift() {\n        this.promises.shift()\n        if (this.promises[0]) this.promises[0]()\n    }\n    acquire<T>(f: () => Promise<T>): Promise<T> {\n        return new Promise<T>((resolve, reject) => {\n            this.promises.push(() =>\n                f().then(\n                    v => {\n                        this.shift()\n                        resolve(v)\n                    },\n                    e => {\n                        this.shift()\n                        reject(e)\n                    }\n                )\n            )\n            if (this.promises.length == 1) this.promises[0]()\n        })\n    }\n}\n","import React, { Fragment } from \"react\"\nimport { serviceSpecificationFromClassIdentifier } from \"../../jacdac-ts/src/jdom/spec\"\nimport { Chip } from \"@material-ui/core\"\n\nexport default function EnumSpecification(props: { serviceClass: number }) {\n    const { serviceClass } = props\n    const spec = serviceSpecificationFromClassIdentifier(serviceClass)\n    const enums = Object.values(spec?.enums || {}).filter(en => !en.derived)\n    if (!enums.length)\n        return <></>\n\n    return <Fragment>\n        <h2>Enums</h2>\n        {enums.map(e => <Fragment key={e.name}>\n            <h3>{e.name} {e.isFlags && <Chip label=\"flags\" size=\"small\" />}</h3>\n            <ul>\n                {Object.keys(e.members).map(en => <li key={en}>{en}: <code>0x{e.members[en].toString(16)}</code></li>)}\n            </ul>\n        </Fragment>)}\n    </Fragment>\n}\n","import React, { Fragment, useContext } from \"react\"\nimport { Link } from \"gatsby-theme-material-ui\"\nimport {\n    serviceSpecificationFromName,\n    isRegister,\n    isEvent,\n    isCommand,\n    isPipeReport,\n    isReportOf,\n    isPipeReportOf,\n} from \"../../jacdac-ts/src/jdom/spec\"\nimport PacketSpecification from \"../components/PacketSpecification\"\nimport IDChip from \"./IDChip\"\nimport Markdown from \"./ui/Markdown\"\nimport EnumSpecification from \"./EnumSpecification\"\nimport { Box, Grid } from \"@material-ui/core\"\nimport ServiceSpecificationStatusAlert from \"./ServiceSpecificationStatusAlert\"\nimport useServiceProviderFromServiceClass from \"./hooks/useServiceProviderFromServiceClass\"\nimport JacdacContext, { JacdacContextProps } from \"../jacdac/Context\"\nimport useChange from \"../jacdac/useChange\"\nimport DashbardDeviceItem from \"./dashboard/DashboardDeviceItem\"\nimport VMBlockEditor from \"./vm/VMBlockEditor\"\nimport PaperBox from \"./ui/PaperBox\"\n\nfunction DashboardServiceDevices(props: { serviceClass: number }) {\n    const { serviceClass } = props\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const devices = useChange(bus, b => b.devices({ serviceClass }))\n    return (\n        <Grid container spacing={1}>\n            {devices.map(device => (\n                <DashbardDeviceItem\n                    key={device.id}\n                    device={device}\n                    showAvatar={true}\n                    showHeader={true}\n                />\n            ))}\n        </Grid>\n    )\n}\n\nexport default function ServiceSpecification(props: {\n    service: jdspec.ServiceSpec\n    showDerived?: boolean\n}) {\n    const { service: node, showDerived } = props\n    const { shortId, name, classIdentifier } = node\n    const packets = node.packets.filter(pkt => showDerived || !pkt.derived)\n    const registers = packets.filter(isRegister)\n    const events = packets.filter(isEvent)\n    const commands = packets.filter(isCommand)\n    const reports = packets.filter(r => r.secondary)\n    const pipeReports = packets.filter(isPipeReport)\n    const others = packets.filter(\n        r =>\n            registers.indexOf(r) < 0 &&\n            events.indexOf(r) < 0 &&\n            commands.indexOf(r) < 0 &&\n            reports.indexOf(r) < 0 &&\n            pipeReports.indexOf(r) < 0\n    )\n    // spin up provider on demand\n    useServiceProviderFromServiceClass(node.classIdentifier)\n\n    const reportOf = (pkt: jdspec.PacketInfo) =>\n        reports.find(rep => isReportOf(pkt, rep))\n    const pipeReportOf = (pkt: jdspec.PacketInfo) =>\n        pipeReports.find(rep => isPipeReportOf(pkt, rep))\n\n    return (\n        <Fragment key={`servicespec${shortId}`}>\n            <h1 key=\"title\">\n                {name}\n                <Box ml={1} component=\"span\">\n                    <IDChip\n                        id={node.classIdentifier}\n                        filter={`srv:${shortId}`}\n                    />\n                </Box>\n            </h1>\n            <ServiceSpecificationStatusAlert specification={node} />\n            <Markdown key=\"notesshort\" source={node.notes.short} />\n            {!!node.extends?.length && (\n                <p key=\"extends\">\n                    <span>Extends </span>\n                    {node.extends.map((extend, i) => (\n                        <Fragment key={`extend${extend}`}>\n                            {i > 0 && <span>, </span>}\n                            <Link\n                                key={`extend${extend}`}\n                                to={`/services/${extend}/`}\n                            >\n                                {serviceSpecificationFromName(extend).name}\n                            </Link>\n                        </Fragment>\n                    ))}\n                    .\n                </p>\n            )}\n            <Markdown key=\"noteslong\" source={node.notes.long || \"\"} />\n            <PaperBox>\n                <VMBlockEditor />\n            </PaperBox>\n            <DashboardServiceDevices serviceClass={classIdentifier} />\n            <EnumSpecification key=\"enums\" serviceClass={classIdentifier} />\n            {[\n                {\n                    name: \"Registers\",\n                    packets: registers,\n                    note: node.notes[\"registers\"],\n                },\n                { name: \"Events\", packets: events, note: node.notes[\"events\"] },\n                {\n                    name: \"Commands\",\n                    packets: commands,\n                    note: node.notes[\"commands\"],\n                },\n                { name: \"Others\", packets: others, note: node.notes[\"others\"] },\n            ]\n                .filter(group => group.packets.length)\n                .map(group => (\n                    <Fragment key={`group${group.name}`}>\n                        <h2>{group.name}</h2>\n                        {group.note && (\n                            <Markdown\n                                key={`node${group.name}`}\n                                source={group.note}\n                            />\n                        )}\n                        {group.packets\n                            .sort(\n                                (l, r) =>\n                                    (l.derived ? 1 : -1) - (r.derived ? 1 : -1)\n                            )\n                            .map((pkt, i) => (\n                                <PacketSpecification\n                                    key={`pkt${pkt.name}`}\n                                    serviceClass={node.classIdentifier}\n                                    packetInfo={pkt}\n                                    reportInfo={reportOf(pkt)}\n                                    pipeReportInfo={pipeReportOf(pkt)}\n                                    showDevices={true}\n                                />\n                            ))}\n                    </Fragment>\n                ))}\n        </Fragment>\n    )\n}\n","import { Grid } from \"@material-ui/core\";\nimport React, { useContext } from \"react\";\nimport { JDDevice } from \"../../../jacdac-ts/src/jdom/device\";\nimport DashboardDevice from \"./DashboardDevice\";\nimport { GridBreakpoints } from \"../useGridBreakpoints\";\nimport { DashboardDeviceProps } from \"./Dashboard\";\nimport useChange from \"../../jacdac/useChange\";\nimport { dashboardServiceWeight } from \"./DashboardServiceWidget\";\nimport AppContext, { DrawerType } from \"../AppContext\";\n\nexport default function DashboardDeviceItem(props: {\n    device: JDDevice,\n    expanded?: boolean,\n    toggleExpanded?: () => void,\n    variant?: \"icon\" | \"\"\n} & DashboardDeviceProps) {\n    const { device, expanded, toggleExpanded, variant, ...other } = props;\n    const { drawerType } = useContext(AppContext)\n    const breakpoints: GridBreakpoints = useChange(device, () => {\n        const breakpointWeight = device.services()\n            .map(srv => {\n                return dashboardServiceWeight(srv)\n                    || (srv.readingRegister || srv.valueRegister || srv.intensityRegister ? 1 : 0)\n            })\n            .reduce((c: number, v) => c + v, 0);\n\n        if (breakpointWeight > 3 || drawerType !== DrawerType.None)\n            return { xs: 12, sm: 12, md: 12, lg: 6, xl: 6 };\n        else if (breakpointWeight == 3)\n            return { xs: 12, sm: 12, md: 4, lg: 4, xl: 4 };\n        else if (breakpointWeight == 2)\n            return { xs: 12, sm: 6, md: 4, lg: 3, xl: 4 };\n        else\n            return { xs: expanded ? 12 : 6, sm: 4, md: 3, lg: 2, xl: \"auto\" };\n    }, [expanded, drawerType]);\n\n    // based on size, expanded or reduce widget size\n    return <Grid item {...breakpoints}>\n        <DashboardDevice\n            device={device}\n            expanded={expanded}\n            toggleExpanded={toggleExpanded}\n            variant={variant}\n            {...other}\n        />\n    </Grid>\n}","import React from \"react\"\nimport { serviceSpecificationFromClassIdentifier } from \"../../jacdac-ts/src/jdom/spec\"\nimport ServiceSpecification from \"../components/ServiceSpecification\"\n\nexport default function Page(props: { pageContext: { node: { classIdentifier: number } } }) {\n    const spec = serviceSpecificationFromClassIdentifier(props.pageContext.node.classIdentifier);\n    return <ServiceSpecification service={spec} />\n}\n"],"sourceRoot":""}