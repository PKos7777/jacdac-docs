{"version":3,"sources":["webpack:///./src/components/dashboard/DashboardPower.tsx"],"names":["DashboardPower","props","service","enabledRegister","register","PowerReg","Enabled","enabled","useRegisterBoolValue","overload","Overload","useRegisterUnpackedValue","BatteryCharge","batteryCharge","host","useServiceServer","color","useWidgetTheme","background","active","textProps","w","h","r","ro","ri","label","mw","bw","hw","rw","toggleEnabled","sendSetBoolAsync","refresh","widgetSize","undefined","Math","floor"],"mappings":"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","file":"116-427d7a0445d8c1c9b3cf.js","sourcesContent":["import React from \"react\"\nimport { PowerReg } from \"../../../jacdac-ts/src/jdom/constants\"\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\"\nimport { useRegisterBoolValue, useRegisterUnpackedValue } from \"../../jacdac/useRegisterValue\"\nimport SvgWidget from \"../widgets/SvgWidget\"\nimport useServiceServer from \"../hooks/useServiceServer\"\nimport ReflectedLightServer from \"../../../jacdac-ts/src/servers/reflectedlightserver\"\nimport PowerButton from \"../widgets/PowerButton\"\nimport useWidgetTheme from \"../widgets/useWidgetTheme\"\n\nexport default function DashboardPower(props: DashboardServiceProps) {\n    const { service } = props\n\n    const enabledRegister = service.register(PowerReg.Enabled)\n    const enabled = useRegisterBoolValue(\n        enabledRegister,\n        props\n    )\n    const overload = useRegisterBoolValue(\n        service.register(PowerReg.Overload),\n        props\n    )\n    const [batteryCharge] = useRegisterUnpackedValue<[number]>(\n        service.register(PowerReg.BatteryCharge),\n        props\n    )\n\n    const host = useServiceServer<ReflectedLightServer>(service)\n    const color = host ? \"secondary\" : \"primary\"\n    const { background, active, textProps } = useWidgetTheme(color)\n\n    const w = 64\n    const h = w\n    const r = (h - 4) >> 1\n    const ro = r - 4\n    const ri = ro - 8\n    const label = overload ? \"overload\" : enabled ? \"on\" : \"off\"\n\n    const mw = 2\n    const bw = 12\n    const hw = 4\n    const rw = mw / 2\n\n    const toggleEnabled = async () => {\n        await enabledRegister.sendSetBoolAsync(!enabled)\n        enabledRegister.refresh()\n    }\n    const widgetSize = `clamp(3rem, 10vw, 16vw)`\n\n    return (\n        <SvgWidget width={w} height={h} size={widgetSize}>\n            <g>\n                <PowerButton\n                    cx={w / 2}\n                    cy={h / 2}\n                    r={ro}\n                    ri={ri}\n                    off={!enabled}\n                    color={color}\n                    aria-label={label}\n                    borderStroke={!!overload && \"red\"}\n                    onClick={toggleEnabled}\n                />\n                {batteryCharge !== undefined && (\n                    <g>\n                        <title>{`battery charge ${Math.floor(\n                            batteryCharge * 100\n                        )}%`}</title>\n                        <rect\n                            x={w - bw - mw}\n                            y={mw}\n                            width={bw * batteryCharge}\n                            height={hw}\n                            rx={rw}\n                            ry={rw}\n                            fill={active}\n                        />\n                        <rect\n                            x={w - bw - mw}\n                            y={mw}\n                            width={bw}\n                            height={hw}\n                            rx={rw}\n                            ry={rw}\n                            fill={\"none\"}\n                            stroke={background}\n                            strokeWidth={1}\n                        />\n                        <text\n                            x={w - 2 * mw}\n                            y={mw + hw / 2}\n                            {...textProps}\n                            textAnchor=\"end\"\n                            fontSize={hw * 0.6}\n                        >\n                            {Math.floor(batteryCharge * 100)}%\n                        </text>\n                    </g>\n                )}\n            </g>\n        </SvgWidget>\n    )\n}\n"],"sourceRoot":""}