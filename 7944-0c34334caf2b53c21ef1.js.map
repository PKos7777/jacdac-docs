{"version":3,"sources":["webpack://jacdac-docs/./node_modules/@material-ui/core/esm/CardActions/CardActions.js","webpack://jacdac-docs/./jacdac-ts/src/jdom/logparser.ts","webpack://jacdac-docs/./src/components/TraceCard.tsx","webpack://jacdac-docs/./src/components/TraceList.tsx","webpack://jacdac-docs/./src/components/useGridBreakpoints.ts"],"names":["parseTrace","contents","description","packets","split","forEach","ln","m","exec","length","push","timestamp","parseInt","data","fromHex","Packet","Trace","join","trim","undefined","parseLogicLog","logcontents","res","frameBytes","lastTime","tm","parseFloat","Uint8Array","info","test","replayLog","bus","frames","speed","arrayConcatMany","map","frame","fromFrame","player","TracePlayer","trace","clear","start","TraceCard","props","name","duration","useContext","PacketsContext","setReplayTrace","toggleTracing","AppContext","setDrawerType","handleClick","DrawerType","prettyDuration","TraceList","gridBreakpoints","useGridBreakpoints","useStaticQuery","traces","allPlainText","nodes","filter","node","parent","ext","content","itemCount","drawerType","xs","sm","md","lg","xl"],"mappings":"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","file":"7944-0c34334caf2b53c21ef1.js","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport withStyles from '../styles/withStyles';\nexport var styles = {\n  /* Styles applied to the root element. */\n  root: {\n    display: 'flex',\n    alignItems: 'center',\n    padding: 8\n  },\n\n  /* Styles applied to the root element if `disableSpacing={false}`. */\n  spacing: {\n    '& > :not(:first-child)': {\n      marginLeft: 8\n    }\n  }\n};\nvar CardActions = /*#__PURE__*/React.forwardRef(function CardActions(props, ref) {\n  var _props$disableSpacing = props.disableSpacing,\n      disableSpacing = _props$disableSpacing === void 0 ? false : _props$disableSpacing,\n      classes = props.classes,\n      className = props.className,\n      other = _objectWithoutProperties(props, [\"disableSpacing\", \"classes\", \"className\"]);\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    className: clsx(classes.root, className, !disableSpacing && classes.spacing),\n    ref: ref\n  }, other));\n});\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nexport default withStyles(styles, {\n  name: 'MuiCardActions'\n})(CardActions);","import { arrayConcatMany, fromHex } from \"./utils\"\nimport { JDBus } from \"./bus\"\nimport Packet from \"./packet\"\nimport TracePlayer from \"./traceplayer\"\nimport Frame from \"./frame\"\nimport Trace from \"./trace\"\n\nexport function parseTrace(contents: string): Trace {\n    const description: string[] = []\n    const packets: Packet[] = []\n    contents?.split(/\\r?\\n/).forEach(ln => {\n        // parse data\n        const m = /(\\d+)\\s+([a-f0-9]{12,})/i.exec(ln)\n        if (!m) {\n            // probably junk data\n            if (packets.length == 0) description.push(ln)\n            return\n        }\n\n        const timestamp = parseInt(m[1])\n        const data = fromHex(m[2])\n        // add to array\n        packets.push(Packet.fromBinary(data, timestamp))\n    })\n    if (packets.length) return new Trace(packets, description.join(\"\\n\").trim())\n    else return undefined\n}\n\nexport function parseLogicLog(logcontents: string): Frame[] {\n    if (!logcontents) return undefined\n\n    const res: Frame[] = []\n    let frameBytes = []\n    let lastTime = 0\n    for (const ln of logcontents.split(/\\r?\\n/)) {\n        let m = /^JD (\\d+) ([0-9a-f]+)/i.exec(ln)\n        if (m) {\n            res.push({\n                timestamp: parseInt(m[1]),\n                data: fromHex(m[2]),\n            })\n            continue\n        }\n\n        /** Windows, logic 1.*\nTime [s],Value,Parity Error,Framing Error\n0.042909760000000,0x00,,Error\n0.042980320000000,0xD4,,\n0.042990240000000,0x81,,\n0.043000160000000,0x10,,\n0.043010240000000,0x00,,\n0.043020160000000,0xE8,,\n0.043030240000000,0xDF,,\n0.043040160000000,0xCB,,\n0.043050240000000,0xD1,,\n0.043060160000000,0x97,,\n0.043070240000000,0x34,,\n0.043080160000000,0x37,,\n0.043090240000000,0x48,,\n0.043100160000000,0x0C,,\n0.043110080000000,0x00,,\n0.043120160000000,0x00,,\n0.043130080000000,0x00,,\n0.043140160000000,0x00,,\n0.043150080000000,0x00,,\n0.043160160000000,0x00,,\n0.043170080000000,0x00,,\n0.043180160000000,0xCA,,\n0.043190080000000,0x1F,,\n0.043200160000000,0xDC,,\n0.043210080000000,0x12,,\n0.043220160000000,0x46,,\n0.043230080000000,0x47,,\n0.043240160000000,0x27,,\n0.043250080000000,0x1F,,\n0.043264800000000,0x00,,Error\n0.063968960000000,0x00,,Error\n         */\n        m = /^([\\d.]+),(?:Async Serial,)?.*(0x[A-F0-9][A-F0-9])/.exec(ln)\n        if (!m) continue\n        const tm = parseFloat(m[1])\n        if (lastTime && tm - lastTime > 0.1) {\n            res.push({\n                timestamp: lastTime * 1000,\n                data: new Uint8Array(frameBytes),\n                info: \"timeout\",\n            })\n            frameBytes = []\n            lastTime = 0\n        }\n\n        lastTime = tm\n        if (/(framing error|Error)/.test(ln)) {\n            if (frameBytes.length > 0)\n                res.push({\n                    timestamp: lastTime * 1000,\n                    data: new Uint8Array(frameBytes),\n                })\n            frameBytes = []\n            lastTime = 0\n        } else {\n            frameBytes.push(parseInt(m[2]))\n        }\n    }\n\n    return res\n}\n\nexport function replayLog(bus: JDBus, frames: Frame[], speed?: number): void {\n    const packets = arrayConcatMany(\n        frames.map(frame => Packet.fromFrame(frame.data, frame.timestamp))\n    )\n    const player = new TracePlayer(bus, speed)\n    player.trace = new Trace(packets)\n    bus.clear(packets[0].timestamp)\n    player.start()\n}\n","import { Button, Card, CardActions, CardContent, CardHeader, Typography } from \"@material-ui/core\";\nimport React, { useContext } from \"react\";\nimport { prettyDuration } from \"../../jacdac-ts/src/jdom/pretty\";\nimport Trace from \"../../jacdac-ts/src/jdom/trace\";\nimport AppContext, { DrawerType } from \"./AppContext\";\nimport Markdown from \"./ui/Markdown\"\nimport PacketsContext from \"./PacketsContext\";\n\nexport default function TraceCard(props: { name: string, trace: Trace }) {\n    const { name, trace } = props;\n    const { description, duration, length } = trace;\n    const { setReplayTrace, toggleTracing } = useContext(PacketsContext)\n    const { setDrawerType } = useContext(AppContext)\n\n    const handleClick = () => {\n        setDrawerType(DrawerType.Packets)\n        setReplayTrace(trace)\n        toggleTracing();\n    }\n\n    return <Card>\n        <CardHeader\n            title={name}\n            subheader={`${prettyDuration(duration)}, ${length} packets`}\n        />\n        <CardContent>\n            {description && <Markdown source={description} />}\n        </CardContent>\n        <CardActions>\n            <Button onClick={handleClick} variant=\"outlined\">import</Button>\n        </CardActions>\n    </Card>\n}","import React from \"react\"\nimport { graphql, useStaticQuery } from \"gatsby\";\nimport { parseTrace } from \"../../jacdac-ts/src/jdom/logparser\"\nimport Trace from \"../../jacdac-ts/src/jdom/trace\";\nimport { Grid } from \"@material-ui/core\";\nimport TraceCard from \"./TraceCard\";\nimport useGridBreakpoints from \"./useGridBreakpoints\"\n\nexport default function TraceList() {\n  const gridBreakpoints = useGridBreakpoints();\n  const data = useStaticQuery(graphql`\n    query {\n        allPlainText {\n          nodes {\n            content\n            parent {\n              ... on File {\n                name\n                ext\n              }\n            }\n          }\n        }\n      }`)\n  const traces: { trace: Trace; name: string }[] = data.allPlainText.nodes\n    .filter(node => node.parent?.ext === \".txt\")\n    .map(node => {\n      return {\n        trace: parseTrace(node.content as string),\n        name: node.parent.name as string\n      }\n    })\n    .filter(trace => !!trace.trace);\n\n  return <Grid container spacing={2}>\n    {traces.map(({ trace, name }) => <Grid item key={name}>\n      <TraceCard name={name} trace={trace} {...gridBreakpoints} />\n    </Grid>)}\n  </Grid >;\n}","import { GridSize } from \"@material-ui/core\"\nimport React, { useContext } from \"react\"\nimport AppContext, { DrawerType } from \"./AppContext\"\n\nexport interface GridBreakpoints {\n    xs?: GridSize,\n    md?: GridSize,\n    sm?: GridSize,\n    lg?: GridSize,\n    xl?: GridSize\n}\n\nexport default function useGridBreakpoints(itemCount?: number): GridBreakpoints {\n    const { drawerType } = useContext(AppContext)\n\n    if (itemCount !== undefined) {\n        switch (itemCount) {\n            case 1:\n            case 2: return { xs: 12, sm: 6, md: 6, lg: 6, xl: 6 }\n            case 3: return { xs: 12, sm: 6, md: 6, lg: 4, xl: 4 }\n        }\n    }\n\n    if (drawerType != DrawerType.None)\n        return { xs: 12, md: 6, sm: 6, lg: 6, xl: 4 }\n    else return {\n        xs: 12,\n        sm: 6,\n        md: 4,\n        lg: 4,\n        xl: 3\n    }\n}"],"sourceRoot":""}