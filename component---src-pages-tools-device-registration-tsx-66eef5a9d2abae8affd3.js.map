{"version":3,"file":"component---src-pages-tools-device-registration-tsx-66eef5a9d2abae8affd3.js","mappings":"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","sources":["webpack://jacdac-docs/./node_modules/@material-ui/icons/Add.js","webpack://jacdac-docs/./node_modules/@material-ui/icons/Check.js","webpack://jacdac-docs/./src/components/AddServiceIconButton.tsx","webpack://jacdac-docs/./src/components/RandomGenerator.tsx","webpack://jacdac-docs/./src/components/hooks/useIdleCallback.ts","webpack://jacdac-docs/./src/components/firmware/useFirmwareBlobs.ts","webpack://jacdac-docs/./src/components/semver.ts","webpack://jacdac-docs/./src/components/useFetch.ts","webpack://jacdac-docs/./src/components/github.ts","webpack://jacdac-docs/./src/components/ui/PaperBox.tsx","webpack://jacdac-docs/./node_modules/@material-ui/lab/esm/Skeleton/Skeleton.js","webpack://jacdac-docs/./src/components/useBlobCanvas.ts","webpack://jacdac-docs/./src/components/ImageImportCanvas.tsx","webpack://jacdac-docs/./src/pages/tools/device-registration.tsx"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\"\n}), 'Add');\n\nexports.default = _default;","\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\n\nvar _default = (0, _createSvgIcon.default)( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"\n}), 'Check');\n\nexports.default = _default;","import React, { useMemo } from \"react\"\nimport { Menu, MenuItem, Typography } from \"@material-ui/core\"\nimport {\n    isInfrastructure,\n    serviceSpecificationFromClassIdentifier,\n    serviceSpecifications,\n} from \"../../jacdac-ts/src/jdom/spec\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport AddIcon from \"@material-ui/icons/Add\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport IconButtonWithTooltip from \"./ui/IconButtonWithTooltip\"\nimport { useId } from \"react-use-id-hook\"\n\nexport default function AddServiceIconButton(props: {\n    onAdd: (service: jdspec.ServiceSpec) => void\n    serviceFilter?: (service: jdspec.ServiceSpec) => boolean\n    error?: string\n    children?: JSX.Element | JSX.Element[]\n}) {\n    const { error, onAdd, children, serviceFilter } = props\n    const [servicesAnchorEl, setServicesAnchorEl] =\n        React.useState<null | HTMLElement>(null)\n    const servicesMenuId = useId()\n    const services = useMemo(\n        () =>\n            serviceSpecifications()\n                .filter(srv => !isInfrastructure(srv))\n                .filter(srv => !serviceFilter || serviceFilter(srv)),\n        [serviceFilter]\n    )\n\n    const handleServiceAddClick = (\n        event: React.MouseEvent<HTMLButtonElement>\n    ) => {\n        setServicesAnchorEl(event.currentTarget)\n    }\n    const handleServiceAddClose = (id: number) => () => {\n        setServicesAnchorEl(null)\n        if (id !== undefined) {\n            const srv = serviceSpecificationFromClassIdentifier(id)\n            onAdd(srv)\n        }\n    }\n\n    return (\n        <>\n            <IconButtonWithTooltip\n                title=\"Add a service\"\n                aria-controls={servicesMenuId}\n                aria-haspopup=\"true\"\n                onClick={handleServiceAddClick}\n            >\n                {children || <AddIcon />}\n            </IconButtonWithTooltip>\n            <Menu\n                id={servicesMenuId}\n                anchorEl={servicesAnchorEl}\n                keepMounted\n                open={Boolean(servicesAnchorEl)}\n                onClose={handleServiceAddClose(undefined)}\n            >\n                {services.map(srv => (\n                    <MenuItem\n                        key={srv.classIdentifier}\n                        value={srv.classIdentifier.toString(16)}\n                        onClick={handleServiceAddClose(srv.classIdentifier)}\n                    >\n                        {srv.name}\n                    </MenuItem>\n                ))}\n            </Menu>\n            <Typography\n                variant=\"caption\"\n                color={error ? \"error\" : \"inherit\"}\n                component=\"div\"\n            >\n                {error || \"Select one or more services.\"}\n            </Typography>\n        </>\n    )\n}\n","import React, { useState } from \"react\"\nimport {\n    deviceSpecificationFromProductIdentifier,\n    serviceSpecificationFromClassIdentifier,\n} from \"../../jacdac-ts/src/jdom/spec\"\nimport {\n    Card,\n    makeStyles,\n    CardContent,\n    CardActions,\n    Typography,\n    createStyles,\n    Input,\n} from \"@material-ui/core\"\n// tslint:disable-next-line: no-submodule-imports match-default-export-name\nimport CheckIcon from \"@material-ui/icons/Check\"\n// tslint:disable-next-line: no-submodule-imports\nimport Alert from \"./ui/Alert\"\nimport { Button } from \"gatsby-theme-material-ui\"\nimport { NoSsr } from \"@material-ui/core\"\nimport { useId } from \"react-use-id-hook\"\nimport { cryptoRandomUint32 } from \"../../jacdac-ts/src/jdom/random\"\nimport { toFullHex } from \"../../jacdac-ts/src/jdom/utils\"\n\nfunction looksRandom(n: number) {\n    const s = n.toString(16)\n    const h = \"0123456789abcdef\"\n    for (let i = 0; i < h.length; ++i) {\n        const hh = h[i]\n        if (s.indexOf(hh + hh + hh) >= 0) return false\n    }\n    if (/f00d|dead|deaf|beef/.test(s)) return false\n    return true\n}\n\nfunction genServId() {\n    const n = cryptoRandomUint32(1)\n    if (n === undefined) return undefined\n    return (n[0] & 0xfff_ffff) | 0x1000_0000\n}\n\nfunction genFirmwareId() {\n    const n = cryptoRandomUint32(1)\n    if (n === undefined) return undefined\n    return (n[0] & 0xfff_ffff) | 0x3000_0000\n}\n\nexport function uniqueServiceId() {\n    let id = genServId()\n    while (\n        id !== undefined &&\n        (!looksRandom(id) || serviceSpecificationFromClassIdentifier(id))\n    ) {\n        id = genServId()\n    }\n    return id !== undefined && toFullHex([id])\n}\n\nexport function uniqueDeviceId() {\n    const n = cryptoRandomUint32(2)\n    return n !== undefined && toFullHex([n[0], n[1]])\n}\n\nexport function uniqueFirmwareId() {\n    let id = genFirmwareId()\n    while (\n        id !== undefined &&\n        (!looksRandom(id) || deviceSpecificationFromProductIdentifier(id))\n    ) {\n        id = genFirmwareId()\n    }\n    return id !== undefined && toFullHex([id])\n}\n\nconst useStyles = makeStyles(\n    createStyles({\n        root: {\n            minWidth: 275,\n            marginBottom: \"1rem\",\n        },\n        title: {\n            fontSize: 14,\n        },\n    })\n)\n\nexport default function RandomGenerator(props: {\n    device?: boolean\n    firmware?: boolean\n}) {\n    const { device, firmware } = props\n    const labelId = useId()\n    const fieldId = useId()\n    const classes = useStyles()\n    const [value, setValue] = useState(\n        device ? uniqueDeviceId() : uniqueServiceId()\n    )\n    const [copySuccess, setCopySuccess] = useState(false)\n\n    const handleRegenerate = () => {\n        const v = device\n            ? uniqueDeviceId()\n            : firmware\n            ? uniqueFirmwareId()\n            : uniqueServiceId()\n        setValue(v)\n        setCopySuccess(false)\n    }\n    const handleCopy = async () => {\n        try {\n            await navigator.clipboard.writeText(value)\n            setCopySuccess(true)\n        } catch (err) {\n            setCopySuccess(false)\n        }\n    }\n    const title = device\n        ? \"Random Device Identifier\"\n        : firmware\n        ? \"Random Product Identifier\"\n        : \"Random Service Identifier\"\n    return (\n        <NoSsr>\n            <Card className={classes.root}>\n                <CardContent>\n                    <Typography\n                        id={labelId}\n                        className={classes.title}\n                        color=\"textSecondary\"\n                        gutterBottom\n                    >\n                        {title}\n                    </Typography>\n                    {value !== undefined && (\n                        <Typography variant=\"h5\" component=\"h2\">\n                            <Input\n                                id={fieldId}\n                                value={value}\n                                readOnly={true}\n                                inputProps={{\n                                    \"aria-labelledby\": labelId,\n                                }}\n                            />\n                            {copySuccess && <CheckIcon />}\n                        </Typography>\n                    )}\n                    {value === undefined && (\n                        <Alert severity=\"error\">\n                            Oops, unable to generate a strong random number.\n                        </Alert>\n                    )}\n                </CardContent>\n                <CardActions>\n                    <Button\n                        aria-label=\"copy random number to clipboard\"\n                        size=\"small\"\n                        variant=\"contained\"\n                        onClick={handleCopy}\n                    >\n                        Copy\n                    </Button>\n                    <Button\n                        aria-label=\"regenerate random number\"\n                        size=\"small\"\n                        variant=\"contained\"\n                        color=\"primary\"\n                        onClick={handleRegenerate}\n                    >\n                        Regenerate\n                    </Button>\n                </CardActions>\n            </Card>\n        </NoSsr>\n    )\n}\n","import { DependencyList, useEffect } from \"react\"\n\ntype RequestIdleCallbackHandle = any;\ntype RequestIdleCallbackOptions = {\n  timeout: number;\n};\ntype RequestIdleCallbackDeadline = {\n  readonly didTimeout: boolean;\n  timeRemaining: (() => number);\n};\n\ndeclare global {\n  interface Window {\n    requestIdleCallback: ((\n      callback: ((deadline: RequestIdleCallbackDeadline) => void),\n      opts?: RequestIdleCallbackOptions,\n    ) => RequestIdleCallbackHandle);\n    cancelIdleCallback: ((handle: RequestIdleCallbackHandle) => void);\n  }\n}\n\nexport default function useIdleCallback(\n    cb: () => void,\n    timeout: number,\n    deps?: DependencyList\n) {\n    useEffect(() => {\n        if (typeof window === \"undefined\" || !cb) return\n\n        if (\"requestIdleCallback\" in window) {\n            const id = window.requestIdleCallback(cb, { timeout })\n            return () => window.cancelIdleCallback(id)\n        } else {\n            const id = setTimeout(cb, timeout)\n            return () => clearTimeout(id)\n        }\n    }, [cb, timeout, ...(deps || [])])\n}\n","import { useCallback, useContext } from \"react\"\nimport JacdacContext, { JacdacContextProps } from \"../../jacdac/Context\"\nimport {\n    FirmwareBlob,\n    parseFirmwareFile,\n} from \"../../../jacdac-ts/src/jdom/flashing\"\nimport DbContext, { DbContextProps } from \"../DbContext\"\nimport { useChangeAsync } from \"../../jacdac/useChange\"\nimport { deviceSpecifications } from \"../../../jacdac-ts/src/jdom/spec\"\nimport { unique } from \"../../../jacdac-ts/src/jdom/utils\"\nimport { fetchLatestRelease, fetchReleaseBinary } from \"../github\"\nimport useIdleCallback from \"../hooks/useIdleCallback\"\n\nexport default function useFirmwareBlobs() {\n    const { bus } = useContext<JacdacContextProps>(JacdacContext)\n    const { db } = useContext<DbContextProps>(DbContext)\n    const firmwares = db?.firmwares\n\n    const loadFirmwares = useCallback(async () => {\n        console.log(`firmware: load`)\n        const names = await firmwares?.list()\n        if (!names) return\n\n        const missingSlugs = unique(\n            deviceSpecifications()\n                .filter(spec => !!spec?.firmwares.length) // needs some firmwares\n                .map(spec => spec.repo)\n                .filter(repo => /^https:\\/\\/github.com\\//.test(repo))\n                .map(repo => repo.substr(\"https://github.com/\".length))\n                .filter(slug => names.indexOf(slug) < 0)\n        )\n        for (const slug of missingSlugs) {\n            console.log(`db: fetch latest release of ${slug}`)\n            const rel = await fetchLatestRelease(slug, {\n                ignoreThrottled: true,\n            })\n            if (!rel?.version) {\n                console.warn(`release not found`)\n                return\n            }\n\n            console.log(\n                `db: fetch binary release ${slug} ${rel.version}`\n            )\n            const fw = await fetchReleaseBinary(slug, rel.version)\n            if (fw) {\n                console.log(\n                    `db: binary release ${slug} ${rel.version} downloaded`\n                )\n                firmwares.set(slug, fw)\n            }\n            // throttle github queries\n            await bus.delay(5000)\n        }\n    }, [db, firmwares]);\n    useIdleCallback(loadFirmwares, 30000, [db, firmwares]);\n    useChangeAsync(\n        firmwares,\n        async fw => {\n            console.log(`firmwares: change`)\n            const names = await fw?.list()\n            console.log(`import stored uf2`, names)\n            const uf2s: FirmwareBlob[] = []\n            if (names?.length) {\n                for (const name of names) {\n                    const blob = await fw.get(name)\n                    const uf2Blobs = await parseFirmwareFile(blob, name)\n                    uf2Blobs?.forEach(uf2Blob => {\n                        uf2s.push(uf2Blob)\n                    })\n                }\n            }\n            bus.firmwareBlobs = uf2s\n        },\n        []\n    )\n\n    return bus.firmwareBlobs\n}\n\nexport function useFirmwareBlob(repoSlug: string) {\n    repoSlug = repoSlug.replace(/^https:\\/\\/github\\.com\\//i, \"\")\n    const { db } = useContext<DbContextProps>(DbContext)\n    const firmwares = db?.firmwares\n\n    const blobs = useChangeAsync(\n        firmwares,\n        async () => {\n            if (!repoSlug) return undefined\n\n            const blob = await firmwares?.get(repoSlug)\n            if (!blob) {\n                return undefined\n            } else {\n                const uf2Blobs = await parseFirmwareFile(blob, repoSlug)\n                return uf2Blobs\n            }\n        },\n        [repoSlug]\n    )\n\n    const setFirmwareFile = async (tag: string, f: Blob) => {\n        await firmwares?.set(repoSlug, f)\n    }\n\n    return {\n        firmwareBlobs: blobs,\n        setFirmwareFile,\n    }\n}\n","interface Version {\n    major: number\n    minor: number\n    patch: number\n    pre: string[]\n    build: string[]\n}\n\nfunction cmp(a: Version, b: Version) {\n    if (!a)\n        if (!b) return 0\n        else return 1\n    else if (!b) return -1\n    else {\n        let d = a.major - b.major || a.minor - b.minor || a.patch - b.patch\n        if (d) return d\n        if (a.pre.length == 0 && b.pre.length > 0) return 1\n        if (a.pre.length > 0 && b.pre.length == 0) return -1\n        for (let i = 0; i < a.pre.length + 1; ++i) {\n            const aa = a.pre[i]\n            const bb = b.pre[i]\n            if (!aa)\n                if (!bb) return 0\n                else return -1\n            else if (!bb) return 1\n            else if (/^\\d+$/.test(aa))\n                if (/^\\d+$/.test(bb)) {\n                    d = parseInt(aa) - parseInt(bb)\n                    if (d) return d\n                } else return -1\n            else if (/^\\d+$/.test(bb)) return 1\n            else {\n                d = strcmp(aa, bb)\n                if (d) return d\n            }\n        }\n        return 0\n    }\n}\n\nfunction tryParse(v: string): Version {\n    if (!v) return null\n    if (\"*\" === v) {\n        return {\n            major: Number.MAX_SAFE_INTEGER,\n            minor: Number.MAX_SAFE_INTEGER,\n            patch: Number.MAX_SAFE_INTEGER,\n            pre: [],\n            build: [],\n        }\n    }\n    if (/^v\\d/i.test(v)) v = v.slice(1)\n    const m = /^(\\d+)\\.(\\d+)\\.(\\d+)(-([0-9a-zA-Z\\-\\.]+))?(\\+([0-9a-zA-Z\\-\\.]+))?$/.exec(\n        v\n    )\n    if (m)\n        return {\n            major: parseInt(m[1]),\n            minor: parseInt(m[2]),\n            patch: parseInt(m[3]),\n            pre: m[5] ? m[5].split(\".\") : [],\n            build: m[7] ? m[7].split(\".\") : [],\n        }\n    return null\n}\n\nfunction strcmp(a: string, b: string) {\n    if (a === b) return 0\n    if (a < b) return -1\n    else return 1\n}\n\nexport function semverCmp(a: string, b: string) {\n    const aa = tryParse(a)\n    const bb = tryParse(b)\n    if (!aa && !bb) return strcmp(a, b)\n    else return cmp(aa, bb)\n}\n","import { useState } from \"react\"\nimport useEffectAsync from \"./useEffectAsync\"\n\nexport default function useFetch<T>(url: RequestInfo, options?: RequestInit) {\n    const [response, setResponse] = useState<T>(undefined)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const [error, setError] = useState<any>(undefined)\n    const [status, setStatus] = useState<number>(undefined)\n    const [loading, setLoading] = useState(true) // start in loading mode\n\n    useEffectAsync(\n        async mounted => {\n            setLoading(true)\n            try {\n                if (!url) {\n                    setStatus(404)\n                    setResponse(undefined)\n                } else {\n                    const res = await fetch(url, options)\n                    if (!mounted()) return\n                    const status = res.status\n                    setStatus(status)\n                    if (status >= 200 && status <= 204) {\n                        const json = await res.json()\n                        if (!mounted()) return\n                        setResponse(json)\n                    }\n                }\n            } catch (error) {\n                if (!mounted()) return\n                setError(error)\n            } finally {\n                if (mounted()) setLoading(false)\n            }\n        },\n        [url]\n    )\n\n    return {\n        response,\n        error,\n        status,\n        loading,\n    }\n}\n","import { useMemo } from \"react\"\nimport { semverCmp } from \"./semver\"\nimport useFetch from \"./useFetch\"\n\nconst ROOT = \"https://api.github.com/\"\nexport const GITHUB_API_KEY = \"githubtoken\"\n\ninterface GithubContent {\n    name: string\n    sha: string\n    size: number\n    html_url: string\n    download_url: string\n    type: \"file\" | \"dir\" | \"symlink\"\n}\n\nexport interface GithubFirmwareRelease {\n    version: string\n    sha: string\n    size: number\n    html_url: string\n    download_url: string\n}\n\nexport interface GithubUser {\n    login: string\n    avatar_url: string\n    html_url: string\n}\n\nexport interface GithubRepository {\n    name: string\n    full_name: string\n    private: boolean\n    owner: GithubUser\n    description: string\n    fork: boolean\n    homepage: string\n    default_branch: string\n    organization: GithubUser\n    html_url: string\n}\n\nfunction contentToFirmwareRelease(\n    content: GithubContent\n): GithubFirmwareRelease {\n    // filter out non-file, non-uf2\n    const version =\n        content?.type === \"file\" &&\n        /^fw-(\\d+\\.\\d+.\\d+)\\.uf2$/.exec(content.name)?.[1]\n    if (!version) return undefined\n\n    return {\n        version,\n        sha: content.sha,\n        size: content.size,\n        html_url: content.html_url,\n        download_url: content.download_url,\n    }\n}\n\nfunction contentsToFirmwareReleases(contents: GithubContent[]) {\n    return contents\n        ?.map(contentToFirmwareRelease)\n        .filter(r => !!r)\n        .sort((l, r) => -semverCmp(l.version, r.version))\n}\n\nexport function normalizeSlug(slug: string) {\n    const cleaned = slug.replace(/^https:\\/\\/github.com\\//, \"\")\n    const parts = cleaned.split(\"/\")\n    return {\n        repoPath: `${parts[0]}/${parts[1]}`,\n        folder: parts.slice(2).join(\"/\"),\n    }\n}\n\nexport interface GitHubApiOptions {\n    ignoreThrottled?: boolean\n}\n\nexport function parseRepoUrl(url: string): { owner: string; name: string } {\n    const m = /^https:\\/\\/github\\.com\\/([^/ \\t]+)\\/([^/ \\t]+)\\/?$/.exec(\n        url || \"\"\n    )\n    if (m) return { owner: m[1], name: m[2] }\n    return undefined\n}\n\nexport async function fetchLatestRelease(\n    slug: string,\n    options?: GitHubApiOptions\n): Promise<GithubFirmwareRelease> {\n    // https://api.github.com/repos/microsoft/jacdac-msr-modules/contents/dist\n    const { repoPath } = normalizeSlug(slug)\n    const uri = `${ROOT}repos/${repoPath}/contents/dist`\n    const resp = await fetch(uri)\n    //    console.log(resp)\n    switch (resp.status) {\n        case 200:\n        case 204: {\n            const contents: GithubContent[] = await resp.json()\n            const releases = contentsToFirmwareReleases(contents)\n            return releases[0]\n        }\n        case 404:\n            // unknow repo or no access\n            return undefined\n        case 403:\n            // throttled\n            if (options?.ignoreThrottled) return undefined\n            throw new Error(\"Too many calls to GitHub, try again later\")\n    }\n    throw new Error(`unknown status code ${resp.status}`)\n}\n\nexport async function fetchReleaseBinary(\n    slug: string,\n    version: string\n): Promise<Blob> {\n    // we are not using the release api because of CORS.\n    const { repoPath } = normalizeSlug(slug)\n    const downloadUrl = `https://raw.githubusercontent.com/${repoPath}/main/dist/fw-${version}.uf2`\n    const req = await fetch(downloadUrl, {\n        headers: { Accept: \"application/octet-stream\" },\n    })\n    if (req.status == 200) {\n        const firmware = await req.blob()\n        return firmware\n    }\n    return undefined\n}\n\nexport async function fetchText(\n    slug: string,\n    tag: string,\n    path: string,\n    mimeType: string\n) {\n    const { repoPath, folder } = normalizeSlug(slug)\n    const downloadUrl = `https://raw.githubusercontent.com/${repoPath}/${tag}/${\n        folder ? `${folder}/` : \"\"\n    }${path}`\n    const req = await fetch(downloadUrl, {\n        headers: { Accept: mimeType },\n    })\n    if (req.status == 200) {\n        const src = await req.text()\n        return src\n    }\n    return undefined\n}\n\nfunction useFetchApi<T>(path: string, options?: GitHubApiOptions) {\n    const res = useFetch<T>(`${ROOT}${path}`)\n    if (res.status !== undefined)\n        switch (res.status) {\n            case 200:\n            case 201:\n            case 202:\n            case 203:\n            case 204:\n                break\n            case 404:\n                // unknow repo or no access\n                res.response = undefined\n                break\n            case 403:\n                // throttled\n                if (options?.ignoreThrottled) {\n                    res.response = undefined\n                    return res\n                } else\n                    throw new Error(\"Too many calls to GitHub, try again later\")\n\n            default:\n                console.log(`unknown status`, res)\n                throw new Error(`Unknown response from GitHub ${res.status}`)\n        }\n    return res\n}\n\nexport function useFetchJSON<T>(\n    slug: string,\n    tag: string,\n    path: string,\n    mimeType: \"text/plain\" | \"application/json\"\n) {\n    const { repoPath, folder } = normalizeSlug(slug)\n    const downloadUrl = `https://raw.githubusercontent.com/${repoPath}/${tag}/${\n        folder ? `${folder}/` : \"\"\n    }${path}`\n    return useFetch<T>(downloadUrl, {\n        headers: { Accept: mimeType },\n    })\n}\n\nexport function useRepository(slug: string) {\n    const { repoPath } = normalizeSlug(slug)\n    const path = `repos/${repoPath}`\n    const res = useFetchApi<GithubRepository>(path, { ignoreThrottled: true })\n    return res\n}\n\nexport function useLatestRelease(slug: string, options?: GitHubApiOptions) {\n    const resp = useLatestReleases(slug, options)\n    return {\n        ...resp,\n        response: resp.response?.[0],\n    }\n}\n\nexport function useLatestReleases(slug: string, options?: GitHubApiOptions) {\n    if (!slug)\n        return {\n            response: undefined,\n            loading: false,\n            error: undefined,\n            status: undefined,\n        }\n    const { repoPath } = normalizeSlug(slug)\n    const uri = `repos/${repoPath}/contents/dist`\n    const res = useFetchApi<GithubContent[]>(uri, {\n        ...(options || {}),\n        ignoreThrottled: true,\n    })\n    return {\n        ...res,\n        response: contentsToFirmwareReleases(res.response),\n    }\n}\n","import { Box, BoxProps, Paper, PaperProps, useTheme } from \"@material-ui/core\";\nimport React from \"react\";\n\nexport default function PaperBox(props: { padding?: number; elevation?: number; bgcolor?: string } & BoxProps) {\n    const { children, padding, elevation, bgcolor, ...others } = props;\n    const theme = useTheme();\n\n    return <Box {...others} bgcolor={bgcolor} mb={theme.spacing(0.25)}>\n        <Paper square elevation={elevation}>\n            {padding !== 0 && <Box p={theme.spacing(padding || 0.25)}>\n                {children}\n            </Box>}\n            {padding === 0 && children}\n        </Paper>\n    </Box>\n}","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport * as React from 'react';\nimport clsx from 'clsx';\nimport { alpha, withStyles } from '@material-ui/core/styles';\nexport var styles = function styles(theme) {\n  return {\n    /* Styles applied to the root element. */\n    root: {\n      display: 'block',\n      // Create a \"on paper\" color with sufficient contrast retaining the color\n      backgroundColor: alpha(theme.palette.text.primary, theme.palette.type === 'light' ? 0.11 : 0.13),\n      height: '1.2em'\n    },\n\n    /* Styles applied to the root element if `variant=\"text\"`. */\n    text: {\n      marginTop: 0,\n      marginBottom: 0,\n      height: 'auto',\n      transformOrigin: '0 60%',\n      transform: 'scale(1, 0.60)',\n      borderRadius: theme.shape.borderRadius,\n      '&:empty:before': {\n        content: '\"\\\\00a0\"'\n      }\n    },\n\n    /* Styles applied to the root element if `variant=\"rect\"`. */\n    rect: {},\n\n    /* Styles applied to the root element if `variant=\"circle\"`. */\n    circle: {\n      borderRadius: '50%'\n    },\n\n    /* Styles applied to the root element if `animation=\"pulse\"`. */\n    pulse: {\n      animation: '$pulse 1.5s ease-in-out 0.5s infinite'\n    },\n    '@keyframes pulse': {\n      '0%': {\n        opacity: 1\n      },\n      '50%': {\n        opacity: 0.4\n      },\n      '100%': {\n        opacity: 1\n      }\n    },\n\n    /* Styles applied to the root element if `animation=\"wave\"`. */\n    wave: {\n      position: 'relative',\n      overflow: 'hidden',\n      '&::after': {\n        animation: '$wave 1.6s linear 0.5s infinite',\n        background: \"linear-gradient(90deg, transparent, \".concat(theme.palette.action.hover, \", transparent)\"),\n        content: '\"\"',\n        position: 'absolute',\n        transform: 'translateX(-100%)',\n        // Avoid flash during server-side hydration\n        bottom: 0,\n        left: 0,\n        right: 0,\n        top: 0\n      }\n    },\n    '@keyframes wave': {\n      '0%': {\n        transform: 'translateX(-100%)'\n      },\n      '60%': {\n        // +0.5s of delay between each loop\n        transform: 'translateX(100%)'\n      },\n      '100%': {\n        transform: 'translateX(100%)'\n      }\n    },\n\n    /* Styles applied when the component is passed children. */\n    withChildren: {\n      '& > *': {\n        visibility: 'hidden'\n      }\n    },\n\n    /* Styles applied when the component is passed children and no width. */\n    fitContent: {\n      maxWidth: 'fit-content'\n    },\n\n    /* Styles applied when the component is passed children and no height. */\n    heightAuto: {\n      height: 'auto'\n    }\n  };\n};\nvar Skeleton = /*#__PURE__*/React.forwardRef(function Skeleton(props, ref) {\n  var _props$animation = props.animation,\n      animation = _props$animation === void 0 ? 'pulse' : _props$animation,\n      classes = props.classes,\n      className = props.className,\n      _props$component = props.component,\n      Component = _props$component === void 0 ? 'span' : _props$component,\n      height = props.height,\n      _props$variant = props.variant,\n      variant = _props$variant === void 0 ? 'text' : _props$variant,\n      width = props.width,\n      other = _objectWithoutProperties(props, [\"animation\", \"classes\", \"className\", \"component\", \"height\", \"variant\", \"width\"]);\n\n  var hasChildren = Boolean(other.children);\n  return /*#__PURE__*/React.createElement(Component, _extends({\n    ref: ref,\n    className: clsx(classes.root, classes[variant], className, hasChildren && [classes.withChildren, !width && classes.fitContent, !height && classes.heightAuto], animation !== false && classes[animation])\n  }, other, {\n    style: _extends({\n      width: width,\n      height: height\n    }, other.style)\n  }));\n});\nprocess.env.NODE_ENV !== \"production\" ? void 0 : void 0;\nexport default withStyles(styles, {\n  name: 'MuiSkeleton'\n})(Skeleton);","import { useState } from \"react\";\nimport useEffectAsync from \"./useEffectAsync\"\n\nfunction readBlobToCanvas(blob: Blob, width: number, height: number): Promise<HTMLCanvasElement> {\n    return new Promise((resolve, reject) => {\n        const url = URL.createObjectURL(blob);\n        const img = new Image();\n        img.onload = () => {\n            URL.revokeObjectURL(url);\n\n            const cvs = document.createElement(\"canvas\");\n            cvs.width = width;\n            cvs.height = height;\n            const ctx = cvs.getContext(\"2d\")\n\n            // compute center of image to be copied into canvas\n            const cw = cvs.width\n            const ch = cvs.height\n            const car = cw / ch\n            const iw = img.width\n            const ih = img.height\n            const iar = iw / ih\n            let sx = 0, sy = 0, sw = iw, sh = ih;\n            if (iar < car) { // image is wider, clip sides\n                const dw = iw - cw;\n                sx = dw >> 1\n                sw = iw - dw\n            } else { // klip top\n                const dh = ih - ch;\n                sy = dh >> 1\n                sh = ih - dh;\n            }\n            ctx.drawImage(img, sx, sy, sw, sh, 0, 0, cw, ch);\n\n            // done\n            resolve(cvs);\n        }\n        img.onerror = () => {\n            // error\n            URL.revokeObjectURL(url);\n            reject(undefined);\n        }\n        img.src = url;\n    })\n}\n\nexport default function useBlobCanvas(blob: Blob, width: number, height: number) {\n    const [canvas, setCanvas] = useState<HTMLCanvasElement>(undefined);\n    useEffectAsync(async () => {\n        if (!blob)\n            setCanvas(undefined);\n        else {\n            try {\n                const cvs = await readBlobToCanvas(blob, width, height);\n                setCanvas(cvs);\n            } catch (e) {\n                setCanvas(undefined)\n            }\n        }\n    }, [blob, width, height])\n    return canvas;\n}","import React, { lazy, useEffect, useMemo, useState } from \"react\"\nimport { Box, createStyles, makeStyles } from \"@material-ui/core\"\nimport { Skeleton } from \"@material-ui/lab\"\nimport useBlobCanvas from \"./useBlobCanvas\"\n\nimport Suspense from \"./ui/Suspense\"\nconst ImportButton = lazy(() => import(\"./ImportButton\"))\n\nconst useStyles = makeStyles(theme =>\n    createStyles({\n        root: {\n            position: \"relative\",\n        },\n        img: {\n            margin: \"auto\",\n            display: \"block\",\n            width: \"100%\",\n        },\n        btn: {\n            position: \"absolute\",\n            borderRadius: \"6rem\",\n            left: \"calc(50% - 2rem)\",\n            top: \"calc(50% - 2rem)\",\n            background: theme.palette.background.paper,\n        },\n    })\n)\n\nexport default function ImportImageCanvas(props: {\n    width: number\n    height: number\n    onImageImported?: (cvs: HTMLCanvasElement) => void\n}) {\n    const { width, height, onImageImported } = props\n    const [imageBlob, setImageBlob] = useState<Blob>(undefined)\n    const canvas = useBlobCanvas(imageBlob, width, height)\n    const canvasUrl = useMemo(() => canvas?.toDataURL(\"image/png\"), [canvas])\n    const classes = useStyles()\n\n    const handleFilesUploaded = async (files: File[]) => {\n        const file = files[0]\n        setImageBlob(file)\n    }\n    // notify of new canvas\n    useEffect(() => canvas && onImageImported(canvas), [canvas])\n\n    return (\n        <div className={classes.root}>\n            <div className={classes.img}>\n                {!canvasUrl && (\n                    <Skeleton variant=\"rect\" width={\"100%\"} height={\"18rem\"} />\n                )}\n                {canvasUrl && (\n                    <img\n                        alt=\"preview\"\n                        src={canvasUrl}\n                        width={\"100%\"}\n                        height={\"100%\"}\n                    />\n                )}\n            </div>\n            <Box className={classes.btn}>\n                <Suspense>\n                    <ImportButton\n                        icon={true}\n                        text=\"Import 4:3 image\"\n                        onFilesUploaded={handleFilesUploaded}\n                        acceptedFiles={[\"image/jpeg\", \"image/png\"]}\n                    />\n                </Suspense>\n            </Box>\n        </div>\n    )\n}\n","import React, { lazy, useMemo, useState } from \"react\"\nimport { Grid, Link } from \"@material-ui/core\"\nimport useLocalStorage from \"../../components/hooks/useLocalStorage\"\nimport { clone, unique } from \"../../../jacdac-ts/src/jdom/utils\"\nimport {\n    Box,\n    Chip,\n    Menu,\n    MenuItem,\n    TextField,\n    Typography,\n    Card,\n    CardActions,\n    Button,\n} from \"@material-ui/core\"\nimport { ChangeEvent } from \"react\"\nimport {\n    deviceSpecifications,\n    serviceSpecificationFromClassIdentifier,\n} from \"../../../jacdac-ts/src/jdom/spec\"\nimport PaperBox from \"../../components/ui/PaperBox\"\nimport { uniqueFirmwareId } from \"../../components/RandomGenerator\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport AddIcon from \"@material-ui/icons/Add\"\n// tslint:disable-next-line: match-default-export-name no-submodule-imports\nimport CreateIcon from \"@material-ui/icons/Create\"\nimport IconButtonWithTooltip from \"../../components/ui/IconButtonWithTooltip\"\nimport { parseRepoUrl } from \"../../components/github\"\nimport {\n    DEVICE_IMAGE_HEIGHT,\n    DEVICE_IMAGE_WIDTH,\n    escapeDeviceIdentifier,\n    escapeDeviceNameIdentifier,\n    normalizeDeviceSpecification,\n} from \"../../../jacdac-ts/jacdac-spec/spectool/jdspec\"\nimport ImportImageCanvas from \"../../components/ImageImportCanvas\"\n// tslint:disable-next-line: no-submodule-imports\nimport { Autocomplete } from \"@material-ui/lab/\"\nimport { useFirmwareBlob } from \"../../components/firmware/useFirmwareBlobs\"\nimport { FirmwareBlob } from \"../../../jacdac-ts/src/jdom/flashing\"\nimport { useId } from \"react-use-id-hook\"\nimport AddServiceIconButton from \"../../components/AddServiceIconButton\"\nimport useDevices from \"../../components/hooks/useDevices\"\nimport DeviceCardHeader from \"../../components/DeviceCardHeader\"\nimport Suspense from \"../../components/ui/Suspense\"\nimport { ControlReg } from \"../../../jacdac-ts/jacdac-spec/dist/specconstants\"\nimport JDDevice from \"../../../jacdac-ts/src/jdom/device\"\nimport useGridBreakpoints from \"../../components/useGridBreakpoints\"\nimport Alert from \"../../components/ui/Alert\"\n\nconst GithubPullRequestButton = lazy(\n    () => import(\"../../components/buttons/GithubPullRequestButton\")\n)\n\nfunction CompanySelect(props: {\n    error?: string\n    value?: string\n    onValueChange?: (name: string) => void\n}) {\n    const { onValueChange, value, error } = props\n    const [company, setCompany] = useState(value)\n    const companies = useMemo(\n        () => unique(deviceSpecifications().map(dev => dev.company)),\n        []\n    )\n    const companyId = useId()\n    const helperText =\n        \"Name of the company manufacturing this device. The company name will be used to generate the module identifier.\"\n\n    const handleChange = (ev: unknown, newValue: string) => {\n        setCompany(newValue)\n        onValueChange?.(newValue)\n    }\n    const renderInputs = params => (\n        <TextField\n            {...params}\n            error={!!error}\n            label=\"Company\"\n            helperText={error || helperText}\n            variant=\"outlined\"\n        />\n    )\n\n    return (\n        <Autocomplete\n            id={companyId}\n            freeSolo={true}\n            fullWidth={true}\n            includeInputInList\n            autoComplete\n            options={companies}\n            renderInput={renderInputs}\n            inputValue={company}\n            aria-label={helperText}\n            onInputChange={handleChange}\n        />\n    )\n}\n\nexport default function DeviceRegistration() {\n    const [device, setDevice] = useLocalStorage<jdspec.DeviceSpec>(\n        \"jacdac:devicedesigner;2\",\n        {\n            id: \"my-device\",\n            name: \"My device\",\n            services: [],\n            productIdentifiers: [],\n            repo: \"\",\n        } as jdspec.DeviceSpec\n    )\n    const gridBreakpoints = useGridBreakpoints()\n    const devices = useDevices({\n        announced: true,\n        physical: true,\n        ignoreSelf: true,\n        productIdentifier: true,\n    })\n    const updateDevice = () => {\n        setDevice(clone(device))\n    }\n    const [firmwaresAnchorEl, setFirmwaresAnchorEl] =\n        React.useState<null | HTMLElement>(null)\n    const [imageBase64, setImageBase64] = useState<string>(undefined)\n    const nameId = useId()\n    const firmwareMenuId = useId()\n    const repoId = useId()\n    const identifierId = useId()\n    const descriptionId = useId()\n    const homepageId = useId()\n    const handleServiceAdd = (srv: jdspec.ServiceSpec) => {\n        console.log(`add`, srv.classIdentifier)\n        device.services.push(srv.classIdentifier)\n        updateDevice()\n    }\n    const companyRepos = useMemo(\n        () =>\n            unique(\n                deviceSpecifications()\n                    .filter(d => d.company === device.company)\n                    .map(d => d.repo)\n                    .filter(repo => !!repo)\n            ),\n        [device?.company]\n    )\n    const { firmwareBlobs } = useFirmwareBlob(device.repo)\n    const variant = \"outlined\"\n    const companyError = !device.company ? \"select a company\" : \"\"\n    const nameError = device.name?.length > 32 ? \"name too long\" : undefined\n    const parsedRepo = parseRepoUrl(device.repo)\n    const githubError = parsedRepo ? \"\" : \"invalid GitHub repository\"\n    const linkError =\n        !device.link || /^https:\\/\\//.test(device.link)\n            ? \"\"\n            : \"Must be https://...\"\n    const idError = !device.id\n        ? \"missing identifier\"\n        : deviceSpecifications().find(dev => dev.id == device.id)\n        ? \"identifer already used\"\n        : \"\"\n    const servicesError = device.services?.length\n        ? \"\"\n        : \"Select at least one service\"\n    const imageError = !imageBase64 ? \"missing image\" : \"\"\n    const ok =\n        !nameError &&\n        parsedRepo &&\n        !linkError &&\n        !idError &&\n        !servicesError &&\n        !imageError &&\n        !companyError\n\n    const route = device.id?.split(\"-\").join(\"/\")\n    const modulePath = ok && `devices/${route}.json`\n    const imagePath = ok && `devices/${route}.jpg`\n\n    const updateDeviceId = () => {\n        const companyid = escapeDeviceIdentifier(device.company)\n        const nameid = escapeDeviceNameIdentifier(device.name)\n        device.id = companyid + \"-\" + nameid\n    }\n\n    const handleNameChange = (ev: ChangeEvent<HTMLInputElement>) => {\n        device.name = ev.target.value\n        updateDeviceId()\n        updateDevice()\n    }\n    const handleRepoChange = (ev: unknown, newValue: string) => {\n        console.log(`new repo`, { newValue })\n        device.repo = newValue\n        updateDevice()\n    }\n    const handleLinkChange = (ev: ChangeEvent<HTMLInputElement>) => {\n        device.link = ev.target.value\n        updateDevice()\n    }\n    const handleDescriptionChange = (ev: ChangeEvent<HTMLInputElement>) => {\n        device.description = ev.target.value\n        updateDevice()\n    }\n    const handleDeleteService = (i: number) => () => {\n        device.services.splice(i, 1)\n        updateDevice()\n    }\n    const handleDeleteFirmware = (i: number) => () => {\n        device.productIdentifiers.splice(i, 1)\n        updateDevice()\n    }\n    const handleFirmwareAddClick = (\n        event: React.MouseEvent<HTMLButtonElement>\n    ) => {\n        setFirmwaresAnchorEl(event.currentTarget)\n        // device.firmwares.push(parseInt(uniqueFirmwareId(), 16))\n        updateDevice()\n    }\n    const handleProductIdentifierAddRandomClick = () => {\n        device.productIdentifiers.push(parseInt(uniqueFirmwareId(), 16))\n        updateDevice()\n    }\n    const handleFirmwareAddClose = (blob: FirmwareBlob) => () => {\n        setFirmwaresAnchorEl(null)\n        const id = blob?.productIdentifier\n        if (id !== undefined) {\n            device.productIdentifiers.push(id)\n            device.name = blob.name\n            updateDeviceId()\n            updateDevice()\n        }\n    }\n    const handleImageImported = (cvs: HTMLCanvasElement) => {\n        const url = cvs.toDataURL(\"image/jpeg\", 99)\n        setImageBase64(url.slice(url.indexOf(\",\")))\n    }\n    const handleCompanyChanged = (value: string) => {\n        device.company = value\n        updateDeviceId()\n        updateDevice()\n    }\n    const renderRepoInput = params => (\n        <TextField\n            {...params}\n            error={!!githubError}\n            type=\"url\"\n            label=\"Firmware repository *\"\n            helperText={\n                githubError ||\n                \"GitHub Repository hosting the firmware binaries.\"\n            }\n            variant=\"outlined\"\n        />\n    )\n    const handleImportDevice = (dev: JDDevice) => async () => {\n        const controlService = dev.service(0)\n        const descrReg = controlService.register(ControlReg.DeviceDescription)\n        await descrReg.refresh(true)\n        const urlReg = controlService.register(ControlReg.DeviceUrl)\n        await urlReg.refresh(true)\n\n        const fw = await dev.resolveProductIdentifier()\n        if (fw) device.productIdentifiers = [fw]\n        device.services = dev.serviceClasses.slice(1)\n        device.description = descrReg.stringValue\n        device.link = urlReg.stringValue\n        updateDevice()\n    }\n\n    return (\n        <>\n            <h1>Device Registration</h1>\n            <p>\n                Compose a device from various services, prepare the metadata and\n                register it to the <Link href=\"/devices/\">Devices catalog</Link>\n                .\n            </p>\n            <Grid container direction=\"row\" spacing={2}>\n                {devices.map(dev => (\n                    <Grid item key={dev.id} {...gridBreakpoints}>\n                        <Card>\n                            <DeviceCardHeader device={dev} />\n                            <CardActions>\n                                <Button\n                                    variant=\"outlined\"\n                                    onClick={handleImportDevice(dev)}\n                                >\n                                    Import\n                                </Button>\n                            </CardActions>\n                        </Card>\n                    </Grid>\n                ))}\n                <Grid item xs={12}>\n                    <TextField\n                        id={nameId}\n                        required\n                        error={!!nameError}\n                        helperText={nameError}\n                        fullWidth={true}\n                        label=\"Name\"\n                        placeholder=\"My module\"\n                        value={device.name || \"\"}\n                        onChange={handleNameChange}\n                        variant={variant}\n                    />\n                </Grid>\n                <Grid item xs={12}>\n                    <Autocomplete\n                        id={repoId}\n                        freeSolo={true}\n                        autoComplete\n                        placeholder=\"https://github.com/...\"\n                        inputValue={device.repo || \"\"}\n                        onInputChange={handleRepoChange}\n                        options={companyRepos}\n                        renderInput={renderRepoInput}\n                    />\n                </Grid>\n                <Grid item xs={12}>\n                    <CompanySelect\n                        value={device?.company}\n                        error={companyError}\n                        onValueChange={handleCompanyChanged}\n                    />\n                </Grid>\n                <Grid item xs={12}>\n                    <PaperBox elevation={1}>\n                        <Typography>Product Identifiers</Typography>\n                        {device.productIdentifiers?.map((id, i) => {\n                            const blob = firmwareBlobs?.find(\n                                b => b.productIdentifier == id\n                            )\n                            return (\n                                <Box\n                                    component=\"span\"\n                                    ml={0.5}\n                                    mb={0.5}\n                                    key={id}\n                                >\n                                    <Chip\n                                        label={\n                                            blob\n                                                ? `${\n                                                      blob.name\n                                                  } (0x${id.toString(16)})`\n                                                : `0x${id.toString(16)}`\n                                        }\n                                        onDelete={handleDeleteFirmware(i)}\n                                    />\n                                </Box>\n                            )\n                        })}\n                        <IconButtonWithTooltip\n                            title=\"Add random product identifier\"\n                            onClick={handleProductIdentifierAddRandomClick}\n                        >\n                            <CreateIcon />\n                        </IconButtonWithTooltip>\n                        {firmwareBlobs && (\n                            <IconButtonWithTooltip\n                                title=\"Add product identifier from repository\"\n                                aria-controls={firmwareMenuId}\n                                aria-haspopup=\"true\"\n                                onClick={handleFirmwareAddClick}\n                            >\n                                <AddIcon />\n                            </IconButtonWithTooltip>\n                        )}\n                        <Menu\n                            id={firmwareMenuId}\n                            anchorEl={firmwaresAnchorEl}\n                            keepMounted\n                            open={Boolean(firmwaresAnchorEl)}\n                            onClose={handleFirmwareAddClose(undefined)}\n                        >\n                            {firmwareBlobs?.map(blob => (\n                                <MenuItem\n                                    key={blob.productIdentifier}\n                                    value={blob.productIdentifier.toString(16)}\n                                    onClick={handleFirmwareAddClose(blob)}\n                                >\n                                    {blob.name}\n                                    <Typography\n                                        variant=\"caption\"\n                                        component=\"span\"\n                                    >\n                                        {blob.version}\n                                    </Typography>\n                                </MenuItem>\n                            ))}\n                        </Menu>\n                        <Typography variant=\"caption\" component=\"div\">\n                            Product identifiers uniquely identify your hardware\n                            on the Jacdac bus. Each revision of your hardware\n                            may have a different identifier.\n                        </Typography>\n                    </PaperBox>\n                </Grid>\n                <Grid item xs={12}>\n                    <PaperBox elevation={1}>\n                        <Typography color={servicesError ? \"error\" : \"inherit\"}>\n                            Services *\n                        </Typography>\n                        {device.services?.map((id, i) => (\n                            <Box component=\"span\" m={0.5} key={id}>\n                                <Chip\n                                    label={\n                                        serviceSpecificationFromClassIdentifier(\n                                            id\n                                        )?.name || id\n                                    }\n                                    onDelete={handleDeleteService(i)}\n                                />\n                            </Box>\n                        ))}\n                        <AddServiceIconButton onAdd={handleServiceAdd} />\n                    </PaperBox>\n                </Grid>\n                <Grid item xs={12}>\n                    <TextField\n                        id={identifierId}\n                        disabled\n                        error={!!idError}\n                        fullWidth={true}\n                        label=\"Identifier\"\n                        helperText={\n                            \"This generated identifer is a URL friendly string created from your company and product name.\"\n                        }\n                        variant={variant}\n                        value={device.id || \"\"}\n                    />\n                </Grid>\n                <Grid item xs={12}>\n                    <TextField\n                        id={descriptionId}\n                        fullWidth={true}\n                        required\n                        label=\"Description\"\n                        multiline={true}\n                        rows={4}\n                        value={device.description || \"\"}\n                        onChange={handleDescriptionChange}\n                        variant={variant}\n                    />\n                </Grid>\n                <Grid item xs={12}>\n                    <TextField\n                        id={homepageId}\n                        label=\"Home page url\"\n                        error={!!linkError}\n                        helperText={linkError}\n                        fullWidth={true}\n                        placeholder=\"https://...\"\n                        value={device.link || \"\"}\n                        onChange={handleLinkChange}\n                        variant={variant}\n                        type=\"url\"\n                    />\n                </Grid>\n                <Grid item xs={12}>\n                    <PaperBox>\n                        <Typography>Catalog image</Typography>\n                        <ImportImageCanvas\n                            width={DEVICE_IMAGE_WIDTH}\n                            height={DEVICE_IMAGE_HEIGHT}\n                            onImageImported={handleImageImported}\n                        />\n                        <Typography variant=\"caption\" component=\"div\">\n                            {`Import a ${DEVICE_IMAGE_WIDTH}x${DEVICE_IMAGE_HEIGHT} image of the device.`}\n                        </Typography>\n                        {imageError && (\n                            <Alert severity=\"error\">{imageError}</Alert>\n                        )}\n                    </PaperBox>\n                </Grid>\n                <Grid item xs={12}>\n                    <Suspense>\n                        <GithubPullRequestButton\n                            label={\"register device\"}\n                            title={`Device: ${device.name}`}\n                            head={`devices/${device.id}`}\n                            description={`This pull request registers a new device for Jacdac.`}\n                            files={\n                                modulePath && {\n                                    [modulePath]: JSON.stringify(\n                                        normalizeDeviceSpecification(device),\n                                        null,\n                                        2\n                                    ),\n                                    [imagePath]: {\n                                        content: imageBase64,\n                                        encoding: \"base64\",\n                                    },\n                                }\n                            }\n                        />\n                    </Suspense>\n                </Grid>\n            </Grid>\n        </>\n    )\n}\n"],"names":["React","useMemo","Menu","MenuItem","Typography","isInfrastructure","serviceSpecificationFromClassIdentifier","serviceSpecifications","AddIcon","IconButtonWithTooltip","useId","AddServiceIconButton","props","error","onAdd","children","serviceFilter","servicesAnchorEl","setServicesAnchorEl","useState","servicesMenuId","services","filter","srv","handleServiceAddClick","event","currentTarget","handleServiceAddClose","id","undefined","Boolean","map","classIdentifier","toString","name","deviceSpecificationFromProductIdentifier","Card","makeStyles","CardContent","CardActions","createStyles","Input","CheckIcon","Alert","Button","NoSsr","cryptoRandomUint32","toFullHex","looksRandom","n","s","h","i","length","hh","indexOf","test","genServId","genFirmwareId","uniqueServiceId","uniqueDeviceId","uniqueFirmwareId","useStyles","root","minWidth","marginBottom","title","fontSize","RandomGenerator","device","firmware","labelId","fieldId","classes","value","setValue","copySuccess","setCopySuccess","handleRegenerate","v","handleCopy","navigator","clipboard","writeText","err","useEffect","useIdleCallback","cb","timeout","deps","window","requestIdleCallback","cancelIdleCallback","setTimeout","clearTimeout","useCallback","useContext","JacdacContext","parseFirmwareFile","DbContext","useChangeAsync","deviceSpecifications","unique","fetchLatestRelease","fetchReleaseBinary","useFirmwareBlobs","bus","db","firmwares","loadFirmwares","console","log","names","list","missingSlugs","spec","repo","substr","slug","rel","ignoreThrottled","version","warn","fw","set","delay","uf2s","blob","get","uf2Blobs","forEach","uf2Blob","push","firmwareBlobs","useFirmwareBlob","repoSlug","replace","blobs","setFirmwareFile","tag","f","cmp","a","b","d","major","minor","patch","pre","aa","bb","parseInt","strcmp","tryParse","Number","MAX_SAFE_INTEGER","build","slice","m","exec","split","semverCmp","useEffectAsync","useFetch","url","options","response","setResponse","setError","status","setStatus","loading","setLoading","mounted","res","fetch","json","ROOT","GITHUB_API_KEY","contentToFirmwareRelease","content","type","sha","size","html_url","download_url","contentsToFirmwareReleases","contents","r","sort","l","normalizeSlug","cleaned","parts","repoPath","folder","join","parseRepoUrl","owner","uri","resp","releases","Error","downloadUrl","req","headers","Accept","fetchText","path","mimeType","src","text","useFetchApi","useFetchJSON","useRepository","useLatestRelease","useLatestReleases","Box","Paper","useTheme","PaperBox","padding","elevation","bgcolor","others","theme","spacing","readBlobToCanvas","width","height","Promise","resolve","reject","URL","createObjectURL","img","Image","onload","revokeObjectURL","cvs","document","createElement","ctx","getContext","cw","ch","car","iw","ih","iar","sx","sy","sw","sh","dw","dh","drawImage","onerror","useBlobCanvas","canvas","setCanvas","e","lazy","Skeleton","Suspense","ImportButton","position","margin","display","btn","borderRadius","left","top","background","palette","paper","ImportImageCanvas","onImageImported","imageBlob","setImageBlob","canvasUrl","toDataURL","handleFilesUploaded","files","file","Grid","Link","useLocalStorage","clone","Chip","TextField","CreateIcon","DEVICE_IMAGE_HEIGHT","DEVICE_IMAGE_WIDTH","escapeDeviceIdentifier","escapeDeviceNameIdentifier","normalizeDeviceSpecification","Autocomplete","useDevices","DeviceCardHeader","ControlReg","useGridBreakpoints","GithubPullRequestButton","CompanySelect","onValueChange","company","setCompany","companies","dev","companyId","helperText","handleChange","ev","newValue","renderInputs","params","DeviceRegistration","setDevice","productIdentifiers","gridBreakpoints","devices","announced","physical","ignoreSelf","productIdentifier","updateDevice","firmwaresAnchorEl","setFirmwaresAnchorEl","imageBase64","setImageBase64","nameId","firmwareMenuId","repoId","identifierId","descriptionId","homepageId","handleServiceAdd","companyRepos","variant","companyError","nameError","parsedRepo","githubError","linkError","link","idError","find","servicesError","imageError","ok","route","modulePath","imagePath","updateDeviceId","companyid","nameid","handleNameChange","target","handleRepoChange","handleLinkChange","handleDescriptionChange","description","handleDeleteService","splice","handleDeleteFirmware","handleFirmwareAddClick","handleProductIdentifierAddRandomClick","handleFirmwareAddClose","handleImageImported","handleCompanyChanged","renderRepoInput","handleImportDevice","controlService","service","descrReg","register","DeviceDescription","refresh","urlReg","DeviceUrl","resolveProductIdentifier","serviceClasses","stringValue","JSON","stringify","encoding"],"sourceRoot":""}