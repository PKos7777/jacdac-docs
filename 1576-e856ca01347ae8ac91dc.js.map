{"version":3,"sources":["webpack://jacdac-docs/./src/components/dashboard/DashboardPower.tsx"],"names":["DashboardPower","props","service","enabledRegister","useRegister","PowerReg","overloadRegister","batteryChargeRegister","enabled","useRegisterBoolValue","overload","useRegisterUnpackedValue","batteryCharge","server","useServiceServer","color","useWidgetTheme","background","active","textProps","w","h","r","ro","ri","label","mw","bw","hw","rw","toggleEnabled","sendSetBoolAsync","widgetSize","undefined","Math","floor"],"mappings":"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","file":"1576-e856ca01347ae8ac91dc.js","sourcesContent":["import React from \"react\"\nimport { PowerReg } from \"../../../jacdac-ts/src/jdom/constants\"\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\"\nimport {\n    useRegisterBoolValue,\n    useRegisterUnpackedValue,\n} from \"../../jacdac/useRegisterValue\"\nimport SvgWidget from \"../widgets/SvgWidget\"\nimport useServiceServer from \"../hooks/useServiceServer\"\nimport ReflectedLightServer from \"../../../jacdac-ts/src/servers/reflectedlightserver\"\nimport PowerButton from \"../widgets/PowerButton\"\nimport useWidgetTheme from \"../widgets/useWidgetTheme\"\nimport useRegister from \"../hooks/useRegister\"\n\nexport default function DashboardPower(props: DashboardServiceProps) {\n    const { service } = props\n\n    const enabledRegister = useRegister(service, PowerReg.Enabled)\n    const overloadRegister = useRegister(service, PowerReg.Overload)\n    const batteryChargeRegister = useRegister(service, PowerReg.BatteryCharge)\n\n    const enabled = useRegisterBoolValue(enabledRegister, props)\n    const overload = useRegisterBoolValue(overloadRegister, props)\n    const [batteryCharge] = useRegisterUnpackedValue<[number]>(\n        batteryChargeRegister,\n        props\n    )\n\n    const server = useServiceServer<ReflectedLightServer>(service)\n    const color = server ? \"secondary\" : \"primary\"\n    const { background, active, textProps } = useWidgetTheme(color)\n\n    const w = 64\n    const h = w\n    const r = (h - 4) >> 1\n    const ro = r - 4\n    const ri = ro - 8\n    const label = overload ? \"overload\" : enabled ? \"on\" : \"off\"\n\n    const mw = 2\n    const bw = 12\n    const hw = 4\n    const rw = mw / 2\n\n    const toggleEnabled = () => enabledRegister.sendSetBoolAsync(!enabled, true)\n    const widgetSize = `clamp(3rem, 10vw, 16vw)`\n\n    return (\n        <SvgWidget width={w} height={h} size={widgetSize}>\n            <g>\n                <PowerButton\n                    cx={w / 2}\n                    cy={h / 2}\n                    r={ro}\n                    ri={ri}\n                    off={!enabled}\n                    color={color}\n                    aria-label={label}\n                    borderStroke={!!overload && \"red\"}\n                    onClick={toggleEnabled}\n                />\n                {batteryCharge !== undefined && (\n                    <g>\n                        <title>{`battery charge ${Math.floor(\n                            batteryCharge * 100\n                        )}%`}</title>\n                        <rect\n                            x={w - bw - mw}\n                            y={mw}\n                            width={bw * batteryCharge}\n                            height={hw}\n                            rx={rw}\n                            ry={rw}\n                            fill={active}\n                        />\n                        <rect\n                            x={w - bw - mw}\n                            y={mw}\n                            width={bw}\n                            height={hw}\n                            rx={rw}\n                            ry={rw}\n                            fill={\"none\"}\n                            stroke={background}\n                            strokeWidth={1}\n                        />\n                        <text\n                            x={w - 2 * mw}\n                            y={mw + hw / 2}\n                            {...textProps}\n                            textAnchor=\"end\"\n                            fontSize={hw * 0.6}\n                        >\n                            {Math.floor(batteryCharge * 100)}%\n                        </text>\n                    </g>\n                )}\n            </g>\n        </SvgWidget>\n    )\n}\n"],"sourceRoot":""}