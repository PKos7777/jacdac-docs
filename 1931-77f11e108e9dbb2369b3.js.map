{"version":3,"file":"1931-77f11e108e9dbb2369b3.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAIe,SAASE,gBAAT,CAEbC,OAFa,EAEOC,OAFP,EAEwD;AACnE,MAAM;AAAA,OAACC,MAAD;AAAA,OAASC;AAAT,MAAsBL,kBAAQ,CAAiBM,SAAjB,CAApC;AAEAP,EAAAA,mBAAS,CAAC,MAAM;AACZ,QAAMQ,CAAC,GAAGL,OAAO,IAAIC,OAAO,CAACD,OAAD,CAA5B;AACAG,IAAAA,SAAS,CAACE,CAAD,CAAT;AACA,WAAO,MAAMA,CAAN,aAAMA,CAAN,uBAAMA,CAAC,CAAEC,OAAH,EAAb;AACH,GAJQ,EAIN,CAACN,OAAD,EAAUC,OAAV,CAJM,CAAT;AAMA,SAAOC,MAAP;AACH;;;;;;;;;;;;;;;;;;;;;AChBD;AAUA;AAGA;AACA;AACA;AAEO,IAAMgB,uBAAb;AAAA;;AAKI,mCAAYlB,OAAZ,EAAgC;AAAA;;AAC5B,wCAAMA,OAAN;AACAiB,IAAAA,wBAAM,CAACjB,OAAO,CAACmB,YAAR,KAAyBN,2CAA1B,CAAN,CAF4B,CAI5B;;AACA,UAAKO,eAAL,GAAuB,MAAKpB,OAAL,CAAaqB,QAAb,CACnBZ,uDADmB,CAAvB;AAGA,UAAKc,wBAAL,GAAgC,MAAKvB,OAAL,CAAaqB,QAAb,CAC5BZ,yEAD4B,CAAhC;AAGA,UAAKgB,kBAAL,GAA0B,MAAKzB,OAAL,CAAaqB,QAAb,CACtBZ,6DADsB,CAA1B;;AAGA,UAAKkB,KAAL,CAAW,MACP,MAAKP,eAAL,CAAqBQ,SAArB,CAA+BhB,gCAA/B,EAA8C,MAC1C,MAAKiB,IAAL,CAAUnB,yBAAV,CADJ,CADJ;;AAKA,UAAKiB,KAAL,CAAW,MACP,MAAKJ,wBAAL,CAA8BK,SAA9B,CAAwChB,gCAAxC,EAAuD,MACnD,MAAKiB,IAAL,CAAUnB,yBAAV,CADJ,CADJ;;AAKA,UAAKiB,KAAL,CAAW,MACP,MAAKF,kBAAL,CAAwBG,SAAxB,CAAkChB,gCAAlC,EAAiD,MAC7C,MAAKiB,IAAL,CAAUnB,yBAAV,CADJ,CADJ;;AAKA,UAAKiB,KAAL,CAAW,MACP,MAAK3B,OAAL,CACK8B,KADL,CACWtB,uFADX,EAEKwB,EAFL,CAEQrB,wBAFR,EAEe,MAAM;AACb,YAAKY,wBAAL,CAA8BU,OAA9B;;AACA,YAAKJ,IAAL,CAAUnB,yBAAV;AACH,KALL,CADJ;;AA7B4B;AAqC/B;;AA1CL;;AAAA,SAgEUwB,OAhEV;AAAA,uDAgEI,aAAgB;AACZ,YAAM,KAAKlC,OAAL,CAAamC,YAAb,CACF5B,uDADE,EAEFH,SAFE,EAGF,IAHE,CAAN;AAKH,KAtEL;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA,SAwEUiC,UAxEV;AAAA,0DAwEI,aAAmB;AACf,YAAM,KAAKrC,OAAL,CAAamC,YAAb,CACF5B,6DADE,EAEFH,SAFE,EAGF,IAHE,CAAN;AAKH,KA9EL;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA,SAgFUmC,QAhFV;AAAA,wDAgFI,WAAeC,QAAf,EAAiC;AAC7B,YAAM,KAAKxC,OAAL,CAAamC,YAAb,CACF5B,yDADE,EAEFS,8BAAa,CAACwB,QAAD,CAFX,EAGF,IAHE,CAAN;AAKH,KAtFL;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA,SAwFUE,KAxFV;AAAA,qDAwFI,WAAYF,QAAZ,EAA8B;AAC1B,YAAM,KAAKxC,OAAL,CAAamC,YAAb,CACF5B,mDADE,EAEFS,8BAAa,CAACwB,QAAD,CAFX,EAGF,IAHE,CAAN;AAKH,KA9FL;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA,SAgGUI,IAhGV;AAAA,oDAgGI,WAAWC,KAAX,EAA0B;AACtB,UAAMC,IAAI,GAAGhC,uBAAM,CAAW,KAAX,EAAkB,CAAC+B,KAAD,CAAlB,CAAnB;AACA,YAAM,KAAK7C,OAAL,CAAamC,YAAb,CAA0B5B,iDAA1B,EAAqDuC,IAArD,EAA2D,IAA3D,CAAN;AACH,KAnGL;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA,SA4CI,eAAc;AACV,aAAO,KAAK1B,eAAL,CAAqB4B,WAA5B;AACH;AA9CL;AAAA;AAAA,SAgDI,eAA0D;AAAA;;AACtD,UAAMC,GAAG,GAAG,KAAK1B,wBAAjB;AACA,mCAAO0B,GAAG,CAACC,aAAX,uDAAO,mBAAoB,CAApB,CAAP;AACH;AAnDL;AAAA;AAAA,SAqDI,eAAiB;AACb,UAAM,CAACC,OAAD,EAAUrB,KAAV,EAAiBsB,YAAjB,EAA+BC,WAA/B,IACF,KAAK5B,kBAAL,CAAwByB,aAD5B;AAEA,aAAO;AACHC,QAAAA,OADG;AAEHrB,QAAAA,KAFG;AAGHsB,QAAAA,YAHG;AAIHC,QAAAA;AAJG,OAAP;AAMH;AA9DL;;AAAA;AAAA,EAA6CtC,oCAA7C;AAqGA,4DAAeG,uBAAf;;;;;;;;ACtHA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEe,SAAS6C,0BAAT,CACXC,KADW,EAEb;AACE,MAAM;AAAEhE,IAAAA;AAAF,MAAcgE,KAApB;AACA,MAAMC,SAAS,GAAGH,uCAAK,EAAvB;AAEA,MAAM7D,OAAO,GAAGsD,qBAAW,CAACW,GAAG,IAAI,IAAIhD,uBAAJ,CAA4BgD,GAA5B,CAAR,EAA0C,EAA1C,CAA3B;AACA,MAAMhE,MAAM,GAAGH,gBAAgB,CAACC,OAAD,EAAUC,OAAV,CAA/B;AACA,MAAMkE,OAAO,GAAGR,4BAAS,CAACzD,MAAD,EAASkE,CAAC,IAAIA,CAAJ,aAAIA,CAAJ,uBAAIA,CAAC,CAAED,OAAjB,CAAzB;AACA,MAAME,gBAAgB,GAAGV,4BAAS,CAACzD,MAAD,EAASkE,CAAC,IAAIA,CAAJ,aAAIA,CAAJ,uBAAIA,CAAC,CAAEC,gBAAjB,CAAlC;AACA,MAAMC,KAAK,GAAG,SAAd;AACA,MAAM;AAAEC,IAAAA;AAAF,MAAkBX,iCAAc,CAACU,KAAD,CAAtC;AACA,MAAME,SAAS,GACXH,gBAAgB,KAAKR,4EADzB;AAGA,sBACI,oBAAC,mBAAD;AACI,aAAS,MADb;AAEI,WAAO,EAAE,CAFb;AAGI,SAAK,EAAE;AAAES,MAAAA,KAAK,EAAEC,WAAT;AAAsBG,MAAAA,QAAQ,EAAE;AAAhC;AAHX,kBAKI,oBAAC,mBAAD;AAAM,QAAI,MAAV;AAAW,MAAE,EAAE;AAAf,kBACI,oBAAC,yBAAD;AAAY,aAAS,EAAC,MAAtB;AAA6B,WAAO,EAAC;AAArC,cACUP,OADV,CADJ,eAII,oBAAC,qBAAD;AAAQ,WAAO,EAAEK,SAAjB;AAA4B,uBAAiBP;AAA7C,IAJJ,eAKI;AAAO,aAAS,EAAC,oBAAjB;AAAsC,MAAE,EAAEA;AAA1C,KACKJ,wDAAiC,CAACQ,gBAAD,CADtC,CALJ,CALJ,CADJ;AAiBH","sources":["webpack://jacdac-docs/./src/jacdac/useServiceClient.ts","webpack://jacdac-docs/./jacdac-ts/src/clients/azureiothubhealthclient.ts","webpack://jacdac-docs/./src/components/dashboard/DashboardAzureIoTHubHealth.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\"\nimport JDService from \"../../jacdac-ts/src/jdom/service\"\nimport { JDServiceClient } from \"../../jacdac-ts/src/jdom/serviceclient\"\n\nexport default function useServiceClient<\n    TServiceClient extends JDServiceClient\n>(service: JDService, factory: (service: JDService) => TServiceClient) {\n    const [client, setClient] = useState<TServiceClient>(undefined)\n\n    useEffect(() => {\n        const c = service && factory(service)\n        setClient(c)\n        return () => c?.unmount()\n    }, [service, factory])\n\n    return client\n}\n","import {\n    AzureIotHubHealthCmd,\n    AzureIotHubHealthConnectionStatus,\n    AzureIotHubHealthEvent,\n    AzureIotHubHealthReg,\n    CHANGE,\n    EVENT,\n    REPORT_UPDATE,\n    SRV_AZURE_IOT_HUB_HEALTH,\n} from \"../jdom/constants\"\nimport { jdpack } from \"../jdom/pack\"\nimport JDRegister from \"../jdom/register\"\nimport JDService from \"../jdom/service\"\nimport { JDServiceClient } from \"../jdom/serviceclient\"\nimport { parseDeviceId } from \"../jdom/spec\"\nimport { assert } from \"../jdom/utils\"\n\nexport class AzureIoTHubHealthClient extends JDServiceClient {\n    private readonly hubNameRegister: JDRegister\n    private readonly connectionStatusRegister: JDRegister\n    private readonly statisticsRegister: JDRegister\n\n    constructor(service: JDService) {\n        super(service)\n        assert(service.serviceClass === SRV_AZURE_IOT_HUB_HEALTH)\n\n        // tell the bus to refresh these register\n        this.hubNameRegister = this.service.register(\n            AzureIotHubHealthReg.HubName\n        )\n        this.connectionStatusRegister = this.service.register(\n            AzureIotHubHealthReg.ConnectionStatus\n        )\n        this.statisticsRegister = this.service.register(\n            AzureIotHubHealthReg.Statistics\n        )\n        this.mount(() =>\n            this.hubNameRegister.subscribe(REPORT_UPDATE, () =>\n                this.emit(CHANGE)\n            )\n        )\n        this.mount(() =>\n            this.connectionStatusRegister.subscribe(REPORT_UPDATE, () =>\n                this.emit(CHANGE)\n            )\n        )\n        this.mount(() =>\n            this.statisticsRegister.subscribe(REPORT_UPDATE, () =>\n                this.emit(CHANGE)\n            )\n        )\n        this.mount(() =>\n            this.service\n                .event(AzureIotHubHealthEvent.ConnectionStatusChange)\n                .on(EVENT, () => {\n                    this.connectionStatusRegister.refresh()\n                    this.emit(CHANGE)\n                })\n        )\n    }\n\n    get hubName() {\n        return this.hubNameRegister.stringValue\n    }\n\n    get connectionStatus(): AzureIotHubHealthConnectionStatus {\n        const reg = this.connectionStatusRegister\n        return reg.unpackedValue?.[0] as AzureIotHubHealthConnectionStatus\n    }\n\n    get statistics() {\n        const [reading, event, twinReported, twinDesired] =\n            this.statisticsRegister.unpackedValue\n        return {\n            reading,\n            event,\n            twinReported,\n            twinDesired,\n        }\n    }\n\n    async connect() {\n        await this.service.sendCmdAsync(\n            AzureIotHubHealthCmd.Connect,\n            undefined,\n            true\n        )\n    }\n\n    async disconnect() {\n        await this.service.sendCmdAsync(\n            AzureIotHubHealthCmd.Disconnect,\n            undefined,\n            true\n        )\n    }\n\n    async identify(deviceId: string) {\n        await this.service.sendCmdAsync(\n            AzureIotHubHealthCmd.Identify,\n            parseDeviceId(deviceId),\n            true\n        )\n    }\n\n    async reset(deviceId: string) {\n        await this.service.sendCmdAsync(\n            AzureIotHubHealthCmd.Reset,\n            parseDeviceId(deviceId),\n            true\n        )\n    }\n\n    async ping(value: number) {\n        const data = jdpack<[number]>(\"u32\", [value])\n        await this.service.sendCmdAsync(AzureIotHubHealthCmd.Ping, data, true)\n    }\n}\nexport default AzureIoTHubHealthClient\n","import React, { useCallback } from \"react\"\nimport { DashboardServiceProps } from \"./DashboardServiceWidget\"\nimport { Grid, Switch, Typography } from \"@material-ui/core\"\nimport useChange from \"../../jacdac/useChange\"\nimport useServiceClient from \"../../jacdac/useServiceClient\"\nimport AzureIoTHubHealthClient from \"../../../jacdac-ts/src/clients/azureiothubhealthclient\"\nimport useWidgetTheme from \"../widgets/useWidgetTheme\"\nimport { AzureIotHubHealthConnectionStatus } from \"../../../jacdac-ts/jacdac-spec/dist/specconstants\"\nimport { useId } from \"react-use-id-hook\"\n\nexport default function DashboardAzureIoTHubHealth(\n    props: DashboardServiceProps\n) {\n    const { service } = props\n    const connectId = useId()\n\n    const factory = useCallback(srv => new AzureIoTHubHealthClient(srv), [])\n    const client = useServiceClient(service, factory)\n    const hubName = useChange(client, _ => _?.hubName)\n    const connectionStatus = useChange(client, _ => _?.connectionStatus)\n    const color = \"primary\"\n    const { textPrimary } = useWidgetTheme(color)\n    const connected =\n        connectionStatus === AzureIotHubHealthConnectionStatus.Connected\n\n    return (\n        <Grid\n            container\n            spacing={1}\n            style={{ color: textPrimary, minWidth: \"16rem\" }}\n        >\n            <Grid item xs={12}>\n                <Typography component=\"span\" variant=\"subtitle1\">\n                    hub: {hubName}\n                </Typography>\n                <Switch checked={connected} aria-labelledby={connectId} />\n                <label className=\".no-pointer-events\" id={connectId}>\n                    {AzureIotHubHealthConnectionStatus[connectionStatus]}\n                </label>\n            </Grid>\n        </Grid>\n    )\n}\n"],"names":["useEffect","useState","useServiceClient","service","factory","client","setClient","undefined","c","unmount","AzureIotHubHealthCmd","AzureIotHubHealthEvent","AzureIotHubHealthReg","CHANGE","EVENT","REPORT_UPDATE","SRV_AZURE_IOT_HUB_HEALTH","jdpack","JDServiceClient","parseDeviceId","assert","AzureIoTHubHealthClient","serviceClass","hubNameRegister","register","HubName","connectionStatusRegister","ConnectionStatus","statisticsRegister","Statistics","mount","subscribe","emit","event","ConnectionStatusChange","on","refresh","connect","sendCmdAsync","Connect","disconnect","Disconnect","identify","deviceId","Identify","reset","Reset","ping","value","data","Ping","stringValue","reg","unpackedValue","reading","twinReported","twinDesired","React","useCallback","Grid","Switch","Typography","useChange","useWidgetTheme","AzureIotHubHealthConnectionStatus","useId","DashboardAzureIoTHubHealth","props","connectId","srv","hubName","_","connectionStatus","color","textPrimary","connected","Connected","minWidth"],"sourceRoot":""}